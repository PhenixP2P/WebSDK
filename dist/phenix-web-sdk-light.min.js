/**
 * Copyright 2019 Phenix Real Time Solutions, Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("phenix-web-sdk",[],e):"object"==typeof exports?exports["phenix-web-sdk"]=e():t["phenix-web-sdk"]=e()}(window,function(){return e={},f.m=d=[function(t,e,i){var n,r;n=[i(33)],void 0===(r=function(t){"use strict";return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(35)],void 0===(r=function(t){return t}.apply(e,n))||(t.exports=r)},function(J,K,L){var Q,R,S,T,U,V,W,Y;function X(t){if(Y[t])return Y[t].exports;var e=Y[t]={i:t,l:!1,exports:{}};return W[t].call(e.exports,e,e.exports,X),e.l=!0,e.exports}J.exports=(Q=L(0),R=L(18),S=L(1),T=L(3),U=L(7),V=L(4),W=[function(i,n,t){(function(t){var e;void 0===(e=function(){"use strict";return"object"==typeof window?window:"object"==typeof t?t:{}}.apply(n,[]))||(i.exports=e)}).call(n,t(5))},function(t,e){t.exports=Q},function(t,e){t.exports=R},function(t,e,i){var n,r;n=[i(1),i(7),i(4),i(0),i(13)],void 0===(r=function(o,h,a,u,c){"use strict";function t(t,e,i,n){var r=this;this.e=t,this.a=e,this.u="phenix"===i,this.h="flash"===i,this.f=n||{},this.v={},this.g=new h.DisposableList,this.y=null;function s(t){r.w=!0,r.b=!0===t,t?f.call(r):p("Failed to create Phenix video element"),r.k&&r.k(r.b)}try{if(this.S=function(){var t=document.createElement("video");if(this.u&&((t=document.createElement("object")).type="application/x-phenix-video"),this.h){this.y=new c(this.e,this.a,this.f);var e=this;this.g.add(new h.Disposable(function(){e.y.destroy()})),t=this.y.getElement()}return t}.call(this),this.S.className=this.e.className,this.S.height=this.e.height,this.S.width=this.e.width,this.I=this.e.style.cssText,this.e.style.cssText="visibility:hidden !important;width:0px !important;height:0px !important;margin:0px !important;padding:0px !important;border-style:none !important;border-width:0px !important;max-width:0px !important;max-height:0px !important;outline:none !important",this.g.add(new h.Disposable(function(){r.e.style.cssText=r.I})),this.S.onunload=function(){r.w=!1},function(){var n=this;if(o.get(u,["MutationObserver"])){var t=new MutationObserver(function(t){t.forEach(function(t){if("childList"===t.type)for(var e=0;e<t.addedNodes.length;e++){var i=t.addedNodes[e];t.target!==n.S&&(i===n.e?(t.target.replaceChild(n.S,n.e),f.call(n)):l(t.target,n.e)&&(n.e.parentNode&&n.e.parentNode.replaceChild(n.S,n.e),f.call(n)))}})});t.observe(document.body,{childList:!0,attributes:!1,characterData:!1,subtree:!0}),n.g.add(new h.Disposable(function(){t.disconnect()}))}else{m("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details.");var e=function(){n.e.parentNode&&n.e.parentNode.replaceChild(n.S,n.e)};n.addEventListener("DOMNodeInserted",e,!1),n.g.add(new h.Disposable(function(){n.removeEventListener("DOMNodeInserted",e,!1)}))}}.call(this),document.body&&document.body.contains||m("document.body.contains is not supported"),document.body&&document.body.contains&&document.body.contains(this.e)&&(this.e.parentNode.replaceChild(this.S,this.e),this.h&&this.y&&(this.S=this.y.finishInitializationInDom()),this.g.add(new h.Disposable(function(){r.S.parentNode&&r.S.parentNode.replaceChild(r.e,r.S)}))),!this.u)return s(!0);(new a).waitForReady(this.S,s)}catch(t){p("Error while loading Phenix RTC"+t),s(!1)}}function r(i){var n=this;n.S.phenixSetEventListener(i,function(){var t=n.v[i];if(t)for(var e=0;e<t.length;e++)t[e].apply(n,arguments)})}function d(t,e){var i;document.createEvent?(i=document.createEvent("HTMLEvents")).initEvent(e,!0,!0):(i=document.createEventObject()).eventType=e,i.eventName=e,setTimeout(function(){document.createEvent?t.dispatchEvent(i):t.fireEvent("on"+i.eventType,i)})}function f(){for(var t=Object.keys(this.v),e=0;e<t.length;e++)r.call(this,t[e]);this.hookUpEvents(),function(){var e=this,i=["style"];if(o.get(u,["MutationObserver"])){var t=new MutationObserver(function(t){t.forEach(function(t){"attributes"===t.type&&t.target===e.e&&-1===i.indexOf(t.attributeName)&&(e.S[t.attributeName]=e.e[t.attributeName])})});t.observe(e.e,{attributes:!0}),e.g.add(new h.Disposable(function(){t.disconnect()}))}else{m("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details.");var n=function(t){e.S[t.target.tagName]=e.e[t.target.tagName]};e.e.addEventListener?(e.e.addEventListener("DOMAttrModified",n,!1),e.g.add(new h.Disposable(function(){e.e.removeEventListener("DOMAttrModified",n,!1)}))):(e.e.attachEvent("onpropertychange",n),e.g.add(new h.Disposable(function(){e.e.detachEvent("DOMAttrModified",n)})))}}.call(this),this.S.id=this.e.id,this.S.style.cssText=this.I,this.S.className=this.e.className,this.S.innerHtml=this.e.innerHtml,this.S.width=this.e.width,this.S.height=this.e.height,this.S.autoplay=this.e.autoplay,this.S.muted=this.e.muted,this.S.defaultMuted=this.e.defaultMuted,this.S.volume=this.e.volume,this.a&&!this.h&&(this.S.src=this.a)}function l(t,e){for(var i=e.parentNode;null!==i;){if(i===t)return!0;i=i.parentNode}return!1}function p(){console.error.apply(console,arguments)}var m=function(){console.log.apply(console,arguments)};return t.prototype.hookUpEvents=function(){function t(){d(u,"error")}function e(){u.muted=a.S.muted,d(u,"mute")}function i(){u.muted=a.S.muted,d(u,"unmute")}function n(){u.ended=a.S.ended,d(u,"ended")}function r(){u.width=a.S.width,u.height=a.S.height,d(u,"loadedmetadata")}function s(){u.width=a.S.width,u.height=a.S.height,d(u,"loadeddata")}function o(){u.width=a.S.width,u.height=a.S.height,d(u,"resize")}var a=this,u=this.e;this.addEventListener("error",t),this.addEventListener("mute",e),this.addEventListener("unmute",i),this.addEventListener("ended",n),this.addEventListener("loadedmetadata",r),this.addEventListener("loadeddata",s),this.addEventListener("resize",o);var c=new h.Disposable(function(){a.removeEventListener("error",t),a.removeEventListener("mute",e),a.removeEventListener("unmute",i),a.removeEventListener("ended",n),a.removeEventListener("loadedmetadata",r),a.removeEventListener("loadeddata",s),a.removeEventListener("resize",o)});return this.g.add(c),c},t.prototype.onReady=function(t){var e=this;this.w?setTimeout(function(){t(e.b)},1):this.k=t},t.prototype.getElement=function(){return this.S},t.prototype.addEventListener=function(t,e,i){(function(t,e,i){if(this.h)return this.y.addEventListener(t,e);if(this.u){var n=this.v[t];return n||(n=this.v[t]=[],this.w&&r.call(this,t)),n.push(e)}return this.S.addEventListener(t,e,i)}).call(this,t,e,i)},t.prototype.removeEventListener=function(t,e,i){(function(t,e,i){if(this.h)return this.y.removeEventListener(t,e);if(!this.u)return this.S.removeEventListener(t,e,i);var n=this.v[t];if(n){var r=n.indexOf(e);0<=r&&(0<(n=n.splice(r,1)).length?this.v[t]=n:delete this.v[t])}}).call(this,t,e,i)},t.prototype.destroy=function(){this.g.dispose()},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(2)],void 0===(r=function(t){"use strict";function e(t){this.T=t||15e3}function u(){console.error.apply(console,arguments)}var c=new t(navigator.userAgent).detect();return e.prototype.waitForReadyWithTimeout=function(e,i,n){function r(t){s||(s=!0,i(t))}var s=!1,o=1,a=o;e.hasOwnProperty&&e.hasOwnProperty("onload")||"IE"!==c.browser&&u("No means of detecting when <object> is loaded"),e.onload=function(){r(!0)},function t(){4===e.readyState?r(!0):e.phenixVersion?r(!0):(o=Math.min(o+1e3,2*o),(a+=o)>n?(u("Timed out while waiting for <object> to load"),r(!1)):setTimeout(t,o))}()},e.prototype.waitForReady=function(t,e){t.phenixVersion?e(!0):this.waitForReadyWithTimeout(t,e,this.T)},e}.apply(e,n))||(t.exports=r)},function(wc,xc){var yc;yc=function(){return this}();try{yc=yc||Function("return this")()||eval("this")}catch(t){"object"==typeof window&&(yc=window)}wc.exports=yc},function(t,e){t.exports=S},function(t,e){t.exports=T},function(t,e){t.exports=U},function(t,e,i){var n,r;n=[i(1),i(6),i(8),i(2),i(0),i(15),i(14)],void 0===(r=function(i,t,e,n,r,s,o){"use strict";function a(){if(i.assign(c,s()),o.isSupported()){c.phenixSupported=!0;var t=new o,e=function(){c.RTCPeerConnection=t.getRTCPeerConnectionConstructor(),c.RTCSessionDescription=t.getRTCSessionDescriptionConstructor(),c.RTCIceCandidate=t.getRTCIceCandidateConstructor(),c.getSources=t.getSourcesDelegate(),c.getUserMedia=t.getUserMediaDelegate(),c.getStats=t.getStatsDelegate(),Function.prototype.bind?(c.attachMediaStream=t.attachMediaStream.bind(t),c.reattachMediaStream=t.reattachMediaStream.bind(t),c.isPhenixEnabled=t.isEnabled.bind(t)):(c.attachMediaStream=function(){t.attachMediaStream.apply(t,arguments)},c.reattachMediaStream=function(){t.reattachMediaStream.apply(t,arguments)},c.isPhenixEnabled=function(){return t.isEnabled()}),c.webrtcSupported=!0,c.phenixSupported=!0,c.phenixVersion=t.getVersion(),c.onLoaded&&c.onLoaded.call()};t.isEnabled()?e():t.onReady(function(t){t&&(e(),c.onload&&"function"==typeof c.onload&&c.onload())}),t.onLoaded(function(){e()})}else c.phenixSupported=!1;return c}var u=new n(navigator.userAgent).detect(),c={browser:u.browser,browserVersion:u.version,phenixSupported:!1,isPhenixEnabled:function(){return!1},onLoaded:void 0,global:r};return i.assign(a(),{shim:a})}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0)],void 0===(r=function(e){"use strict";return function(t){e.RTCPeerConnection=t.RTCPeerConnection,e.RTCSessionDescription=t.RTCSessionDescription,e.RTCIceCandidate=t.RTCIceCandidate}}.apply(e,n))||(t.exports=r)},function(t,e,i){(function(e){t.exports=function r(s,o,a){function u(e,t){if(!o[e]){if(!s[e]){if(c)return(void 0)(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var n=o[e]={exports:{}};s[e][0].call(n.exports,function(t){return u(s[e][1][t]||t)},n,n.exports,r,s,o,a)}return o[e].exports}for(var c=!1,t=0;t<a.length;t++)u(a[t]);return u}({1:[function(t,e,i){},{}],2:[function(i,n,t){(function(t){"use strict";var e=i("./adapter_factory.js");n.exports=e({window:t.window})}).call(this,void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":3}],3:[function(l,t,e){"use strict";t.exports=function(t,e){var i=t&&t.window,n={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var r in e)hasOwnProperty.call(e,r)&&(n[r]=e[r]);var s=l("./utils"),o=s.log,a=s.detectBrowser(i),u={browserDetails:a,extractVersion:s.extractVersion,disableLog:s.disableLog,disableWarnings:s.disableWarnings},c=l("./chrome/chrome_shim")||null,h=l("./edge/edge_shim")||null,d=l("./firefox/firefox_shim")||null,f=l("./safari/safari_shim")||null;switch(a.browser){case"chrome":if(!c||!c.shimPeerConnection||!n.shimChrome)return o("Chrome shim is not included in this adapter release."),u;o("adapter.js shimming chrome."),(u.browserShim=c).shimGetUserMedia(i),c.shimMediaStream(i),s.shimCreateObjectURL(i),c.shimSourceObject(i),c.shimPeerConnection(i),c.shimOnTrack(i),c.shimAddTrackRemoveTrack(i),c.shimGetSendersWithDtmf(i);break;case"firefox":if(!d||!d.shimPeerConnection||!n.shimFirefox)return o("Firefox shim is not included in this adapter release."),u;o("adapter.js shimming firefox."),(u.browserShim=d).shimGetUserMedia(i),s.shimCreateObjectURL(i),d.shimSourceObject(i),d.shimPeerConnection(i),d.shimOnTrack(i);break;case"edge":if(!h||!h.shimPeerConnection||!n.shimEdge)return o("MS edge shim is not included in this adapter release."),u;o("adapter.js shimming edge."),(u.browserShim=h).shimGetUserMedia(i),s.shimCreateObjectURL(i),h.shimPeerConnection(i),h.shimReplaceTrack(i);break;case"safari":if(!f||!n.shimSafari)return o("Safari shim is not included in this adapter release."),u;o("adapter.js shimming safari."),u.browserShim=f,s.shimCreateObjectURL(i),f.shimRTCIceServerUrls(i),f.shimCallbacksAPI(i),f.shimLocalStreamsAPI(i),f.shimRemoteStreamsAPI(i),f.shimGetUserMedia(i);break;default:o("Unsupported browser!")}return u}},{"./chrome/chrome_shim":4,"./edge/edge_shim":1,"./firefox/firefox_shim":6,"./safari/safari_shim":8,"./utils":9}],4:[function(t,e,i){"use strict";var o=t("../utils.js"),n=o.log,r={shimMediaStream:function(t){t.MediaStream=t.MediaStream||t.webkitMediaStream},shimOnTrack:function(s){if("object"==typeof s&&s.RTCPeerConnection&&!("ontrack"in s.RTCPeerConnection.prototype)){Object.defineProperty(s.RTCPeerConnection.prototype,"ontrack",{get:function(){return this.R},set:function(t){this.R&&this.removeEventListener("track",this.R),this.addEventListener("track",this.R=t)}});var t=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return r.x||(r.x=function(n){n.stream.addEventListener("addtrack",function(e){var t;t=s.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(t){return t.track.id===e.track.id}):{track:e.track};var i=new Event("track");i.track=e.track,i.receiver=t,i.streams=[n.stream],r.dispatchEvent(i)}),n.stream.getTracks().forEach(function(e){var t;t=s.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(t){return t.track.id===e.id}):{track:e};var i=new Event("track");i.track=e,i.receiver=t,i.streams=[n.stream],r.dispatchEvent(i)})},r.addEventListener("addstream",r.x)),t.apply(r,arguments)}}},shimGetSendersWithDtmf:function(t){if("object"==typeof t&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){var n=function(t,e){return{track:e,get dtmf(){return void 0===this.C&&("audio"===e.kind?this.C=t.createDTMFSender(e):this.C=null),this.C},M:t}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this.P=this.P||[],this.P.slice()};var r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(t,e){var i=r.apply(this,arguments);return i||(i=n(this,t),this.P.push(i)),i};var i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(t){i.apply(this,arguments);var e=this.P.indexOf(t);-1!==e&&this.P.splice(e,1)}}var s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(t){var e=this;e.P=e.P||[],s.apply(e,[t]),t.getTracks().forEach(function(t){e.P.push(n(e,t))})};var e=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(t){var i=this;i.P=i.P||[],e.apply(i,[i.O[t.id]||t]),t.getTracks().forEach(function(e){var t=i.P.find(function(t){return t.track===e});t&&i.P.splice(i.P.indexOf(t),1)})}}else if("object"==typeof t&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){var o=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=o.apply(e,[]);return t.forEach(function(t){t.M=e}),t},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this.C&&("audio"===this.track.kind?this.C=this.M.createDTMFSender(this.track):this.C=null),this.C}})}},shimSourceObject:function(t){var i=t&&t.URL;"object"==typeof t&&(!t.HTMLMediaElement||"srcObject"in t.HTMLMediaElement.prototype||Object.defineProperty(t.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.q},set:function(t){var e=this;return this.q=t,this.src&&i.revokeObjectURL(this.src),t?(this.src=i.createObjectURL(t),t.addEventListener("addtrack",function(){e.src&&i.revokeObjectURL(e.src),e.src=i.createObjectURL(t)}),void t.addEventListener("removetrack",function(){e.src&&i.revokeObjectURL(e.src),e.src=i.createObjectURL(t)})):void(this.src="")}}))},shimAddTrackRemoveTrack:function(o){if(!o.RTCPeerConnection.prototype.addTrack){var i=o.RTCPeerConnection.prototype.getLocalStreams;o.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=i.apply(this);return e.D=e.D||{},t.map(function(t){return e.D[t.id]})};var n=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(t){var i=this;if(i.O=i.O||{},i.D=i.D||{},t.getTracks().forEach(function(e){if(i.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!i.D[t.id]){var e=new o.MediaStream(t.getTracks());i.O[t.id]=e,i.D[e.id]=t,t=e}n.apply(i,[t])};var r=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(t){var e=this;e.O=e.O||{},e.D=e.D||{},r.apply(e,[e.O[t.id]||t]),delete e.D[e.O[t.id]?e.O[t.id].id:t.id],delete e.O[t.id]},o.RTCPeerConnection.prototype.addTrack=function(e,t){var i=this;if("closed"===i.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find(function(t){return t===e}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(i.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError");i.O=i.O||{},i.D=i.D||{};var r=i.O[t.id];if(r)r.addTrack(e),i.dispatchEvent(new Event("negotiationneeded"));else{var s=new o.MediaStream([e]);i.O[t.id]=s,i.D[s.id]=t,i.addStream(s)}return i.getSenders().find(function(t){return t.track===e})},o.RTCPeerConnection.prototype.removeTrack=function(e){var i,n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e.M)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e.M===n))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");n.O=n.O||{},Object.keys(n.O).forEach(function(t){n.O[t].getTracks().find(function(t){return e.track===t})&&(i=n.O[t])}),i&&(1===i.getTracks().length?n.removeStream(i):i.removeTrack(e.track),n.dispatchEvent(new Event("negotiationneeded")))}}},shimPeerConnection:function(i){var t=o.detectBrowser(i);if(i.RTCPeerConnection){var s=i.RTCPeerConnection;i.RTCPeerConnection=function(t,e){if(t&&t.iceServers){for(var i=[],n=0;n<t.iceServers.length;n++){var r=t.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(o.deprecated("RTCIceServer.url","RTCIceServer.urls"),(r=JSON.parse(JSON.stringify(r))).urls=r.url,i.push(r)):i.push(t.iceServers[n])}t.iceServers=i}return new s(t,e)},i.RTCPeerConnection.prototype=s.prototype,Object.defineProperty(i.RTCPeerConnection,"generateCertificate",{get:function(){return s.generateCertificate}})}else i.RTCPeerConnection=function(t,e){return n("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new i.webkitRTCPeerConnection(t,e)},i.RTCPeerConnection.prototype=i.webkitRTCPeerConnection.prototype,i.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(i.RTCPeerConnection,"generateCertificate",{get:function(){return i.webkitRTCPeerConnection.generateCertificate}});var a=i.RTCPeerConnection.prototype.getStats;i.RTCPeerConnection.prototype.getStats=function(t,e,i){var n=this,r=arguments;if(0<arguments.length&&"function"==typeof t)return a.apply(this,arguments);if(0===a.length&&(0===arguments.length||"function"!=typeof t))return a.apply(this,[]);function s(t){var n={};return t.result().forEach(function(e){var i={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){i[t]=e.stat(t)}),n[i.id]=i}),n}function o(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))}return 2<=arguments.length?a.apply(this,[function(t){r[1](o(s(t)))},t]):new Promise(function(e,t){a.apply(n,[function(t){e(o(s(t)))},t])}).then(e,i)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=i.RTCPeerConnection.prototype[t];i.RTCPeerConnection.prototype[t]=function(){var i=arguments,n=this,t=new Promise(function(t,e){r.apply(n,[i[0],t,e])});return i.length<2?t:t.then(function(){i[1].apply(null,[])},function(t){3<=i.length&&i[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var r=i.RTCPeerConnection.prototype[t];i.RTCPeerConnection.prototype[t]=function(){var i=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var n=1===arguments.length?arguments[0]:void 0;return new Promise(function(t,e){r.apply(i,[t,e,n])})}return r.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var e=i.RTCPeerConnection.prototype[t];i.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?i.RTCIceCandidate:i.RTCSessionDescription)(arguments[0]),e.apply(this,arguments)}});var e=i.RTCPeerConnection.prototype.addIceCandidate;i.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};e.exports={shimMediaStream:r.shimMediaStream,shimOnTrack:r.shimOnTrack,shimAddTrackRemoveTrack:r.shimAddTrackRemoveTrack,shimGetSendersWithDtmf:r.shimGetSendersWithDtmf,shimSourceObject:r.shimSourceObject,shimPeerConnection:r.shimPeerConnection,shimGetUserMedia:t("./getusermedia")}},{"../utils.js":9,"./getusermedia":5}],5:[function(t,e,i){"use strict";var s=t("../utils.js"),c=s.log;e.exports=function(t){function o(r){if("object"!=typeof r||r.mandatory||r.optional)return r;var s={};return Object.keys(r).forEach(function(e){if("require"!==e&&"advanced"!==e&&"mediaSource"!==e){var i="object"==typeof r[e]?r[e]:{ideal:r[e]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var n=function(t,e){return t?t+e.charAt(0).toUpperCase()+e.slice(1):"deviceId"===e?"sourceId":e};if(void 0!==i.ideal){s.optional=s.optional||[];var t={};"number"==typeof i.ideal?(t[n("min",e)]=i.ideal,s.optional.push(t),(t={})[n("max",e)]=i.ideal):t[n("",e)]=i.ideal,s.optional.push(t)}void 0!==i.exact&&"number"!=typeof i.exact?(s.mandatory=s.mandatory||{},s.mandatory[n("",e)]=i.exact):["min","max"].forEach(function(t){void 0!==i[t]&&(s.mandatory=s.mandatory||{},s.mandatory[n(t,e)]=i[t])})}}),r.advanced&&(s.optional=(s.optional||[]).concat(r.advanced)),s}function n(i,n){if((i=JSON.parse(JSON.stringify(i)))&&"object"==typeof i.audio){var t=function(t,e,i){e in t&&!(i in t)&&(t[i]=t[e],delete t[e])};t((i=JSON.parse(JSON.stringify(i))).audio,"autoGainControl","googAutoGainControl"),t(i.audio,"noiseSuppression","googNoiseSuppression"),i.audio=o(i.audio)}if(i&&"object"==typeof i.video){var r=i.video.facingMode;r=r&&("object"==typeof r?r:{ideal:r});var s,e=a.version<61;if(r&&("user"===r.exact||"environment"===r.exact||"user"===r.ideal||"environment"===r.ideal)&&(!u.mediaDevices.getSupportedConstraints||!u.mediaDevices.getSupportedConstraints().facingMode||e)&&(delete i.video.facingMode,"environment"===r.exact||"environment"===r.ideal?s=["back","rear"]:"user"!==r.exact&&"user"!==r.ideal||(s=["front"]),s))return u.mediaDevices.enumerateDevices().then(function(t){var e=(t=t.filter(function(t){return"videoinput"===t.kind})).find(function(e){return s.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!e&&t.length&&-1!==s.indexOf("back")&&(e=t[t.length-1]),e&&(i.video.deviceId=r.exact?{exact:e.deviceId}:{ideal:e.deviceId}),i.video=o(i.video),c("chrome: "+JSON.stringify(i)),n(i)});i.video=o(i.video)}return c("chrome: "+JSON.stringify(i)),n(i)}function r(t){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[t.name]||t.name,message:t.message,constraint:t.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}}var a=s.detectBrowser(t),u=t&&t.navigator;u.getUserMedia=function(t,e,i){n(t,function(t){u.webkitGetUserMedia(t,e,function(t){i(r(t))})})};function e(i){return new Promise(function(t,e){u.getUserMedia(i,t,e)})}if(u.mediaDevices||(u.mediaDevices={getUserMedia:e,enumerateDevices:function(){return new Promise(function(e){var i={audio:"audioinput",video:"videoinput"};return t.MediaStreamTrack.getSources(function(t){e(t.map(function(t){return{label:t.label,kind:i[t.kind],deviceId:t.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),u.mediaDevices.getUserMedia){var i=u.mediaDevices.getUserMedia.bind(u.mediaDevices);u.mediaDevices.getUserMedia=function(t){return n(t,function(e){return i(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(t){t.stop()}),new DOMException("","NotFoundError");return t},function(t){return Promise.reject(r(t))})})}}else u.mediaDevices.getUserMedia=function(t){return e(t)};void 0===u.mediaDevices.addEventListener&&(u.mediaDevices.addEventListener=function(){c("Dummy mediaDevices.addEventListener called.")}),void 0===u.mediaDevices.removeEventListener&&(u.mediaDevices.removeEventListener=function(){c("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":9}],6:[function(t,e,i){"use strict";var n=t("../utils"),r={shimOnTrack:function(t){"object"!=typeof t||!t.RTCPeerConnection||"ontrack"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get:function(){return this.R},set:function(t){this.R&&(this.removeEventListener("track",this.R),this.removeEventListener("addstream",this.x)),this.addEventListener("track",this.R=t),this.addEventListener("addstream",this.x=function(i){i.stream.getTracks().forEach(function(t){var e=new Event("track");e.track=t,e.receiver={track:t},e.streams=[i.stream],this.dispatchEvent(e)}.bind(this))}.bind(this))}})},shimSourceObject:function(t){"object"==typeof t&&(!t.HTMLMediaElement||"srcObject"in t.HTMLMediaElement.prototype||Object.defineProperty(t.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(t){this.mozSrcObject=t}}))},shimPeerConnection:function(a){var u=n.detectBrowser(a);if("object"==typeof a&&(a.RTCPeerConnection||a.mozRTCPeerConnection)){a.RTCPeerConnection||(a.RTCPeerConnection=function(t,e){if(u.version<38&&t&&t.iceServers){for(var i=[],n=0;n<t.iceServers.length;n++){var r=t.iceServers[n];if(r.hasOwnProperty("urls"))for(var s=0;s<r.urls.length;s++){var o={url:r.urls[s]};0===r.urls[s].indexOf("turn")&&(o.username=r.username,o.credential=r.credential),i.push(o)}else i.push(t.iceServers[n])}t.iceServers=i}return new a.mozRTCPeerConnection(t,e)},a.RTCPeerConnection.prototype=a.mozRTCPeerConnection.prototype,a.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.mozRTCPeerConnection.generateCertificate}}),a.RTCSessionDescription=a.mozRTCSessionDescription,a.RTCIceCandidate=a.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var e=a.RTCPeerConnection.prototype[t];a.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),e.apply(this,arguments)}});var t=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(t,r,e){return i.apply(this,[t||null]).then(function(i){if(u.version<48&&(e=i,n=new Map,Object.keys(e).forEach(function(t){n.set(t,e[t]),n[t]=e[t]}),i=n),u.version<53&&!r)try{i.forEach(function(t){t.type=s[t.type]||t.type})}catch(t){if("TypeError"!==t.name)throw t;i.forEach(function(t,e){i.set(e,Object.assign({},t,{type:s[t.type]||t.type}))})}var e,n;return i}).then(r,e)}}}};e.exports={shimOnTrack:r.shimOnTrack,shimSourceObject:r.shimSourceObject,shimPeerConnection:r.shimPeerConnection,shimGetUserMedia:t("./getusermedia")}},{"../utils":9,"./getusermedia":7}],7:[function(t,e,i){"use strict";var f=t("../utils"),l=f.log;e.exports=function(t){function r(t){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[t.name]||t.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[t.message]||t.message,constraint:t.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}}function n(t,e,i){function n(n){if("object"!=typeof n||n.require)return n;var r=[];return Object.keys(n).forEach(function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var e=n[t]="object"==typeof n[t]?n[t]:{ideal:n[t]};if(void 0===e.min&&void 0===e.max&&void 0===e.exact||r.push(t),void 0!==e.exact&&("number"==typeof e.exact?e.min=e.max=e.exact:n[t]=e.exact,delete e.exact),void 0!==e.ideal){n.advanced=n.advanced||[];var i={};"number"==typeof e.ideal?i[t]={min:e.ideal,max:e.ideal}:i[t]=e.ideal,n.advanced.push(i),delete e.ideal,Object.keys(e).length||delete n[t]}}}),r.length&&(n.require=r),n}return t=JSON.parse(JSON.stringify(t)),s.version<38&&(l("spec: "+JSON.stringify(t)),t.audio&&(t.audio=n(t.audio)),t.video&&(t.video=n(t.video)),l("ff37: "+JSON.stringify(t))),o.mozGetUserMedia(t,e,function(t){i(r(t))})}var s=f.detectBrowser(t),o=t&&t.navigator,e=t&&t.MediaStreamTrack;if(o.mediaDevices||(o.mediaDevices={getUserMedia:function(i){return new Promise(function(t,e){n(i,t,e)})},addEventListener:function(){},removeEventListener:function(){}}),o.mediaDevices.enumerateDevices=o.mediaDevices.enumerateDevices||function(){return new Promise(function(t){t([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},s.version<41){var i=o.mediaDevices.enumerateDevices.bind(o.mediaDevices);o.mediaDevices.enumerateDevices=function(){return i().then(void 0,function(t){if("NotFoundError"===t.name)return[];throw t})}}if(s.version<49){var a=o.mediaDevices.getUserMedia.bind(o.mediaDevices);o.mediaDevices.getUserMedia=function(e){return a(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(t){t.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(t){return Promise.reject(r(t))})}}if(!(55<s.version&&"autoGainControl"in o.mediaDevices.getSupportedConstraints())){var u=function(t,e,i){e in t&&!(i in t)&&(t[i]=t[e],delete t[e])},c=o.mediaDevices.getUserMedia.bind(o.mediaDevices);if(o.mediaDevices.getUserMedia=function(t){return"object"==typeof t&&"object"==typeof t.audio&&(t=JSON.parse(JSON.stringify(t)),u(t.audio,"autoGainControl","mozAutoGainControl"),u(t.audio,"noiseSuppression","mozNoiseSuppression")),c(t)},e&&e.prototype.getSettings){var h=e.prototype.getSettings;e.prototype.getSettings=function(){var t=h.apply(this,arguments);return u(t,"mozAutoGainControl","autoGainControl"),u(t,"mozNoiseSuppression","noiseSuppression"),t}}if(e&&e.prototype.applyConstraints){var d=e.prototype.applyConstraints;e.prototype.applyConstraints=function(t){return"audio"===this.kind&&"object"==typeof t&&(t=JSON.parse(JSON.stringify(t)),u(t,"autoGainControl","mozAutoGainControl"),u(t,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[t])}}}o.getUserMedia=function(t,e,i){return s.version<44?n(t,e,i):(f.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),void o.mediaDevices.getUserMedia(t).then(e,i))}}},{"../utils":9}],8:[function(t,e,i){"use strict";var o=t("../utils"),n={shimLocalStreamsAPI:function(t){if("object"==typeof t&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this.A||(this.A=[]),this.A}),"getStreamById"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getStreamById=function(e){var i=null;return this.A&&this.A.forEach(function(t){t.id===e&&(i=t)}),this.F&&this.F.forEach(function(t){t.id===e&&(i=t)}),i}),!("addStream"in t.RTCPeerConnection.prototype)){var n=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(e){this.A||(this.A=[]),-1===this.A.indexOf(e)&&this.A.push(e);var i=this;e.getTracks().forEach(function(t){n.call(i,t,e)})},t.RTCPeerConnection.prototype.addTrack=function(t,e){e&&(this.A?-1===this.A.indexOf(e)&&this.A.push(e):this.A=[e]),n.call(this,t,e)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(t){this.A||(this.A=[]);var e=this.A.indexOf(t);if(-1!==e){this.A.splice(e,1);var i=this,n=t.getTracks();this.getSenders().forEach(function(t){-1!==n.indexOf(t.track)&&i.removeTrack(t)})}})}},shimRemoteStreamsAPI:function(t){"object"==typeof t&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this.F?this.F:[]}),"onaddstream"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this.N},set:function(t){this.N&&(this.removeEventListener("addstream",this.N),this.removeEventListener("track",this.U)),this.addEventListener("addstream",this.N=t),this.addEventListener("track",this.U=function(t){var e=t.streams[0];if(this.F||(this.F=[]),!(0<=this.F.indexOf(e))){this.F.push(e);var i=new Event("addstream");i.stream=t.streams[0],this.dispatchEvent(i)}}.bind(this))}}))},shimCallbacksAPI:function(t){if("object"==typeof t&&t.RTCPeerConnection){var e=t.RTCPeerConnection.prototype,r=e.createOffer,s=e.createAnswer,o=e.setLocalDescription,a=e.setRemoteDescription,u=e.addIceCandidate;e.createOffer=function(t,e){var i=2<=arguments.length?arguments[2]:t,n=r.apply(this,[i]);return e?(n.then(t,e),Promise.resolve()):n},e.createAnswer=function(t,e){var i=2<=arguments.length?arguments[2]:t,n=s.apply(this,[i]);return e?(n.then(t,e),Promise.resolve()):n};var i=function(t,e,i){var n=o.apply(this,[t]);return i?(n.then(e,i),Promise.resolve()):n};e.setLocalDescription=i,i=function(t,e,i){var n=a.apply(this,[t]);return i?(n.then(e,i),Promise.resolve()):n},e.setRemoteDescription=i,i=function(t,e,i){var n=u.apply(this,[t]);return i?(n.then(e,i),Promise.resolve()):n},e.addIceCandidate=i}},shimGetUserMedia:function(t){var n=t&&t.navigator;n.getUserMedia||(n.webkitGetUserMedia?n.getUserMedia=n.webkitGetUserMedia.bind(n):n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=function(t,e,i){n.mediaDevices.getUserMedia(t).then(e,i)}.bind(n)))},shimRTCIceServerUrls:function(t){var s=t.RTCPeerConnection;t.RTCPeerConnection=function(t,e){if(t&&t.iceServers){for(var i=[],n=0;n<t.iceServers.length;n++){var r=t.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(o.deprecated("RTCIceServer.url","RTCIceServer.urls"),(r=JSON.parse(JSON.stringify(r))).urls=r.url,delete r.url,i.push(r)):i.push(t.iceServers[n])}t.iceServers=i}return new s(t,e)},t.RTCPeerConnection.prototype=s.prototype,Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:function(){return s.generateCertificate}})}};e.exports={shimCallbacksAPI:n.shimCallbacksAPI,shimLocalStreamsAPI:n.shimLocalStreamsAPI,shimRemoteStreamsAPI:n.shimRemoteStreamsAPI,shimGetUserMedia:n.shimGetUserMedia,shimRTCIceServerUrls:n.shimRTCIceServerUrls}},{"../utils":9}],9:[function(t,e,i){"use strict";var n=!0,r=!0,u={disableLog:function(t){return"boolean"!=typeof t?new Error("Argument type: "+typeof t+". Please use a boolean."):(n=t)?"adapter.js logging disabled":"adapter.js logging enabled"},disableWarnings:function(t){return"boolean"!=typeof t?new Error("Argument type: "+typeof t+". Please use a boolean."):(r=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(n)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(t,e){r&&console.warn(t+" is deprecated, please use "+e+" instead.")},extractVersion:function(t,e,i){var n=t.match(e);return n&&n.length>=i&&parseInt(n[i],10)},detectBrowser:function(t){var e=t&&t.navigator,i={browser:null,version:null};if(void 0===t||!t.navigator)return i.browser="Not a browser.",i;if(e.mozGetUserMedia)i.browser="firefox",i.version=this.extractVersion(e.userAgent,/Firefox\/(\d+)\./,1);else if(e.webkitGetUserMedia)if(t.webkitRTCPeerConnection)i.browser="chrome",i.version=this.extractVersion(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.userAgent.match(/Version\/(\d+).(\d+)/))return i.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",i;i.browser="safari",i.version=this.extractVersion(e.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(e.mediaDevices&&e.userAgent.match(/Edge\/(\d+).(\d+)$/))i.browser="edge",i.version=this.extractVersion(e.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.mediaDevices||!e.userAgent.match(/AppleWebKit\/(\d+)\./))return i.browser="Not a supported browser.",i;i.browser="safari",i.version=this.extractVersion(e.userAgent,/AppleWebKit\/(\d+)\./,1)}return i},shimCreateObjectURL:function(t){var e=t&&t.URL;if("object"==typeof t&&t.HTMLMediaElement&&"srcObject"in t.HTMLMediaElement.prototype){var i=e.createObjectURL.bind(e),n=e.revokeObjectURL.bind(e),r=new Map,s=0;e.createObjectURL=function(t){if("getTracks"in t){var e="polyblob:"+ ++s;return r.set(e,t),u.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),e}return i(t)},e.revokeObjectURL=function(t){n(t),r.delete(t)};var o=Object.getOwnPropertyDescriptor(t.HTMLMediaElement.prototype,"src");Object.defineProperty(t.HTMLMediaElement.prototype,"src",{get:function(){return o.get.apply(this)},set:function(t){return this.srcObject=r.get(t)||null,o.set.apply(this,[t])}});var a=t.HTMLMediaElement.prototype.setAttribute;t.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=r.get(arguments[1])||null),a.apply(this,arguments)}}}};e.exports={log:u.log,deprecated:u.deprecated,disableLog:u.disableLog,disableWarnings:u.disableWarnings,extractVersion:u.extractVersion,shimCreateObjectURL:u.shimCreateObjectURL,detectBrowser:u.detectBrowser.bind(u)}},{}]},{},[2])(2)}).call(e,i(5))},function(t,e,i){"use strict";var n,r;n=[i(9),i(10),i(3)],void 0===(r=function(t,e,i){return t.PhenixVideo=i,t.onLoaded=function(){e(t)},t.onLoaded(),t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(2),i(7),i(16),i(4),i(0)],void 0===(r=function(r,t,s,o,e,a){"use strict";function i(t,e,i){this.g=new s.DisposableList,this.v=new o.NamedEvents,this.j="video"===t.tagName,this.L=i.swfSrc,this.B=t.id||i.streamId,this.W=t.clientWidth,this.V=t.clientHeight,this.e=t,this.z=null,this.G=[],this.J=["uid="+this.B,"autoplay="+(!!r.isUndefined(t.autoplay)||t.autoplay),"muted="+(!r.isUndefined(t.muted)&&t.muted),"allowScriptAccess=always","preload=true","src="+JSON.stringify(e)];var n=this;this.g.add(new s.Disposable(function(){d.call(n,"fire_stop")}));try{this.z=v||g?function(){return document.createElement("div")}.call(this):function(){var t=document.createElement("embed");return t.setAttribute("id","__"+this.B),t.setAttribute("name","__"+this.B),t.setAttribute("play","true"),t.setAttribute("loop","false"),t.setAttribute("quality","high"),t.setAttribute("bgcolor","#000000"),t.setAttribute("wmode","transparent"),t.setAttribute("allowScriptAccess","always"),t.setAttribute("allowFullScreen","true"),t.setAttribute("type","application/x-shockwave-flash"),t.setAttribute("pluginspage","//www.macromedia.com/go/getflashplayer"),t.setAttribute("src",this.L),t.setAttribute("flashvars",this.J.join("&")),this.j&&(t.setAttribute("width",this.W.toString()),t.setAttribute("height",this.V.toString())),t}.call(this),c.call(this)}catch(t){!function(){console.error.apply(console,arguments)}("Error while loading Flash Player"+t)}}function n(e,i){return r.findIndex(this.G,function(t){return t.name===e&&t.listener===i})}function u(t,e){var i=document.createElement("param");return i.setAttribute("name",t),i.setAttribute("value",e),i}function c(){r.assign(this.z,l,{id:this.B,width:this.W,height:this.V,videoWidth:this.W,videoHeight:this.V}),function(){var n=this;a["__event__"+this.B]=function(t,e){var i=function(t,e){var i=t.match(/([a-z]+\.([a-z]+))/i),n={target:e};if(null!==i&&(t=i[1],n.namespace=i[2]),"IE"===m.browser&&8<m.version){var r=a.document.createEvent("CustomEvent");return r.initCustomEvent(t,!1,!1,n),r}return a.CustomEvent?new a.CustomEvent(t,{detail:n}):n}(t,n.z);if(e)try{i.data=JSON.parse(e),i.details.data=i.data}catch(t){i.message=e}switch(t){case"ended":break;case"error":n.z.error=i.data,n.z.dispatchEvent&&n.z.dispatchEvent(new Error(e));break;case"loadeddata":case"loadedmetadata":case"loadstart":n.z.dispatchEvent&&n.z.dispatchEvent(i);break;case"pause":n.z.paused=!0;break;case"play":case"playing":n.z.paused=!1;break;case"progress":case"seeked":case"seeking":case"stalled":case"suspend":n.z.dispatchEvent&&n.z.dispatchEvent(i);break;case"timeupdate":n.z.currentTime=function(t){return(this.z["get_"+t]||r.noop).call(this.z)}.call(n,"currentTime"),n.z.dispatchEvent&&n.z.dispatchEvent(i)}n.v.fireAsync(t,[i])};var e=this.z.requestFullscreen||this.z.mozRequestFullScreen||this.z.webkitRequestFullScreen||this.z.msRequestFullscreen;function t(){d.call(n,"set_size",n.H?screen.width:n.z.clientWidth,n.H?screen.height:n.z.clientHeight)}this.g.add(new s.Disposable(function(){delete a["__event__"+n.B]})),this.z.play=function(){d.call(n,"fire_play")},this.z.load=function(){d.call(n,"fire_load")},this.z.seek=function(){d.call(n,"fire_seek")},this.z.pause=function(){d.call(n,"fire_pause")},this.z.requestFullscreen=function(){if(n.H=!0,function(){function i(){document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement||(document.removeEventListener("webkitfullscreenchange",i),document.removeEventListener("mozfullscreenchange",i),document.removeEventListener("fullscreenchange",i),document.removeEventListener("MSFullscreenChange",i),document.removeEventListener("keydown",t),e.H=!1,e.z.style.position=e.K,e.z.style.height=e.Q,e.z.style.width=e.X)}function t(t){var e=t||a.event;("key"in e?"Escape"===e.key||"Esc"===e.key:27===e.keyCode)&&i()}var e=this;document.addEventListener("webkitfullscreenchange",i,!1),document.addEventListener("mozfullscreenchange",i,!1),document.addEventListener("fullscreenchange",i,!1),document.addEventListener("MSFullscreenChange",i,!1),document.addEventListener("keydown",t,!1)}.call(n),n.Q=n.z.style.height,n.X=n.z.style.width,n.K=n.z.style.position,n.z.style.position="absolute",n.z.style.height="100%",n.z.style.width="100%",void 0!==a.ActiveXObject){var t=new a("WScript.Shell");null!==t&&t.SendKeys("{F11}")}e.call(n.z)},r.addEventListener(a,"resize",t),this.g.add(new s.Disposable(function(){r.removeEventListener(a,"resize",t)}))}.call(this),function(){var e=this,i=["currentTime","paused","error","src"];if(r.get(a,["MutationObserver"])){var t=new MutationObserver(function(t){t.forEach(function(t){"attributes"!==t.type||t.target!==e.z||r.includes(i,t.attributeName)||h.call(e,t.attributeName,e.z[t.attributeName])})});t.observe(e.z,{attributes:!0}),e.g.add(new s.Disposable(function(){t.disconnect()}))}else{f("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details.");var n=function(t){r.includes(i,t.target.tagName)||h.call(e,t.target.tagName,e.z[t.target.tagName])};e.z.addEventListener?(e.z.addEventListener("DOMAttrModified",n,!1),e.g.add(new s.Disposable(function(){e.z.removeEventListener("DOMAttrModified",n,!1)}))):(e.z.attachEvent("onpropertychange",n),e.g.add(new s.Disposable(function(){e.z.detachEvent("DOMAttrModified",n)})))}}.call(this),function(){var t=function(){var i=this,n=i.e.muted,r=i.z.muted;return function(){var t=i.z.muted,e=i.z.muted;t===n&&e===r||(t!==n&&(e=r=n=t),e!==r&&(r=n=t),i.z.muted=e,i.e.muted=e,h.call(i,"muted",e))}}.call(this),e=function(){var i=this,n=i.e.volume,r=i.z.volume;return function(){var t=i.z.volume,e=i.z.volume;t===n&&e===r||(t!==n&&(e=r=n=t),e!==r&&(r=n=t),i.z.volume=e,i.e.volume=e,h.call(i,"volume",e))}}.call(this),i=setInterval(function(){t(),e()},p);this.g.add(new s.Disposable(function(){clearInterval(i)}))}.call(this)}function h(t,e){return(this.z["set_"+t]||r.noop).call(this.z,e)}function d(t){var e=this.z[t];if([].shift.apply(arguments),e)return e.apply(this.z,arguments)}var f=function(){console.log.apply(console,arguments)},l={width:480,height:360,videoWidth:480,videoHeight:360,muted:!1,volume:1,currentTime:0,duration:1/0,readyState:0,ended:!1,buffered:null,autoplay:!0},p=300,m=new t(navigator.userAgent).detect(),v="IE"===m.browser&&/(trident|microsoft)/i.test(r.get(a.navigator,["appName"],"")),g="Edge"===m.browser&&r.get(a.navigator,"msLaunchUri")&&!r.get(a.document,"documentMode");return i.prototype.finishInitializationInDom=function(){return function(){if(!v&&!g)return this.z;var t=(g?"__"+this.B:this.B)+r.uniqueId(),i=document.createElement("object"),e=document.createElement("div"),n=[u("movie",this.L+"?x="+r.now()),u("flashvars",this.J.join("&")),u("quality",2),u("bgcolor","#000000"),u("wmode","transparent"),u("allowScriptAccess","always"),u("allowFullScreen","true"),e];return e.innerHTML="You are using a browser that does not have Flash player enabled or installed. Please turn on your Flash player plugin or download the latest version from https://get.adobe.com/flashplayer/",g?(i.setAttribute("type","application/x-shockwave-flash"),i.setAttribute("data",this.L),i.setAttribute("id",t),i.setAttribute("width","__"+this.W.toString()),i.setAttribute("height","__"+this.V.toString())):(i.setAttribute("classid","clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"),i.setAttribute("codebase","//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab"),i.setAttribute("id",t),i.setAttribute("width",this.W.toString()),i.setAttribute("height",this.V.toString())),i.object?(r.forEach(n,function(t){r.isNullOrUndefined(r.get(i.object,[t.name]))||(i.object[t.name]=t.value)}),i.appendChild(e)):r.forEach(n,function(e){var t=r.find(i.children,function(t){return t.name===e.name});return t?i.replaceChild(e,t):i.appendChild(e)}),this.z.outerHTML=i.outerHTML,a.document.getElementById&&(this.z=a.document.getElementById(t),c.call(this)),this.z}.call(this)},i.prototype.getElement=function(){return this.z},i.prototype.addEventListener=function(t,e){if(!(-1<n.call(this,t,e))){var i=this.v.listen(t,e);this.g.add(i),this.G.push({name:t,listener:e,disposable:i})}},i.prototype.removeEventListener=function(t,e){var i=n.call(this,t,e);-1<i&&this.G.splice(i,1)[0].disposable.dispose()},i.prototype.destroy=function(){this.g.dispose()},i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(6),i(8),i(4),i(3)],void 0===(r=function(r,i,s,o,n){"use strict";function t(){var t,e,i,n=this;this.Y=((t=document.createElement("div")).id="phenixRTC",t.style.cssText="visibility:hidden !important;width:0px !important;height:0px !important;margin:0px !important;padding:0px !important;border-style:none !important;border-width:0px !important;max-width:0px !important;max-height:0px !important;outline:none !important",document.body.appendChild(t),t),this.Z="?";try{this.$=(e=this.Y,(i=document.createElement("object")).type="application/x-phenix-rtc",e.appendChild(i),i),this.$.onunload=function(){n.w=!1},(new o).waitForReady(this.$,function(t){n.w=!0,n.b=!0===t,n.Z=n.$.phenixVersion||"?.?.?.?",function(){console.log.apply(console,arguments)}(t?"Phenix RTC "+n.Z:"No Phenix RTC"),n.k&&n.k(n.b)})}catch(t){!function(){console.error.apply(console,arguments)}("Error while loading Phenix RTC"+t)}}function a(){this.Y&&document.getElementById("phenixRTC")!==this.Y&&(document.body.appendChild(this.Y),this.tt&&this.tt.call(this))}function e(e){function i(){var t=null;switch(arguments.length){case 0:t=new e;break;case 1:t=new e(arguments[0]);break;case 2:t=new e(arguments[0],arguments[1]);break;case 3:t=new e(arguments[0],arguments[1],arguments[2]);break;case 4:t=new e(arguments[0],arguments[1],arguments[2],arguments[3]);break;case 5:t=new e(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);break;default:throw new Error("Unsupported number of arguments in Phenix Object Constructor")}return t.phenixAddEventListener=r.bind(u,t),t.phenixRemoveEventListener=r.bind(c,t),t}return r.forOwn(e,function(t,e){i[e]=t}),i}function u(t,e){i.et(t,"name"),i.it(e,"listener"),function(i){if(!this.events||!this.events[i]){this.events||(this.events={});var n=this.events;n[i]={observable:(new s.Observable).extend({timeout:0}),subscription:null,listeners:[]},this.phenixSetEventListener(i,r.bind(n[i].observable.setValue,n[i].observable)),n[i].subscription=n[i].observable.subscribe(function(e){var t=n[i].listeners;r.forEach(t,function(t){t(e)})})}}.call(this,t),function(t,e){if(!this.events||!this.events[t])throw new Error("No event observable for event: "+name);this.events[t].listeners.push(e)}.call(this,t,e)}function c(t,e){(function(t,e){this.events&&this.events.events[t]&&(this.events[t].listeners=r.filter(this.events[t].listeners,function(t){return e!==t}))}).call(this,t,e)}return t.prototype.onReady=function(t){var e=this;this.w?setTimeout(function(){t(e.b)},1):this.k=t},t.prototype.onLoaded=function(t){this.tt=t},t.prototype.isLoaded=function(){return!0===this.w},t.isSupported=function(){if(navigator.plugins)for(var t=navigator.plugins,e=0;e<t.length;e++)if(0<=t[e].name.indexOf("PhenixRTC"))return!0;if(navigator.userAgent&&(navigator.userAgent.match(/MSIE/)||navigator.userAgent.match(/Trident/)))try{return new window.ActiveXObject("PhenixP2P.RTC"),!0}catch(t){return!1}return!1},t.prototype.isEnabled=function(){return a.call(this),this.$&&void 0!==this.$.phenixVersion},t.prototype.getVersion=function(){return a.call(this),this.Z},t.prototype.getRTCPeerConnectionConstructor=function(){return a.call(this),e(this.$.RTCPeerConnection)},t.prototype.getRTCSessionDescriptionConstructor=function(){return a.call(this),e(this.$.RTCSessionDescription)},t.prototype.getRTCIceCandidateConstructor=function(){return a.call(this),e(this.$.RTCIceCandidate)},t.prototype.getSourcesDelegate=function(){var e=this;return function(t){return a.call(e),e.$.getSources(t)}},t.prototype.getUserMediaDelegate=function(){var n=this;return function(t,e,i){return a.call(n),n.$.getUserMedia(t,e,i)}},t.prototype.getStatsDelegate=function(){return function(t,e,i,n){return t.getStats(e,i,n)}},t.prototype.attachMediaStream=function(t,e){return a.call(this),function(t,e){if(!t)throw new Error("Can not attach a stream to a undefined element");if(t.phenixVersion)return t.src=e,t;var i=new n(t,e,!0);return(i.getElement().phenixPresenter=i).getElement()}.call(this,t,e)},t.prototype.reattachMediaStream=function(t,e){return a.call(this),this.attachMediaStream(t,e.src)},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(2),i(11),i(0),i(3)],void 0===(r=function(o,t,e,r,i){"use strict";function n(t,e,i){var n=o.bind(s,this,t,e,i);return navigator&&o.it(navigator.getUserMedia)?navigator.getUserMedia(t,n,i):r&&o.it(r.getUserMedia)?r.getUserMedia(t,n,i):void 0}function s(r,s,o,a){setTimeout(function(){for(var t=a.getTracks(),e=0;e<t.length;e++){var i=t[e];if(i.onended=function(t){p(t.timeStamp,"Track",i.id,i.label,"ended")},p("Track",i.id,i.label,t[e].kind,"readyState=",t[e].readyState),"ended"===i.readyState)return u("User media not available",o,t)}var n=(r.audio?1:0)+(r.video?1:0);return t.length!==n?u("Unable to get all requested user media.",o,t):void s(a)},100)}function u(t,e,i){try{var n=new Error(t);n.code="unavailable",e(n)}finally{!function(t){for(var e=0;e<t.length;e++)t[e].stop()}(i)}}function a(i,n){if("input"!==i&&"output"!==i)throw new Error("Unsupported device type "+i);navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices().then(function(t){var e=[];t.forEach(function(t){t.kind==="audio"+i?e.push({kind:"audio",id:t.deviceId,label:t.label}):t.kind==="video"+i&&e.push({kind:"video",id:t.deviceId,label:t.label})}),n(e)})}function c(t,e,i){void 0!==t.srcObject?t.srcObject=e:void 0!==t.mozSrcObject?t.mozSrcObject=e:void 0!==t.src?t.src=URL.createObjectURL(e):p("Error attaching stream to element.");var n=t.play();return void 0===n?"function"==typeof i&&i():n.then(function(){"function"==typeof i&&i()}).catch(function(t){p("Play() failed: "+t),"function"==typeof i&&i(t)}),t}function h(t,e){return t.src=e,t.play(),t}function d(t,e){return t.src=e.src,t}function f(t,e,i){e(function(e,t){switch(m.browser){case"Edge":t.forEach(function(t){t.mediaType=function(t,i){var n,e,r,s;if(i)return r=(e=e=t).localDescription.sdp.split("m="),s=e.remoteDescription.sdp.split("m="),r.length===s.length&&o.findIndex(r,function(t,e){return function(t){o.startsWith(t,"video")&&o.includes(t.toLowerCase(),i.toLowerCase())&&(n="video"),o.startsWith(t,"audio")&&o.includes(t.toLowerCase(),i.toLowerCase())&&(n="audio")}(t)}),n}(e,t.codecId),t.bytesSent=l(t.packetsSent,t.mediaType),t.bytesReceived=l(t.packetsReceived,t.mediaType)});break;case"Safari":t.forEach(function(t){o.includes(t.id.toLowerCase(),"audio")&&o.includes(t.id.toLowerCase(),"rtp")&&(t.mediaType="audio"),o.includes(t.id.toLowerCase(),"video")&&o.includes(t.id.toLowerCase(),"rtp")&&(t.mediaType="video")})}return t}(t,i))}function l(t,e){var i=parseInt(t)||0;return"audio"===e?100*i:"video"===e?1080*i:void 0}var p=function(){console.log.apply(console,arguments)},m=new t(navigator.userAgent).detect(),v=r.RTCPeerConnection,g=r.RTCSessionDescription,y=r.RTCIceCandidate,w=null,b=null,k=null,S=null,I=null,T=null,R=null,E=!1;return function(){!function(){if(v=r.RTCPeerConnection,g=r.RTCSessionDescription,y=r.RTCIceCandidate,navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(w=o.bind(a,null,"input")),navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(b=o.bind(a,null,"output")),(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||r.getUserMedia)&&(k=n),!r.RTCPeerConnection)return p("[%s] browser version [%s] does not appear to be WebRTC-capable",m.browser,m.version);switch(m.browser){case"Firefox":p("Firefox detected",m),I=c,R=d,S=function(t,e,i,n){t.getStats(e,o.bind(f,this,t,i),n)},E=!0;break;case"Opera":p("Opera detected",m),I=c,R=d,S=function(t,e,i,n){t.getStats(o.bind(f,this,t,i),e,n)},E=!0;break;case"Chrome":p("Webkit detected",m),I=c,R=d,S=function(t,e,i,n){t.getStats(o.bind(f,this,t,i),e,n)},E=!0;break;case"Edge":p("Edge detected",m),I=c,R=d,S=function(t,e,i,n){t.getStats(e,o.bind(f,this,t,i),n)},E=!0;break;case"Safari":p("Safari detected",m),I=function(t,e,i){return o.nt(e)&&(t.__phenixHasPlayedWebRtc=!0),c(t,e,i)},T=function(t,e){return t.__phenixHasPlayedWebRtc?((t=new i(t,e,!1).getElement()).play(),t):h(t,e)},R=d,S=function(t,e,i,n){t.getStats(e).then(o.bind(f,this,t,i),n)},E=!0;break;case"ReactNative":p("React Native detected",m),I=function(){p("attachMediaStream not supported in React Native environment")},T=function(){p("attachUriStream not supported in React Native environment")},R=function(){p("reattachMediaStream not supported in React Native environment")},S=function(t,e,i,n){t.getStats(e).then(o.bind(f,this,t,i),n)},E=!0;break;default:p("Browser does not appear to be WebRTC-capable",m)}}();var t={RTCPeerConnection:v,RTCSessionDescription:g,RTCIceCandidate:y,getSources:w,getDestinations:b,getUserMedia:k,getStats:S,attachMediaStream:I,attachUriStream:T||h,reattachMediaStream:R,webrtcSupported:E,exportGlobal:function(){r.RTCPeerConnection=t.RTCPeerConnection,r.RTCSessionDescription=t.RTCSessionDescription,r.RTCIceCandidate=t.RTCIceCandidate}};return t}}.apply(e,n))||(t.exports=r)},function(t,e){t.exports=V}],Y={},X.m=W,X.c=Y,X.i=function(t){return t},X.d=function(t,e,i){X.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},X.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return X.d(e,"a",e),e},X.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},X.p="",X(X.s=12))},function(t,e,i){var n,r;n=[i(36),i(37)],void 0===(r=function(t,e){return{Disposable:t,DisposableList:e}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(20),i(40)],void 0===(r=function(t,e){return{Event:t,NamedEvents:e}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(62)],void 0===(r=function(t){"use strict";return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{networkStates:{networkEmpty:{id:0,name:"NETWORK_EMPTY"},networkIdle:{id:1,name:"NETWORK_IDLE"},networkLoading:{id:2,name:"NETWORK_LOADING"},networkNoSource:{id:3,name:"NETWORK_NO_SOURCE"}},types:{realTime:{id:0,name:"real-time"},dash:{id:1,name:"dash"},hls:{id:2,name:"hls"},rtmp:{id:0,name:"rtmp"}},streamEvents:{playerEnded:{id:0,name:"playerended"},playerError:{id:1,name:"playererror"},stopped:{id:2,name:"stopped"}},rendererEvents:{ended:{id:0,name:"ended"},error:{id:1,name:"error"},autoMuted:{id:2,name:"autoMuted"},failedToPlay:{id:3,name:"failedToPlay"}}}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(19),i(38),i(39)],void 0===(r=function(t,e,i){"use strict";return{Observable:t,ObservableArray:e,ObservableMonitor:i}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(42)],void 0===(r=function(t){"use strict";return t()}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(41),i(44),i(13)],void 0===(r=function(t,e,i){"use strict";return{createLogger:function(){return new t},Logger:t,ConsoleAppender:e,level:i.level}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4)],void 0===(r=function(i,n,r){"use strict";function t(t,e){n.nt(t,"logger"),this.rt=t,this.st=new r.Event,this.ot=null,this.at=!1,this.ut=null,this.ct={pollFrequency:500,previousWidth:0,previousHeight:0},e&&e.pollFrequency&&(this.ct.pollFrequency=15<=e.pollFrequency?e.pollFrequency:15),this.ht=null}function s(){if(this.at&&!this.ot&&0!==this.st.size()){var t=this;this.ct.previousWidth=this.ut.videoWidth,this.ct.previousHeight=this.ut.videoHeight,this.ot=setInterval(function(){t.ut.videoWidth===t.ct.previousWidth&&t.ut.videoHeight===t.ct.previousHeight||(t.ct.previousWidth=t.ut.videoWidth,t.ct.previousHeight=t.ut.videoHeight,t.st.fireAsync([t.ht,{width:t.ut.videoWidth,height:t.ut.videoHeight}]))},t.ct.pollFrequency)}}return t.prototype.start=function(t,e){(function(t,e){e&&!i.isUndefined(e.videoWidth)||this.rt.warn("Attempting to start dimensions changed monitor without providing proper 'video' element."),this.ht=t,this.ut=e,this.at=!0,s.call(this)}).call(this,t,e)},t.prototype.stop=function(){(function(){this.at=!1,this.ot&&(clearInterval(this.ot),this.ot=null),this.st.dispose()}).call(this)},t.prototype.addVideoDisplayDimensionsChangedCallback=function(t){return n.it(t,"addVideoDisplayDimensionsChangedCallback"),s.call(this),this.st.listen(t)},t.prototype.toString=function(){return"DimensionsChangedMonitor[pollFrequency="+this.ct.pollFrequency+", previousHeight="+this.ct.previousHeight+", previousWidth="+this.ct.previousHeight+", state="+(this.ot?"running":"stopped")+"]"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(64)],void 0===(r=function(t){"use strict";return new t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{isSupported:!1}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{level:{TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,FATAL:5}}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(0)],void 0===(r=function(e){"use strict";return{parseEnvFromPcastBaseUri:function(t){return t=t.toLowerCase(),e.includes(t,"local")?"local":e.includes(t,"stg")?"staging":"production"}}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(48),i(59),i(23)],void 0===(r=function(t,e,i){return{MQWebSocket:t,BatchHttpProto:e,MQService:i}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(2)],void 0===(r=function(h,r){"use strict";function t(){}function d(t,e,i,n,r){return h.dt(t)?t:h.dt(e)?e:h.dt(i)?i:h.dt(n)?n:r}function f(t,e,i,n,r){return h.ft(t)?t:h.ft(e)?e:h.ft(i)?i:h.dt(n)?n:r}function l(t,e){var i=parseInt(t,e);if(!isNaN(i))return i}function p(t){var e=parseFloat(t);if(!isNaN(e))return e}function m(t){return h.includes(t.id,"send")||h.includes(t.id,"outbound")||"outboundrtp"===t.type||"outbound-rtp"===t.type||"kOutboundRtp"===t.type}function v(t){return h.includes(t.id,"recv")||"inboundrtp"===t.type||"inbound-rtp"===t.type||"kInboundRtp"===t.type}return t.convertPeerConnectionStats=function(i,t){return function(t,u){if(!i)return null;var c=[],e=function(e){var n={};switch(r.browser){case"Firefox":return h.forOwn(e,function(i,t){h.includes(t,"rtcp")&&h.forOwn(e,function(t,e){h.includes(e,"rtp")&&i.mediaType===t.mediaType&&(t.jitter=1e3*(i.jitter||t.jitter),t.roundTripTime=i.roundTripTime)})}),e;case"IE":return h.forOwn(e,function(t,e){h.startsWith(e,"ssrc")&&(n[t.id]=t)}),n;case"Edge":return e.forEach(function(t){n[t.id]=t,h.hasIndexOrKey(t,"jitter")&&(t.jitter*=1e3)}),h.forOwn(n,function(e){"track"===e.type&&h.hasIndexOrKey(e,"framesPerSecond")&&h.forOwn(n,function(t){"video"===t.mediaType&&(t.framesPerSecond=parseInt(e.framesPerSecond,10))})}),n;case"Safari":return e.forEach(function(t){n[t.id]=t}),h.forOwn(n,function(e){if(h.hasIndexOrKey(e,"id")&&v(e)){var t=parseInt(h.get(e.id.split("_"),[1]),10);e.ssrc=t||e.ssrc}h.hasIndexOrKey(e,"jitter")&&(e.jitter*=1e3),"candidate-pair"===e.type&&h.forOwn(n,function(t){"audio"!==t.mediaType&&"video"!==t.mediaType||(t.currentRoundTripTime=1e3*e.currentRoundTripTime)}),"track"===e.type&&h.forOwn(n,function(t){"audio"===t.mediaType&&v(t)?t.audioOutputLevel=1e5*e.audioLevel:"audio"===t.mediaType&&m(t)&&(t.audioInputLevel=1e5*e.audioLevel)})}),n;case"ReactNative":return(h.ft(e)?JSON.parse(e):e).forEach(function(t){var i={id:t.id,type:t.type};t.values.forEach(function(e){h.keys(e).forEach(function(t){i[t]=e[t]})}),i.timestamp=t.timestamp,n[i.id]=i}),n;case"Chrome":default:return e.result().forEach(function(e){var i={id:e.id,type:e.type};e.names().forEach(function(t){i[t]=e.stat(t)}),i.timestamp=e.timestamp.getTime(),n[i.id]=i}),n}}(i);return h.forOwn(e,function(t){if(h.hasIndexOrKey(t,"ssrc")&&t.ssrc&&!h.includes(t.id,"rtcp")){var e=t.id||t.ssrc;h.hasIndexOrKey(u,e)||(u[e]={timestamp:h.now()});var i="?",n=parseFloat(t.timestamp)-u[e].timestamp,r=function(t,e,i){if(!h.isUndefined(e))return t?8*(t-(e||0))/i:0}(parseFloat(t.bytesSent),u[e].bytesSent,n),s=function(t,e,i){if(!h.isUndefined(e))return t?8*(t-(e||0))/i:0}(parseFloat(t.bytesReceived),u[e].bytesReceived,n),o=function(t,e,i){if(!h.isUndefined(e))return(t-e)/(i/1e3)}(d(l(t.framesEncoded),l(t.framesDecoded)),u[e].framesEncoded||u[e].framesDecoded,n);m(t)&&(i="upload"),v(t)&&(i="download");var a={uploadRate:r,downloadRate:s,mediaType:t.mediaType,ssrc:t.ssrc,direction:i,nativeReport:t,rtt:d(l(t.rtt),l(t.googRtt),l(t.roundTripTime),l(t.currentRoundTripTime)),bitrateMean:l(t.bitrateMean,10)||1e3*(m(t)?r:s),targetDelay:l(f(t.targetDelay,t.googTargetDelayMs),10),currentDelay:l(f(t.currentDelay,t.currentDelayMs,t.googCurrentDelayMs),10)};h.assign(u[e],t),"video"===t.mediaType&&(a=h.assign(a,{droppedFrames:l(t.droppedFrames,10)||0,framerateMean:d(t.framerateMean,t.framesPerSecond,o)||0,cpuLimitedResolution:f(t.cpuLimitedResolution,t.googCpuLimitedResolution),avgEncode:l(f(t.avgEncode,t.avgEncodeMs,t.googAvgEncodeMs),10)})),"audio"===t.mediaType&&(a=h.assign(a,{audioInputLevel:f(t.audioInputLevel,t.googAudioInputLevel),audioOutputLevel:f(t.audioOutputLevel,t.googAudioOutputLevel),jitter:l(f(t.jitter,t.jitterReceived,t.googJitterReceived),10),jitterBuffer:l(f(t.jitterBuffer,t.jitterBufferMs,t.googJitterBufferMs),10),totalSamplesDuration:p(t.totalSamplesDuration),totalAudioEnergy:p(t.totalAudioEnergy)})),c.push(a)}}),c}(0,t)},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(2),i(8),i(28),i(6)],void 0===(r=function(o,i,e,n,r,a){"use strict";var s=[a.types.realTime.name,a.types.dash.name,a.types.hls.name];function u(t){t=t||s,i.isArray(t,"features"),o.forEach(t,function(t,e){i.lt(t,a.types,"FeatureType["+e+"]")}),this.pt=o.map(t,o.bind(o.getEnumName,o,a.types))}function c(){var t=o.get(n,["navigator","userAgent"],"");return/iPad|iPhone|iPod/.test(t)&&!n.MSStream}function t(){var t=o.get(n,["navigator","userAgent"],"");return/SamsungBrowser/.test(t)}function h(t,e){return o.includes(t,e)||t.push(e),t}return u.isFeatureSupported=function(t){switch(t&&i.mt(t,"feature"),o.getEnumName(a.types,t)){case a.types.realTime.name:return e.webrtcSupported;case a.types.dash.name:case a.types.hls.name:case a.types.rtmp.name:return r.canPlaybackType(t);default:return!1}},u.mapFeatureToPCastCapability=function(t){switch(t&&i.mt(t,"feature"),o.getEnumName(a.types,t)){case a.types.realTime.name:return"real-time";case a.types.dash.name:case a.types.hls.name:return"streaming";case a.types.rtmp.name:return"rtmp";default:return""}},u.mapPCastCapabilitiesToFeatures=function(t){return i.isArray(t,"capabilities"),o.reduce(t,function(t,e){return t.concat(u.mapPCastCapabilityToFeatures(e))},[])},u.mapPCastCapabilityToFeatures=function(t){return t&&i.mt(t,"capability"),"real-time"===t?[a.types.realTime.name]:"streaming"===t?[a.types.dash.name,a.types.dash.name]:"rtmp"===t?[a.types.rtmp.name]:[]},u.prototype.getFeatures=function(){return this.pt},u.prototype.getFeaturePCastCapabilities=function(){var t=o.map(this.pt,u.mapFeatureToPCastCapability);return o.reduce(t,h,[])},u.prototype.getPreferredFeatureFromPublisherCapabilities=function(r,s){i.isArray(r,"capabilities");var t=o.reduce(this.pt,function(t,e){var i=u.mapFeatureToPCastCapability(e),n=u.isFeatureSupported(e)&&(o.includes(r,i)||"real-time"===e&&!s);return t||(n?e:null)},null);return t===a.types.dash.name&&u.shouldUseNativeHls&&o.includes(r,u.mapFeatureToPCastCapability(a.types.hls.name))&&o.includes(this.pt,a.types.hls.name)?t=a.types.hls.name:t===a.types.hls.name&&!u.shouldUseNativeHls&&o.includes(r,u.mapFeatureToPCastCapability(a.types.dash.name))&&o.includes(this.pt,a.types.dash.name)&&(t=a.types.dash.name),t},u.shouldUseNativeHls=c()||"Safari"===e.browser||t(),u.isIOS=c,u.isSamsungBrowser=t,u.isAndroid=function(){var t=o.get(n,["navigator","userAgent"],"");return/(android)/i.test(t)},u.isMobile=function(){var t=o.get(n,["navigator","userAgent"],"");return c()||/Android|webOS|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(t)},u.getIOSVersion=function(){var t=o.get(n,["navigator","userAgent"],"");if(/iP(hone|od|ad)/.test(t)){var e=t.match(/.*OS (\d+)_(\d+)_?(\d+)? like Mac OS X/);return{major:parseInt(o.get(e,[1],0),10),minor:parseInt(o.get(e,[2],0),10),patch:parseInt(o.get(e,[3],0),10)}}},u}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(34)],void 0===(r=function(t){return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(3)],void 0===(r=function(s,o,a){"use strict";function t(t,e){this.latestValue=null,this.subscribeCallbacks={},this.subscriptionTimeout=100,this.subscriptionCount=0,this.resetOnChange=!1,this.lastChangeTime=0,this.isPendingChanges=!1,this.beforeChange=e,n.call(this,t)}function i(t){return null==t?t:s.isArray(t)?t.slice():t}function n(t){var e=t;this.beforeChange&&(e=this.beforeChange(t)),this.latestValue=i(e)}function u(t,e){if(this.lastChangeTime=s.now(),!this.isPendingChanges&&0!==this.subscriptionCount){if(this.isPendingChanges=!0,e)return r.call(this);(function e(t){var i=this;setTimeout(function(){var t=s.now()-i.lastChangeTime;i.resetOnChange&&t<i.subscriptionTimeout?e.call(i,i.subscriptionTimeout-t):r.call(i)},t)}).call(this,t)}}function r(){try{(function(){var e=this;s.forOwn(e.subscribeCallbacks,function(t){s.it(t)&&t(e.latestValue)})}).call(this)}finally{this.isPendingChanges=!1}}return t.prototype.getValue=function(){return i(this.latestValue)},t.prototype.setValue=function(t){t!==this.latestValue&&(n.call(this,t),u.call(this,this.subscriptionTimeout))},t.prototype.subscribe=function(t,e){o.it(t,"callback"),e&&o.nt(e,"options");var i,n=this,r=s.uniqueId();return n.subscribeCallbacks[r]=t,n.subscriptionCount+=1,e&&("notify"===e.initial&&u.call(n,n.subscriptionTimeout,!0),e.listenForChanges&&(i=setInterval(function(){var t=e.listenForChanges.callback();t!==n.latestValue&&n.setValue(t)},e.listenForChanges.timeout))),new a.Disposable(function(){delete n.subscribeCallbacks[r],i&&(clearInterval(i),i=null),n.subscriptionCount-=1})},t.prototype.extend=function(t){switch(o.nt(t,"options"),t.method){case"notifyWhenChangesStop":this.subscriptionTimeout=t.timeout,this.resetOnChange=!0;break;case"notifyAtFixedRate":this.subscriptionTimeout=t.timeout}return s.dt(t.rateLimit)&&(this.subscriptionTimeout=t.rateLimit),this},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(3)],void 0===(r=function(s,o,i){"use strict";function t(){this.vt=[]}function n(e,i,t){var n=this;function r(){s.forEach(n.vt,function(t){t.apply(i,e)})}s.isNullOrUndefined(e)&&(e=[]),o.isArray(e,"args"),t?setTimeout(function(){r(),t()},0):r()}return t.prototype.fire=function(t,e){n.call(this,t,e)},t.prototype.fireAsync=function(t,e,i){n.call(this,t,e,i||function(){})},t.prototype.listen=function(e){var t=this;return o.it(e,"listener"),t.vt.push(e),new i.Disposable(function(){t.vt=s.remove(t.vt,function(t){return t===e})})},t.prototype.size=function(){return this.vt.length},t.prototype.dispose=function(){this.vt=[]},t.prototype.toString=function(){return"Event|"+this.size()},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(7),i(3),i(45),i(5),i(11),i(14),i(65),i(66),i(69),i(72),i(73),i(26),i(10),i(74),i(76),i(77),i(16),i(79),i(28),i(83),i(17),i(6),i(29),i(2),i(27)],void 0===(r=function(I,T,r,s,o,t,a,R,e,u,c,h,n,b,i,d,l,f,k,v,p,g,E,x,S,C,y){"use strict";var m=50;function w(t){function e(t){var e=t?t.error:"Unknown Error";i.rt.error("Window Error Event Triggered with pcast in [%s] state [%s]",i.gt.getValue(),e,e)}t=t||{},T.nt(t,"options"),t.streamingSourceMapping&&(T.nt(t.streamingSourceMapping,"options.streamingSourceMapping"),T.mt(t.streamingSourceMapping.replacement,"options.streamingSourceMapping.replacement"),t.streamingSourceMapping.patternToReplace instanceof RegExp||T.mt(t.streamingSourceMapping.patternToReplace,"options.streamingSourceMapping.patternToReplace")),I.isNullOrUndefined(t.disableMultiplePCastInstanceWarning)||T.yt(t.disableMultiplePCastInstanceWarning,"options.disableMultiplePCastInstanceWarning"),I.isNullOrUndefined(t.disableGlobalErrorListener)||T.yt(t.disableGlobalErrorListener,"options.disableGlobalErrorListener"),I.isNullOrUndefined(t.disableBeforeUnload)||T.yt(t.disableBeforeUnload,"options.disableBeforeUnload"),I.isNullOrUndefined(t.disableConsoleLogging)||T.yt(t.disableConsoleLogging,"options.disableConsoleLogging"),I.isNullOrUndefined(t.treatBackgroundAsOffline)||T.yt(t.treatBackgroundAsOffline,"options.treatBackgroundAsOffline"),I.isNullOrUndefined(t.reAuthenticateOnForeground)||T.yt(t.reAuthenticateOnForeground,"options.reAuthenticateOnForeground"),!0===t.treatBackgroundAsOffline&&!1===t.reAuthenticateOnForeground&&this.rt.warn('Conflicting options "reAuthenticateOnForeground" can not be false when "treatBackgroundAsOffline" is true. Will reauthenticate upon entering foreground.'),this.gt=new r.Observable("offline"),this.wt=t.uri||c.DefaultPCastUri,this.bt=t.deviceId||"",this.Z="2019-11-22T20:59:57Z",this.rt=t.logger||o.createPCastLogger(this.wt,t.disableConsoleLogging),this.kt=t.metricsTransmitter||d.createMetricsTransmitter(this.wt),this.St=new h(t,this.rt),this.It=t.shaka,this.Tt=t.videojs||C.global.videojs,this.Rt=t.rtmp||{},this.Et=t.streamingSourceMapping,this.g=new s.DisposableList,this.xt=t.disableMultiplePCastInstanceWarning,this.Ct=!0===t.treatBackgroundAsOffline,this.Mt=!0===t.reAuthenticateOnForeground,this.Pt=0,this.Ot=0,this.qt=!0,this.Dt=[],this.At=[],this.Ft=new E(t.features),this.Nt={},this.Ut={};var i=this,n=I.filter(this.Ft.getFeatures(),E.isFeatureSupported);this.rt.info("Device supports features [%s], user selected [%s]",n,this.Ft.getFeatures()),I.addEventListener(C.global,"unload",function(){return i.rt.info("Window Unload Event Triggered"),i.stop("window-unload")}),t.disableGlobalErrorListener||(I.addEventListener(C.global,"error",e),C.global.__phenixGlobalErrorListenerDisposable&&C.global.__phenixGlobalErrorListenerDisposable.dispose(),C.global.__phenixGlobalErrorListenerDisposable=new s.Disposable(function(){I.removeEventListener(C.global,"unload",e)})),t.disableBeforeUnload||I.addEventListener(C.global,"beforeunload",function(){return i.rt.info("Window Before Unload Event Triggered"),i.stop("window-beforeunload")}),C.webrtcSupported||"ReactNative"!==C.browser||C.shim(),C.webrtcSupported&&(function(){var i=this,n=new C.RTCPeerConnection;"Safari"===C.browser&&10<C.browserVersion&&(n.addTransceiver("audio"),n.addTransceiver("video"));try{var t=function(t){var e=y.getH264ProfileIds(t.sdp);if(i.At=y.getSupportedCodecs(t.sdp),i.rt.info("Supported WebRTC video codecs [%s]",i.At),0===e.length)return i.rt.info("Unable to find local h264 profile level id",t.sdp);i.rt.info("Found local h264 profile level ids [%s]",e,t.sdp),i.Dt=e,n.close&&n.close()},e=function(t){i.rt.error("Unable to create offer to get local h264 profile level id",t),n.close&&n.close()},r={offerToReceiveAudio:!0,offerToReceiveVideo:!0};if("function"==typeof C.global.Promise)return n.createOffer(r).then(t).catch(e);n.createOffer(t,e,r)}catch(t){i.rt.error("Failed to set environment defaults. Creating the Offer failed",t),n.close&&n.close()}}.call(this),B.call(this))}function M(){var i=this;if(i.jt)i.rt.warn("[%s] Skip connect due to stopped state",i);else{D.call(i)&&"offline"===i.gt.getValue()&&(this.rt.warn("[PCast] connected after being offline. Reconnecting."),P.call(i)),this.Lt=!0;var n=i.Bt,r=++i.Pt;n.authenticate(i.Wt,function(t,e){n===i.Bt?r===i.Pt?i._t&&(t?(i.rt.error("Failed to authenticate [%s]",t),X.call(i,"unauthorized"),i._t.call(i,i,"unauthorized","")):"ok"!==e.status?(i.rt.warn("Failed to authenticate, status [%s]",e.status),X.call(i,"unauthorized"),i._t.call(i,i,"unauthorized","")):(X.call(i,"online"),i._t.call(i,i,e.status,e.sessionId))):i.rt.info("Ignoring authentication response as a latter request is already underway"):i.rt.info("Ignoring authentication response as reset took place")})}}function P(){X.call(this,"reconnecting")}function O(t){t&&T.ft("reason",t),X.call(this,"reconnected",t),this.rt.info("Attempting to re-authenticate after reconnected event [%s]",t),function(){var r=this;if(r.jt)r.rt.info("Skip re-authentication due to stopped state");else{var s=r.Bt,o=++r.Ot;s.authenticate(r.Wt,function(t,e){var i=!0===r.Lt;if(s===r.Bt){if(o===r.Ot){if(t)return r.rt.error("Unable to authenticate after reconnect to WebSocket [%s]",t),X.call(r,"reconnect-failed");if("ok"===e.status)return r.Lt=!0,r.rt.info("Successfully authenticated after reconnect to WebSocket"),X.call(r,"online",null,i);r.rt.warn("Unable to authenticate after reconnect to WebSocket, status [%s]",e.status);var n="capacity"===e.status?e.status:"reconnect-failed";return X.call(r,n)}r.rt.info("Ignoring re-authentication response as a latter request is already underway")}else r.rt.info("Ignoring re-authentication response as reset took place")})}}.call(this)}function q(){if(D.call(this)&&"reconnecting"===this.gt.getValue())return this.rt.warn("[PCast] disconnected after attempting to reconnect. Going offline."),X.call(this,"critical-network-issue"),this.stop("critical-network-issue");this.Lt=!1,X.call(this,"offline")}function D(){return I.reduce(this.Vt,function(t,e){return t?"closed"===e.iceConnectionState:t},!0)}function A(t){var e=t.streamId,i=t.reason;return N.call(this,e,i)}function F(t){var e=t.streamId,i=t.status,n=t.reason,r=this.zt[e];r&&r.dataQualityChangedCallback(i,n);var s=this.Gt[e];s&&I.it(s.dataQualityChangedCallback)&&s.dataQualityChangedCallback(s,i,n)}function N(t,e){this.rt.info("[%s] Stream ended with reason [%s]",t,e);var i=this.zt[t];i&&i.streamEndedCallback(v.getStreamEndedStatus(e),e,!0),delete this.zt[t];var n=this.Gt[t];n&&I.it(n.publisherEndedCallback)&&n.publisherEndedCallback(n,v.getStreamEndedStatus(e),e),delete this.Gt[t];var r=this.Vt[t];r&&Y.call(this,t,r,"ended"),delete this.Vt[t]}function U(a,u,c,h,d,f){function t(t){if(!u.failed&&!m){var e=y.getNumberOfActiveSections(c),i=t.stream||I.get(t,["streams",0]),n="real-time";if(!i)return u.failed=!0,p.rt.warn("[%s] No remote stream",a),d.call(p,void 0,"failed");if(l&&clearTimeout(l),e===i.getTracks().length||"ReactNative"===C.browser){m=!0,p.rt.info("[%s] Got remote stream",a),h.setProperty("kind",n);var r=I.assign({networkLag:p.Jt},f),s=new g(a,i,c,h,r,p.rt),o=new v(n,s,p.rt);o.on(x.streamEvents.playerError.name,function(t,e){p.rt.info("Phenix Real-Time stream error [%s] [%s]",t,e),o.streamErrorCallback(n,e)}),o.on(x.streamEvents.stopped.name,function(t){!u.stopped&&p.Bt&&(p.rt.info("[%s] media stream has stopped with reason [%s]",a,t),Y.call(p,a,c,"stop"),p.Bt.destroyStream(a,t||"",function(t,e){t?p.rt.error("[%s] failed to destroy stream [%s]",a,t):"ok"===e.status?p.rt.info("[%s] destroyed stream",a):p.rt.warn("[%s] failed to destroy stream, status [%s]",a,e.status)}),u.stopped=!0)}),p.zt[a]=o,d.call(p,s)}else l=setTimeout(function(){return u.failed=!0,p.rt.warn("[%s] Did not receive all tracks within [%s] ms",a,3e3),d.call(p,void 0,"failed")},3e3)}}var l,p=this,m=!1;I.addEventListener(c,"addstream",t),I.addEventListener(c,"track",t)}function j(i,t,n){var r=this;I.addEventListener(t,"icecandidate",function(t){var e=t.candidate;e?r.rt.info("[%s] ICE candidate: [%s] [%s] [%s]",i,e.sdpMid,e.sdpMLineIndex,e.candidate):r.rt.info("[%s] ICE candidate discovery complete",i),n&&n(e)})}function L(e,i){var n=this;I.addEventListener(i,"negotiationneeded",function(t){n.rt.info("[%s] Negotiation needed",e)}),I.addEventListener(i,"iceconnectionstatechange",function(t){n.rt.info("[%s] ICE connection state changed [%s]",e,i.iceConnectionState)}),I.addEventListener(i,"icegatheringstatechange ",function(t){n.rt.info("[%s] ICE gathering state changed [%s]",e,i.iceGatheringState)}),I.addEventListener(i,"signalingstatechange",function(t){n.rt.info("[%s] Signaling state changed [%s]",e,i.signalingState)}),I.addEventListener(i,"connectionstatechange",function(t){n.rt.info("[%s] Connection state changed [%s]",e,i.connectionState)})}function B(e){var i=this;switch(C.browser){case"Edge":return C.getDestinations(function(t){0===I.filter(t,function(t){return"audio"===t.kind}).length?(i.qt&&i.rt.info("Detected no audio devices attached to machine"),i.qt=!1):i.qt=!0,e&&e()});default:e&&e()}}function W(t,n,e,i,r,s){if("IE"===C.browser)throw new Error("Subscribing in real-time not supported on IE");var o=this,a={failed:!1,stopped:!1},u=e.match(/a=crypto:/i),c=e.match(/m=application /i),h=new C.RTCPeerConnection(t,{optional:[{DtlsSrtpKeyAgreement:!u},{RtpDataChannels:c}]});if(nt(h),o.Vt[n]=h,"Firefox"===C.browser||"Edge"===C.browser){if(e.match(/(\nm=video)/g)&&e.match(/(\nm=audio)/g)){var d=/(a=candidate)((.|\n)*)(?=m=)/g;e=e.replace(d,e.match(d)+"a=end-of-candidates\n")}e=(e+="a=end-of-candidates").replace(/(\na=ice-options:trickle)/g,"")}function f(t){a.failed||(t instanceof Error&&(o.rt.info("[%s] Failed to setup peer connection",n,t),t="failed"),a.failed=!0,a.stopped=!0,delete o.Vt[n],delete o.zt[n],delete o.Ht[n],Y.call(o,n,h,"failure"),r.call(o,void 0,t||"failed"))}"ReactNative"===C.browser&&(e=y.setGroupLineOrderToMatchMediaSectionOrder(e)),U.call(o,n,a,h,i,r,s),j.call(o,n,h,function(t){o.Ht[n]&&o.Ht[n](t)}),L.call(o,n,h);var l=new C.RTCSessionDescription({type:"offer",sdp:e}),p={mandatory:{}};if("Chrome"===C.browser||"ReactNative"===C.browser?(p.mandatory.OfferToReceiveVideo=!1!==s.receiveVideo,p.mandatory.OfferToReceiveAudio=!1!==s.receiveAudio):(p.mandatory.offerToReceiveVideo=!1!==s.receiveVideo,p.mandatory.offerToReceiveAudio=!1!==s.receiveAudio),"function"==typeof C.global.Promise)return h.setRemoteDescription(l).then(I.bind(V,o,h)).then(function(){return h.createAnswer(p)}).then(I.bind(z,o)).then(function(i){return new C.global.Promise(function(t,e){G.call(o,n,i,t,e)})}).then(function(t){return h.setLocalDescription(t)}).then(I.bind(_,o,h)).catch(f);h.setRemoteDescription(l,function(){V.call(o,h),h.createAnswer(function(t){z.call(o,t),G.call(o,n,t,function(t){h.setLocalDescription(t,I.bind(_,o,h),f)},f)},f,p)},f)}function _(t){this.rt.debug("Set local description [%s] [%s]",I.get(t,["localDescription","type"]),I.get(t,["localDescription","sdp"]))}function V(t){this.rt.debug("Set remote description [%s] [%s]",I.get(t,["localDescription","type"]),I.get(t,["remoteDescription","sdp"]))}function z(t){return this.rt.info("Created answer [%s]",t.sdp),t}function G(s,t,o,a){var u=this;u.Bt.setAnswerDescription(s,t.sdp,function(t,e){if(t)return u.rt.error("Failed to set answer description [%s]",t),a();if("ok"!==e.status)return u.rt.warn("Failed to set answer description, status [%s]",e.status),a(e.status);e&&I.includes(e.options,"ice-candidates")&&(u.Ht[s]=I.bind(J,u,s));var i=e.sessionDescription.sdp;if(E.isIOS()){var n=I.get(E.getIOSVersion(),["major"]);u.rt.info("iOS Version is [%s]",n),n<11&&(i=i.replace("BUNDLE audio video","BUNDLE video audio"))}var r=new C.RTCSessionDescription({type:"answer",sdp:i});o(r)})}function J(t,e){var i=this,n=this.Nt[t];n=n||(this.Nt[t]=[]),e&&I.get(e,["candidate"])?n.push(e):(i.Ut[t]&&(i.rt.debug("[%s] Dismissing scheduled batch for adding ICE candidates. Sending candidates immediately because there are no more candidates.",t),clearTimeout(i.Ut[t])),H.call(i,t,["completed"]),delete this.Nt[t],delete this.Ut[t]),this.Ut[t]?i.rt.debug("[%s] Using existing batch for adding ICE candidates",t):(this.Ut[t]=setTimeout(function(){H.call(i,t,[]),delete i.Ut[t]},m),this.g.add(new s.Disposable(function(){i.Ut[t]&&clearTimeout(i.Ut[t]),delete i.Nt[t],delete i.Ut[t]})))}function H(i,t){var e=this.Nt[i]||[];if(0!==e.length||0!==t.length){var n=this;delete n.Nt[i],this.rt.info("[%s] Adding [%s] ICE Candidates with Options [%s]",i,e.length,t),this.Bt.addIceCandidates(i,e,t,function(t,e){return t?n.rt.error("Failed to add ICE candidate [%s]",t):"ok"!==e.status?n.rt.warn("Failed to add ICE candidate, status [%s]",e.status):void(I.includes(e.options,"cancel")&&delete n.Ht[i])})}}function K(t,e,i,n,r){var s=this,o=/a=x-rtmp:(rtmp:\/\/[^\n]*)/m,a=e.match(o),u=e.match(/a=x-playlist:([^\n]*[.]mpd\??[^\s]*)/m),c=e.match(/a=x-playlist:([^\n]*[.]m3u8\??[^\s]*)/m),h=I.get(u,[1],""),d=I.get(c,[1],""),f=u&&2===u.length,l=c&&2===c.length,p=!!a,m=[];(f||l)&&m.push("streaming"),p&&m.push("rtmp");var v=this.Ft.getPreferredFeatureFromPublisherCapabilities(m,!0);switch(this.Et&&(h=h.replace(this.Et.patternToReplace,this.Et.replacement),d=d.replace(this.Et.patternToReplace,this.Et.replacement)),v){case x.types.rtmp.name:var g=[],y=R.parseEnvFromPcastBaseUri(this.wt);for(this.rt.info("Selecting flash playback for rtmp.");a;){var w=I.get(a,[1],""),b=I.get(w.match(/(rtmp:\/\/[^\n\s]*)/),[0]),k=I.get(w.match(/bitrate=([^\n\s;]*)/),[1]),S=I.get(w.match(/resolution=([^\n\s;]*)/),[1]);e=e.replace(w,""),b&&g.push({uri:b,bitrate:k,resolution:S}),a=e.match(o)}return Q.call(s,t,g,x.types.rtmp.name,i,n,I.assign({env:y},this.Rt,r));case x.types.dash.name:return this.rt.info("Selecting dash playback for live stream."),r.isDrmProtectedContent=/[?&]drmToken=([^&]*)/.test(h)||/x-widevine-service-certificate/.test(e),r.isDrmProtectedContent&&(r.widevineServiceCertificateUrl=e.match(/a=x-widevine-service-certificate:([^\n][^\s]*)/m)[1],r.playreadyLicenseUrl=e.match(/a=x-playready-license-url:([^\n][^\s]*)/m)[1]),this.It&&!this.It.Player.isBrowserSupported()?(this.rt.warn("[%s] Shaka does not support this browser",t),n.call(this,void 0,"browser-unsupported")):Q.call(s,t,h,x.types.dash.name,i,n,r);case x.types.hls.name:return this.rt.info("Selecting hls playback for live stream."),r.isDrmProtectedContent=/[?&]drmToken=([^&]*)/.test(d),r.hlsTargetDuration&&(T.dt(r.hlsTargetDuration,"options.hlsTargetDuration"),d=d+(-1<d.indexOf("?")?"&":"?")+"targetDuration="+r.hlsTargetDuration),Q.call(s,t,d,x.types.hls.name,i,n,I.assign({preferNative:E.shouldUseNativeHls},r))}return s.rt.warn("[%s] Device does not support [%s] playback. Creating live viewer stream failed.",t,E.mapPCastCapabilitiesToFeatures(m)),n.call(s,void 0,"failed")}function Q(i,t,e,n,r,s){var o=this,a=new p(e,i,t,n,s,this.It,this.rt),u=new v(e,a,this.rt);n.setProperty("kind",e),u.on(x.streamEvents.playerError.name,function(t,e){o.rt.warn("Phenix Live Stream Player Error [%s] [%s]",t,e),u.streamErrorCallback(t,e)}),u.on(x.streamEvents.stopped.name,function(t){if(!o.Bt)return o.rt.warn("Unable to destroy stream [%s]",i);o.Bt.destroyStream(i,t||"",function(t,e){t?o.rt.error("[%s] failed to destroy stream, [%s]",i,t):"ok"===e.status||o.rt.warn("[%s] failed to destroy stream, status [%s]",i,e.status)})}),this.zt[i]=u,r.call(this,u.getPhenixMediaStream())}function X(t,e,i){var n=this.getStatus();if(n!==t&&("critical-network-issue"!==n&&"offline"!==n||"offline"!==t)){this.gt.setValue(t);var r=this.getProtocol(),s=r?r.getSessionId():"";if(this.rt.debug("[%s] Transition from [%s] to [%s] with reason [%s]",s,n,t,e),i)return;switch(t){case"connecting":case"reconnecting":case"reconnected":break;case"critical-network-issue":case"unauthorized":case"reconnect-failed":case"offline":return this.Kt.call(this);case"online":return this.Qt.call(this)}}}function Y(t,e,i){"closed"===e.signalingState||e.__closing?this.rt.debug("[%s] Peer connection is already closed [%s]",t,i):(this.rt.debug("[%s] close peer connection [%s]",t,i),e.close(),e.__closing=!0)}function Z(){(this.Ct||this.Mt)&&O.call(this,"entered-foreground")}function $(){this.Ct&&X.call(this,"offline","entered-background")}function tt(t){if(!t)return t;var e=I.isArray(t)?[]:{},i=I.bind(et,null,e);return I.isArray(t)?I.forEach(t,i):I.forOwn(t,i),e}function et(t,e,i){if(null!==e){if(I.nt(e)||I.isArray(e))return t[i]=tt(e);if(!I.ft(e)||!I.ft(i))return t[i]=e;var n=I.startsWith(e.toLowerCase(),i.toLowerCase())?e.substring(i.length,e.length).toLowerCase():e;t[i]=n}}function it(t){switch(C.browser){case"Firefox":(i=t)&&I.forEach(i.iceServers,function(t){t.urls=I.filter(t.urls,function(t){return!I.startsWith(t,"turns")})});break;case"Edge":(e=t)&&I.forEach(e.iceServers,function(t){t.urls=I.map(t.urls,function(t){return t.replace("transport=tcp","transport=udp")})})}var e,i;return t}w.prototype.getBaseUri=function(){return this.wt},w.prototype.getStatus=function(){return this.gt.getValue()},w.prototype.getObservableStatus=function(){return this.gt},w.prototype.isStarted=function(){return this.Xt},w.prototype.reAuthenticate=function(t){if(T.mt(t,"authToken"),"online"===this.gt.getValue())return this.rt.warn("Already authenticated. Denying request to re-authenticate");this.rt.info("Attempting to re-authenticate with new auth token [%s]",t),this.Wt=t,O.call(this)},w.prototype.start=function(t,e,i,n){if(T.mt(t,"authToken"),T.it(e,"authenticationCallback"),T.it(i,"onlineCallback"),T.it(n,"offlineCallback"),this.Xt)throw new Error('"Already started"');I.dt(C.global.__phenixInstantiatedPCastCount)?C.global.__phenixInstantiatedPCastCount++:C.global.__phenixInstantiatedPCastCount=1,1<C.global.__phenixInstantiatedPCastCount&&!this.xt&&this.rt.warn("Avoid using multiple instances of PCast as this uses unnecessary resources and will reduce performance. This is your [%s] simultaneous instance. Remember to dispose all resources when done with them by calling .stop() or .dispose()",C.global.__phenixInstantiatedPCastCount),this.jt=!1,this.Xt=!0,this.Wt=t,this._t=e,this.Qt=i,this.Kt=n,this.Yt=new f(this.rt,this.kt),this.Zt=new c(this.Z,this.wt,this.rt,this.Yt),X.call(this,"connecting"),this.Vt={},this.zt={},this.Ht={},this.Gt={},this.$t=[],this.g.add(this.Zt),this.g.add(this.Yt),this.g.add(a.onBackground(I.bind($,this))),this.g.add(a.onForeground(I.bind(Z,this)));var r=this;r.Zt.resolveUri(function(t,e){if(t){if(r.rt.error("Failed to connect to [%s]",r.wt,t),X.call(r,"offline"),r._t)switch(t.code){case 0:r._t.call(r,r,"network-unavailable","");break;case 503:r._t.call(r,r,"capacity","");break;default:r._t.call(r,r,"failed","")}return r.jt=!0,void(r.Xt=!1)}r.rt.info("Discovered end point [%s] with RTT [%s]",e.uri,e.roundTripTime),r.Jt=e.roundTripTime/2,r.te=e.uri,r.Xt&&function(t){this.Bt=new u(t,this.bt,this.Z,this.rt),this.Bt.onEvent("connected",I.bind(M,this)),this.Bt.onEvent("reconnecting",I.bind(P,this)),this.Bt.onEvent("reconnected",I.bind(O,this)),this.Bt.onEvent("disconnected",I.bind(q,this)),this.Bt.onEvent("pcast.StreamEnded",I.bind(A,this)),this.Bt.onEvent("pcast.StreamDataQuality",I.bind(F,this)),this.rt.setObservableSessionId&&this.rt.setObservableSessionId(this.Bt.getObservableSessionId()),this.ee&&(this.ee.dispose(),this.Yt.setSessionId(null)),this.ee=this.Bt.getObservableSessionId().subscribe(I.bind(this.Yt.setSessionId,this.Yt))}.call(r,e.uri)})},w.prototype.stop=function(i){if(i=i||"",T.ft(i,"reason"),this.Xt){this.rt.info("Stopping pcast instance with reason [%s]",i),this.jt=!0,this.Xt=!1,delete this._t;try{var n=this;I.forOwn(this.zt,function(t,e){N.call(n,e,i)}),I.forOwn(this.Gt,function(t,e){N.call(n,e,i),I.includes(t.getOptions(),"detached")||t.stop(i,!0)}),I.forOwn(this.Vt,function(t,e){N.call(n,e,i)}),I.forEach(this.$t,function(t){var e=t.getTracks();I.forEach(e,function(t){t.stop()})})}finally{if(this.Bt){try{this.Bt.disconnect()}catch(t){n.rt.warn("Failed to disconnect pcast",t)}this.Bt=null}this.rt.setObservableSessionId&&this.rt.setObservableSessionId(null),this.ee&&(this.ee.dispose(),this.Yt.setSessionId(null)),C.global.__phenixInstantiatedPCastCount--,this.g.dispose()}}},w.prototype.getUserMedia=function(t,e,i){if("IE"===C.browser)throw new Error("Publishing not supported on IE");return T.nt(t,"options"),T.it(e,"callback"),i&&T.it(i,"onScreenShare"),new n(this.rt,this.St,i).getUserMedia(t,e)},w.prototype.publish=function(t,a,u,e,c){if("IE"===C.browser)throw new Error("Publishing not supported on IE");if(!this.Xt)throw new Error("PCast not started. Unable to publish. Please start pcast first.");if(e=e||[],c=c||{},T.mt(t,"streamToken"),T.it(u,"callback"),T.isArray(e,"tags"),T.nt(c,"options"),!I.nt(a)&&!I.ft(a))throw new Error('"streamToPublish" must be an object or URI');var h=this,d=I.assign({},c,{negotiate:!0});I.ft(a)?(d.negotiate=!1,d.connectUri=a):d.connectUri=c.connectUri,0<e.length&&(d.tags=e);var f=new l(this.getProtocol().getSessionId(),this.rt,this.kt);f.setProperty("resource","upload"),this.Bt.setupStream("upload",t,d,2*h.Jt,function(t,e){if(t)return h.rt.error("Failed to create uploader [%s]",t),u.call(h,h,"failed");if("ok"===e.status){var i=e.createStreamResponse.streamId;if(f.setStreamId(i),f.setStartOffset(e.createStreamResponse.offset),f.recordMetric("Provisioned"),f.recordMetric("RoundTripTime",{uint64:2*h.Jt},null,{resource:h.te,kind:"https"}),!0!==d.negotiate)return function(i,t,e){var n=this,r={stopped:!1},s={getStreamId:function(){return i},getStream:function(){return n.rt.debug("[%s] Unable to get stream on publisher of remote origin.",i),null},getStats:function(){return n.rt.debug("[%s] Unable to get stream stats on publisher of remote origin.",i),null},isActive:function(){return!r.stopped},hasEnded:function(){return r.stopped},stop:function(t){r.stopped||(n.rt.info("[%s] stopping publisher with reason [%s]",i,t),n.Bt.destroyStream(i,t||"",function(t,e){t?n.rt.error("[%s] failed to destroy stream [%s]",i,t):"ok"===e.status?n.rt.info("[%s] destroyed stream",i):n.rt.warn("[%s] failed to destroy stream, status [%s]",i,e.status)}),r.stopped=!0)},setPublisherEndedCallback:function(t){T.it(t,"callback"),this.publisherEndedCallback=t},setDataQualityChangedCallback:function(t){T.it(t,"callback"),this.dataQualityChangedCallback=t},getOptions:function(){return e},monitor:function(t,e){T.nt(t,"options"),T.it(e,"callback")},getMonitor:function(){return null}};t(n.Gt[i]=s)}.call(h,i,function(t,e){f.recordMetric("SetupCompleted",{string:e?"failed":"ok"}),e?u.call(h,h,"failed",null):u.call(h,h,"ok",t)},e.createStreamResponse.options);var n=e.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,r=it(tt(e.createStreamResponse.rtcConfiguration));if("Opera"===C.browser&&0<h.Dt.length){var s=I.get(y.getH264ProfileIds(n),[0]),o=y.getH264ProfileIdWithSameProfileAndEqualToOrHigherLevel(h.Dt,s);o?s!==o&&(h.rt.info("[%s] Replacing publisher h264 profile level id [%s] with new value [%s] in offer sdp",i,s,o),n=y.replaceH264ProfileId(n,s,o)):h.rt.warn("[%s] Unable to find new publisher h264 profile level id to replace [%s]. Rejected environment defaults of [%s]",i,s,h.Dt)}return function(t,s,u,e,i,c,n,h){var d=this,f={failed:!1,stopped:!1},r=e.match(/a=crypto:/i),o=e.match(/m=application /i),l=new C.RTCPeerConnection(t,{optional:[{DtlsSrtpKeyAgreement:!r},{RtpDataChannels:o}]}),p=null,m=null;if(nt(l),(d.Vt[u]=l).addStream(s),"Firefox"===C.browser||"Edge"===C.browser){if(e.match(/(\nm=video)/g)&&e.match(/(\nm=audio)/g)){var a=/(a=candidate)((.|\n)*)(?=m=)/g;e=e.replace(a,e.match(a)+"a=end-of-candidates\n")}e=(e+="a=end-of-candidates").replace(/(\na=ice-options:trickle)/g,"")}function v(t){f.failed||(t instanceof Error&&(d.rt.info("[%s] Failed to setup peer connection",u,t),t="failed"),f.failed=!0,f.stopped=!0,delete d.Vt[u],delete d.Gt[u],delete d.Ht[u],Y.call(d,u,l,"failure"),c.call(d,void 0,t||"failed"))}function g(){var r=/(b=AS:([0-9]*)[\n\r]*)/gi,o=/(mid:video)([\n\r]*)/gi,a=0,t=r.exec(e);t&&3<=t.length&&(a=1e3*t[2]);var n={getStreamId:function(){return u},getStream:function(){return s},isActive:function(){return!f.stopped},hasEnded:function(){switch(l.iceConnectionState){case"new":case"checking":case"connected":case"completed":return!1;case"disconnected":case"failed":case"closed":default:return!0}},stop:function(t){!f.stopped&&d.Bt&&(d.rt.info("[%s] stopping publisher with reason [%s]",u,t||"client-action"),Y.call(d,u,l,"closed"),d.Bt.destroyStream(u,t||"",function(t,e){t?d.rt.error("[%s] failed to destroy stream [%s]",u,t):"ok"===e.status?d.rt.info("[%s] destroyed stream",u):d.rt.warn("[%s] failed to destroy stream, status [%s]",u,e.status)}),f.stopped=!0)},setPublisherEndedCallback:function(t){T.it(t,"callback"),this.publisherEndedCallback=t},setDataQualityChangedCallback:function(t){T.it(t,"callback"),this.dataQualityChangedCallback=t},limitBandwidth:function(t){if("Edge"===C.browser)return d.rt.warn("Limit bandwidth not support on [%s]",C.browser);T.dt(t,"bandwidthLimit");var s=a?Math.min(t,a):t,e=l.remoteDescription;d.rt.info("Changing bandwidth limit to [%s]",s);var i=e.sdp.replace(r,"");i=i.replace(o,function(t,e,i,n,r){return[e,i,"b=AS:",Math.ceil(s/1e3),i].join("")});var n=new C.RTCSessionDescription({type:e.type,sdp:i});return l.setRemoteDescription(n),{dispose:function(){l.setRemoteDescription(e)}}},getMonitor:function(){return m},monitor:function(t,i){T.nt(t,"options"),T.it(i,"callback");var e=new b(u,l,d.rt);return t.direction="outbound",e.start(t,function(){return d.Gt[u]===n&&!f.stopped},function(t,e){return t&&d.rt.warn("[%s] Publisher monitor triggered unrecoverable error [%s]",t),d.rt.warn("[%s] Publisher triggered monitor condition for [%s]",u,e.reasons),i(n,"client-side-failure",e)}),I.forEach(s.getTracks(),function(t){I.addEventListener(t,"readystatechange",function(){if("ended"===t.readyState)return d.rt.warn("[%s] Publisher track has failed [%s]",u,t),i(n,"camera-track-failure",{type:t.kind+"-track-ended",message:"Publisher "+t.kind+" track has ended in an unrecoverable way. This may require reconfiguring your camera or microphone."})})}),m=e},addBitRateThreshold:function(t,e){return new S("Publisher",m,function(){return a}).addThreshold(t,e)},setRemoteMediaStreamCallback:function(t){T.it(t,"callback"),this.remoteMediaStreamCallback=t,p&&t(n,p)},getOptions:function(){return h},getStats:function(e){T.it(e,"callback"),this.ie||(this.ie={});var i=this;return C.getStats(l,null,function(t){e(k.convertPeerConnectionStats(t,i.ie))})}};d.Gt[u]=n,c.call(d,n)}U.call(d,u,f,l,i,function(t){var e=d.Gt[u];p=t,e&&e.remoteMediaStreamCallback&&e.remoteMediaStreamCallback(e,t)},n),j.call(d,u,l,function(t){d.Ht[u]&&d.Ht[u](t)}),L.call(d,u,l);var y=new C.RTCSessionDescription({type:"offer",sdp:e}),w={mandatory:{}};if("Chrome"===C.browser||"ReactNative"===C.browser?(w.mandatory.OfferToReceiveVideo=!0===n.receiveVideo,w.mandatory.OfferToReceiveAudio=!0===n.receiveAudio):(w.mandatory.offerToReceiveVideo=!0===n.receiveVideo,w.mandatory.offerToReceiveAudio=!0===n.receiveAudio),"function"==typeof C.global.Promise)return l.setRemoteDescription(y).then(I.bind(V,d,l)).then(function(){return l.createAnswer(w)}).then(I.bind(z,d)).then(function(i){return new C.global.Promise(function(t,e){G.call(d,u,i,t,e)})}).then(function(t){return l.setLocalDescription(t)}).then(I.bind(_,d,l)).then(g).catch(v);d.rt.info("[%s] Using legacy callback api",u),l.setRemoteDescription(y,function(){V.call(d,l),l.createAnswer(function(t){z.call(d,t),G.call(d,u,t,function(t){l.setLocalDescription(t,function(){_.call(d,l),g()},v)},v)},v,w)},v)}.call(h,r,a,i,n,f,function(t,e){f.recordMetric("SetupCompleted",{string:e?"failed":"ok"}),e?u.call(h,h,"failed",null):u.call(h,h,"ok",t)},c,e.createStreamResponse.options)}switch(h.rt.warn("Failed to create uploader, status [%s]",e.status),e.status){case"timeout":case"capacity":case"unauthorized":return u.call(h,h,e.status);default:return u.call(h,h,"failed")}})},w.prototype.subscribe=function(i,d,n){if(!this.Xt)throw new Error("PCast not started. Unable to subscribe. Please start pcast first.");n=n||{},T.mt(i,"streamToken"),T.it(d,"callback"),T.nt(n,"options");var f=this;B.call(f,function(){var t="download",e=I.assign({},n,{negotiate:!1!==n.negotiate}),c=new l(f.getProtocol().getSessionId(),f.rt,f.kt),h=I.assign({},n);h.canPlaybackAudio=f.qt,!f.qt&&n.disableAudioIfNoOutputFound&&!1!==n.receiveAudio&&(e.receiveAudio=!1,h.receiveAudio=!1,h.forcedAudioDisabled=!0),n.originStreamId&&(e.originStreamId=n.originStreamId),c.setProperty("resource",t),f.Bt.setupStream(t,i,e,2*f.Jt,function(t,e){if(t)return f.rt.error("Failed to create downloader [%s]",t),d.call(f,f,"failed");if("ok"===e.status){var i=e.createStreamResponse.streamId,n=e.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,r=it(tt(e.createStreamResponse.rtcConfiguration)),s=I.bind(W,f,r),o=n.match(/a=x-playlist:/)||n.match(/a=x-rtmp:/);if(o&&(s=K),c.setStreamId(i),c.setStartOffset(e.createStreamResponse.offset),c.recordMetric("Provisioned"),c.recordMetric("RoundTripTime",{uint64:2*f.Jt},null,{resource:f.getBaseUri(),kind:"https"}),h.originStartTime=I.now()-e.createStreamResponse.offset+f.Jt,!o&&("Chrome"===C.browser&&62<=C.browserVersion&&E.isMobile()||"Opera"===C.browser)&&0<f.Dt.length){var a=I.get(y.getH264ProfileIds(n),[0]),u=y.getH264ProfileIdWithSameOrHigherProfileAndEqualToOrHigherLevel(f.Dt,a);u?a!==u&&(f.rt.info("[%s] Replacing subscriber h264 profile level id [%s] with new value [%s] in offer sdp",i,a,u),n=y.replaceH264ProfileId(n,a,u)):f.rt.warn("[%s] Unable to find new subscriber h264 profile level id to replace [%s]. Rejected environment defaults of [%s]",i,a,f.Dt)}return s.call(f,i,n,c,function(t,e){c.recordMetric("SetupCompleted",{string:e?"failed":"ok"}),e?d.call(f,f,"failed",null):d.call(f,f,"ok",t)},h)}switch(f.rt.warn("Failed to create downloader, status [%s]",e.status),e.status){case"capacity":case"stream-ended":case"origin-stream-ended":case"origin-not-found":case"streaming-not-available":case"unauthorized":case"timeout":return d.call(f,f,e.status);default:return d.call(f,f,"failed")}})})},w.prototype.getProtocol=function(){return this.Bt},w.prototype.getLogger=function(){return this.rt},w.prototype.toString=function(){var t=this.getProtocol();return"PCast["+(t?t.getSessionId():"")||!1};var nt=function(i){if(I.isUndefined(i.onaddstream)){var e=[],t=[];I.addEventListener(i,"track",function(t){I.forEach(t.streams,function(t){I.includes(e,t)||e.push(t)})}),i.getRemoteStreams=function(){return e},i.getLocalStreams=function(){return t},i.addStream=function(e){I.includes(t,e)||t.push(e),I.forEach(e.getTracks(),function(t){i.addTrack(t,e)})}}};return w}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(51)],void 0===(r=function(t){"use strict";return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(3),i(24),i(56)],void 0===(r=function(c,o,s,n,a,u){"use strict";var h="continuation",d=18e3;function t(t,e,i,n,r){o.nt(t,"logger"),o.it(e,"sendCallback"),o.it(i,"receiveCallback"),this.rt=t,this.ne=new a(n,r),this.re=0,this.se=new s.NamedEvents,this.oe={},this.ae={},this.ue={},this.ce={},this.he={},this.de={},this.fe=i,this.le=e,i(c.bind(f,this))}function f(t){if(this.pe)return this.rt.warn("Proto already disposed of. Unable process message");var e,i,n;try{e=this.ne.decode("mq.Message",u.toByteArray(t.data)),n=this.oe[e.requestId],this.rt.info(">> [%s] [%s]",e.messageType,e.type),i=this.ne.decode(e.type,e.payload)}catch(t){if(this.rt.error(t),n)return n(t);throw t}switch(function(t,e,i){var n=c.now(),r=this.he[t.requestId];if(c.dt(r)){var s=n-r;t.wallTime=[s].concat(t.wallTime)}this.se.fireAsync("received",[{key:t.requestId,messageType:t.messageType,type:t.type,wallTime:t.wallTime,received:n,bytes:i,payload:e}]),delete this.he[t.requestId]}.call(this,e,i,t.data.length),e.messageType){case"Response":if(i.status!==h&&delete this.oe[e.requestId],clearTimeout(this.ce[e.requestId]),delete this.ce[e.requestId],!n)return;return"mq.Error"!==e.type?n(null,i):n(i,null);case"Request":var r=c.bind(this.sendResponse,this,e.requestId,e.type+"Response"),s=this.ue[e.type];this.ae[e.requestId]=c.now(),s?s(i,r):this.rt.info("Received request without a subscribed listener");break;case"Event":return function(t,e){this.se.fire(t,e,this)}.call(this,e.type,[i]);default:return this.rt.warn(">> Unsupported message type [%s]",e.messageType)}}function l(t,e,i,n,r,s,o){return o&&o.status===h?(!this.de[t]&&this.oe[t]&&(this.de[t]=function(t,e){return setTimeout(c.bind(v,this,t,3e5,e),3e5)}.call(this,t,r)),function(t,e,i,n,r,s){if(!n||!n.continuationId&&!n.routeKey)return this.rt.warn("Received request for continuation without a continuationId or routeKey"),s();var o=c.assign({},i,{continuationId:n.continuationId,routeKey:n.routeKey}),a={requestId:t,type:e,payload:this.ne.encode(e,o),messageType:"Request"},u=this;return setTimeout(function(){if(u.oe[t])return p.call(u,t,a,o,r,s)},2e3)}.call(this,t,e,i,o,n,r)):(clearTimeout(this.de[t]),delete this.de[t],r(s,o))}function p(t,e,i,n,r){this.ce[t]&&clearTimeout(this.ce[t]);var s=n||d;return this.ce[t]=setTimeout(c.bind(v,this,t,s,r),s),m.call(this,e,i)}function m(t,e){var i=u.toString(this.ne.encode("mq.Message",t));return function(t,e,i){var n=c.now();this.he[t.requestId]=n,this.se.fireAsync("sent",[{key:t.requestId,messageType:t.messageType,type:t.type,received:n,bytes:i,payload:e}])}.call(this,t,e,i.length),this.le(i)}function v(t,e,i){if(this.oe[t])return function(t,e){this.se.fireAsync("timeout",[{key:t,timeout:e}]),delete this.he[t]}.call(this,t,e),this.rt.warn("Request [%s] has not completed in [%s] ms. Dropping request.",t,e),delete this.oe[t],i(null,{status:"timeout"})}return t.prototype.onEvent=function(t,e){return this.pe?this.rt.warn("Proto already disposed of. Unable to listen for event"):(o.mt(t,"eventName"),o.it(e,"handler"),this.se.listen(t,e))},t.prototype.onRequest=function(t,e){if(this.pe)return this.rt.warn("Proto already disposed of. Unable to listen for request");o.mt(t,"requestName"),o.it(e,"handler"),this.ue[t]&&this.rt.warn("May not set multiple handlers for the same request. Overriding existing handlers for request [%s]",t),this.ue[t]=e;var i=this;return new n.Disposable(function(){i.ue[t]=null})},t.prototype.sendRequest=function(t,e,i,n){if(this.pe)return this.rt.warn("Proto already disposed of. Unable to send request"),i(null,{status:"proto-disposed"});n=n||{},o.mt(t,"type"),o.nt(e,"message"),o.nt(n,"settings"),i&&o.it(i,"callback"),n.timeout&&o.dt(n.timeout,"settings.timeout");var r="C"+(this.re++).toString(),s={requestId:r,type:t,payload:this.ne.encode(t,e),messageType:"Request"};return this.oe[r]=c.bind(l,this,r,t,e,n.timeout,i),p.call(this,r,s,e,n.timeout,i)},t.prototype.sendResponse=function(t,e,i,n){if(this.pe)return this.rt.warn("Proto already disposed of. Unable to send response"),n(null,{status:"proto-disposed"});o.mt(t,"requestId"),o.mt(e,"type"),o.nt(i,"message");var r=this.ae[t];r||(this.rt.error("Already responded to request [%s]",t),n(new Error("no-response-handler")));var s={requestId:t,type:e,payload:this.ne.encode(e,i),messageType:"Response",wallTime:[c.now()-r]};return m.call(this,s,i),delete this.ae[t],n(null,{status:"ok"})},t.prototype.disposeOfRequests=function(){c.forOwn(this.ce,function(t){clearTimeout(t)}),c.forOwn(this.de,function(t){clearTimeout(t)}),this.oe={},this.ae={},this.ue={},this.ce={},this.he={},this.de={}},t.prototype.dispose=function(){this.pe=!0,this.fe=null,this.le=null,this.disposeOfRequests(),this.se.dispose()},t.prototype.getApiVersion=function(){return this.ne.getApiVersion()},t.prototype.toString=function(){return"Proto["+this.me.toString()+"]"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(52),i(54),i(55)],void 0===(r=function(a,u,n,r){"use strict";function t(t,e){var i=this;this.ve={},this.ve[r.package]=new n(r),a.forEach(t,function(t){i.ve[t.package]=new n(t)}),this.ge=e||3}return t.prototype.getApiVersion=function(){return this.ge},t.prototype.encode=function(t,e){if("string"!=typeof t)throw new Error("'type' must be a string");if("object"!=typeof e)throw new Error("'data' must be an object");var i=t.split("."),n=a.get(i,[0]),r=a.get(i,[1]),s=a.get(this.ve,[n]),o=new u;return s.write(r,e,o),o.finish()},t.prototype.decode=function(t,e){if("string"!=typeof t)throw new Error("'type' must be a string");var i=t.split("."),n=a.get(i,[0]),r=a.get(i,[1]),s=a.get(this.ve,[n]),o=new u(e);return s.read(r,o)},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{package:"telemetry",messages:[{name:"LogData",fields:[{rule:"required",type:"LogLevel",name:"level",id:1},{rule:"required",type:"string",name:"timestamp",id:2},{rule:"required",type:"string",name:"category",id:3},{rule:"required",type:"string",name:"message",id:4},{rule:"optional",type:"string",name:"source",id:5},{rule:"optional",type:"string",name:"fullQualifiedName",id:11},{rule:"optional",type:"string",name:"sessionId",id:6},{rule:"optional",type:"string",name:"userId",id:7},{rule:"optional",type:"string",name:"environment",id:8},{rule:"optional",type:"string",name:"version",id:9},{rule:"optional",type:"float",name:"runtime",id:10}]},{name:"StoreLogRecords",fields:[{rule:"repeated",type:"LogData",name:"records",id:1}]},{name:"StoreLogRecordsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"required",type:"uint64",name:"storedRecords",id:2}]},{name:"MetricValue",fields:[{rule:"optional",type:"string",name:"string",id:1},{rule:"optional",type:"float",name:"float",id:2},{rule:"optional",type:"uint64",name:"uint64",id:3},{rule:"optional",type:"int64",name:"int64",id:4},{rule:"optional",type:"bool",name:"boolean",id:5},{rule:"optional",type:"string",name:"timestamp",id:6}]},{name:"MetricData",fields:[{rule:"required",type:"string",name:"timestamp",id:1},{rule:"optional",type:"string",name:"sessionId",id:2},{rule:"optional",type:"string",name:"streamId",id:3},{rule:"optional",type:"string",name:"source",id:4},{rule:"optional",type:"string",name:"resource",id:5},{rule:"optional",type:"string",name:"kind",id:6},{rule:"required",type:"Metric",name:"metric",id:7},{rule:"optional",type:"MetricValue",name:"value",id:8},{rule:"optional",type:"MetricValue",name:"previousValue",id:9},{rule:"optional",type:"uint64",name:"elapsed",id:10},{rule:"optional",type:"string",name:"fullQualifiedName",id:11},{rule:"optional",type:"string",name:"environment",id:12},{rule:"optional",type:"string",name:"version",id:13},{rule:"optional",type:"string",name:"tool",id:14},{rule:"optional",type:"string",name:"toolVersion",id:15},{rule:"required",type:"float",name:"runtime",id:16}]},{name:"SubmitMetricRecords",fields:[{rule:"repeated",type:"MetricData",name:"records",id:1}]},{name:"SubmitMetricRecordsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"required",type:"uint64",name:"storedRecords",id:2}]}],enums:[{name:"LogLevel",values:[{name:"Trace",id:0},{name:"Debug",id:1},{name:"Info",id:2},{name:"Warn",id:3},{name:"Error",id:4},{name:"Fatal",id:5}]},{name:"Metric",values:[{name:"RoundTripTime",id:0},{name:"DownlinkThroughputCapacity",id:26},{name:"Initialized",id:1},{name:"Provisioned",id:2},{name:"SetupCompleted",id:3},{name:"Offset",id:4},{name:"TimeToFirstFrame",id:5},{name:"Playing",id:6},{name:"Stalled",id:7},{name:"Buffering",id:8},{name:"Seeking",id:22},{name:"Stopped",id:9},{name:"BitRateAdaptation",id:10},{name:"ResolutionChanged",id:11},{name:"DisplayResolutionChanged",id:23},{name:"VideoBitRate",id:28},{name:"AudioBitRate",id:29},{name:"FrameRateChanged",id:12},{name:"FramesDropped",id:13},{name:"PacketsLost",id:14},{name:"PictureLost",id:15},{name:"PlayoutDelayChanged",id:16},{name:"CodecChanged",id:17},{name:"PlayerEvent",id:21},{name:"MetricDropped",id:18},{name:"NetworkOffline",id:19},{name:"NetworkOnline",id:20},{name:"NetworkType",id:27},{name:"ApplicationForeground",id:24},{name:"ApplicationBackground",id:25}]}]}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(2),i(27),i(16)],void 0===(r=function(S,r,s,I,T,a){"use strict";function t(t,e,i){r.ft(t,"name"),r.nt(e,"peerConnection"),r.nt(i,"logger"),this.ye=t,this.we=e,this.rt=i,this.ie={}}function R(t){var e=function(t){var e=t.getSenders?S.map(t.getSenders(),function(t){return t.track}):[];if(0!==(e=S.filter(e,function(t){return!S.isNullOrUndefined(t)})).length)return e;var i=t.getLocalStreams?t.getLocalStreams():[];return S.reduce(i,function(t,e){return t.concat(e.getTracks())},[])}(t),i=function(t){var e=t.getReceivers?S.map(t.getReceivers(),function(t){return t.track}):[];if(0!==(e=S.filter(e,function(t){return!S.isNullOrUndefined(t)})).length)return e;var i=t.getRemoteStreams?t.getRemoteStreams():[];return S.reduce(i,function(t,e){return t.concat(e.getTracks())},[])}(t);if(0===e.length||0===i.length)return 0!==e.length?e:0!==i.length?i:[];var n=[];return S.forEach(e,function(t){n.push(t)}),S.forEach(i,function(t){n.push(t)}),n}function E(e){var t=R.call(this,this.we),i=S.filter(t,function(t){return t.kind===e}),n=S.filter(this.be,function(t){return t.kind===e});return S.reduce(i,function(t,e){if(!t)return t;var i=!!S.find(n,function(t){return t.id===e.id});return!e.enabled||i},!0)}return t.prototype.start=function(t,e,i){if(r.nt(t,"options"),r.it(e,"activeCallback"),r.it(i,"monitorCallback"),"inbound"!==t.direction&&"outbound"!==t.direction)throw new Error("Invalid monitoring direction");if(!t.hasOwnProperty("monitoringInterval")||0<t.monitoringInterval){if(this.ke=t.frameRateThreshold||2,this.Se=t.videoBitRateThreshold||1e3,this.Ie=t.audioBitRateThreshold||5e3,this.Te=t.conditionCountForNotificationThreshold||3,this.Re=Math.max(500,t.monitoringInterval||4e3),this.Ee=Math.max(500,t.conditionMonitoringInterval||1500),this.xe=!t.hasOwnProperty("monitorFrameRate")||t.monitorFrameRate,this.Ce=!t.hasOwnProperty("monitorBitRate")||t.monitorBitRate,this.Me=!t.hasOwnProperty("monitorState")||t.monitorState,this.be=[],this.Pe=new s.Event,"Edge"===I.browser){var n=this.Ee*this.Te;this.Re=Math.max(this.Re,6e3),this.Ee=Math.max(this.Ee,6e3),this.Te=Math.max(Math.ceil(n/this.Re),2),this.rt.info("Using modified options for optimal monitoring of PeerConnection on [Edge]. Monitor Interval [%s], Condition Monitor Interval [%s], Condition Count For Notification [%s]",this.Re,this.Ee,this.Te)}return function(f,l,p,m,v){var g=this,y=0,w=void 0,b=void 0,k=void 0;setTimeout(function d(){(function(t,i,e,n,r,s){if(!n())return this.rt.info("[%s] Finished monitoring of peer connection",this.ye);var o=this;I.getStats(t,null,function(t){var e=a.convertPeerConnectionStats(t,o.ie);e=S.filter(e,function(t){return"inbound"===i.direction&&"download"===t.direction||"outbound"===i.direction&&"upload"===t.direction}),r(e)},function(t){s(t)})}).call(g,l,p,null,m,function(t){var e=!1,i=!1,n=!1;if(!m())return g.rt.info("[%s] Finished monitoring of peer connection",f);if(!t)throw new Error("Report must be a valid PeerConnection.getStats Report");if(S.forEach(t,function(t){if("outbound"===p.direction&&"upload"===t.direction)switch(t.mediaType){case"video":g.rt.debug("[%s] [%s] [%s] [%s] with RTT [%s], bitrate [%s], dropped frames [%s], frame rate [%s] and average encoding time [%s] ms (CPU limited=[%s])",f,p.direction,t.mediaType,t.ssrc,t.rtt,t.bitrateMean,t.droppedFrames,t.framerateMean,t.avgEncode,t.cpuLimitedResolution),w=t.framerateMean,b=t.uploadRate?1e3*t.uploadRate:t.uploadRate,i=e=!0,"Edge"===I.browser&&(e=!1);break;case"audio":g.rt.debug("[%s] [%s] [%s] [%s] with RTT [%s], jitter [%s] and audio input level [%s]",f,p.direction,t.mediaType,t.ssrc,t.rtt,t.jitter,t.audioInputLevel),n=!0,k=t.uploadRate?1e3*t.uploadRate:t.uploadRate}if("inbound"===p.direction&&"download"===t.direction)switch(t.mediaType){case"video":g.rt.debug("[%s] [%s] [%s] [%s] with framerate [%s], current delay [%s] ms and target delay [%s] ms",f,p.direction,t.mediaType,t.ssrc,t.framerateMean,t.currentDelay,t.targetDelay),e=!0,w=t.framerateMean||0,i=!0,b=t.downloadRate?1e3*t.downloadRate:t.downloadRate,"Edge"===I.browser&&(e=!1);break;case"audio":g.rt.debug("[%s] [%s] [%s] [%s] with jitter [%s], jitter buffer [%s] ms, audio output level [%s], total audio energy [%s] and total samples duration [%s]",f,p.direction,t.mediaType,t.ssrc,t.jitter,t.jitterBuffer,t.audioOutputLevel,t.totalAudioEnergy,t.totalSamplesDuration),n=!0,k=t.downloadRate?1e3*t.downloadRate:t.downloadRate}}),S.isUndefined(k)&&S.isUndefined(b))return setTimeout(d,g.Re);var r=T.hasActiveAudio(l),s=T.hasActiveVideo(l);(i&&0===b||n&&0===k||e&&0===w)&&(i=i&&s,n=n&&r,e=e&&s),(n||i||e)&&(g.rt.debug("[%s] [%s] Current bit rate is [%s] bps for audio and [%s] bps for video with [%s] FPS",f,p.direction,Math.ceil(k||0),Math.ceil(b||0),w||"?"),0<S.values(g.ie).length&&g.Pe.fire([{videoBitRate:b,audioBitRate:k,frameRate:w}]));var o=[];if(g.Me&&("closed"===l.connectionState||"disconnected"===l.connectionState||"failed"===l.connectionState||"disconnected"===l.iceConnectionState||"failed"===l.iceConnectionState)){var a=r&&s,u=R.call(g,l);if(!a&&T.hasMediaSectionsInLocalSdp(l))return void g.rt.info("[%s] [%s] Finished monitoring of peer connection with [%s] inactive tracks",f,p.direction,u.length);o.push("connection")}function c(){g.rt.info("[%s] [%s] Failure has been acknowledged",f,p.direction),y=Number.MIN_VALUE,setTimeout(d,g.Re)}if(g.xe&&e&&w<=g.ke&&!E.call(g,"video")&&o.push("frameRate"),g.Ce&&n&&k<=g.Ie&&!E.call(g,"audio")&&o.push("audioBitRate"),g.Ce&&i&&b<=g.Se&&!E.call(g,"video")&&o.push("videoBitRate"),0===b&&s&&!E.call(g,"video")&&o.push("noVideoData"),0===k&&r&&!E.call(g,"audio")&&o.push("noAudioData"),0<o.length?y++:y=0,y>=g.Te){var h="["+f+"] ["+p.direction+"] Failure detected with frame rate ["+w+"] FPS, audio bit rate ["+k+"] bps, video bit rate ["+b+"] bps, connection state ["+l.connectionState+"], and ice connection state ["+l.iceConnectionState+"] after ["+y+"] checks";v(null,{type:"condition",reasons:o,message:h,report:t,frameRate:w,videoBitRate:b,audioBitRate:k,acknowledgeFailure:c})?c():g.rt.info(h+": [%s]",t)}else setTimeout(d,0<y?g.Ee:g.Re)},function(t){v(t,{type:"error",message:"Unable to get Connection statistics. Connection may have failed."})})},g.Re)}.call(this,this.ye,this.we,t,e,i)}this.rt.info("[%s] Monitoring is disabled",name)},t.prototype.setMonitorTrackState=function(e,t){r.nt(e,"track"),r.yt(t,"state");try{var i=R.call(this,this.we);if(!S.find(i,function(t){return t.id===e.id}))return this.rt.warn("[%s] Unable to find track [%s] [%s] in peer connection",this.ye,e.kind,e.id)}catch(t){"Firefox"===I.browser&&"InvalidStateError: Peer connection is closed"===t.message?this.rt.debug("Failed to verify monitor track due to closed peer connection"):this.rt.warn("Failed to verify monitor track due to [%s]",t.message)}if(!t)return this.rt.info("[%s] Pausing monitoring of track [%s] [%s]",this.ye,e.kind,e.id),this.be.push(e);var n=this.be.length;this.be=S.filter(this.be,function(t){return t.id!==e.id}),n!==this.be.length&&this.rt.info("[%s] Starting monitoring of track [%s] [%s] after it was paused",this.ye,e.kind,e.id)},t.prototype.on=function(t,e){switch(r.mt(t,"eventName"),r.it(e,"listener"),t){case"calculatedmetrics":return this.Pe.listen(e);default:throw new Error("Unsupported event "+t)}},t.prototype.toString=function(){return"PeerConnectionMonitor["+this.ye+"]"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(s,o){"use strict";var a=/profile-level-id=[^;\n]*/,i=/vp8/i,n=/vp9/i,r=/h264/i,u=/h265/i;function t(){}return t.prototype.getH264ProfileIds=function(t){o.mt(t,"offerSdp");for(var e=[],i=t.match(a),n=t;i;){var r=s.get(i,"0","");e.push(r.split("=")[1]),i=(n=n.substring(i.index+r.length,t.length)).match(a)}return e},t.prototype.replaceH264ProfileId=function(t,e,i){o.mt(t,"offerSdp"),o.mt(i,"newProfileId");var n=this.getH264ProfileIds(t);return s.includes(n,e)?t.replace("profile-level-id="+e,"profile-level-id="+i):t},t.prototype.getH264ProfileIdWithSameProfileAndEqualToOrHigherLevel=function(t,e){if(s.includes(t,e))return e;var i=s.reduce(t,function(t,e){var i=parseInt(t.substring(0,2),16),n=parseInt(t.substring(4,6),16),r=parseInt(e.substring(0,2),16),s=parseInt(e.substring(4,6),16);return i!==r?t:s<=n?t:e},e);return i===e?null:i},t.prototype.getH264ProfileIdWithSameOrHigherProfileAndEqualToOrHigherLevel=function(t,e){var i=this.getH264ProfileIdWithSameProfileAndEqualToOrHigherLevel(t,e);if(i)return i;var n=s.reduce(t,function(t,e){var i=parseInt(t.substring(0,2),16),n=parseInt(t.substring(4,6),16),r=parseInt(e.substring(0,2),16),s=parseInt(e.substring(4,6),16);return i<r?e:r<i?t:s<n?t:e},e);return n===e?null:n},t.prototype.getSupportedCodecs=function(t){o.mt(t,"offerSdp");var e=[];return i.test(t)&&e.push("VP8"),n.test(t)&&e.push("VP9"),r.test(t)&&e.push("H264"),u.test(t)&&e.push("H265"),e},t.prototype.hasMediaSectionsInLocalSdp=function(t){return this.findInSdpSections(t,function(t){return s.startsWith(t,"video")||s.startsWith(t,"audio")})<0},t.prototype.hasActiveAudio=function(t){return this.findInSdpSections(t,function(t,e,i){return!!s.startsWith(t,"audio")&&!s.includes(t,"a=inactive")&&!s.includes(i[e],"a=inactive")})<0},t.prototype.hasActiveVideo=function(t){return this.findInSdpSections(t,function(t,e,i){return!!s.startsWith(t,"video")&&!s.includes(t,"a=inactive")&&!s.includes(i[e],"a=inactive")})<0},t.prototype.findInSdpSections=function(t,i){var e=this.getLocalSdp(t).split("m="),n=this.getRemoteSdp(t).split("m=");return e.length===n.length&&s.findIndex(e,function(t,e){return i(t,e,n)})},t.prototype.getNumberOfActiveSections=function(t){var e=(this.getLocalSdp(t)||this.getRemoteSdp(t)).split("m=");return s.filter(e,function(t){return!s.includes(t,"a=inactive")&&(s.startsWith(t,"audio")||s.startsWith(t,"video"))}).length},t.prototype.getLocalSdp=function(t){return s.get(t,["localDescription","sdp"],"")},t.prototype.getRemoteSdp=function(t){return s.get(t,["remoteDescription","sdp"],"")},t.prototype.setGroupLineOrderToMatchMediaSectionOrder=function(i){var t=i.match(/(?=a=group:BUNDLE).*/),e=s.get(s.get(t,[0],"").split("a=group:BUNDLE "),[1],""),n=e.split(" ").sort(function(t,e){return i.indexOf("m="+t)-i.indexOf("m="+e)});return 0<n.length&&(i=i.replace(e,n.join(" "))),i},new t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(2),i(12),i(80),i(81),i(82),i(6)],void 0===(r=function(n,i,a,t,e,r,s,o,u){"use strict";function c(t,e,i,n,r,s,o){this.Oe=t,this.qe=e,this.De=i,this.Ae=n,this.f=r,this.It=s,this.rt=o,this.Fe=[],this.Ne=null,this.se=new a.NamedEvents}return c.prototype.on=function(t,e){this.se.listen(t,e)},c.prototype.createRenderer=function(){var e=null;switch(this.Oe){case u.types.dash.name:e=this.It?new r(this.qe,this.De,this.Ae,this.f,this.It,this.rt):new s(this.qe,this.De,this.Ae,this.f,this.rt);break;case u.types.hls.name:e=new s(this.qe,this.De,this.Ae,this.f,this.rt);break;case u.types.rtmp.name:e=new o(this.qe,this.De,this.Ae,this.f,this.rt);break;default:throw new Error("Unsupported Live stream Type "+this.Oe)}var i=this;return e.on(u.rendererEvents.error.name,function(t,e){i.se.fire(u.streamEvents.playerError.name,[t,e])}),e.on(u.rendererEvents.ended.name,function(t){i.Fe=n.filter(i.Fe,function(t){return t!==e}),0===i.Fe.length&&(i.Ae.stop(),i.se.fire(u.streamEvents.playerEnded.name,[t]))}),this.Fe.push(e),e},c.prototype.select=function(t){return this.rt.warn("[%s] selection of tracks not supported for [%s] live streams",this.qe,this.Oe),this},c.prototype.setStreamEndedCallback=function(t){i.it(t,"callback"),this.streamEndedCallback=t},c.prototype.setStreamErrorCallback=function(t){i.it(t,"callback"),this.streamErrorCallback=t},c.prototype.stop=function(t){this.isActive()&&(this.rt.info("[%s] stop [live] media stream with reason [%s]",this.qe,t),this.se.fire(u.streamEvents.stopped.name,[t]),this.Ue=!0)},c.prototype.monitor=function(t,e){i.nt(t,"options"),i.it(e,"callback")},c.prototype.getMonitor=function(){return null},c.prototype.addBitRateThreshold=function(t,e){i.it(e,"callback")},c.prototype.getStream=function(){return this.rt.debug("[%s] [%s] This type of stream has no internal stream object",this.qe,this.Oe),null},c.prototype.isActive=function(){return!this.Ue},c.prototype.getStreamId=function(){return this.qe},c.prototype.getStats=function(){return this.rt.debug("[%s] [%s] This type of stream has no stats",this.qe,this.Oe),null},c.prototype.getRenderer=function(){return n.get(this.Fe,[0],null)},c.canPlaybackType=function(t){switch(t){case u.types.dash.name:return e.WebPlayer.deviceSupportsDashPlayback;case u.types.hls.name:return e.WebPlayer.deviceSupportsHlsPlayback;case u.types.rtmp.name:return o.isSupported();default:return!1}},c}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(p,n){"use strict";function t(t,e,i){n.mt(t,"name"),n.nt(e,"monitor"),n.it(i,"getLimit"),this.ye=t,this.je=e,this.Le=i||p.noop}return t.prototype.addThreshold=function(t,h){var d=function(t){var e=[];if(p.isArray(t))p.forEach(t,function(t){n.dt(t,"threshold")}),e=t.sort();else if(p.nt(t)){n.dt(t.levels,"threshold.levels");for(var i=0;i<t.levels;i++)e.push(i/t.levels)}else n.dt(t,"threshold"),e.push(t);return e.push(3),e}(t),f=null,l=this;return l.je.on("calculatedmetrics",function(t){var n,r,e=l.Le(),i=t.videoBitRate+t.audioBitRate,s=(n=d,r=i/e,p.reduce(n,function(t,e,i){return null===t&&r<=e?i:e<n[t]&&r<=e?i:t},null)),o=p.get(d,[s]),a=o*e,u=p.get(d,[f],1),c=u*e;if(0!==e)return null===f?f=s:void(s!==f&&(s<f?h({isIncreasing:!1,bitRate:i,currentThreshold:a,targetBitRate:e,index:s,lastIndex:f,message:l.ye+" bit rate is below "+o+" * "+e+" threshold of "+a+" with a bit rate of "+i}):f<s&&h({isIncreasing:!0,bitRate:i,currentThreshold:c,targetBitRate:e,index:s,lastIndex:f,message:l.ye+" bit rate is above "+u+" * "+e+" threshold of "+c+" with a bit rate of "+i}),f=s))})},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(2),i(85)],void 0===(r=function(v,s,q,o){"use strict";function t(t,e){s.nt(t,"pcast"),e&&s.nt(e,"options"),e&&e.screenShare&&s.it(e.screenShare,"options.screenShare"),this.Be=t,this.rt=t.getLogger(),this.f=e||{},this.We=v.get(e,["onScreenShare"])}return t.prototype.getUserMedia=function(t,e){s.nt(t,"deviceOptions");var i=new o(this.f),n=i.getDefaultResolution(),r=i.getDefaultFrameRate();(function a(u,c,h,d,f){var l=this.getVendorSpecificConstraints(u,c||{},h),p=!!l.video,m=this;this.Be.getUserMedia(l,function(t,e,i,n){if("ok"===e)return m.rt.info("Acquired user media with constraints [%s]",l),f(null,{userMedia:i,options:{frameRate:p?h:null,resolution:p?v.get(c,["resolution"],null):null,aspectRatio:p?v.get(c,["aspectRatio"],null):null}});m.rt.info("Failed to acquire user media with constraints [%s]",l);var r=c,s=h,o=function(t){return t.constraintName?t.constraintName:t.constraint?t.constraint:""}(n);if(n&&("ConstraintNotSatisfiedError"===n.name||"OverconstrainedError"===n.name||"OverconstrainedError"===n.constructor.name||"unavailable"===n.code&&"Edge"===q.browser))switch(o.toLowerCase()){case"width":case"height":if(!c||!d.canResolveNextResolution())break;return m.rt.warn("Unable to get user media with constraint [%s] with height [%s] and width [%s]. Retrying with next closest resolution.",o,r.height,r.width),r=d.getNextResolution(c.height,c.aspectRatio),a.call(m,u,r,s,d,f);case"framerate":default:if(h)return m.rt.warn("Unable to get user media with constraint [%s] and frame rate [%s]. Retrying without frame rate constraint.",o,h),a.call(m,u,r,s=null,d,f);if(!c||!d.canResolveNextResolution())break;return m.rt.warn("Unable to get user media with constraint [%s] with height [%s] and width [%s]. Retrying with next closest resolution.",o,r.height,r.width),r=d.getNextResolution(c.height,c.aspectRatio),a.call(m,u,r,s,d,f)}return m.rt.error("Unable to get user media with status [%s]",e,n),f(n)},function(t){var e=t;if(m.We&&"Chrome"===q.browser){var i,n=function(t){var e=v.get(t,["video","mandatory","chromeMediaSource"]),i=v.get(t,["audio","mandatory","chromeMediaSource"]),n=v.get(t,["video","mandatory","chromeMediaSourceId"]),r=v.get(t,["audio","mandatory","chromeMediaSourceId"]),s={};return(e||r)&&(v.set(s,["screen","mediaSource"],e),v.set(s,["screen","mediaSourceId"],n)),(i||r)&&(v.set(s,["screenAudio","mediaSource"],i),v.set(s,["screenAudio","mediaSourceId"],r)),s}(t);if((e=m.We(n)).resolution&&e.aspectRatio)switch(this._e){case"9x16":case"3x4":i={width:e.resolution,height:d.calculateLongerDimensionByAspectRatio(e.resolution,e.aspectRatio)};break;case"16x9":case"4x3":default:i={width:d.calculateLongerDimensionByAspectRatio(e.resolution,e.aspectRatio),height:e.resolution}}e=function(t,e,i){var n=this.getVendorSpecificConstraints(t,e,i);n.screen&&(n.video=n.screen,delete n.screen),n.screenAudio&&(n.audio=n.screenAudio,delete n.screenAudio);var r=v.get(n,["video","mandatory","mediaSource"]),s=v.get(n,["audio","mandatory","mediaSource"]),o=v.get(n,["video","mandatory","mediaSourceId"]),a=v.get(n,["audio","mandatory","mediaSourceId"]);return(r||o)&&(v.set(n,["video","mandatory","chromeMediaSource"],r),v.set(n,["video","mandatory","chromeMediaSourceId"],o),delete n.video.mandatory.mediaSource,delete n.video.mandatory.mediaSourceId),(s||a)&&(v.set(n,["audio","mandatory","chromeMediaSource"],s),v.set(n,["audio","mandatory","chromeMediaSourceId"],a),delete n.audio.mandatory.mediaSource,delete n.audio.mandatory.mediaSourceId),n}.call(m,n,i,e.frameRate)}return e})}).call(this,t,n,r,i,e)},t.prototype.getVendorSpecificConstraints=function(t,e,i){if(e=e||{},!t||!t.audio&&!t.video&&!t.screen&&!t.screenAudio)throw new Error("Invalid device options. Must pass in at least one device option.");return"Firefox"===q.browser&&38<q.browserVersion||"Chrome"===q.browser&&52<q.browserVersion&&!t.screen&&!t.screenAudio||"Safari"===q.browser&&10<q.browserVersion||"Opera"===q.browser&&40<q.browserVersion?(I=e,T=i,R=(S=t).video,E=S.audio,x=S.screen,C=S.screenAudio,M=I.width,P=I.height,O={},R&&(O.video={height:{min:P,ideal:P,max:P},width:{min:M,ideal:M,max:M},frameRate:{ideal:T,max:T}},R.deviceId&&(O.video.deviceId={exact:R.deviceId}),R.facingMode&&(O.video.facingMode=R.facingMode),M||delete O.video.width,P||delete O.video.height,T||delete O.video.frameRate,M||P||T||R.deviceId||R.facingMode||(O.video=!0)),E&&(O.audio={},E.deviceId&&(O.audio.deviceId={exact:E.deviceId}),E.mediaSource&&(O.audio.mediaSource=E.mediaSource),E.mediaSourceId&&(O.audio.mediaSourceId=E.mediaSourceId),E.deviceId||E.mediaSource||E.mediaSourceId||(O.audio=!0)),C&&(O.screenAudio={},C.deviceId&&(O.screenAudio.deviceId={exact:C.deviceId}),C.mediaSource&&(O.screenAudio.mediaSource=C.mediaSource),C.mediaSourceId&&(O.screenAudio.mediaSourceId=C.mediaSourceId),C.deviceId||C.mediaSource||C.mediaSourceId||(O.screenAudio=!0)),x&&(O.screen={height:{min:P,ideal:P,max:P},width:{min:M,ideal:M,max:M},frameRate:{ideal:T,max:T}},M||delete O.screen.width,P||delete O.screen.height,T||delete O.screen.frameRate,x.mediaSource&&(O.screen.mediaSource=x.mediaSource),M||P||T||x.mediaSource||(O.screen=!0)),x&&R&&(O.screen=!0),O):"Edge"===q.browser?(p=e,m=i,v=(l=t).video,g=l.audio,y=l.screen,w=p.width,b=p.height,k={},v&&(k.video={height:{min:b,max:b,exact:b},width:{min:w,max:w,exact:w},frameRate:m},v.deviceId&&(k.video.deviceId=v.deviceId),v.facingMode&&(k.video.facingMode=v.facingMode),w||delete k.video.width,b||delete k.video.height,m||delete k.video.frameRate,w||b||m||v.deviceId||v.facingMode||(k.video=!0)),g&&(k.audio=!0,g.deviceId&&(k.audio={deviceId:g.deviceId})),y&&(k.screen=!0),k):(r=e,s=i,o=(n=t).video,a=n.audio,u=n.screen,c=n.screenAudio,h=r.width,d=r.height,f={},o&&(f.video={mandatory:{minHeight:d,maxHeight:d,minWidth:h,maxWidth:h,maxFrameRate:s}},o.deviceId&&(f.video.mandatory.sourceId=o.deviceId),o.facingMode&&(f.video.facingMode=o.facingMode),o.mediaSource&&(f.video.mandatory.mediaSource=o.mediaSource),o.mediaSourceId&&(f.video.mandatory.mediaSourceId=o.mediaSourceId),h||(delete f.video.mandatory.minWidth,delete f.video.mandatory.maxWidth),d||(delete f.video.mandatory.minHeight,delete f.video.mandatory.maxHeight),s||delete f.video.mandatory.maxFrameRate,h||d||s||o.deviceId||o.facingMode||o.mediaSource||o.mediaSourceId||(f.video=!0)),a&&(f.audio={mandatory:{}},a.deviceId&&(f.audio.mandatory.sourceId=a.deviceId),a.mediaSource&&(f.audio.mandatory.mediaSource=a.mediaSource),a.mediaSourceId&&(f.audio.mandatory.mediaSourceId=a.mediaSourceId),a.deviceId||a.mediaSource||a.mediaSourceId||(f.audio=!0)),c&&(f.screenAudio={mandatory:{}},c.deviceId&&(f.screenAudio.mandatory.sourceId=c.deviceId),c.mediaSource&&(f.screenAudio.mandatory.mediaSource=c.mediaSource),c.mediaSourceId&&(f.screenAudio.mandatory.mediaSourceId=c.mediaSourceId),c.deviceId||c.mediaSource||c.mediaSourceId||(f.screenAudio=!0)),u&&(f.screen={mandatory:{minHeight:d,maxHeight:d,minWidth:h,maxWidth:h,maxFrameRate:s}},h||(delete f.screen.mandatory.minWidth,delete f.screen.mandatory.maxWidth),d||(delete f.screen.mandatory.minHeight,delete f.screen.mandatory.maxHeight),s||delete f.screen.mandatory.maxFrameRate,u.mediaSource&&(f.screen.mandatory.mediaSource=u.mediaSource),u.mediaSourceId&&(f.screen.mandatory.mediaSourceId=u.mediaSourceId),h||d||s||u.mediaSource||(f.screen=!0)),u&&o&&(f.screen=!0),f);var n,r,s,o,a,u,c,h,d,f,l,p,m,v,g,y,w,b,k,S,I,T,R,E,x,C,M,P,O},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5),i(3)],void 0===(r=function(a,u,c,r){"use strict";var h={timeout:2e4,retryOptions:{backoff:1.5,delay:1e3,maxAttempts:3,additionalRetryErrorCodes:[0]}},s={body:{id:1,name:"body"},header:{id:2,name:"header"}},e={createStreamTokenPath:"/stream",createAuthTokenPath:"/auth"},o="auth",d="stream";function t(){this.Ve=null,this.ze="",this.Ge=e,this.Je={},this.He=s.body.name,this.g=new r.DisposableList}function f(t,i){var n=null,e=t(a.bind(p,this,function(t,e){clearTimeout(n),i(t,e)}));return n=setTimeout(function(){e.dispose(),i(new Error("timeout"))},2e4),this.g.add(e),this.g.add(new r.Disposable(function(){clearTimeout(n)})),e}function l(t,e,i,n,r){switch(this.He){case s.body.name:n=function(t){return a.assign({},t,this.Je)}.call(this,n);break;case s.header.name:r=function(t){return t.headers?(t.headers=a.assign({},this.Je,t.headers),t):a.assign({},{headers:this.Je},t)}.call(this,r);break;default:throw new Error("Unsupported Authentication Mode "+this.He)}return a.bind(t,e,i,JSON.stringify(n),r)}function p(t,e,i){if(e)return t(e,{});var n=JSON.parse(i.data);return"ok"!==n.status?t(null,{status:n.status||"status-code-missing"}):t(null,n)}function m(t,e,i,n){if(!n||i)return e(i,{status:"failed"});var r={status:"ok"};switch(t){case o:r.authenticationToken=n;break;case d:r.streamToken=n;break;default:throw new Error("Unsupported request type "+t)}return e(i,r)}return t.prototype.dispose=function(){return this.g.dispose()},t.prototype.toString=function(){return"AdminApiProxyClient[customRequestHandler="+(!!this.Ve).toString()+",backendUri="+this.ze+",authenticationDataLocationInPayload="+this.He+",customEndpointPaths="+(this.Ge===e).toString()+",customAuthenticationData="+(0<a.keys(this.Je).length).toString()+"]"},t.prototype.getBackendUri=function(){return this.ze},t.prototype.setBackendUri=function(t){u.ft(t,"backendUri"),this.ze=t},t.prototype.getEndpointPaths=function(){return a.assign({},this.Ge)},t.prototype.setEndpointPaths=function(t){u.nt(t,"endpointPaths"),t.createStreamTokenPath&&u.mt(t.createStreamTokenPath,"endpointPaths.createStreamTokenPath"),t.createAuthTokenPath&&u.mt(t.createAuthTokenPath,"endpointPaths.createAuthTokenPath"),this.Ge=a.assign({},e,t)},t.prototype.getAuthenticationData=function(){return a.assign({},this.Je)},t.prototype.setAuthenticationData=function(t){u.nt(t,"authenticationData"),this.Je=t},t.prototype.getAuthenticationDataLocationInPayload=function(){return this.He},t.prototype.setAuthenticationDataLocationInPayload=function(t){u.lt(t,s,"authenticationDataLocationInPayload"),this.He=t},t.prototype.getRequestHandler=function(){return this.Ve},t.prototype.setRequestHandler=function(t){if(u.it(t,"callback"),this.ze)throw new Error("Conflicting parameter [backendUri]");if(0<a.keys(this.Je).length)throw new Error("Conflicting parameter [authenticationData]");if(this.He!==s.body.name)throw new Error("Conflicting parameter [authenticationDataLocationInPayload]");if(this.Ge!==e)throw new Error("Conflicting parameter [endpointPaths]");this.Ve=t},t.prototype.createAuthenticationToken=function(t){if(this.Ve)return this.Ve(o,{},a.bind(m,this,o,t));this.ze||t(null,{status:"unauthorized"});var e=l.call(this,c.postWithRetry,c,this.ze+this.Ge.createAuthTokenPath,{},h);return f.call(this,e,t)},t.prototype.createStreamTokenForPublishing=function(t,e,i){u.mt(t,"sessionId"),u.nt(e,"capabilities");var n={sessionId:t,capabilities:e};if(this.Ve)return this.Ve(d,n,a.bind(m,this,d,i));this.ze||i(null,{status:"unauthorized"});var r=l.call(this,c.postWithRetry,c,this.ze+this.Ge.createStreamTokenPath,n,h);return f.call(this,r,i)},t.prototype.createStreamTokenForPublishingToExternal=function(t,e,i,n){this.createStreamTokenForSubscribing(t,e,i,null,n)},t.prototype.createStreamTokenForSubscribing=function(t,e,i,n,r){u.mt(t,"sessionId"),u.nt(e,"capabilities"),a.isNullOrUndefined(n)||(u.isArray(n,"additionalStreamIds"),a.forEach(n,function(t){u.mt(t,"alternateOriginStreamId")}));var s={sessionId:t,capabilities:e,originStreamId:i};if(n&&0<n.length&&(s.alternateOriginStreamIds=n),this.Ve)return this.Ve(d,s,a.bind(m,this,d,r));this.ze||r(null,{status:"unauthorized"});var o=l.call(this,c.postWithRetry,c,this.ze+this.Ge.createStreamTokenPath,s,h);return f.call(this,o,r)},t}.apply(e,n))||(t.exports=r)},function(t,e,i){"use strict";var n,r;n=[i(2),i(9),i(21),i(30),i(86),i(31)],void 0===(r=function(t,e,i,n,r,s){return{express:{PCastExpress:r},lowLevel:{PCast:t.global.PhenixPCast=i},media:{UserMediaResolver:n},net:{AdminApiProxyClient:s},utils:{logging:e,rtc:t},logging:e,PCast:i,RTC:t,UserMediaResolver:n}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";function a(){}a.clone=function(t){return a.isArray(t)?t.slice():a.nt(t)?a.assign({},t):t},a.get=function(t,e,i){if(a.isNullOrUndefined(t))return i;o(t,"objectToTraverse");var n=e;if(a.ft(n))n=h(e);else if(!a.isArray(n))throw new Error("Unsupported path type "+typeof e);var r=a.reduce(n,function(t,e){if(a.nt(t)||a.isArray(t))return t[e]},t);return a.isUndefined(r)?i:r},a.set=function(t,e,i){if(!a.nt(t))return t;o(t,"objectToTraverse");var n=t,r=e;if(a.ft(r))r=h(e);else if(!a.isArray(r))throw new Error("Unsupported path type "+typeof e);return a.forEach(r,function(t,e){!function(t,e,i){if(a.dt(parseInt(e))&&a.isArray(t))return t[e]=i;if(a.ft(e)&&a.nt(t))return t[e]=i;throw new Error("Unsupported type "+typeof e+" when setting property or index")}(n,t,function(t,e,i,n){if(t.length-1===e)return n;var r=t[e],s=t[e+1];if(a.isArray(i[r])||a.nt(i[r]))return i[r];if(!a.isArray(i[r])&&a.dt(parseInt(s)))return[];if(!a.nt(i[r])&&a.ft(s))return{};throw new Error("Unsupported type "+typeof r+" when setting property or index")}(r,e,n,i)),n=n[t]}),t},a.bind=function(e,i){var n=Array.prototype.slice.call(arguments,2);return function(){if(!a.it(e))throw new TypeError("_.bind - callback must be a function. Received ["+typeof e+"]");var t=n.concat(Array.prototype.slice.call(arguments));return e.apply(i,t)}},a.now=function(){return(new Date).getTime()},a.utc=function(t){return a.dt(t)?t:t?Math.floor(t):NaN},a.isoString=function(){var t=new Date;return t.toISOString?t.toISOString():t.getUTCFullYear()+"-"+a.pad(t.getUTCMonth()+1,2)+"-"+a.pad(t.getUTCDate(),2)+"T"+a.pad(t.getUTCHours(),2)+":"+a.pad(t.getUTCMinutes(),2)+":"+a.pad(t.getUTCSeconds(),2)+"."+(t.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},a.map=function(t,i){o(t,"collection");var n=[];return t.constructor===Array?a.forEach(t,function(t,e){a.ft(i)&&a.nt(t)?n.push(t[i]):a.it(i)&&n.push(i(t,e))}):a.forOwn(t,function(t,e){a.it(i)&&n.push(i(t,e))}),n},a.values=function(t){if(!a.nt(t)||a.isArray(t))throw new Error("_.values argument, Collection, must be an object. Received ["+typeof t+"]");return a.map(t,function(t){return t})},a.keys=function(t){if(!a.nt(t)||a.isArray(t))throw new Error("_.keys argument, Collection, must be an object. Received ["+typeof t+"]");return a.map(t,function(t,e){return e})},a.forEach=function(t,e){if(!a.it(e))throw new Error("_.forEach argument, Callback, must be a function. Received ["+typeof e+"]");s(t,"collection");for(var i=0;i<t.length;i++)if(!1===e(t[i],i))return},a.forOwn=function(t,e){if(!a.it(e))throw new Error("Callback must be a function. Received ["+typeof e+"]");o(t,"objectWithProperties");for(var i=Object.keys(t),n=0;n<i.length;n++){var r=i[n];if((t.hasOwnProperty(r)||Object.prototype.hasOwnProperty.call(t,r))&&!1===e(t[r],r))return}},a.argumentsToArray=function(t){if(!a.nt(t)||!t.length)throw new Error("Collection must be arguments. Received ["+typeof t+"]");for(var e=[],i=0;i<t.length;i++)e.push(t[i]);return e},a.assign=function(i){a.isNullOrUndefined(i)&&(i={}),o(i,"target");var t=a.argumentsToArray(arguments);return t.shift(),a.forEach(t,function(t,e){a.isNullOrUndefined(t)||(o(t,"_.assign(sources["+e+"])"),a.forOwn(t,function(t,e){i[e]=t}))}),i},a.includes=function(t,e){if(a.ft(t))return c(e,"Includes value and search parameter"),-1<t.indexOf(e);if(a.isUndefined(t)||a.isUndefined(e))return!1;function i(t){if(t===e)return!(n=!0)}o(t,"collection");var n=!1;return t.constructor===Array?a.forEach(t,i):a.forOwn(t,i),n},a.reduce=function(t,i,e){o(t,"collection");var n=e===a.noop()?null:e;return t.constructor===Array?a.forEach(t,function(t,e){n=i(n,t,e)}):a.forOwn(t,function(t,e){n=i(n,t,e)}),n},a.sample=function(t){return s(t,"collection"),t[Math.floor(Math.random()*t.length)]},a.uniqueId=function(){return(a.now()*Math.random()).toString()},a.find=function(t,i,n){s(t,"collection");var r=void 0;return a.forEach(t,function(t,e){if(i(t)&&(n||0)<=e)return r=t,!1}),r},a.findIndex=function(t,i,n){s(t,"collection");var r=-1;return a.forEach(t,function(t,e){if(i(t,e)&&(n||0)<=e)return r=e,!1}),r},a.filter=function(t,e){s(t,"collection");var i=[];return a.forEach(t,function(t){e(t)&&i.push(t)}),i},a.remove=function(t,e){return s(t,"collection"),a.filter(t,function(t){return!e(t)})},a.take=function(t,e){return s(t,"collection"),t.slice(0,e)},a.hasDifferences=function(t,e,i){return 0<a.findDifferences(t,e,i).length},a.findDifferences=function(i,n,r){var s=[],o={};function t(t,e){o[e]=1,(a.nt(t)||a.isArray(t))&&r?a.hasIndexOrKey(n,e)&&a.sameTypes(i[e],n[e])?a.hasDifferences(i[e],n[e],r)&&s.push(e):s.push(e):i[e]!==n[e]&&s.push(e)}if(a.isArray(i)&&a.isArray(n))i.length>n.length?a.forEach(i,t):a.forEach(n,t);else{if(!a.nt(i)||!a.nt(n)||a.isArray(i)||a.isArray(n))throw new Error("Object types do not match");a.forOwn(i,t),a.forOwn(n,function(t,e){o.hasOwnProperty(e)||s.push(e)})}return s},a.hasIndexOrKey=function(t,e){return a.isArray(t)?t.length>parseInt(e):!!a.nt(t)&&t.hasOwnProperty(e)},a.startsWith=function(t,e){return c(t,"value"),c(e,"prefix"),0===t.indexOf(e)},a.endsWith=function(t,e){c(t,"value"),c(e,"postfix");var i=t.length-e.length;return t.indexOf(e,i)===i},a.sameTypes=function(t,e){return a.isNullOrUndefined(t)||a.isNullOrUndefined(e)?a.isNullOrUndefined(t)&&a.isNullOrUndefined(e):a.isArray(t)||a.isArray(e)?a.isArray(t)&&a.isArray(e):typeof t==typeof e},a.freeze=function(t){return"freeze"in Object?Object.freeze(t):t},a.noop=function(){},a.nt=function(t){return null!==t&&"object"==typeof t},a.isArray=function(t){return!!a.nt(t)&&t.constructor===Array},a.ft=function(t){return"string"==typeof t},a.dt=function(t){return!isNaN(t)&&"number"==typeof t},a.yt=function(t){return"boolean"==typeof t},a.it=function(t){return"function"==typeof t},a.isNullOrUndefined=function(t){return null===t||a.isUndefined(t)},a.isUndefined=function(t){return void 0===t},a.getEnumName=function(t,e){var i=null,n=a.map(t,function(t){return t});return a.dt(e)?i=a.find(n,function(t){return t.id===e}):a.ft(e)&&(i=a.find(n,function(t){return t.name.toLowerCase()===e.toLowerCase()})),i?i.name:null},a.toString=function(t){if(a.ft(t))return t;if(a.yt(t))return t?"true":"false";if(a.dt(t))return t.toString();var e="";if(t)if(a.it(t.toString))e=t.toString();else if(a.nt(t.toString))try{e=t.toString()}catch(t){e="[object invalid toString()]"}if(0!==e.indexOf("[object"))return e;var i=[];return e+JSON.stringify(t,function(t,e){if(a.nt(e)&&!a.isNullOrUndefined(e)){if(a.includes(i,e))return"<recursive>";i.push(e)}return""===t?e:a.toString(e)})},a.pad=function(t,e){r(t,"value"),r(e,"numberToPad");for(var i=t.toString().length,n=0;n<e-i;n++)t="0"+t.toString();return t.toString()},a.addEventListener=function(t,e,i,n){o(t,"target"),c(e,"eventName"),u(i,"listener"),t.phenixAddEventListener?t.phenixAddEventListener.call(t,e,i,!!n):t.addEventListener?t.addEventListener(e,i,!!n):t.attachEvent&&t.attachEvent("on"+e,i)},a.removeEventListener=function(t,e,i,n){o(t,"target"),c(e,"eventName"),u(i,"listener"),t.phenixRemoveEventListener?t.phenixRemoveEventListener.call(t,e,i,!!n):t.removeEventListener?t.removeEventListener(e,i,!!n):t.detachEvent&&t.detachEvent("on"+e,i)};var s=function(t){if(!a.isArray(t))throw new Error("Input must be an array. Received ["+typeof t+"]")},r=function(t,e){if(c(e,"name"),!a.dt(t))throw new Error(e+" must be a number. Received ["+typeof t+"]")},o=function(t,e){if(c(e,"name"),!a.nt(t))throw new Error("collection type not supported - "+e+" must be an array or object. Received ["+typeof t+"]")},u=function(t,e){if(c(e,"name"),!a.it(t))throw new Error(e+" must be a function. Received ["+typeof t+"]")},c=function(t,e){if(!a.ft(e))throw new Error("Name must be a string. Received ["+typeof e+"]");if(!a.ft(t))throw new Error(e+" must be a string. Received ["+typeof t+"]")};function h(t){var e=t.split("."),i=[];return a.forEach(e,function(t){i=i.concat(function(t){for(var e="",i=[],n=0,r=0;r<t.length;r++)if("["===t[r]){if(n++,!a.ft(e)||1<n)return[t];e&&(i.push(e),e="")}else if("]"===t[r]){if(0!=--n)return[t];i.push(e),e=""}else{if(r===t.length-1)return[t];e+=t[r]}return i}(t))}),i}return a}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(0)],void 0===(r=function(s){"use strict";function t(t){this.Ke=t||""}return t.prototype.detect=function(){var t="Unknown",e="?",i=this.Ke.match(/(Chrome|Chromium|Firefox|Opera|Safari)+\//),n=this.Ke.match(/(Chrome|Chromium|Firefox|Version)+\/([0-9]+)\./),r=!1;return i&&2<=i.length?t=i[1]:this.Ke.match(/^\(?Mozilla/)&&(t="Mozilla",(this.Ke.match(/MSIE/)||this.Ke.match(/; Trident\/.*rv:[0-9]+/))&&(t="IE",(n=this.Ke.match(/MSIE ([0-9]+)/))?(e=parseInt(n[1],10),(n=this.Ke.match(/MSIE [0-9]+.*MSIE ([0-9]+)/))&&(e=parseInt(n[1],10))):(n=this.Ke.match(/rv:([0-9]+)/))&&(e=parseInt(n[1],10)))),"Chrome"===t&&this.Ke.match(/OPR\//)?(t="Opera",n=this.Ke.match(/(OPR)\/([0-9]+)\./)):"Chrome"===t&&this.Ke.match(/Edge\//)?(t="Edge",n=this.Ke.match(/(Edge)\/([0-9]+)\./)):"Firefox"!==t&&"IE"!==t||!this.Ke.match(/Opera/)?"Mozilla"===t&&this.Ke.match(/iphone|ipod|ipad/i)&&(t="Safari",e=parseInt(s.get(this.Ke.match(/OS\s([0-9]+)/),[1]),10),r=!0):(t="Opera",n=this.Ke.match(/(Opera) ([0-9]+)\./)),"Chrome"===t&&(this.Ke.match(/; wv/)||this.Ke.match(/Android/)&&this.Ke.match(/Version\/[0-9].[0-9]/))&&(r=!0),"IE"!==t&&n&&3<=n.length&&(e=parseInt(n[2],10)),"ReactNative"===navigator.product&&(t="ReactNative",e=navigator.productSub||"?"),{browser:t,version:e,isWebview:r}},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0)],void 0===(r=function(r){function s(){}return s.prototype.nt=function(t,e){if(s.prototype.ft("name",e),!r.nt(t))throw new Error('"'+e+'" must be an object. Received ['+typeof t+"]")},s.prototype.isArray=function(t,e){if(s.prototype.ft("name",e),!r.isArray(t))throw new Error('"'+e+'" must be an array. Received ['+typeof t+"]")},s.prototype.ft=function(t,e){if(!r.ft(e))throw new Error('"name" must be a string. Received ['+typeof e+"]");if(!r.ft(t))throw new Error('"'+e+'" must be a string. Received ['+typeof t+"]")},s.prototype.yt=function(t,e){if(s.prototype.ft("name",e),!r.yt(t))throw new Error('"'+e+'" must be a boolean. Received ['+typeof t+"]")},s.prototype.dt=function(t,e){if(s.prototype.ft("name",e),!r.dt(t))throw new Error('"'+e+'" must be a number. Received ['+typeof t+"]")},s.prototype.it=function(t,e){if(s.prototype.ft("name",e),!r.it(t))throw new Error('"'+e+'" must be a function. Received ['+typeof t+"]")},s.prototype.et=function(t,e){s.prototype.mt(t,e)},s.prototype.mt=function(t,e){if(s.prototype.ft("name",e),s.prototype.ft(t,e),""===t)throw new Error('"'+e+'" must not be empty')},s.prototype.Qe=function(t,e,i){if(s.prototype.ft("name",i),!r.nt(t))throw new Error('"'+i+'" must be an instance. Received ['+typeof t+"]");if(!(t instanceof e))throw new Error('"'+i+'" must be a valid instance of class '+r.get(e,["name"],"undefined"))},s.prototype.Xe=function(t,e){if(s.prototype.ft("name",e),r.isUndefined(t))throw new Error('"'+e+'" must not be undefined')},s.prototype.lt=function(t,e,i){s.prototype.mt(i,"name");var n=r.getEnumName(e,t);if(r.isNullOrUndefined(n))throw new Error('"'+i+'" must be a valid type. Unable to locate type ['+t+"]");return n},s.prototype.Ye=function(t,i){s.prototype.ft(i,"name"),s.prototype.isArray(t,i),r.forEach(t,function(t,e){s.prototype.ft(t,i+"["+e+"]")})},new s}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(t,e){"use strict";function i(t){e.it(t,"cleanup"),this.Ze=t}return i.prototype.dispose=function(){return this.Ze.call()},i.prototype.toString=function(){return t.toString(this)},i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0)],void 0===(r=function(i){"use strict";function t(){this.$e=[]}return t.prototype.add=function(t){if(!t||!i.it(t.dispose))throw new Error('"disposable" must be a disposable or implement dispose');this.$e.push(t)},t.prototype.dispose=function(){var e=[];return i.forEach(this.$e,function(t){e.push(t.dispose())}),this.$e=[],e},t.prototype.toString=function(){return i.toString(this)},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(19)],void 0===(r=function(r,n,s){"use strict";function t(t,e){var i=t;null==i&&(i=[]),n.isArray(i,"valuesToSet"),this.observableArray=new s(i,e)}return t.prototype.getValue=function(){return this.observableArray.getValue()},t.prototype.setValue=function(t){return null==t&&(t=[]),void 0!==t&&n.isArray(t,"values"),this.observableArray.setValue(t)},t.prototype.subscribe=function(t,e){return this.observableArray.subscribe(t,e)},t.prototype.push=function(t){var e=this.observableArray.getValue();e.push(t),this.observableArray.setValue(e)},t.prototype.pop=function(){var t=this.observableArray.getValue(),e=t.pop();return this.observableArray.setValue(t),e},t.prototype.remove=function(e){function t(t){return r.it(e)?e(t):t===e}var i=this.observableArray.getValue(),n=r.filter(i,t);return 0<n.length&&this.observableArray.setValue(r.remove(i,t)),n},t.prototype.removeAll=function(){var t=this.observableArray.getValue();return this.observableArray.setValue([]),t},t.prototype.extend=function(t){return this.observableArray.extend(t),this},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(i,e){"use strict";function t(t){e.nt(t,"observable"),this.ti=t,this.ei=null,this.ii=!1}return t.prototype.start=function(t,e){this.ii=!0,this.ei=this.ti.subscribe(i.noop,{listenForChanges:{callback:t,timeout:e||500}})},t.prototype.stop=function(){this.ii=!1,this.ei&&this.ei.dispose(),this.ei=null},t.prototype.isEnabled=function(){return this.ii},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(20)],void 0===(r=function(n,r,i){"use strict";function t(){this.v={}}return t.prototype.fire=function(t,e,i){r.mt(t,"name"),n.includes(n.keys(this.v),t)&&this.v[t].fire(e,i)},t.prototype.fireAsync=function(t,e,i){r.mt(t,"name"),n.includes(n.keys(this.v),t)&&this.v[t].fireAsync(e,i)},t.prototype.listen=function(t,e){return r.mt(t,"name"),(n.includes(n.keys(this.v),t)?this.v[t]:this.v[t]=new i).listen(e)},t.prototype.size=function(t){return n.includes(n.keys(this.v),t)?this.v[t].size():0},t.prototype.dispose=function(){n.forOwn(this.v,function(t){t.dispose()}),this.v={}},t.prototype.toString=function(){return"NamedEvents|"+n.keys(this.v).length},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(8),i(13)],void 0===(r=function(a,e,t,u){"use strict";var c=t.__phenixPageLoadTime||t.__pageLoadTime||a.now(),i="2019-11-22T20:59:57Z",n="2019.2.24";function r(){this.ni=[],this.ri=null,this.si=null,this.oi="production",this.ai=i}function s(t){(this.si=t)?this.info("Session started on websdk version [%s] ([%s]), user agent [%s]",i,n,navigator.userAgent):this.info("Websdk version [%s] ([%s]), user agent [%s]",i,n,navigator.userAgent)}function o(e,i){var n=(a.now()-c)/1e3,r=function(t){switch(t){case u.level.TRACE:return"Trace";case u.level.DEBUG:return"Debug";case u.level.INFO:return"Info";case u.level.WARN:return"Warn";case u.level.ERROR:return"Error";case u.level.FATAL:return"Fatal";default:throw new Error("Unsupported Logging Level "+t)}}(i.level),s=i.name||"websdk",o=this;a.forEach(this.ni,function(t){try{t.log(n,r,s,h(Array.prototype.slice.call(e)),o.si,o.ri,o.oi,o.ai,i)}catch(t){}})}r.prototype.trace=function(){return o.call(this,arguments,{level:u.level.TRACE})},r.prototype.debug=function(){return o.call(this,arguments,{level:u.level.DEBUG})},r.prototype.info=function(){return o.call(this,arguments,{level:u.level.INFO})},r.prototype.warn=function(){return o.call(this,arguments,{level:u.level.WARN})},r.prototype.error=function(){return o.call(this,arguments,{level:u.level.ERROR})},r.prototype.fatal=function(){return o.call(this,arguments,{level:u.level.FATAL})},r.prototype.addAppender=function(t){e.nt(t,"appender"),e.it(t.log,"appender.log"),this.ni.push(t)},r.prototype.getAppenders=function(){return this.ni},r.prototype.getUserId=function(){return this.ri},r.prototype.setUserId=function(t){this.ri=t},r.prototype.getEnvironment=function(){return this.oi},r.prototype.setEnvironment=function(t){this.oi=t},r.prototype.getApplicationVersion=function(){return this.ai},r.prototype.setApplicationVersion=function(t){this.ai=t},r.prototype.getObservableSessionId=function(){return this.ui},r.prototype.setObservableSessionId=function(t){this.ui=t,this.ci&&this.ci.dispose(),t&&(e.nt(t,"observableSessionId"),this.ci=this.ui.subscribe(a.bind(s,this),{initial:"notify"}))};var h=function(t){if(0!==t.length){var e=[],i=[];return a.forEach(t,function(t){e.push(a.toString(t)),t instanceof Error&&i.push(t.stack)}),d(e.concat(i))}},d=function(t){for(var e=t[0],i=0;e.indexOf&&1<t.length&&0<=i;)if(0<(i=e.indexOf("%",i)))switch(e.substring(i+1,i+2)){case"%":e=e.substring(0,i)+e.substring(i+1),i++;break;case"s":case"d":t[0]=e=e.substring(0,i)+t[1]+e.substring(i+2),t.splice(1,1);break;default:return t}return t};return r}.apply(e,n))||(t.exports=r)},function(i,n,t){(function(t){var e;void 0===(e=function(){"use strict";return function(){return"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{}}}.apply(n,[]))||(i.exports=e)}).call(this,t(43))},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){var n,r;n=[i(0),i(1),i(13)],void 0===(r=function(t,e,c){"use strict";function i(){this.hi=c.level.TRACE}i.prototype.setThreshold=function(t){e.dt(t,"level"),this.hi=t},i.prototype.getThreshold=function(){return this.hi},i.prototype.log=function(t,e,i,n,r,s,o,a,u){u.level<this.hi||(n[0]=t+" ["+i+"] "+e+" "+n[0],u.level>c.level.INFO?d(n):h(n))};var h=function(t){console.log.apply(console,t)},d=function(t){console.error.apply(console,t)};return i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(9),i(46)],void 0===(r=function(t,r,s,o){"use strict";function e(){}return e.prototype.createPCastLogger=function(t,e){t&&r.mt(t,"baseUri");var i=new s.Logger,n=o.getAppender(t);return n.setThreshold(s.level.INFO),e||i.addAppender(new s.ConsoleAppender),i.addAppender(n),i.isPCastLogger=!0,i},new e}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(14),i(47)],void 0===(r=function(t,e,n,r){var s={urls:{local:"",staging:"https://telemetry-stg.phenixrts.com",production:"https://telemetry.phenixrts.com"}};function i(){this.di={}}return i.prototype.getAppender=function(t){var e=n.parseEnvFromPcastBaseUri(t||""),i=s.urls[e];return this.di[e]||(this.di[e]=function(t){var e=new r(t);return t||e.setEnabled(!1),e}.call(this,i)),this.di[e]},new i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(2),i(9),i(15),i(25)],void 0===(r=function(c,h,e,i,n,r){function t(t){h.ft(t,"uri"),this.fi="/telemetry/logs",this.li="object"==typeof location?location.hostname:e.browser+"-"+e.browserVersion+"-unknown",this.hi=i.level.TRACE,this.ii=!0,this.pi=(e.browser||"Browser")+"/"+(e.browserVersion||"?"),this.mi=0,this.vi=new n.BatchHttpProto(t+this.fi,[r],"telemetry.StoreLogRecords",{maxAttempts:3,maxBufferedRecords:1e3,maxBatchSize:512}),this.vi.on("capacity",c.bind(s,this))}function s(t){this.vi.addRecordToBeginning({level:"Warn",timestamp:c.isoString(),category:"websdk/telemetryLogger",message:"Deleted "+t+" records",source:this.pi,fullQualifiedName:this.li,sessionId:this.gi,userId:this.yi,environment:this.wi,version:this.bi,runtime:this.mi})}return t.prototype.setThreshold=function(t){h.dt(t,"level"),this.hi=t},t.prototype.getThreshold=function(){return this.hi},t.prototype.isEnabled=function(){return this.ii},t.prototype.setEnabled=function(t){h.yt(t,"enabled"),this.ii=t},t.prototype.log=function(t,e,i,n,r,s,o,a,u){u.level<this.hi||!this.ii||(h.isArray(n,"messages"),this.mi=t,this.gi=r,this.yi=s,this.wi=o,this.bi=a,function(t,e,i){this.vi.addRecord({level:t,timestamp:c.isoString(),category:e,message:i.join(" "),source:this.pi,fullQualifiedName:this.li,sessionId:this.gi,userId:this.yi,environment:this.wi,version:this.bi,runtime:this.mi})}.call(this,e,i,n))},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(49),i(23)],void 0===(r=function(r,s,o,a,u){"use strict";function t(t,e,i,n){s.mt(t,"uri"),s.nt(e,"logger"),s.isArray(i,"protocols"),this.De=t,this.rt=e,this.rt.info("Connecting to [%s]",t),this.me=new a(this.De,this.rt),this.ki=new u(this.rt,r.bind(m,this),r.bind(p,this),i,n),this.se=new o.NamedEvents,this.me.onconnected=r.bind(h,this),this.me.onreconnecting=r.bind(c,this),this.me.onreconnected=r.bind(d,this),this.me.ondisconnected=r.bind(f,this),this.me.onerror=r.bind(l,this),this.Si=!1}function e(t,e){this.se.fire(t,e,this)}function c(t){e.call(this,"reconnecting")}function h(t){e.call(this,"connected")}function d(t){e.call(this,"reconnected")}function f(t){e.call(this,"disconnected",[t.code,t.reason]),this.Si&&(this.se.dispose(),this.ki.dispose())}function l(t){e.call(this,"error",[t.data])}function p(t){this.me.onmessage=t}function m(t){this.me&&this.me.send(t)}return t.prototype.onEvent=function(t,e){return this.se.listen(t,e),this.ki.onEvent(t,e)},t.prototype.onRequest=function(t,e){return this.ki.onRequest(t,e)},t.prototype.sendRequest=function(t,e,i,n){return this.ki.sendRequest(t,e,i,n)},t.prototype.sendResponse=function(t,e,i,n){return this.ki.sendResponse(t,e,i,n)},t.prototype.disconnect=function(){return this.Si=!0,this.me.disconnect()},t.prototype.disposeOfPendingRequests=function(){return this.rt.info("Disposing of pending MQ WebSocket requests"),this.ki.disposeOfRequests()},t.prototype.getApiVersion=function(){return this.ki.getApiVersion()},t.prototype.toString=function(){return"MQWebSocket["+this.me.toString()+"]"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(50)],void 0===(r=function(t){"use strict";return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(22)],void 0===(r=function(s,o,a){"use strict";var u={byebye:{code:1e3,reason:"byebye",desc:"Client closed"},backoffLimitReached:{code:4e3,reason:"backoff-limit-reached",desc:"Reached the limit in terms of the number of reconnects"},networkDisconnect:{code:4001,reason:"network-disconnect",desc:"Network connection monitor determined loss to internet connectivity"},reconnecting:{code:4002,reason:"reconnecting",desc:"Closing WebSocket in order to attempt to establish another connection"}},c={code:1,state:"OPEN",desc:"The connection is open and ready to communicate"},e={code:3,state:"CLOSED",desc:"The connection is closed or could not be opened"};function t(t,e,i,n){o.mt(t,"uri"),o.nt(e,"logger"),s.isNullOrUndefined(i)?i=4:o.dt(i,"maxReconnectAttempts"),this.De=t,this.rt=e,this.Ii=i,this.Ti=n||1e3,this.Ri=!1,this.jt=!1,this.Ei=[],this.xi="connecting",this.rt.info("Connecting WebSocket to [%s]",t),this.me=h.call(this,l,d);var r=this;this.Ci=null,this.Mi=a.listenForNetworkChange(function(t){if(t)return s.dt(r.Ci)&&(clearTimeout(r.Ci),r.Ci=null),function(){var t=this;setTimeout(function(){return t.jt?t.rt.info("Unable to go back online after network reconnect. Client has stopped WebSocket."):t.me.readyState!==c.code?(t.rt.info("Network Reconnected. Attempting to reconnect WebSocket."),t.reconnect()):t.Pi?(t.rt.info("Network Reconnected with WebSocket status of [%s].",c.state),l.call(t)):("online"===t.xi&&"reconnected"===this.xi||p.call(t),void t.rt.info("Network Reconnected."))},1e3)}.call(r);s.dt(r.Ci)||(f.call(r),r.Ci=setTimeout(function(){return function(){this.rt.warn("Network not reconnected after [%s]. Going Offline and disconnecting WebSocket connection.",15e3),this.Pi=!0,m.call(this,u.networkDisconnect)}.call(r)},15e3))},0)}function n(t){return this.me.readyState===e.code?d.call(this,t):this.me.close(t.code,t.reason)}function h(t,e){var i=new WebSocket(this.De);return i.onopen=s.bind(t,this),i.onclose=s.bind(e,this),i.onmessage=s.bind(g,this),i.onerror=s.bind(v,this),i}function r(t){this.me.readyState!==c.code&&this.reconnect(t+1)}function d(t){switch(t.code){case u.reconnecting.code:return;case u.byebye.code:case u.backoffLimitReached.code:case u.networkDisconnect.code:return m.call(this,t);default:if(this.Ri)return;return f.call(this,t),this.rt.info("Attempting to re-establish socket connection after disconnect event with code [%s] and reason [%s]",t.code,t.reason),this.reconnect()}}function f(t){this.rt.info("WebSocket is reconnecting"),this.xi="reconnecting",this.onreconnecting&&this.onreconnecting(t)}function l(t){this.rt.info("WebSocket Connected"),function(){var t=this.Ei.length;if(0!==t)for(this.rt.info("Sending [%s] queued messages",t);0<t;){t--;var e=this.Ei.shift();this.send(e)}}.call(this),this.xi="connected",this.onconnected&&this.onconnected(t)}function p(t){this.rt.info("Successfully reconnected to WebSocket"),this.xi="reconnected",this.onreconnected&&this.onreconnected(t)}function m(t){this.rt.info("WebSocket Disconnected [%s]: [%s]",t.code,t.reason),this.xi="disconnected",this.ondisconnected&&this.ondisconnected(t)}function v(t){this.rt.error("An error occurred on the WebSocket connection [%s]",t.data||t),this.onerror&&this.onerror(t)}function g(t){this.rt.debug(">> [%s]",t.data),this.onmessage&&this.onmessage(t)}return t.prototype.onmessage=null,t.prototype.onconnected=null,t.prototype.onreconnecting=null,t.prototype.onreconnected=null,t.prototype.ondisconnected=null,t.prototype.onerror=null,t.prototype.send=function(t){return a.isOnline(),this.me.send(t)},t.prototype.reconnect=function(t){this.me.onclose=null,this.me.onerror=null,this.Ri=!0;var e,i=this;if(s.dt(t)||(t=1),this.jt)return this.rt.info("Client has stopped WebSocket after [%s] reconnect attempts",t-1);if(t>this.Ii)return this.rt.warn("Unable to reconnect WebSocket after [%s] attempts",this.Ii),n.call(this,u.backoffLimitReached);n.call(this,u.reconnecting);try{this.me=h.call(i,function(){return e&&clearTimeout(e),i.Ri=!1,i.me.onclose=s.bind(d,i),p.call(i)},function(){t+1>i.Ii&&(e&&clearTimeout(e),r.call(i,t))})}catch(t){this.rt.warn("Unable to create WebSocket connection [%s]",t)}e=function(t){var e=this;return setTimeout(function(){r.call(e,t)},t*t*this.Ti)}.call(this,t)},t.prototype.disconnect=function(){return this.Mi.dispose(),this.jt=!0,s.dt(this.Ci)&&(clearTimeout(this.Ci),this.Ci=null),this.me.close(u.byebye.code,u.byebye.reason)},t.prototype.toString=function(){return"ReconnectedWebSocket["+this.De+","+this.me.readyState+"]"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(8),i(4),i(7),i(3)],void 0===(r=function(s,e,i,n,o){"use strict";function t(){var t="undefined"==typeof navigator||navigator.onLine;this.Oi=new n.Observable(t).extend({timeout:0}),this.se=new i.NamedEvents,s.addEventListener(e,"online",s.bind(this.se.fire,this.se,"online",[])),s.addEventListener(e,"offline",s.bind(this.se.fire,this.se,"offline",[])),s.addEventListener(e,"unload",s.bind(this.se.dispose,this.se)),this.se.listen("online",s.bind(this.Oi.setValue,this.Oi,!0)),this.se.listen("offline",s.bind(this.Oi.setValue,this.Oi,!1))}function a(t,e){var i=this;if(this.Oi.setValue(!1),!s.dt(e))return t(!1);i.offlineTimeout=setTimeout(function(){t&&!i.Oi.getValue()&&t(!1)},e)}function u(t){this.Oi.setValue(!0),t&&t(!0)}return t.prototype.listenForNetworkChange=function(t,e){var i=new o.DisposableList,n=s.bind(u,this,t),r=s.bind(a,this,t,e);return i.add(this.se.listen("online",n)),i.add(this.se.listen("offline",r)),i},t.prototype.isOnline=function(){return this.Oi.getValue()},new t}.apply(e,n))||(t.exports=r)},function(t,e,i){"use strict";t.exports=r;var n=i(53);function r(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var s=4294967296,o=1/s;function a(t){return t.type===r.Bytes?t.readVarint()+t.pos:t.pos+1}function u(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function c(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;t<=r;r--)i.buf[r+n]=i.buf[r]}function h(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function d(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function f(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function l(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function p(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function m(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function v(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function g(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function y(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function w(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function b(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function k(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}r.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,s=this.pos;this.type=7&n,t(r,e,this),this.pos===s&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=w(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=k(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=w(this.buf,this.pos)+w(this.buf,this.pos+4)*s;return this.pos+=8,t},readSFixed64:function(){var t=w(this.buf,this.pos)+k(this.buf,this.pos+4)*s;return this.pos+=8,t},readFloat:function(){var t=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,n=this.buf;return e=127&(i=n[this.pos++]),i<128?e:(e|=(127&(i=n[this.pos++]))<<7,i<128?e:(e|=(127&(i=n[this.pos++]))<<14,i<128?e:(e|=(127&(i=n[this.pos++]))<<21,i<128?e:function(t,e,i){var n,r,s=i.buf;if(n=(112&(r=s[i.pos++]))>>4,r<128)return u(t,n,e);if(n|=(127&(r=s[i.pos++]))<<3,r<128)return u(t,n,e);if(n|=(127&(r=s[i.pos++]))<<10,r<128)return u(t,n,e);if(n|=(127&(r=s[i.pos++]))<<17,r<128)return u(t,n,e);if(n|=(127&(r=s[i.pos++]))<<24,r<128)return u(t,n,e);if(n|=(1&(r=s[i.pos++]))<<31,r<128)return u(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,i){for(var n="",r=e;r<i;){var s,o,a,u=t[r],c=null,h=239<u?4:223<u?3:191<u?2:1;if(i<r+h)break;1===h?u<128&&(c=u):2===h?128==(192&(s=t[r+1]))&&(c=(31&u)<<6|63&s)<=127&&(c=null):3===h?(s=t[r+1],o=t[r+2],128==(192&s)&&128==(192&o)&&((c=(15&u)<<12|(63&s)<<6|63&o)<=2047||55296<=c&&c<=57343)&&(c=null)):4===h&&(s=t[r+1],o=t[r+2],a=t[r+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&((c=(15&u)<<18|(63&s)<<12|(63&o)<<6|63&a)<=65535||1114112<=c)&&(c=null)),null===c?(c=65533,h=1):65535<c&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),r+=h}return n}(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var i=a(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===r.Varint)for(;127<this.buf[this.pos++];);else if(e===r.Bytes)this.pos=this.readVarint()+this.pos;else if(e===r.Fixed32)this.pos+=4;else{if(e!==r.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),b(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),b(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),b(this.buf,-1&t,this.pos),b(this.buf,Math.floor(t*o),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),b(this.buf,-1&t,this.pos),b(this.buf,Math.floor(t*o),this.pos+4),this.pos+=8},writeVarint:function(c){268435455<(c=+c||0)||c<0?function(t,e){var i,n,r,s,o,a,u;if(0<=c?(i=c%4294967296|0,n=c/4294967296|0):(n=~(-c/4294967296),4294967295^(i=~(-c%4294967296))?i=i+1|0:n=n+1|(i=0)),0x10000000000000000<=c||c<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),a=i,(u=e).buf[u.pos++]=127&a|128,a>>>=7,u.buf[u.pos++]=127&a|128,a>>>=7,u.buf[u.pos++]=127&a|128,a>>>=7,u.buf[u.pos++]=127&a|128,a>>>=7,u.buf[u.pos]=127&a,o=(7&(r=n))<<4,(s=e).buf[s.pos++]|=o|((r>>>=3)?128:0),r&&(s.buf[s.pos++]=127&r|((r>>>=7)?128:0),r&&(s.buf[s.pos++]=127&r|((r>>>=7)?128:0),r&&(s.buf[s.pos++]=127&r|((r>>>=7)?128:0),r&&(s.buf[s.pos++]=127&r|((r>>>=7)?128:0),r&&(s.buf[s.pos++]=127&r)))))}(0,this):(this.realloc(4),this.buf[this.pos++]=127&c|(127<c?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(127<c?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(127<c?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var n,r,s=0;s<e.length;s++){if(55295<(n=e.charCodeAt(s))&&n<57344){if(!r){56319<n||s+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):r=n;continue}if(n<56320){t[i++]=239,t[i++]=191,t[i++]=189,r=n;continue}n=r-55296<<10|n-56320|65536,r=null}else r&&(t[i++]=239,t[i++]=191,t[i++]=189,r=null);n<128?t[i++]=n:(n<2048?t[i++]=n>>6|192:(n<65536?t[i++]=n>>12|224:(t[i++]=n>>18|240,t[i++]=n>>12&63|128),t[i++]=n>>6&63|128),t[i++]=63&n|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;128<=i&&c(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),n.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),n.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;128<=n&&c(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,r.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){this.writeMessage(t,h,e)},writePackedSVarint:function(t,e){this.writeMessage(t,d,e)},writePackedBoolean:function(t,e){this.writeMessage(t,p,e)},writePackedFloat:function(t,e){this.writeMessage(t,f,e)},writePackedDouble:function(t,e){this.writeMessage(t,l,e)},writePackedFixed32:function(t,e){this.writeMessage(t,m,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,v,e)},writePackedFixed64:function(t,e){this.writeMessage(t,g,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,y,e)},writeBytesField:function(t,e){this.writeTag(t,r.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,r.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,r.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,r.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},function(t,e){e.read=function(t,e,i,n,r){var s,o,a=8*r-n-1,u=(1<<a)-1,c=u>>1,h=-7,d=i?r-1:0,f=i?-1:1,l=t[e+d];for(d+=f,s=l&(1<<-h)-1,l>>=-h,h+=a;0<h;s=256*s+t[e+d],d+=f,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=n;0<h;o=256*o+t[e+d],d+=f,h-=8);if(0===s)s=1-c;else{if(s===u)return o?NaN:1/0*(l?-1:1);o+=Math.pow(2,n),s-=c}return(l?-1:1)*o*Math.pow(2,s-n)},e.write=function(t,e,i,n,r,s){var o,a,u,c=8*s-r-1,h=(1<<c)-1,d=h>>1,f=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,l=n?0:s-1,p=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),2<=(e+=1<=o+d?f/u:f*Math.pow(2,1-d))*u&&(o++,u/=2),h<=o+d?(a=0,o=h):1<=o+d?(a=(e*u-1)*Math.pow(2,r),o+=d):(a=e*Math.pow(2,d-1)*Math.pow(2,r),o=0));8<=r;t[i+l]=255&a,l+=p,a/=256,r-=8);for(o=o<<r|a,c+=r;0<c;t[i+l]=255&o,l+=p,o/=256,c-=8);t[i+l-p]|=128*m}},function(t,e,i){var n,r;n=[i(0)],void 0===(r=function(f){"use strict";function t(t){this.qi=t,this.Di={},this.Ai={},function s(t,e){0<f.get(t,["messages","length"],0)&&function(t,n){var r=this;n.messages=f.reduce(t,function(t,e){if(!n[e.name]){var i=f.reduce(e.fields,function(t,e){return t[e.id]=!0,t},{});return t[e.name]={parent:n,type:e.name,fieldIds:i},s.call(r,e,t[e.name]),t}},{})}.call(this,t.messages,e),0<f.get(t,["enums","length"],0)&&function(t,e){e.enums=f.reduce(t,function(t,e){return t[e.name]=f.reduce(e.values,function(t,e){return t[e.name]=e,t},{}),t},{})}.call(this,t.enums,e)}.call(this,this.qi,this.Di),function e(t,i){var n=this;f.forEach(t.messages,function(t){i.messages[t.name].fields=f.reduce(t.fields,f.bind(r,this,i.messages[t.name]),{}),t.messages&&e.call(n,t,i.messages[t.name])})}.call(this,this.qi,this.Di)}function u(r,s,t,e){var i,o=this,n=(i=r.messages[s],f.reduce(i.fields,function(t,e){return t[e.name]=f.clone(e.defaultValue),t},{}));return t.readFields(function(t,e,i){if(r.messages[s].fieldIds[t]){var n=r.messages[s].fields[t];"repeated"===n.rule?e[n.name].push(a.call(o,r.messages[s],s,t,i)):e[n.name]=a.call(o,r.messages[s],s,t,i)}},n,e)}function l(e,i,n,r){var s=this,t=e.messages[i];f.forEach(f.keys(t.fields),function(t){return function i(n,r,s,o,a,t){var u=this,e=n.messages[r].fields[s],c=o[e.name];if(f.isUndefined(t)||(c=c[t]),e.defaultValue!==c&&!f.isUndefined(c)){if(f.isArray(c)){if("repeated"!==e.rule)throw new Error("Invalid type. Array is not valid with rule ["+e.rule+"]");return f.forEach(c,function(t,e){i.call(u,n,r,s,o,a,e)})}if(f.nt(e.schema)&&f.nt(c))return a.writeMessage(s,f.bind(l,this,e.schema.parent,e.type),c);var h=f.isUndefined(c)?e.defaultValue:c;if(f.nt(e.schema)&&!e.schema.fields){var d=f.dt(c)?c:f.get(e.schema,[h,"id"]);return a.writeVarintField(s,d)}switch(e.type){case"string":return a.writeStringField(s,h);case"float":return a.writeFloatField(s,h);case"double":return a.writeDoubleField(s,h);case"bool":return a.writeBooleanField(s,h);case"enum":case"uint32":case"uint64":case"int32":case"int64":return a.writeVarintField(s,h);case"sint32":case"sint64":return a.writeSVarintField(s,h);case"fixed32":return a.writeFixed32Field(s,h);case"fixed64":return a.writeFixed64Field(s,h);case"sfixed32":return a.writeSFixed32Field(s,h);case"sfixed64":return a.writeSFixed64Field(s,h);case"bytes":return a.writeBytesField(s,h);default:throw new Error("Unexpected type: "+e.type)}}}.call(s,e,i,parseInt(t),n,r)})}function r(t,e,i){return e[i.id]={rule:i.rule,type:i.type,name:i.name,schema:function t(e,i){return f.get(i,["messages",e])?i.messages[e]:f.get(i,["enums",e])?i.enums[e]:i.parent?t(e,i.parent):e}.call(this,i.type,t),defaultValue:function(t,e,i){if("repeated"===t)return[];switch(e){case"float":case"double":case"uint32":case"uint64":case"int32":case"int64":case"sint32":case"sint64":case"fixed32":case"fixed64":case"sfixed32":case"sfixed64":case"string":case"enum":case"bool":case"long":default:return f.isUndefined(i)?null:i}}(i.rule,i.type,f.get(i,["options","default"]))},e}function a(t,e,i,n){var r="int32"===e||"int64"===e?"true":"",s=t.fields[i];if(f.nt(s.schema)){if(s.schema.fields)return u.call(this,s.schema.parent,s.type,n,n.readVarint()+n.pos);var o=n.readVarint(r),a=f.getEnumName(s.schema,o);if(f.isNullOrUndefined(a))throw new Error("Unsupported enum id ["+o+"] for field ["+s.name+"] on message ["+t.type+"]");return a}switch(s.type){case"string":return n.readString(r);case"float":return n.readFloat(r);case"double":return n.readDouble(r);case"bool":return n.readBoolean(r);case"enum":return n.readVarint(r);case"uint32":case"uint64":case"int32":case"int64":return n.readVarint(r);case"sint32":case"sint64":return n.readSVarint(r);case"fixed32":return n.readFixed32(r);case"fixed64":return n.readFixed64(r);case"sfixed32":return n.readSFixed32(r);case"sfixed64":return n.readSFixed64(r);case"bytes":return n.readBytes(r);default:throw new Error("Unexpected type: "+s.type)}}return t.prototype.read=function(t,e,i){if(!this.Di.messages[t])throw new Error("Unsupported proto type ["+t+"]");return u.call(this,this.Di,t,e,i)},t.prototype.write=function(t,e,i){if(!this.Di.messages[t])throw new Error("Unsupported proto type ["+t+"]");return l.call(this,this.Di,t,e,i)},t.prototype.getDefaults=function(){},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{package:"mq",messages:[{name:"Message",fields:[{rule:"optional",type:"MessageType",name:"messageType",id:7,options:{default:"Request"}},{rule:"optional",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"requestId",id:2},{rule:"required",type:"string",name:"type",id:3},{rule:"optional",type:"string",name:"encoding",id:4},{rule:"required",type:"bytes",name:"payload",id:5},{rule:"repeated",type:"double",name:"wallTime",id:6}],enums:[{name:"MessageType",values:[{name:"Request",id:0},{name:"Response",id:1},{name:"Event",id:2}]}]},{name:"Error",fields:[{rule:"required",type:"string",name:"reason",id:1}]},{name:"PingPong",fields:[{rule:"required",type:"uint64",name:"originTimestamp",id:1},{rule:"optional",type:"uint64",name:"count",id:2}]}]}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(0),i(1),i(8),i(57)],void 0===(r=function(r,s,o,a){"use strict";function u(){this.Fi=[],this.Ni=""}return u.prototype.push=function(){1024<this.Fi.length+arguments.length&&(this.Ni+=String.fromCharCode.apply(String,this.Fi),this.Fi.length=0),Array.prototype.push.apply(this.Fi,arguments)},u.prototype.build=function(){return this.Ni+String.fromCharCode.apply(String,this.Fi)},{toString:function(t){var e=0,i=t.length,n=new u;return a.encode(function(){return e<i?t[e++]:null},r.bind(n.push,n)),n.build()},toByteArray:function(t){s.ft(t,"data");var e,i,n=[];return a.decode((e=t,i=0,function(){return i<e.length?e.charCodeAt(i++):null}),function(t){n.push(t)}),new o.Uint8Array(n)}}}.apply(e,n))||(t.exports=r)},function(t,e,i){t.exports=i(58)},function(n,s,a){var u;!function(){for(var t={},r=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],o=[],e=0,i=r.length;e<i;++e)o[r[e]]=e;t.encode=function(t,e){for(var i,n;null!==(i=t());)e(r[i>>2&63]),n=(3&i)<<4,null!==(i=t())?(e(r[63&((n|=i>>4&15)|i>>4&15)]),n=(15&i)<<2,null!==(i=t())?(e(r[63&(n|i>>6&3)]),e(r[63&i])):(e(r[63&n]),e(61))):(e(r[63&n]),e(61),e(61))},t.decode=function(t,e){var i,n,r;function s(t){throw Error("Illegal character code: "+t)}for(;null!==(i=t());)if(void 0===(n=o[i])&&s(i),null!==(i=t())&&(void 0===(r=o[i])&&s(i),e(n<<2>>>0|(48&r)>>4),null!==(i=t()))){if(void 0===(n=o[i])){if(61===i)break;s(i)}if(e((15&r)<<4>>>0|(60&n)>>2),null!==(i=t())){if(void 0===(r=o[i])){if(61===i)break;s(i)}e((3&n)<<6>>>0|r)}}},t.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)},n.exports?n.exports=t:void 0===(u=function(){return t}.call(s,a,s,n))||(n.exports=u)}()},function(t,e,i){var n,r;n=[i(0),i(1),i(60),i(24),i(63)],void 0===(r=function(a,u,c,h,n){"use strict";function d(t,e,i){return n.toString(t.encode(e,i))}function f(t,e,i){return t.decode(e+"Response",n.toByteArray(i))}return function(t,e,i,n,r){u.mt(t,"uri"),u.isArray(e,"protocols"),u.mt(i,"type"),u.nt(n,"options");var s=a.assign({},n||{},{contentType:"application/protobuf"}),o=new h(e,r);return new c(t,s,a.bind(d,this,o,i),a.bind(f,this,o,i))}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(61)],void 0===(r=function(t){"use strict";return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(8),i(22),i(5),i(7),i(3)],void 0===(r=function(s,o,a,u,c,h,d,f){var i=0,l={capacity:"capacity",error:"error",response:"response"},p=null;function t(t,e,i,n){o.mt(t,"uri"),e=e||{},o.nt(e,"options"),e.requestType&&o.mt(e.requestType,"options.requestType"),e.maxAttempts&&o.dt(e.maxAttempts,"options.maxAttempts"),e.maxBufferedRecords&&o.dt(e.maxBufferedRecords,"options.maxBufferedRecords"),e.maxBatchSize&&o.dt(e.maxBatchSize,"options.maxBatchSize"),e.contentType&&o.mt(e.contentType,"options.maxBatchSize"),i&&o.it(i,"serializeRequest"),n&&o.it(n,"deserializeResponse"),this.Ui="__phenixBatchHttpMessages|"+t,this.ji=e.requestType||"POST",this.Li=e.requestTimeout||3e4,this.Bi=e.maxAttempts||5,this.Wi=e.maxBufferedRecords||1e3,this._i=e.maxBatchSize||100,this.Vi=e.contentType||"application/json",this.zi=i,this.Gi=n,this.De=t,this.Ji=g.call(this)||[],this.ii=!0,this.se=new a.NamedEvents,this.Hi=new d.Observable(!0),this.g=new f.DisposableList,this.Ki=!1,this.Qi=!1,this.Xi=null===p?p=b.call(this):p,this.g.add(this.Hi.subscribe(s.bind(m,this))),this.g.add(function(){var t=this;return c.listenForNetworkChange(function(){v.call(t,t.Ki)})}.call(this)),this.g.add(this.se),w.call(this,[]),m.call(this);var r=this;s.addEventListener(u,"beforeunload",function(){y.call(r,r.Ji),r.Qi=!0,r.Ji=[]})}function e(){if(this.Ji.length>this.Wi){var t=this.Ji.length-this.Wi/2;this.Ji=this.Ji.slice(t),this.se.fireAsync(l.capacity,[null,{numberOfDeletedRecords:t}])}}function m(){if(this.Hi.getValue()&&0!==this.Ji.length){v.call(this,!0);var t={records:s.take(this.Ji,this._i)};this.Ji=this.Ji.slice(this._i);var e=this;try{(function(t,e,n){var r=this,i=this.zi?this.zi(s.assign({},e)):e;switch(this.ji){case"POST":return h.postWithRetry(t,i,{timeout:this.Li,contentType:this.Vi,retryOptions:{maxAttempts:this.Bi,additionalRetryErrorCodes:[0]}},function(t,e){if(t)return"timeout"!==t.message||function(){return this.Ji.length>=this.Wi}.call(r)?(v.call(r,!1),r.se.fire(l.error,[t])):n();v.call(r,!1);var i=r.Gi?r.Gi(e.data):e.data;return r.se.fire(l.response,[i])});default:throw new Error("Invalid request type")}}).call(this,this.De,t,function(){setTimeout(function(){e.Ji=e.Ji.concat(t.records),v.call(e,!1)},i)})}catch(t){setTimeout(function(){return v.call(e,!1),e.se.fire(l.error,[t])},i)}}}function v(t){this.Ki=t,this.Hi.setValue(!t&&c.isOnline())}t.prototype.on=function(t,e){return o.mt(t,"eventName"),o.it(e,"callback"),this.se.listen(t,e)},t.prototype.addRecord=function(t){this.Qi?y.call(this,[t]):(this.Ji.push(t),m.call(this),e.call(this))},t.prototype.addRecordToBeginning=function(t){this.Ji.unshift(t),m.call(this),e.call(this)},t.prototype.dispose=function(){this.Ji=[],this.g.dispose()};var g=function(){if(!this.Xi)return[];try{var t=u.localStorage.getItem(this.Ui);if(t)return JSON.parse(t)}catch(t){console.log("Failed to read local storage ["+t.message+"]")}return[]},y=function(t){if(this.Xi&&t&&0!==t.length){var e=g.call(this).concat(t);w.call(this,e)}},w=function(t){if(this.Xi&&t)try{var e=JSON.stringify(t);u.localStorage.setItem(this.Ui,e)}catch(t){console.log("Failed to store data in local storage ["+t.message+"]")}},b=function(){try{if(!u.localStorage)return console.log("Local storage not available"),!1;var t="__is_local_storage_supported__";u.localStorage.setItem(t,t);var e=u.localStorage.getItem(t);return u.localStorage.removeItem(t),e!==t&&console.log("Local storage is passively blocked"),e===t}catch(t){return console.log("Local storage is blocked"),!1}};return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(3)],void 0===(r=function(p,a,m){"use strict";var v=1,g=2,y=1500,w={clientAborted:{id:4e3,name:"Aborted by Client"}};function t(){}function r(t,e,i,n,r){u(n=n||{});var s=h(t,c(n.queryParameters||{},e)),o=p.bind(b,this,p.now(),r);if(!s)return r(d());n.responseType&&(s.responseType=n.responseType),f(s,n),s.addEventListener("readystatechange",p.bind(l,this,s,n,o)),s.timeout=n.timeout||15e3,s.send(i)}function s(t,e,i,n,r){var s=p.bind(t,this,e,i,n),o={startTime:p.now(),isDisposed:!1};return k.call(this,e,n,s,o,r)}function u(t){a.nt(t,"settings"),t.queryParameters&&a.nt(t.queryParameters,"settings.queryParameters"),t.mimeType&&a.et(t.mimeType,"settings.mimeType"),t.accept&&a.et(t.accept,"settings.accept"),t.contentType&&a.et(t.contentType,"settings.contentType"),t.responseType&&a.et(t.responseType,"settings.responseType"),p.isNullOrUndefined(t.timeout)||a.dt(t.timeout,"settings.timeout")}function c(t,e){var i=e.lastIndexOf("#"),n=e.indexOf("?"),r=p.reduce(t,function(t,e,i){return(t+=t?"&":"")+i.toString()+"="+e.toString()},""),s=-1===i?"":e.substring(i+1),o=-1===n?"":e.substring(n+1,s?i:e.length),a=r+(o?"&"+o:"");return e=e.replace("?"+o,"").replace("#"+s,""),a&&(e+="?"+a),s&&(e+="#"+s),e}function h(t,e){var i=new XMLHttpRequest;if("withCredentials"in i)i.open(t,e,!0);else{if("undefined"==typeof XDomainRequest)return;(i=new XDomainRequest).open(t,e)}return i}function d(){var t=new Error("unsupported");return t.code="unsupported",t}function f(i,t){var e=t.contentType||"application/json",n=t.accept||e,r=p.assign({},{"Content-Type":e,Accept:n},p.get(t,["headers"],{}));p.forOwn(r,function(t,e){i.setRequestHeader(e,t)})}function l(t,e,i){if(4===t.readyState)if(200===t.status){var n=(o=t.getAllResponseHeaders(),p.reduce(o.trim().split(/[\r\n]+/),function(t,e){var i=e.split(": "),n=i.shift(),r=i.join(": ");return n&&(t[n]=r),t},{}));i(null,{data:t.response||t.responseText,headers:n,rawXhr:t})}else{var r=new Error(0===t.status?"timeout":"Status=["+t.status+"]"),s=p.get(e,["retryOptions","additionalRetryErrorCodes"],[]);p.forEach(s,function(t){a.dt(t,"additionalRetryErrorCode")}),r.code=t.status,(500<=t.status&&t.status<600||p.includes(s,t.status))&&(r.retryable=!0),i(r)}var o}function b(t,e,i,n){n&&p.set(n,["stats","successResponseTime"],p.now()-t),e(i,n)}function k(i,n,r,s,o,a){function t(t,e){return s.isDisposed?o(S(w.clientAborted)):t&&t.retryable&&a<d?k.call(u,i,n,r,s,o,a+1):function(t,e,i,n,r){r&&(p.set(r,["stats","totalResponseTimeForAllAttempts"],p.now()-t),p.set(r,["stats","attempts"],e)),i(n,r)}.call(u,s.startTime,a,o,t,e)}a=a||1;var u=this,e=p.get(n,["delay"],null),c=p.get(n,["retryOptions","delay"],y),h=p.get(n,["retryOptions","backoff"],g),d=p.get(n,["retryOptions","maxAttempts"],v),f=1<a?c*Math.pow(a,h):e,l=new m.Disposable(function(){p.dt(s.mostRecentTimeout)&&clearTimeout(s.mostRecentTimeout),s.isDisposed=!0});return!p.dt(e)&&1===a||p.get(n,["retryOptions","sync"],!1)?r.call(u,t):function(t,e,i,n,r,s){var o=this;n.mostRecentTimeout=setTimeout(function(){if(n.isDisposed)return s(S(w.clientAborted));i.call(o,s)},r)}.call(u,i,n,r,s,f,t),l}function S(t){var e=new Error(t.name);return e.code=t.id,e}return t.prototype.get=function(t,e,i){u(e=e||{});var n=h("GET",c(e.queryParameters||{},t)),r=p.bind(b,this,p.now(),i);if(!n)return i(d());e.mimeType&&n.overrideMimeType(e.mimeType),e.responseType&&(n.responseType=e.responseType),f(n,e),n.addEventListener("readystatechange",p.bind(l,this,n,e,r)),n.timeout=e.timeout||5e3,n.send()},t.prototype.post=function(t,e,i,n){return r.call(this,"POST",t,e,i,n)},t.prototype.put=function(t,e,i,n){return r.call(this,"PUT",t,e,i,n)},t.prototype.delete=function(t,e,i,n){return r.call(this,"DELETE",t,e,i,n)},t.prototype.getWithRetry=function(t,e,i){var n=p.bind(this.get,this,t,e),r={startTime:p.now(),isDisposed:!1};return k.call(this,t,e,n,r,i)},t.prototype.postWithRetry=function(t,e,i,n){return s.call(this,this.post,t,e,i,n)},t.prototype.putWithRetry=function(t,e,i,n){return s.call(this,this.put,t,e,i,n)},t.prototype.deleteWithRetry=function(t,e,i,n){return s.call(this,this.delete,t,e,i,n)},new t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(8)],void 0===(r=function(r,s){"use strict";return{toString:function(t){var e=0,i=t.length,n=[],r=[];if(e===i)return"";for(;e<i;)n.push(t[e++]),1024<=n.length&&(r.push(String.fromCharCode.apply(String,n)),n=[]);return r.join("")+String.fromCharCode.apply(String,n)},toByteArray:function(t){r.ft(t,"data");for(var e,i=0,n=new s.Uint8Array(t.length);i<t.length;){if(255<(e=t.charCodeAt(i)))throw RangeError("illegal char code: "+e);n[i++]=e}return n}}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(3)],void 0===(r=function(r,e,t,s){"use strict";function i(){this.se=new t.NamedEvents,this.Yi=r.now(),this.g=new s.DisposableList,this.Zi=!0,this.g.add(this.se),function(){if(n())return function(){if(n()){var r=this;chrome.extension.onRequest.addListener(function(t,i,n){"is_selected"===t&&chrome.tabs.getSelected(null,function(t){var e=t.id===i.tab.id;o.call(r,e),n(e)})})}}.call(this);(function(){var e,t,i=this;function n(){var t=!document[e];o.call(i,t)}"object"==typeof document&&(void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden?(e="webkitHidden",t="webkitvisibilitychange"):void 0!==document.hidden&&(e="hidden",t="visibilitychange"),void 0!==document.addEventListener&&void 0!==document[e]?(r.addEventListener(document,t,n,!1),i.g.add(new s.Disposable(function(){r.removeEventListener(document,t,n,!1)}))):function(){var e=this;e.$i=setInterval(function(){var t=document.hasFocus();o.call(e,t)},3e3),e.g.add(new s.Disposable(function(){r.dt(e.$i)&&clearInterval(e.$i),e.$i=null}))}.call(i))}).call(this)}.call(this)}function n(){return"undefined"!=typeof chrome&&chrome.extension&&chrome.extension.onRequest}function o(t){if(e.yt(t,"isForeground"),this.Zi!==t)return t?(this.Zi=!0,a.call(this,"foreground")):(this.Zi=!1,a.call(this,"background"))}function a(t){var e=r.now(),i=e-this.Yi;this.Yi=e,this.se.fire(t,[i])}return i.prototype.isForeground=function(){return this.Zi},i.prototype.getTimeSinceLastChange=function(){return r.now()-this.Yi},i.prototype.onForeground=function(t){return e.it(t,"callback"),this.se.listen("foreground",t)},i.prototype.onBackground=function(t){return e.it(t,"callback"),this.se.listen("background",t)},i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(2)],void 0===(r=function(t){"use strict";function e(){this.init()}return e.prototype.init=function(){if(!t.global.AudioContext&&!t.global.webkitAudioContext)throw new Error("Browser does not support AudioContext");this.tn=new(t.global.AudioContext||t.global.webkitAudioContext)},e.prototype.getNativeAudioContext=function(){return this.tn},e.prototype.toString=function(){return"AudioContext"},e}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(7),i(15),i(2),i(67),i(68)],void 0===(r=function(c,h,r,s,d,o,a){"use strict";function t(t,e,i,n){h.mt(t,"uri"),h.ft(e,"deviceId"),h.mt(i,"version"),h.nt(n,"logger"),this.bt=e,this.Z=i,this.rt=n,this.en=new s.MQWebSocket(t,this.rt,[o,a],5),this.ui=new r.Observable(null).extend({rateLimit:0})}return t.prototype.onEvent=function(t,e){return this.en.onEvent(t,e)},t.prototype.disconnect=function(){return this.ui.setValue(null),this.en.disconnect()},t.prototype.authenticate=function(t,n){h.mt(t,"authToken"),h.it(n,"callback");var e={apiVersion:this.en.getApiVersion(),clientVersion:this.Z,deviceId:this.bt,platform:d.browser,platformVersion:d.browserVersion.toString(),authenticationToken:t};this.getSessionId()&&(e.sessionId=this.getSessionId());var r=this;return this.en.sendRequest("pcast.Authenticate",e,function(t,e){if(e){var i=r.ui.getValue();i&&i!==e.sessionId&&r.en.disposeOfPendingRequests(),r.ui.setValue(e.sessionId)}return n(t,e)})},t.prototype.getSessionId=function(){return this.ui.getValue()},t.prototype.getObservableSessionId=function(){return this.ui},t.prototype.bye=function(t,e){h.mt(t,"reason"),h.it(e,"callback");var i={sessionId:this.getSessionId(),reason:t};return this.en.sendRequest("pcast.Bye",i,e)},t.prototype.setupStream=function(t,e,i,n,r){h.mt(t,"streamType"),h.mt(e,"streamToken"),h.nt(i,"options"),h.it(r,"callback");var s=d.browser||"UnknownBrowser",o=s+"-"+(d.browserVersion||0),a="rtt[http]="+n,u={streamToken:e,createStream:{sessionId:this.getSessionId(),options:["data-quality-notifications",a],connectUri:i.connectUri,connectOptions:i.connectOptions||[],tags:i.tags||[],userAgent:c.get(d,["global","navigator","userAgent"],o)}};return i.originStreamId&&(u.createStream.originStreamId=i.originStreamId),i.negotiate&&(u.createStream.createOfferDescription={streamId:"",options:[t,s,o],apiVersion:this.en.getApiVersion()},"undefined"!=typeof screen&&u.createStream.createOfferDescription.options.push("screen="+screen.width+"x"+screen.height)),!1===i.receiveAudio&&u.createStream.options.push("no-audio"),!1===i.receiveVideo&&u.createStream.options.push("no-video"),this.en.sendRequest("pcast.SetupStream",u,r)},t.prototype.setAnswerDescription=function(t,e,i){h.mt(t,"streamId"),h.mt(e,"sdp"),h.it(i,"callback");var n={streamId:t,sessionDescription:{type:"Answer",sdp:e},apiVersion:this.en.getApiVersion()};return this.en.sendRequest("pcast.SetRemoteDescription",n,i)},t.prototype.addIceCandidates=function(t,e,i,n){h.mt(t,"streamId"),h.isArray(e,"candidates"),h.nt(i,"options"),h.it(n,"callback");var r={streamId:t,candidates:c.map(e,function(t,e){return h.mt(t.candidate,"candidate["+e+"].candidate"),h.dt(t.sdpMLineIndex,"candidate["+e+"].sdpMLineIndex"),h.mt(t.sdpMid,"candidate["+e+"].sdpMid"),{candidate:t.candidate,sdpMLineIndex:t.sdpMLineIndex,sdpMid:t.sdpMid}}),options:i,apiVersion:this.en.getApiVersion()};return this.en.sendRequest("pcast.AddIceCandidates",r,n)},t.prototype.updateStreamState=function(t,e,i,n,r){h.mt(t,"streamId"),h.mt(e,"signalingState"),h.mt(i,"iceGatheringState"),h.mt(n,"iceConnectionState"),h.it(r,"callback");var s={streamId:t,signalingState:e,iceGatheringState:i,iceConnectionState:n,apiVersion:this.en.getApiVersion()};return this.en.sendRequest("pcast.UpdateStreamState",s,r)},t.prototype.destroyStream=function(t,e,i){h.mt(t,"streamId"),h.ft(e,"reason"),h.it(i,"callback");var n={streamId:t,reason:e};return this.en.sendRequest("pcast.DestroyStream",n,i)},t.prototype.getRoomInfo=function(t,e,i){t?h.ft(t,"roomId"):h.ft(e,"alias"),h.it(i,"callback");var n={roomId:t,alias:e,sessionId:this.getSessionId()};return this.en.sendRequest("chat.GetRoomInfo",n,i)},t.prototype.createRoom=function(t,e){h.nt(t,"room"),h.mt(t.name,"room.name"),h.mt(t.type,"room.type"),h.mt(t.description,"room.description"),h.it(e,"callback");var i={sessionId:this.getSessionId(),room:t};return this.en.sendRequest("chat.CreateRoom",i,e)},t.prototype.enterRoom=function(t,e,i,n,r,s){t?h.ft(t,"roomId"):h.ft(e,"alias"),h.nt(i,"member"),h.dt(r,"timestamp"),h.isArray(n,"options"),h.it(s,"callback");var o={roomId:t,alias:e,sessionId:this.getSessionId(),member:i,options:n,timestamp:r};return this.en.sendRequest("chat.JoinRoom",o,s)},t.prototype.leaveRoom=function(t,e,i){h.ft(t,"roomId"),h.dt(e,"timestamp"),h.it(i,"callback");var n={roomId:t,sessionId:this.getSessionId(),timestamp:e};return this.en.sendRequest("chat.LeaveRoom",n,i)},t.prototype.updateMember=function(t,e,i,n){h.mt(t,"roomId"),h.nt(e,"member"),h.dt(i,"timestamp"),h.it(n,"callback"),e.updateStreams=e.hasOwnProperty("streams");var r={sessionId:this.getSessionId(),roomId:t,member:e,timestamp:i};return this.en.sendRequest("chat.UpdateMember",r,n)},t.prototype.updateRoom=function(t,e,i){h.nt(t,"room"),h.dt(e,"timestamp"),h.it(i,"callback");var n={sessionId:this.getSessionId(),room:t,timestamp:e};return this.en.sendRequest("chat.UpdateRoom",n,i)},t.prototype.sendMessageToRoom=function(t,e,i){h.mt(t,"roomId"),h.nt(e,"chatMessage");var n={roomId:t,chatMessage:e};return this.en.sendRequest("chat.SendMessageToRoom",n,i)},t.prototype.subscribeToRoomConversation=function(t,e,i,n){h.mt(t,"sessionId"),h.mt(e,"roomId"),h.dt(i,"batchSize");var r={sessionId:t,roomId:e,limit:i,options:["Subscribe"]};return this.en.sendRequest("chat.FetchRoomConversation",r,n)},t.prototype.getMessages=function(t,e,i,n,r,s){h.mt(t,"sessionId"),h.mt(e,"roomId"),r&&n||h.dt(i,"batchSize");var o={sessionId:t,roomId:e,limit:i||0,options:[]};return r&&(h.mt(r,"beforeMessageId"),o.beforeMessageId=r),n&&(h.mt(n,"afterMessageId"),o.afterMessageId=n),this.en.sendRequest("chat.FetchRoomConversation",o,s)},t.prototype.toString=function(){return"PCastProtocol["+this.en.toString()+"]"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{package:"pcast",options:{optimize_for:"LITE_RUNTIME"},messages:[{name:"Authenticate",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:9,options:{default:0}},{rule:"required",type:"string",name:"clientVersion",id:1},{rule:"optional",type:"string",name:"device",id:12},{rule:"required",type:"string",name:"deviceId",id:2},{rule:"optional",type:"string",name:"manufacturer",id:13},{rule:"required",type:"string",name:"platform",id:3},{rule:"required",type:"string",name:"platformVersion",id:4},{rule:"required",type:"string",name:"authenticationToken",id:5},{rule:"optional",type:"string",name:"connectionId",id:6},{rule:"optional",type:"string",name:"connectionRouteKey",id:10},{rule:"optional",type:"string",name:"remoteAddress",id:11},{rule:"optional",type:"string",name:"sessionId",id:7},{rule:"optional",type:"string",name:"applicationId",id:8}]},{name:"AuthenticateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"sessionId",id:2},{rule:"optional",type:"string",name:"redirect",id:3},{rule:"repeated",type:"string",name:"roles",id:4}]},{name:"Bye",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2}]},{name:"ByeResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SessionDescription",fields:[{rule:"required",type:"Type",name:"type",id:1,options:{default:"Offer"}},{rule:"required",type:"string",name:"sdp",id:2}],enums:[{name:"Type",values:[{name:"Offer",id:0},{name:"Answer",id:1}]}]},{name:"CreateStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"originStreamId",id:2},{rule:"repeated",type:"string",name:"originStreamIds",id:10},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"string",name:"connectUri",id:8},{rule:"repeated",type:"string",name:"connectOptions",id:9},{rule:"repeated",type:"string",name:"tags",id:4},{rule:"optional",type:"string",name:"userAgent",id:11},{rule:"optional",type:"SetRemoteDescription",name:"setRemoteDescription",id:5},{rule:"optional",type:"CreateOfferDescription",name:"createOfferDescription",id:6},{rule:"optional",type:"CreateAnswerDescription",name:"createAnswerDescription",id:7}]},{name:"IceServer",fields:[{rule:"repeated",type:"string",name:"urls",id:1},{rule:"optional",type:"string",name:"username",id:2},{rule:"optional",type:"string",name:"credential",id:3}]},{name:"RtcConfiguration",fields:[{rule:"optional",type:"BundlePolicy",name:"bundlePolicy",id:1},{rule:"optional",type:"uint32",name:"iceCandidatePoolSize",id:3},{rule:"repeated",type:"IceServer",name:"iceServers",id:4},{rule:"optional",type:"IceTransportPolicy",name:"iceTransportPolicy",id:5},{rule:"optional",type:"string",name:"peerIdentity",id:6},{rule:"optional",type:"RtcpMuxPolicy",name:"rtcpMuxPolicy",id:7}],enums:[{name:"BundlePolicy",values:[{name:"BundlePolicyBalanced",id:1},{name:"BundlePolicyMaxCompat",id:2},{name:"BundlePolicyMaxBundle",id:3}]},{name:"IceTransportPolicy",values:[{name:"IceTransportPolicyAll",id:1},{name:"IceTransportPolicyPublic",id:2},{name:"IceTransportPolicyRelay",id:3}]},{name:"RtcpMuxPolicy",values:[{name:"RtcpMuxPolicyNegotiate",id:1},{name:"RtcpMuxPolicyRequire",id:2}]}]},{name:"CreateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamId",id:2},{rule:"optional",type:"string",name:"instanceRouteKey",id:5},{rule:"repeated",type:"string",name:"streamUris",id:8},{rule:"optional",type:"RtcConfiguration",name:"rtcConfiguration",id:9},{rule:"optional",type:"SetRemoteDescriptionResponse",name:"setRemoteDescriptionResponse",id:3},{rule:"optional",type:"CreateOfferDescriptionResponse",name:"createOfferDescriptionResponse",id:4},{rule:"optional",type:"CreateAnswerDescriptionResponse",name:"createAnswerDescriptionResponse",id:6},{rule:"repeated",type:"string",name:"options",id:7},{rule:"optional",type:"uint64",name:"offset",id:10,options:{default:0}}]},{name:"SetLocalDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"SetLocalDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"SetRemoteDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"SetRemoteDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateOfferDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"CreateOfferDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateAnswerDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"CreateAnswerDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"IceCandidate",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"uint32",name:"sdpMLineIndex",id:2},{rule:"required",type:"string",name:"sdpMid",id:3}]},{name:"AddIceCandidates",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"IceCandidate",name:"candidates",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"uint32",name:"apiVersion",id:4,options:{default:0}}]},{name:"AddIceCandidatesResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"UpdateStreamState",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"string",name:"signalingState",id:2},{rule:"required",type:"string",name:"iceGatheringState",id:3},{rule:"required",type:"string",name:"iceConnectionState",id:4},{rule:"optional",type:"uint32",name:"apiVersion",id:5,options:{default:0}}]},{name:"UpdateStreamStateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"DestroyStream",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"optional",type:"string",name:"reason",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"DestroyStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"ConnectionDisconnected",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"uint32",name:"reasonCode",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"ConnectionDisconnectedResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"StreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"tags",id:3}]},{name:"SourceStreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"tags",id:4},{rule:"optional",type:"string",name:"continuationId",id:5},{rule:"optional",type:"string",name:"routeKey",id:6}]},{name:"SourceStreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"capabilities",id:4},{rule:"repeated",type:"string",name:"tags",id:5}]},{name:"StreamEndedResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"continuationId",id:2},{rule:"optional",type:"string",name:"routeKey",id:3}]},{name:"StreamIdle",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamArchived",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"uint64",name:"startTime",id:4},{rule:"required",type:"string",name:"uri",id:3}]},{name:"SessionEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2},{rule:"required",type:"float",name:"duration",id:3}]},{name:"ResourceIdle",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"routeKey",id:2}]},{name:"ResourceIdleResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"StreamPlaylist",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"PlaylistType",name:"playlistType",id:3},{rule:"required",type:"string",name:"uri",id:4},{rule:"required",type:"bool",name:"isVariant",id:5,options:{default:!0}}],enums:[{name:"PlaylistType",values:[{name:"Live",id:0},{name:"OnDemand",id:1}]}]},{name:"StreamRtmp",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"string",name:"uri",id:2},{rule:"required",type:"uint32",name:"height",id:3},{rule:"required",type:"uint32",name:"bitrate",id:4}]},{name:"SendEventToClient",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"string",name:"type",id:2},{rule:"required",type:"bytes",name:"payload",id:3}]},{name:"SendEventToClientResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SendRequestToClient",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"string",name:"type",id:2},{rule:"required",type:"bytes",name:"payload",id:3}]},{name:"SendRequestToClientResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"type",id:2},{rule:"optional",type:"bytes",name:"payload",id:3}]},{name:"SetupStream",fields:[{rule:"required",type:"string",name:"streamToken",id:1},{rule:"required",type:"CreateStream",name:"createStream",id:2}]},{name:"SetupStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"CreateStreamResponse",name:"createStreamResponse",id:2}]},{name:"SetupPlaylistStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamToken",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"PlaylistStreamManifest",fields:[{rule:"required",type:"string",name:"manifest",id:1},{rule:"required",type:"bool",name:"isProtectedContent",id:2},{rule:"optional",type:"string",name:"drmToken",id:3}]},{name:"SetupPlaylistStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"PlaylistStreamManifest",name:"manifests",id:2},{rule:"optional",type:"uint64",name:"offset",id:3,options:{default:0}}]},{name:"StreamDataQuality",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3},{rule:"required",type:"DataQualityStatus",name:"status",id:4},{rule:"required",type:"DataQualityReason",name:"reason",id:5}],enums:[{name:"DataQualityStatus",values:[{name:"NoData",id:0},{name:"AudioOnly",id:1},{name:"All",id:2}]},{name:"DataQualityReason",values:[{name:"None",id:0},{name:"UploadLimited",id:1},{name:"DownloadLimited",id:2},{name:"PublisherLimited",id:3},{name:"NetworkLimited",id:4}]}]},{name:"StreamDataQualityResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"CallbackEvent",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:1,options:{default:0}},{rule:"required",type:"string",name:"entity",id:2},{rule:"required",type:"string",name:"what",id:3},{rule:"required",type:"string",name:"data",id:4},{rule:"optional",type:"string",name:"sessionId",id:5}]},{name:"Uri",fields:[{rule:"optional",type:"string",name:"protocol",id:1,options:{default:"http"}},{rule:"required",type:"string",name:"host",id:2},{rule:"optional",type:"uint32",name:"port",id:3,options:{default:80}},{rule:"optional",type:"string",name:"method",id:4,options:{default:"POST"}},{rule:"optional",type:"string",name:"path",id:5,options:{default:"/"}}]},{name:"SetApplicationCallback",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"Uri",name:"callback",id:3}]},{name:"SetApplicationCallbackResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"endpoint",id:2}]},{name:"IssueAuthenticationToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3}]},{name:"IssueAuthenticationTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"authenticationToken",id:2}]},{name:"IssueStreamToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"sessionId",id:3},{rule:"optional",type:"string",name:"originStreamId",id:4},{rule:"repeated",type:"string",name:"alternateOriginStreamIds",id:6},{rule:"repeated",type:"string",name:"capabilities",id:5},{rule:"optional",type:"bool",name:"permissive",id:7,options:{default:!1}}]},{name:"IssueStreamTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamToken",id:2}]},{name:"IssueDrmToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"sessionId",id:3},{rule:"required",type:"string",name:"originStreamId",id:4},{rule:"repeated",type:"string",name:"capabilities",id:5}]},{name:"IssueDrmTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"drmToken",id:2}]},{name:"TerminateStream",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"streamId",id:3,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"streamToken",id:5,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"reason",id:4}],oneofs:{streamOrToken:[3,5]}},{name:"TerminateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"DeleteStream",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"streamId",id:3,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"streamToken",id:5,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"reason",id:4}],oneofs:{streamOrToken:[3,5]}},{name:"DeleteStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"Stream",fields:[{rule:"required",type:"string",name:"streamId",id:1}]},{name:"ListStreams",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"start",id:3},{rule:"required",type:"uint32",name:"length",id:4},{rule:"repeated",type:"string",name:"options",id:5}]},{name:"ListStreamsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"start",id:2},{rule:"optional",type:"uint32",name:"length",id:3},{rule:"repeated",type:"Stream",name:"streams",id:4}]},{name:"GetPlaylistUris",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"streamId",id:3},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"GetPlaylistUrisResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"Playlist",name:"playlists",id:2},{rule:"optional",type:"StreamMetadata",name:"streamInfo",id:3}],messages:[{name:"PlaylistMetadata",fields:[{rule:"optional",type:"uint32",name:"bitrate",id:1},{rule:"optional",type:"uint32",name:"height",id:2},{rule:"optional",type:"float",name:"framesPerSecond",id:3}]},{name:"StreamMetadata",fields:[{rule:"required",type:"string",name:"startTime",id:1},{rule:"optional",type:"string",name:"endTime",id:2}]},{name:"Playlist",fields:[{rule:"required",type:"string",name:"name",id:1},{rule:"required",type:"PlaylistType",name:"type",id:2},{rule:"required",type:"string",name:"uri",id:3},{rule:"required",type:"bool",name:"isVariant",id:4},{rule:"required",type:"bool",name:"isProtected",id:5},{rule:"required",type:"PlaylistMetadata",name:"info",id:6}]}],enums:[{name:"PlaylistType",values:[{name:"Hls",id:0},{name:"Dash",id:1}]}]}]}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{package:"shim",messages:[]}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(1),i(0),i(5),i(3),i(70)],void 0===(r=function(r,a,u,s,c){"use strict";function t(t,e,i,n){r.mt(t,"version"),r.mt(e,"baseUri"),r.nt(i,"logger"),this.Z=t,this.wt=e,this.rt=i,this.g=new s.DisposableList,this.Yt=n}return t.DefaultPCastUri="https://pcast.phenixrts.com",t.prototype.getBaseUri=function(){return this.wt},t.prototype.resolveUri=function(t){return function(t,n){var e=0===t.lastIndexOf("wss:",0),i=0===t.lastIndexOf("ws:",0),r=0===t.lastIndexOf("https:",0),s=0===t.lastIndexOf("http:",0);if(e||i)n(void 0,{uri:t+"/ws",roundTripTime:0});else if(r||s){var o=this;(function(t,n){var e=u.getWithRetry(t+"/pcast/endPoints",{timeout:15e3,queryParameters:{version:"2019-11-22T20:59:57Z",_:a.now()},retryOptions:{maxAttempts:4}},function(t,e){if(t)return n(new Error("Failed to resolve an end point",t));var i=e.data.split(",");i.length<1&&n(new Error("Failed to discover end points")),n(void 0,i)});this.g.add(e)}).call(o,t,function(t,e){if(t)return n(t);var i=new c({logger:o.rt,version:o.Z},n,function(t,e){if(t)503===t.code?o.rt.debug("The end point [%s] is temporarily disabled",a.get(e,["endPoint"])):o.rt.warn("An error occurred in resolving an endpoint [%s]",a.get(e,["endPoint"]),t);else{var i=0===e.endPoint.lastIndexOf("https:",0);o.Yt.recordMetric("RoundTripTime",{uint64:e.time},null,{resource:e.endPoint,kind:i?"https":"http"})}});i.resolveAll(e),o.g.add(i)})}else n(new Error("Uri not supported ["+t+"]"))}.call(this,this.wt,t)},t.prototype.dispose=function(){this.g.dispose()},t.prototype.toString=function(){return"PCastEndPoint["+this.wt+"]"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(71)],void 0===(r=function(t){return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5),i(3)],void 0===(r=function(s,n,e,r){"use strict";function t(t,e,i){n.nt(t,"options"),n.nt(t.logger,"options.logger"),n.mt(t.version,"options.version"),n.it(e,"onClosestEndpointFound"),i&&n.it(i,"onAnEndpointResolved"),this.rt=t.logger,this.Z=t.version,this.in=e,this.nn=i,this.g=new r.DisposableList,this.rn=!1}return t.prototype.isResolved=function(){return this.rn},t.prototype.dispose=function(){this.g.dispose()},t.prototype.completeCallback=function(t,e,i){if(!this.isResolved())return this.rn=!0,this.in(null,{uri:i,roundTripTime:e,endPoint:t})},t.prototype.resolveAll=function(t){for(var e=0;e<t.length;e++)this.resolve(t[e])},t.prototype.resolve=function(n){var r=this;r.rt.info("Checking end point [%s]",n);var t=e.getWithRetry(n,{timeout:15e3,queryParameters:{version:r.Z,_:s.now()},retryOptions:{maxAttempts:1}},function(t,e){var i=s.get(e,["stats","successResponseTime"],0);if(r.nn&&(t?r.nn(t,{endPoint:n}):r.nn(null,{time:i,endPoint:n})),t)503===t.code?r.rt.info("End point [%s] is temporarily unavailable",n):r.rt.warn("Unable to resolve end point [%s] with [%s]",n,t);else if(!r.isResolved())return r.completeCallback(n,i,e.data)});r.g.add(t)},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(7),i(2)],void 0===(r=function(u,i,n,c){"use strict";var r=u.freeze({url:"https://addons.mozilla.org/firefox/downloads/file/474686/pcast_screen_sharing-1.0.3-an+fx.xpi",iconUrl:"https://phenixp2p.com/public/images/phenix-logo-unicolor-64x64.png",hash:"sha256:4972e9718ea7f7c896abc12d1a9e664d5f3efe498539b082ab7694f9d7af4f3b"}),s=52;function t(t,e){t=t||{},i.nt(t,"options"),i.nt(e,"logger"),this.rt=e,this.sn=t.screenSharingExtensionId||function(){switch(c.browser){case"Chrome":return"icngjadgidcmifnehjcielbmiapkhjpn";case"Firefox":default:return""}}(),this.an=t.screenSharingAddOn||r,this.un=!1,this.cn=new n.Observable(!1),"Chrome"===c.browser&&this.sn&&function(){var t=a.call(this);if("object"==typeof document){for(var e=document.getElementsByTagName("link"),i=0;i<e.length;i++)if(e[i].href===t)return;this.rt.debug("Adding Chrome Web Store link [%s]",t);var n=document.createElement("link");n.rel="chrome-webstore-item",n.href=t,document.getElementsByTagName("head")[0].appendChild(n)}}.call(this),d.call(this,u.bind(h,this))}function h(t){this.cn.setValue(!0),this.un=t}function d(e){var i=this;if("Chrome"===c.browser&&i.sn){var t=l.call(this);if(!t)return e(!1);try{t.sendMessage(i.sn,{type:"version"},function(t){t&&"ok"===t.status?(i.rt.info("Screen sharing enabled using version [%s]",t.version),e(!0)):(i.rt.info("Screen sharing NOT available"),e(!1))})}catch(t){t.message&&i.rt.warn(t.message,t),e(!1)}}else"Firefox"===c.browser&&c.browserVersion>=s?e(!0):"Firefox"===c.browser&&u.nt(c.global.PCastScreenSharing)?e(!0):e(!1)}function o(t){if(this.cn.getValue())return t();var e=this.cn.subscribe(function(){return e.dispose(),t()})}function a(){return"https://chrome.google.com/webstore/detail/"+this.sn}function f(o,a){switch(c.browser){case"Chrome":return function(e){var i=this,t=l.call(this);if(!t)return e(new Error("not-available"));try{t.sendMessage(i.sn,{type:"get-desktop-media",sources:["screen","window","tab","audio"]},function(t){return t?"ok"!==t.status?e(new Error(t.status),t):void e(null,t):d.call(i,function(t){return h.call(i,t),e(new Error("extension-failure"))})})}catch(t){t.message&&i.rt.warn(t.message),e(t,{status:"failed"})}}.call(this,function(t,e){if(t||e&&"ok"!==e.status)return a(t,e);var i,n,r,s;e.data||e.options||(e.options={canRequestAudioTrack:!0}),e.data&&u.hasIndexOrKey(e.data,"hasAudio")&&!e.options&&(e.options={canRequestAudioTrack:e.data.hasAudio}),a(null,{status:"ok",constraints:(i=o,n=e.streamId,r=e.options,s={},u.nt(i)&&u.nt(i.screen)&&(s.video=i.screen),u.nt(i)&&u.nt(i.screenAudio)&&r.canRequestAudioTrack&&(s.audio=i.screenAudio),i.screen&&u.set(s,["video","mandatory"],{chromeMediaSource:"desktop",chromeMediaSourceId:n}),i.screenAudio&&r.canRequestAudioTrack&&u.set(s,["audio","mandatory"],{chromeMediaSource:"system",chromeMediaSourceId:n}),s)})});case"Firefox":a(null,{status:"ok",constraints:(t=o,e={video:{}},u.nt(t)&&u.nt(t.screen)&&(e.video=t.screen),e.video.mediaSource=e.video.mediaSource||"window",e)});break;default:a(new Error("not-supported"),{status:"not-supported"})}var t,e}function e(i){var n=this;if(!n.un){var t=function(t,e){return"cancelled"===e?i(null,{status:"cancelled"}):"ok"!==e?i(new Error("screen-sharing-installation-failed"),{status:e}):void d.call(n,function(t){if(n.un=t,!n.un)return i(new Error("screen-sharing-installation-failed"),{status:e});i(null,{status:"ok"})})};switch(c.browser){case"Chrome":(function(e){var i=this,t=a.call(this);try{chrome.webstore.install(t,function(){return e(null,"ok")},function(t){if(t){if(t.match(/cancelled/gi))return i.rt.info("User cancelled screen sharing"),e(new Error(t),"cancelled");i.rt.warn(t)}return e(new Error(t||"failed"),"failed")})}catch(t){t.message&&i.rt.warn(t.message),e(t,"failed")}}).call(n,t);break;case"Firefox":(function(e){try{var t,i={"PCast Screen Sharing":{URL:this.an.url,IconURL:this.an.iconUrl,Hash:this.an.hash,toString:function(){return this.URL}}},n=450,r=function(){t&&clearInterval(t),e(null,"ok")},s=function(){t&&clearInterval(t),e(new Error("failed"),"failed")};t=setInterval(function(){return u.nt(c.global.PCastScreenSharing)?r():n--<0?s():void 0},100),InstallTrigger.install(i,function(t,e){0===e?r():s()})}catch(t){t.message&&this.rt.warn(t.message),e("failed",t)}}).call(n,t);break;default:i(new Error("not-supported"),{status:"not-supported"})}}}function l(){switch(c.browser){case"Chrome":return"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.sendMessage?chrome.runtime:(this.rt.info("Screen sharing NOT available. Runtime not supported"),null);case"Firefox":default:return null}}return t.prototype.isScreenSharingEnabled=function(t){var e=this;return o.call(this,function(){return t(e.un)})},t.prototype.installExtension=function(t){return o.call(this,u.bind(e,this,t))},t.prototype.getScreenSharingConstraints=function(t,e){return o.call(this,u.bind(f,this,t,e))},t.prototype.toString=function(){return"ScreenShareExtensionManager["+c.browser+"]"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(2)],void 0===(r=function(u,c,h){"use strict";function t(t,e,i){c.nt(t,"logger"),c.nt(e,"screenShareExtensionManager"),i&&c.it(i,"onScreenShare"),this.rt=t,this.St=e,this.We=i}function i(n,e,r){function s(t){r(d(t),void 0,t)}function o(t){(function(n){var r={},s={},o=this;setTimeout(function t(){var e;e=n,u.reduce(e.getTracks(),function(t,e){return t&&(i=e,c.Xe(i,"track"),"ended"===i.readyState);var i},!0)||(u.forEach(n.getTracks(),function(t){if(h.global.Event&&u.hasIndexOrKey(r,t.id)&&r[t.id]!==t.enabled){var e=new h.global.Event("trackenabledchange");(e.data=t).dispatchEvent(e),o.rt.info("[%s] Detected track [%s] enabled change to [%s]",n.id,t.id,t.enabled)}if(h.global.Event&&u.hasIndexOrKey(s,t.id)&&s[t.id]!==t.readyState){var i=new h.global.Event("readystatechange");(i.data=t).dispatchEvent(i),o.rt.info("[%s] Detected track [%s] Ready State change to [%s]",n.id,t.id,t.readyState)}r[t.id]=t.enabled,s[t.id]=t.readyState}),setTimeout(t,2e3))},2e3)}).call(a,t),e("ok",t)}var a=this;return function(i,n){var r=this;if(i.screen)return r.St.isScreenSharingEnabled(function(t){return t?r.St.getScreenSharingConstraints(i,n):r.St.installExtension(function(t,e){return t||e&&"ok"!==e.status?n(t,e):r.St.getScreenSharingConstraints(i,n)})});var t={audio:i.audio||!1,video:i.video||!1};n(null,{status:"ok",constraints:t})}.call(this,n,function(t,e){if("ok"!==u.get(e,["status"]))return s(t);if("cancelled"!==e.status){var i=e.constraints;if(a.We&&(n.screen||n.screenAudio)&&"Chrome"===h.browser&&!(i=a.We(i)))throw new Error("onScreenShare must return an object of user media constraints");try{h.getUserMedia(i,o,s)}catch(t){s(t)}}else r("cancelled",null)})}t.prototype.getUserMedia=function(t,e){c.nt(t,"options"),c.it(e,"callback"),function(n,r){function s(t,e){a.$t&&a.$t.push(e),r(a,t,e)}function o(t,e,i){n.screenAudio&&a.rt.warn("Screen capture with audio is only supported on Windows or Chrome OS."),r(a,t,e,i)}var a=this,t=n.screen||n.screenAudio,e=n.video||n.audio;return t&&e?i.call(a,{screen:n.screen},function(t,r){return i.call(a,{audio:n.audio,video:n.video},function(t,e){var i,n;i=e,n=r.getTracks(),i&&u.it(i.addTrack)&&u.forEach(n,function(t){i.addTrack(t)}),s(t,e)},function(t,e,i){!function(t){if(t&&u.it(t.stop)&&t.stop(),t&&u.it(t.getTracks))for(var e=t.getTracks(),i=0;i<e.length;i++)e[i].stop()}(r),o(t,e,i)})},o):i.call(a,n,s,o)}.call(this,t,e)};var d=function(t){return"unavailable"===t.code?"conflict":"permission-denied"===t.message?"permission-denied":"PermissionDeniedError"===t.name?"permission-denied":"InternalError"===t.name&&"Starting video failed"===t.message?"conflict":"SourceUnavailableError"===t.name?"conflict":"SecurityError"===t.name&&"The operation is insecure."===t.message?"permission-denied":"failed"};return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(14),i(75)],void 0===(r=function(t,e,n,r){var s={urls:{local:"",staging:"https://telemetry-stg.phenixrts.com",production:"https://telemetry.phenixrts.com"}};function i(){this.hn={}}return i.prototype.createMetricsTransmitter=function(t){var e=n.parseEnvFromPcastBaseUri(t||""),i=s.urls[e];return this.hn[e]||(this.hn[e]=function(t){var e=new r(t);return t||e.setEnabled(!1),e}.call(this,i)),this.hn[e]},new i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(15),i(2),i(25)],void 0===(r=function(a,u,e,i,n){function t(t){u.ft(t,"uri"),this.fi="/telemetry/metrics",this.li="object"==typeof location?location.hostname:i.browser+"-"+i.browserVersion+"-unknown",this.ii=!0,this.pi=(i.browser||"Browser")+"/"+(i.browserVersion||"?"),this.vi=new e.BatchHttpProto(t+this.fi,[n],"telemetry.SubmitMetricRecords",{maxAttempts:3,maxBufferedRecords:1e3,maxBatchSize:512}),this.vi.on("capacity",a.bind(r,this))}function r(t){this.vi.addRecordToBeginning({metric:"MetricDropped",value:{uint64:t},timestamp:a.isoString(),sessionId:this.gi,streamId:this.dn,source:this.pi,fullQualifiedName:this.li,environment:this.wi,version:this.bi,runtime:this.mi})}return t.prototype.isEnabled=function(){return this.ii},t.prototype.setEnabled=function(t){u.yt(t,"enabled"),this.ii=t},t.prototype.submitMetric=function(t,e,i,n,r,s,o){this.ii&&(u.mt(t,"metric"),u.nt(o,"value"),this.mi=e,this.gi=i,this.dn=n,this.wi=r,this.bi=s,function(t,e){var i=a.assign({},e,{metric:t,timestamp:a.isoString(),sessionId:this.gi,streamId:this.dn,source:this.pi,fullQualifiedName:this.li,environment:this.wi,version:this.bi,runtime:this.mi});this.vi.addRecord(i)}.call(this,t,o))},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(3),i(2)],void 0===(r=function(u,s,c,h){"use strict";var t=h.global.__phenixPageLoadTime||h.global.__pageLoadTime||u.now();function e(t,e,i){s.mt(t,"sessionId"),this.oi="production",this.Z="2019-11-22T20:59:57Z",this.si=t,this.fn={},this.rt=e,this.kt=i,this.ln=u.now(),this.g=new c.DisposableList,this.pn=[],this.mn=[],this.vn=[],this.gn=null,d.call(this,"Stream initializing")}function d(){var t=Array.prototype.slice.call(arguments);if(0===t.length)throw new Error("Invalid logging arguments.");var e="[%s] [StreamTelemetry] [%s] "+t[0],i=t.slice(1),n=[e,this.qe,u.now()-this.ln].concat(i);this.rt.debug.apply(this.rt,n)}function o(){return(u.now()-t)/1e3}function a(t,e){s.mt(t.metric,"record.metric");var i=u.assign({},this.fn,t);this.kt.submitMetric(t.metric,e,this.si,this.qe,this.oi,this.Z,i)}return e.prototype.setProperty=function(t,e){s.mt(t,"name"),s.mt(e,"value"),this.fn[t]=e},e.prototype.recordMetric=function(t,e,i,n){s.mt(t,"metric");var r=u.assign({},{metric:t,elapsed:this.elapsed(),value:e,previousValue:i},n||{});a.call(this,r,o())},e.prototype.setStreamId=function(t){if(s.mt(t,"streamId"),this.qe)throw new Error("Stream ID can only be set once.");this.qe=t;var e=u.now();a.call(this,{metric:"Initialized",elapsed:this.elapsed()-e+this.ln},o()-(e-this.ln)/1e3)},e.prototype.setStartOffset=function(t){if(s.dt(t,"startOffset"),this.yn)throw new Error("Start offset can only be set once.");this.yn=t,this.recordMetric("Offset",{uint64:t})},e.prototype.getStartOffset=function(){return this.yn},e.prototype.elapsed=function(){return u.now()-this.ln},e.prototype.stop=function(){this.g.dispose(),this.recordMetric("Stopped"),d.call(this,"Stream stopped")},e.prototype.recordTimeToFirstFrame=function(t){function e(){i.gn||(i.gn=u.now()-n,i.recordMetric("TimeToFirstFrame",{uint64:i.gn}),d.call(i,"First frame [%s]",i.gn),r.dispose())}var i=this,n=u.now();u.addEventListener(t,"loadeddata",e),u.addEventListener(t,"loadedmetadata",e);var r=new c.Disposable(function(){u.removeEventListener(t,"loadeddata",e),u.removeEventListener(t,"loadedmetadata",e)});return this.g.add(r),r},e.prototype.recordVideoResolutionChanges=function(t,e){var i=this,n={width:e.videoWidth,height:e.videoHeight};if(u.find(this.pn,function(t){return t===e}))return new c.Disposable(u.noop);this.pn.push(e);var r=t.addVideoDisplayDimensionsChangedCallback(function(t,e){n.width===e.width&&n.height===e.height||(i.recordMetric("ResolutionChanged",{string:e.width+"x"+e.height},{string:n.width+"x"+n.height}),n={width:e.width,height:e.height},d.call(i,"Resolution changed: width [%s] height [%s]",e.width,e.height))});return this.g.add(r),r},e.prototype.recordRebuffering=function(r){var s,o,a=this;if(u.find(this.mn,function(t){return t===r}))return new c.Disposable(u.noop);function t(){s||(a.recordMetric("Stalled"),s=u.now(),d.call(a,"[buffering] Stream has stalled"))}function e(t){var e=r.buffered.length,i=!("playing"===t.type||0<e)||("progress"===t.type||"timeupdate"===t.type)&&r.buffered.end(e-1)===o;if(s&&(e||"Edge"===h.browser)&&!i){"progress"===t.type&&(o=r.buffered.end(e-1));var n=u.now()-s;a.recordMetric("Buffering",{uint64:n}),d.call(a,"[buffering] Stream has recovered from stall after [%s] milliseconds",n),s=null}}this.mn.push(r),u.addEventListener(r,"stalled",t),u.addEventListener(r,"pause",t),u.addEventListener(r,"suspend",t),u.addEventListener(r,"play",e),u.addEventListener(r,"playing",e),u.addEventListener(r,"progress",e),u.addEventListener(r,"timeupdate",e);var i=new c.Disposable(function(){u.removeEventListener(r,"stalled",t),u.removeEventListener(r,"pause",t),u.removeEventListener(r,"suspend",t),u.removeEventListener(r,"play",e),u.removeEventListener(r,"playing",e),u.removeEventListener(r,"progress",e),u.removeEventListener(r,"timeupdate",e)});return this.g.add(i),i},e.prototype.recordVideoPlayingAndPausing=function(e){var t=this;if(u.find(this.vn,function(t){return t===e}))return new c.Disposable(u.noop);function i(){e.paused?t.recordMetric("Playing",{boolean:!1}):t.recordMetric("Playing",{boolean:!0})}this.vn.push(e),u.addEventListener(e,"pause",i),u.addEventListener(e,"playing",i);var n=new c.Disposable(function(){u.removeEventListener(e,"pause",i),u.removeEventListener(e,"playing",i)});return this.g.add(n),n},e}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(3),i(11),i(78),i(2)],void 0===(r=function(s,o,i,n,r,a){"use strict";var t=a.global.__phenixPageLoadTime||a.global.__pageLoadTime||s.now();function e(t,e){this.oi="production",this.Z="2019-11-22T20:59:57Z",this.si=null,this.fn={resource:"session",kind:"event"},this.rt=t,this.kt=e,this.wn=new r(this.rt),this.ln=s.now(),this.g=new i.DisposableList,this.Ji=[],this.g.add(n.onBackground(s.bind(u,this,!1))),this.g.add(n.onForeground(s.bind(u,this,!0))),this.wn.isSupported()&&(this.g.add(this.wn.onNetworkChange(s.bind(f,this))),this.g.add(this.wn),c.call(this),d.call(this),h.call(this))}function u(t,e){var i=t?"ApplicationForeground":"ApplicationBackground";this.recordMetric(i,{uint64:e}),l.call(this,"Application has gone into the [%s] after [%s] ms",t?"foreground":"background",e)}function c(){var t=this.wn.getEffectiveType();this.recordMetric("NetworkType",{string:t},null,{resource:a.browser}),l.call(this,"[%s] has started with Network effective type of [%s]",this.si?"Session":"Application",t)}function h(t,e){var i=t||this.wn.getRoundTripTime(),n=e||-1;if(this.recordMetric("RoundTripTime",{uint32:i},{uint32:n},{resource:a.browser}),s.isNullOrUndefined(e))return l.call(this,"Network RTT [%s]",i);l.call(this,"Network RTT changed to [%s] from [%s]",i,n)}function d(t,e){var i=t||this.wn.getDownlinkThroughputCapacity(),n=e||-1;if(this.recordMetric("DownlinkThroughputCapacity",{float:i},{float:n},{resource:a.browser}),s.isNullOrUndefined(e))return l.call(this,"Network downlink throughput capacity [%s]",i);l.call(this,"Network downlink throughput capacity changed to [%s] from [%s]",i,n)}function f(t,e){e.downlinkThroughputCapacity!==t.downlinkThroughputCapacity&&d.call(this,t.downlinkThroughputCapacity,e.downlinkThroughputCapacity),e.rtt!==t.rtt&&h.call(this,t.rtt,e.rtt),e.effectiveType!==t.effectiveType&&function(t,e){var i=t||this.wn.getEffectiveType(),n=e;this.recordMetric("NetworkType",{string:i},{string:n},{resource:a.browser}),l.call(this,"Network effective type has changed to [%s] from [%s]",i,n||"New")}.call(this,t.effectiveType,e.effectiveType)}function l(){var t=Array.prototype.slice.call(arguments);if(0===t.length)throw new Error("Invalid logging arguments.");var e="[%s] [SessionTelemetry] [%s] "+t[0],i=t.slice(1),n=[e,this.si,s.now()-this.ln].concat(i);this.rt.info.apply(this.rt,n)}function p(){return(s.now()-t)/1e3}function m(t,e){if(o.mt(t.metric,"record.metric"),!this.si)return this.Ji.push({record:t,since:e});var i=s.assign({},this.fn,t);this.kt.submitMetric(t.metric,e,this.si,null,this.oi,this.Z,i)}return e.prototype.setSessionId=function(t){!t&&this.si&&m.call(this,{metric:"Stopped",elapsed:this.elapsed()},p()),(this.si=t)&&(m.call(this,{metric:"Initialized",elapsed:this.elapsed()},p()),function(){if(this.si)for(var t=this.Ji.length;0<t;){var e=this.Ji.splice(t-1,1);1===e.length&&m.call(this,e[0].record,e[0].since),t--}}.call(this),function(){var t=n.isForeground(),e=n.getTimeSinceLastChange(),i=t?"ApplicationForeground":"ApplicationBackground";this.recordMetric(i,{uint64:e}),l.call(this,"Session has started in the [%s] after [%s] ms",t?"foreground":"background",e)}.call(this),this.wn.isSupported()&&(c.call(this),d.call(this),h.call(this)))},e.prototype.setProperty=function(t,e){o.mt(t,"name"),o.mt(e,"value"),this.fn[t]=e},e.prototype.recordMetric=function(t,e,i,n){o.mt(t,"metric");var r=s.assign({},{metric:t,elapsed:this.elapsed(),value:e,previousValue:i},n||{});m.call(this,r,p())},e.prototype.elapsed=function(){return s.now()-this.ln},e.prototype.dispose=function(){this.g.dispose(),this.recordMetric("Stopped"),l.call(this,"Session telemetry stopped")},e}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(3),i(2)],void 0===(r=function(t,e,i,n,r){function s(t){if(e.nt(t,"logger"),this.rt=t,this.se=new i.NamedEvents,this.g=new n.DisposableList,this.g.add(this.se),!this.isSupported())return this.rt.info("Network monitor is not supported.");this.bn=o.call(this),function(){var t=this;navigator.connection.addEventListener("change",function(){t.se.fireAsync("NetworkChange",[o.call(t),t.bn]),t.bn=o.call(t)})}.call(this)}function o(){return{downlinkThroughputCapacity:this.getDownlinkThroughputCapacity(),effectiveType:this.getEffectiveType(),rtt:this.getRoundTripTime()}}return s.prototype.isSupported=function(){return r.global.navigator&&r.global.navigator.connection},s.prototype.getDownlinkThroughputCapacity=function(){return this.isSupported()?r.global.navigator.connection.downlink||r.global.navigator.connection.downlinkMax:-1},s.prototype.getEffectiveType=function(){return this.isSupported()?r.global.navigator.connection.effectiveType||r.global.navigator.connection.type:"Unknown"},s.prototype.getRoundTripTime=function(){return this.isSupported()?r.global.navigator.connection.rtt||r.global.navigator.connection.type:-1},s.prototype.onNetworkChange=function(t){if(this.isSupported())return e.it(t,"callback"),this.se.listen("NetworkChange",t)},s.prototype.dispose=function(){this.g.dispose()},s}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(6)],void 0===(r=function(r,s,o){"use strict";function a(t,e,i){s.mt(t,"type"),s.nt(e,"stream"),s.nt(i,"logger"),this.Oe=t,this.a=e,this.rt=i,this.kn=null;var n=this;this.a.on(o.streamEvents.playerEnded.name,function(t){if(n.rt.info("[%s] [%s] player ended.",n.a.getStreamId(),n.Oe),n.Sn=!0,n.kn)return n.kn();n.streamEndedCallback(a.getStreamEndedStatus(t),t)})}return a.prototype.toString=function(){return"Stream["+(this.a?this.a.getStreamId():"")+"]"},a.prototype.on=function(t,e){return this.a.on(t,e)},a.prototype.streamErrorCallback=function(t,e){r.it(this.a.streamErrorCallback)?(this.rt.debug("[%s] [%s] stream error event [%s]",this.a.getStreamId(),this.Oe,e),this.a.streamErrorCallback(this.a,t,e)):this.rt.error("[%s] [%s] stream error event [%s]",this.a.getStreamId(),this.Oe,e)},a.prototype.streamEndedCallback=function(t,e,i){var n=this.a.getRenderer();if(!this.In){if(i&&!this.kn&&this.a.isActive()&&n&&!this.Sn)return this.kn=r.bind(this.streamEndedCallback,this,t,e),this.rt.info("[%s] [%s] stream ended. Waiting for end of player.",this.a.getStreamId(),this.Oe),void(n&&n.stop(e,i));this.In=!0,r.it(this.a.streamEndedCallback)&&this.a.streamEndedCallback(this.a,t,e),this.a.stop(e),n&&n.stop(e,i)}},a.prototype.dataQualityChangedCallback=function(t,e){var i=this.a.getRenderer();i&&r.it(i.dataQualityChangedCallback)&&i.dataQualityChangedCallback(i,t,e)},a.prototype.getPhenixMediaStream=function(){return this.a},a.getStreamEndedStatus=function(t){switch(t){case"":case"none":case"ended":return"ended";case"server-error":case"session-error":case"not-ready":case"error":case"died":return"failed";case"censored":return"censored";case"maintenance":return"maintenance";case"capacity":return"capacity";case"app-background":return"app-background";case"egress-failed":return"egress-failed";case"egress-setup-failed":return"egress-setup-failed";case"overload":return"overload";default:return"custom"}},a}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(5),i(3),i(2),i(10),i(6)],void 0===(r=function(o,e,a,r,u,h,c,s){"use strict";var d=null;function t(t,e,i,n,r,s){this.rt=s,this.qe=t,this.Tn=encodeURI(e).replace(/[#]/g,"%23"),this.Ae=i,this.f=n,this.ht=null,this.z=null,this.Ne=new c(s),this.Rn={time:0,buffered:null,averageLength:0,count:0},this.se=new a.NamedEvents,this.g=new u.DisposableList,this.It=r,this.En=o.bind(l,this),this.xn=o.bind(f,this),this.Cn=o.bind(p,this)}function f(){if(this.Rn.time=o.now(),0===this.z.buffered.length)return this.rt.debug("[%s] Shaka live stream player progress event fired without any buffered content",this.qe);var t=this.z.buffered.end(this.z.buffered.length-1);if(this.Rn.buffered!==t){if(null!==this.Rn.buffered){var e=this.Rn.averageLength*this.Rn.count+(t-this.Rn.buffered);this.Rn.count+=1,this.Rn.averageLength=e/this.Rn.count}this.Rn.buffered=t}}function l(){var t=this;t.rt.info("[%s] Loading Shaka live stream player stream stalled.",t.qe),0!==t.Rn.time&&setTimeout(function(){o.now()-t.Rn.time>i.call(t)&&t.Mn&&t.stop("ended")},i.call(t))}function i(){return 1.5*this.Rn.averageLength<2e3?2e3:1.5*this.Rn.averageLength}function p(){this.rt.info("[%s] Shaka live stream player ended.",this.qe)}return t.prototype.on=function(t,e){return this.se.listen(t,e)},t.prototype.start=function(e){var i=this;i.Pn=new this.It.Player(e),this.g.add(this.Ae.recordTimeToFirstFrame(e)),this.g.add(this.Ae.recordRebuffering(e)),this.g.add(this.Ae.recordVideoResolutionChanges(this,e));var t={abr:{defaultBandwidthEstimate:2e6},manifest:{retryParameters:{timeout:1e4}},streaming:{rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,retryParameters:{timeout:1e4,maxAttempts:10,backoffFactor:1.1}}};function n(t){i.Pn.configure(t),!1===i.f.receiveAudio&&(e.muted=!0),o.addEventListener(i.Pn,"error",function(t){i.se.fire(s.rendererEvents.error.name,["player",t])}),o.addEventListener(e,"stalled",i.En,!1),o.addEventListener(e,"pause",i.En,!1),o.addEventListener(e,"suspend",i.En,!1),o.addEventListener(e,"progress",i.xn,!1),o.addEventListener(e,"ended",i.Cn,!1),i.Pn.load(i.Tn).then(function(){i.rt.info("[%s] DASH live stream has been loaded",i.qe),o.it(e.play)&&e.play()}).catch(function(t){i.rt.error("[%s] Error while loading DASH live stream [%s]",i.qe,t.code,t),i.se.fire(s.rendererEvents.error.name,["shaka",t])}),i.Ne.start(this,e),i.z=e}return this.f.isDrmProtectedContent?(function(){var t;if(!o.it(Uint8Array))throw t="Uint8Array support required for DRM",this.rt.error(t),new Error(t);if(!o.it(h.global.atob))throw t="rtc.global.atob support required for DRM",this.rt.error(t),new Error(t)}.call(i),function(u){var c=this;u.getNetworkingEngine().registerResponseFilter(function(t,e){if(t.toString()===c.It.net.NetworkingEngine.RequestType.LICENSE.toString()){var i=new Uint8Array(e.data),n=String.fromCharCode.apply(null,i),r=JSON.parse(n),s=r.license,o=h.global.atob(s);e.data=new Uint8Array(o.length);for(var a=0;a<o.length;++a)e.data[a]=o.charCodeAt(a);r.trackRestrictions&&u.configure({restrictions:r.trackRestrictions})}})}.call(i,i.Pn),function(t,e,i){t.drm||(t.drm={}),t.drm.advanced||(t.drm.advanced={}),t.manifest||(t.manifest={}),t.manifest.dash||(t.manifest.dash={}),function(i,t,n){function e(t,e){t?n(t):(d=e.data,i.drm.advanced["com.widevine.alpha"]={serverCertificate:function(t){for(var e=t.length,i=new Uint8Array(e),n=0;n<e;n++)i[n]=t.charCodeAt(n);return i}(e.data),persistentStateRequired:!0,distinctiveIdentifierRequired:!1},n(null,i))}i.manifest.dash.customScheme=function(t){if("com.phenixrts.widevine"===t.getAttribute("schemeIdUri")||"com.phenixp2p.widevine"===t.getAttribute("schemeIdUri"))return[{keySystem:"com.widevine.alpha",licenseServerUri:decodeURIComponent(t.getAttribute("widevineLicenseServerUrl"))}]},d?e(null,d):r.get(t.widevineServiceCertificateUrl,{mimeType:"text/plain; charset=x-user-defined"},e)}.call(this,t,e,i)}.call(i,t,i.f,function(t,e){if(t)throw i.rt.error("Failed to add DRM configuration to shaka player",t),t;n(e)})):n(t),e},t.prototype.stop=function(t,e){var i=this;if(!i.On){if(e)return i.Mn=!0;if(this.Ne.stop(),this.g.dispose(),this.Pn){var n=function(){i.z&&(o.removeEventListener(i.z,"stalled",i.En,!1),o.removeEventListener(i.z,"pause",i.En,!1),o.removeEventListener(i.z,"suspend",i.En,!1),o.removeEventListener(i.z,"progress",i.xn,!1),o.removeEventListener(i.z,"ended",i.Cn,!1),"Edge"===h.browser&&(i.z.src="")),i.se.fire(s.rendererEvents.ended.name,[""]),i.Pn=null,i.z=null};i.Pn.destroy().then(function(){i.rt.info("[%s] Shaka live stream player has been destroyed",i.qe)}).then(function(){n()}).catch(function(t){i.rt.error("[%s] Error while destroying shaka live stream player [%s]",i.qe,t.code,t),n(),i.se.fire(s.rendererEvents.error.name,["shaka",t])}),i.On=!0}}},t.prototype.getStats=function(){if(!this.Pn)return{width:0,height:0,currentTime:0,lag:0,networkState:s.networkStates.networkNoSource.id};var t=o.assign(this.Pn.getStats(),{currentTime:0,lag:0}),e=o.get(this.z,["currentTime"],0),i=(o.now()-this.f.originStartTime)/1e3,n=Math.max(0,i-e);return this.z&&(t.currentTime=e,t.lag=n),0<t.estimatedBandwidth?t.networkState=s.networkStates.networkLoading.id:0<t.playTime?t.networkState=s.networkStates.networkIdle.id:t.video?t.networkState=s.networkStates.networkEmpty.id:t.networkState=s.networkStates.networkNoSource.id,t},t.prototype.setDataQualityChangedCallback=function(t){e.it(t,"callback"),this.dataQualityChangedCallback=t},t.prototype.getPlayer=function(){return this.Pn},t.prototype.addVideoDisplayDimensionsChangedCallback=function(t,e){return this.Ne.addVideoDisplayDimensionsChangedCallback(t,e)},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(9),i(4),i(5),i(3),i(12),i(2),i(10),i(6)],void 0===(r=function(s,e,o,a,t,u,c,r,h,d){"use strict";var f=6e3,i=15e3;function n(t,e,i,n,r){this.rt=r,this.qe=t,this.Tn=encodeURI(e).replace(/[#]/g,"%23"),this.Ae=i,this.f=n,this.ht=null,this.z=null,this.Ne=new h(r),this.Rn={time:0,buffered:null,averageLength:0,count:0,lastCurrentTime:0,lastCurrentTimeOccurenceTimestamp:0},this.se=new a.NamedEvents,this.g=new u.DisposableList,this.En=s.bind(g,this),this.xn=s.bind(v,this),this.Cn=s.bind(w,this)}function l(t){if(m.call(this)&&t&&(3===t.code||t.severity===c.errors.severity.RECOVERABLE))return this.rt.warn("Reloading unhealthy stream after error event [%s]",t),p.call(this);this.se.fire(d.rendererEvents.error.name,["phenix-player",t])}function p(){m.call(this)&&(this.rt.warn("Reloading unhealthy stream that was active for at least [%s] seconds",i/1e3),this.qn=s.now(),function(){this.Pn.dispose(),this.Pn=null,this.start(this.z)}.call(this))}function m(){var t=!this.qn||s.now()-this.qn>i;return this.z&&!this.Mn&&this.Pn&&0!==this.z.buffered.length&&t}function v(){if(this.Rn.time=s.now(),0===this.z.buffered.length)return this.rt.debug("[%s] Phenix stream player progress event fired without any buffered content",this.qe);var t=this.z.buffered.end(this.z.buffered.length-1);if(this.Rn.buffered!==t){if(null!==this.Rn.buffered){var e=this.Rn.averageLength*this.Rn.count+(t-this.Rn.buffered),i=this.Rn.lastCurrentTime===this.z.currentTime;this.Rn.count+=1,this.Rn.averageLength=e/this.Rn.count,i||(this.Rn.lastCurrentTimeOccurenceTimestamp=s.now());var n=this.Rn.lastCurrentTimeOccurenceTimestamp&&s.now()-this.Rn.lastCurrentTimeOccurenceTimestamp>f;i&&n&&this.z&&!this.z.paused&&m.call(this)&&(this.rt.warn("Reloading stream after current time has not changed for [%s] seconds due to unregistered stall.",f/1e3),p.call(this))}this.Rn.buffered=t,this.Rn.lastCurrentTime=this.z.currentTime}}function g(t){var e=this;if(e.rt.info("[%s] Loading Phenix Live stream player stalled caused by [%s] event.",e.qe,t.type),0!==e.Rn.time&&!e.z.paused){var i=e.z.currentTime;setTimeout(function(){s.now()-e.Rn.time>y.call(e)&&e.Mn&&e.stop("ended")},y.call(e)),setTimeout(function(){e.z&&e.z.currentTime===i&&!e.z.paused&&m.call(e)&&(e.rt.warn("Reloading stream after being stalled for [%s] seconds",f/1e3),p.call(e))},f)}}function y(){return 1.5*this.Rn.averageLength<2e3?2e3:1.5*this.Rn.averageLength}function w(){this.rt.info("[%s] Phenix stream player ended.",this.qe)}return n.isSupported=function(){return c.isSupported},n.prototype.on=function(t,e){return this.se.listen(t,e)},n.prototype.start=function(t){var e,i,n,r=(e=this.rt,i=e.getAppenders(),n=new o.Logger,s.forEach(i,function(t){t instanceof o.ConsoleAppender&&(t=new o.ConsoleAppender).setThreshold(o.level.INFO),n.addAppender(t)}),n.setUserId(e.getUserId()),n.setEnvironment(e.getEnvironment()),n.setApplicationVersion(e.getApplicationVersion()),n.setObservableSessionId(e.getObservableSessionId()),n);return this.Dn=r,this.z=t,this.g.add(this.Ae.recordTimeToFirstFrame(t)),this.g.add(this.Ae.recordRebuffering(t)),this.g.add(this.Ae.recordVideoResolutionChanges(this,t)),this.g.add(this.Ae.recordVideoPlayingAndPausing(t)),function(){var t=s.assign({bandwidthToStartAt:3e6},this.f);s.includes(this.Tn,".mpd")&&this.f.isDrmProtectedContent&&(t.drm={"com.widevine.alpha":{serverCertificateUrl:this.f.widevineServiceCertificateUrl,mediaKeySystemConfiguration:{persistentState:"required"}},"com.microsoft.playready":{licenseServerUrl:this.f.playreadyLicenseUrl}});var e=new c.WebPlayer(this.Dn,this.z,t);s.now()-this.f.originStartTime<6e3&&this.f.isDrmProtectedContent&&s.includes(this.Tn,".m3u8")?setTimeout(s.bind(e.start,e,this.Tn),6e3):e.start(this.Tn),this.Pn=e,s.addEventListener(this.Pn,"error",s.bind(l,this))}.call(this),!1===this.f.receiveAudio&&(t.muted=!0),s.addEventListener(t,"stalled",this.En,!1),s.addEventListener(t,"pause",this.En,!1),s.addEventListener(t,"suspend",this.En,!1),s.addEventListener(t,"progress",this.xn,!1),s.addEventListener(t,"ended",this.Cn,!1),this.Ne.start(this,t),t},n.prototype.stop=function(t,e){var i=this;if(!i.On){if(e)return i.Mn=!0;if(this.Ne.stop(),this.g.dispose(),this.Pn){var n=function(){i.z&&(s.removeEventListener(i.z,"stalled",i.En,!1),s.removeEventListener(i.z,"pause",i.En,!1),s.removeEventListener(i.z,"suspend",i.En,!1),s.removeEventListener(i.z,"progress",i.xn,!1),s.removeEventListener(i.z,"ended",i.Cn,!1),"Edge"===r.browser&&(i.z.src="")),i.se.fire(d.rendererEvents.ended.name,[""]),i.Pn=null,i.z=null};i.On=!0;try{i.Pn.dispose(),i.rt.info("[%s] Phenix stream has been destroyed",i.qe),n()}catch(t){i.rt.error("[%s] Error while destroying Phenix stream player [%s]",i.qe,t.code,t),n(),i.se.fire(d.rendererEvents.error.name,["phenix-player",t])}}}},n.prototype.getStats=function(){if(!this.Pn)return{width:0,height:0,currentTime:0,lag:0,networkState:d.networkStates.networkNoSource.id};var t=this.Pn.getStats(),e=t.currentTime||this.z.currentTime,i=(s.now()-this.f.originStartTime)/1e3;return t.isNative&&"Hls"===t.deliveryType&&(t.currentTime=i-t.lag),t.isNative||(t.lag=Math.max(0,i-e)),0<t.estimatedBandwidth?t.networkState=d.networkStates.networkLoading.id:0<t.playTime?t.networkState=d.networkStates.networkIdle.id:t.video?t.networkState=d.networkStates.networkEmpty.id:t.networkState=d.networkStates.networkNoSource.id,t},n.prototype.setDataQualityChangedCallback=function(t){e.it(t,"callback"),this.dataQualityChangedCallback=t},n.prototype.getPlayer=function(){return this.Pn},n.prototype.addVideoDisplayDimensionsChangedCallback=function(t,e){return this.Ne.addVideoDisplayDimensionsChangedCallback(t,e)},n}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(9),i(4),i(5),i(3),i(12),i(2),i(10),i(6)],void 0===(r=function(c,o,t,a,e,u,i,h,d,n){"use strict";var r=6e3,s=15e3,f="rtmp-flash-renderer-2019.2.18.swf",l={local:"https://local.phenixrts.com/public/rtmp/"+f,staging:"https://stg.phenixrts.com/public/rtmp/"+f,production:"https://phenixrts.com/public/rtmp/"+f};function p(t,e,i,n,r){o.nt(n,"options"),n.env&&o.mt(n.env,"options.env");var s=l[n.env||"production"];this.rt=r,this.qe=t,this.An=c.map(e,function(t){return t.uri=encodeURI(t.uri).replace(/[#]/g,"%23"),t}),this.Ae=i,this.f=n,this.ht=null,this.Fn=null,this.Nn=null,this.se=new a.NamedEvents,this.Ne=new d(r),this.g=new u.DisposableList,this.En=c.bind(g,this),this.Cn=c.bind(y,this),this.Un=c.bind(m,this),this.L=n.swfSrc||s}function m(t){this.se.fire(n.rendererEvents.error.name,["flash-player",t])}function v(){var t=!this.qn||c.now()-this.qn>s;return this.Nn&&!this.Mn&&this.Pn&&0!==this.Nn.buffered.length&&t}function g(t){var e=this;e.rt.info("[%s] Loading flash player stalled caused by [%s] event.",e.qe,t.type);var i=e.Nn.currentTime;setTimeout(function(){e.Nn&&e.Nn.currentTime===i&&!e.Nn.paused&&v.call(e)&&(e.rt.warn("Reloading stream after being stalled for [%s] seconds",r/1e3),function(){v.call(this)&&(this.rt.warn("Reloading unhealthy stream that was active for at least [%s] seconds",s/1e3),this.qn=c.now(),function(){this.Fn.destroy(),this.start(this.jn)}.call(this))}.call(e))},r)}function y(){this.rt.info("[%s] Flash player ended.",this.qe)}p.isSupported=function(){return function(){var t=[10,0,0],e="Shockwave Flash",i=[0,0,0];if(c.yt(w))return w;if(c.get(h.global.navigator,["plugins",e])){var n=h.global.navigator.plugins[e].description;if(n&&c.get(h.global.navigator,["mimeTypes","application/x-shockwave-flash","enabledPlugin"],!1))for(var r=0,s=(i=n.replace(e,"").replace(/^\s+/,"").replace(/\sr/gi,".").split(".")).length;r<s;r++)i[r]=parseInt(i[r].match(/\d+/),10)}else if(h.global.ActiveXObject)try{var o=new h.global.ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(o){var a=o.GetVariable("$version")||"",u=c.get(a.split(" "),[1],i).split(",");i=[parseInt(u[0],10),parseInt(u[1],10),parseInt(u[2],10)]}}catch(t){console.error(t)}return w=i[0]>t[0]||i[0]===t[0]&&0<i[1]||i[0]===t[0]&&0===i[1]&&0<=i[2]}()},p.prototype.on=function(t,e){return this.se.listen(t,e)},p.prototype.start=function(t){var e={streamId:this.qe,swfSrc:this.L};return this.jn=t,this.Fn=new h.PhenixVideo(t,this.An,"flash",e),this.Fn.hookUpEvents(),this.Nn=this.Fn.getElement(),this.g.add(this.Ae.recordTimeToFirstFrame(this.jn)),this.g.add(this.Ae.recordRebuffering(this.jn)),this.g.add(this.Ae.recordVideoResolutionChanges(this,this.jn)),this.g.add(this.Ae.recordVideoPlayingAndPausing(this.jn)),this.Nn&&this.Nn.play(),c.addEventListener(this.jn,"stalled",this.En,!1),c.addEventListener(this.jn,"pause",this.En,!1),c.addEventListener(this.jn,"suspend",this.En,!1),c.addEventListener(this.jn,"ended",this.Cn,!1),c.addEventListener(this.jn,"error",this.Un,!1),t},p.prototype.stop=function(t){var e=this;if(this.g.dispose(),this.Fn){var i=function(){e.Nn&&(c.removeEventListener(e.jn,"stalled",e.En,!1),c.removeEventListener(e.jn,"pause",e.En,!1),c.removeEventListener(e.jn,"suspend",e.En,!1),c.removeEventListener(e.jn,"ended",e.Cn,!1),c.removeEventListener(e.jn,"error",e.Un,!1)),e.Nn=null,e.jn=null,e.se.fire(n.rendererEvents.ended.name,[t])};try{this.Fn.destroy(),this.Fn=null,i(),this.rt.info("[%s] Flash player has been destroyed",this.qe)}catch(t){e.rt.error("[%s] Error while destroying Flash player [%s]",e.qe,t.code,t),i(),e.se.fire(n.rendererEvents.error.name,["flash-player",t])}}},p.prototype.getStats=function(){if(!this.Nn)return{width:0,height:0,currentTime:0,lag:0,networkState:n.networkStates.networkNoSource.id};var t={},e=this.Nn.currentTime,i=(c.now()-this.f.originStartTime)/1e3;return t.lag=Math.max(0,i-e),0<t.estimatedBandwidth?t.networkState=n.networkStates.networkLoading.id:0<t.playTime?t.networkState=n.networkStates.networkIdle.id:t.video?t.networkState=n.networkStates.networkEmpty.id:t.networkState=n.networkStates.networkNoSource.id,t},p.prototype.setDataQualityChangedCallback=function(t){o.it(t,"callback"),this.dataQualityChangedCallback=t},p.prototype.getPlayer=function(){return this.Pn},p.prototype.addVideoDisplayDimensionsChangedCallback=function(t,e){return this.Ne.addVideoDisplayDimensionsChangedCallback(t,e)};var w=null;return p}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(2),i(3),i(11),i(16),i(26),i(29),i(84),i(17),i(6)],void 0===(r=function(a,o,u,c,h,d,n,i,r,t,s,f){"use strict";function l(t,e,i,n,r,s){this.qe=t,this.Ln=e,this.we=i,this.Ae=n,this.f=r,this.rt=s,this.Fe=[],this.Ne=null,this.se=new u.NamedEvents,this.Bn=[],this.Wn=0,this._n=null,this.g=new h.DisposableList,this.Lt=0,this.Vn=a.get(r,["iceConnectionTimeout"],12e3),this.g.add(d.onForeground(a.bind(p,this)));var o=/(b=AS:([0-9]*)[\n\r]*)/gi.exec(i.remoteDescription);o&&3<=o.length&&(this.Wn=1e3*o[2]),a.addEventListener(i,"iceconnectionstatechange",a.bind(m,this))}function p(){if(this._n){var t=this._n;this._n=null,t()}}function m(){var t=this,e=this.we.iceConnectionState;switch(e){case"checking":case"connecting":if(a.dt(this.zn))return;this.Gn=a.now(),this.zn=setTimeout(function(){t.rt.warn("[%s] Stream has not connected within [%s] ms",t.qe,t.Vn),t.se.fire(f.streamEvents.playerError.name,["real-time",new Error("connection-timeout")])},t.Vn);break;case"failed":a.dt(this.zn)&&(clearTimeout(this.zn),this.zn=null),this.rt.info("[%s] Stream has failed",t.qe),this.se.fire(f.streamEvents.playerError.name,["real-time",new Error("connection-failed")]);break;case"closed":case"disconnected":a.dt(this.zn)&&t.rt.warn("[%s] Stream closed before it was connected",t.qe);break;case"connected":a.dt(this.zn)&&(clearTimeout(this.zn),this.zn=null),this.Lt++,this.rt.info("[%s] Ice Connection completed after [%s] ms for [%s] time",this.qe,a.now()-this.Gn,this.Lt),this.Gn=null;break;default:this.rt.info("[%s] Unsupported Ice Connection state [%s]",this.qe,e)}}return l.prototype.on=function(t,e){this.se.listen(t,e)},l.prototype.createRenderer=function(){var i=this,e=new t(this.qe,this.Ln,this.Ae,this.f,this.rt);return e.on(f.rendererEvents.error.name,function(t,e){i.se.fire(f.streamEvents.playerError.name,[t,e])}),e.on(f.rendererEvents.ended.name,function(t){i.Fe=a.filter(i.Fe,function(t){return t!==e}),0===i.Fe.length&&(i.Ae.stop(),i.se.fire(f.streamEvents.playerEnded.name,[t]))}),this.Fe.push(e),e},l.prototype.select=function(t){o.it(t,"trackSelectCallback"),o.it(c.global.MediaStream,"rtc.global.MediaStream");for(var e=this.Ln.getTracks(),i=new c.global.MediaStream,n=0;n<e.length;n++)t(e[n],n)&&i.addTrack(e[n]);if(0===i.getTracks().length)return this.rt.warn("No tracks selected");var r=this,s=new l(this.qe,i,this.we,this.Ae,this.f,this.rt);return s.on(f.streamEvents.stopped.name,function(t){var e;e=r.Ln,a.reduce(e.getTracks(),function(t,e){return t&&(i=e,o.nt(i,"track"),"ended"===i.readyState);var i},!0)&&r.se.fire(f.streamEvents.stopped.name,[t])}),this.Bn.push(s),s},l.prototype.setStreamEndedCallback=function(t){o.it(t,"callback"),this.Jn=t},l.prototype.setStreamErrorCallback=function(t){o.it(t,"callback"),this.Hn=t},l.prototype.streamEndedCallback=function(t,e,i){a.forEach(this.Bn,function(t){t.streamEndedCallback(e,i)}),a.it(this.Jn)&&this.Jn(this,e,i)},l.prototype.streamErrorCallback=function(t,e,i){a.forEach(this.Bn,function(t){t.streamErrorCallback(e,i)}),a.it(this.Hn)&&this.Hn(t,e,i)},l.prototype.stop=function(t){var e;this.isActive()&&(this.g.dispose(),(e=this.Ln)&&a.it(e.stop,"stream.stop")&&e.stop(),a.forEach(e&&e.getTracks?e.getTracks():[],function(t){t.stop()}),this.rt.info("[%s] stop [real-time] media stream with reason [%s]",this.qe,t),this.se.fire(f.streamEvents.stopped.name,[t]),this.Ue=!0)},l.prototype.monitor=function(t,n){o.nt(t,"options"),o.it(n,"callback");var r=this,e=new i(r.qe,r.we,r.rt);return t.direction="inbound",e.start(t,function(){return r.isActive()},function t(e,i){return e&&r.rt.warn("[%s] Media stream monitor triggered unrecoverable error [%s]",r.qe,e),s.isIOS()&&!d.isForeground()?(r.rt.info("[%s] Media stream monitor triggered event while app is in the background. Waiting until foreground to trigger event.",r.qe),r._n=t.bind(null,e,i)):(r.rt.warn("[%s] Media stream triggered monitor condition for [%s] [%s]",r.qe,i.type,i.reasons),n(r,"client-side-failure",i))}),this.je=e},l.prototype.getMonitor=function(){return this.je},l.prototype.addBitRateThreshold=function(t,e){var i=this;return new r("Media Stream",this.je,function(){return i.Wn}).addThreshold(t,e)},l.prototype.getStream=function(){return this.Ln},l.prototype.isActive=function(){return!this.Ue},l.prototype.getStreamId=function(){return this.qe},l.prototype.getStats=function(e){o.it(e,"callback"),this.ie||(this.ie={});var i=this;return c.getStats(this.we,null,function(t){e(n.convertPeerConnectionStats(t,i.ie))})},l.prototype.getRenderer=function(){return a.get(this.Fe,[0],null)},l}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(5),i(3),i(2),i(11),i(18),i(8),i(10),i(6),i(17)],void 0===(r=function(s,e,o,t,a,r,u,c,h,d,f,n){"use strict";var l=1e3,p=200;function i(t,e,i,n,r){this.rt=r,this.qe=t,this.Ln=e,this.Ae=i,this.f=n,this.ht=null,this.z=null,this.Ne=new d(r),this.se=new o.NamedEvents,this.g=new a.DisposableList,this.pi=new c(s.get(h,["navigator","userAgent"],"")).detect(),this.Kn=!1,this.Qn=0,this.Xn=0,this.g.add(u.onBackground(s.bind(g,this))),this.g.add(u.onForeground(s.bind(y,this))),this.Yn=s.bind(m,this),this.Cn=s.bind(v,this)}function m(t){var e=s.now()-this.Qn<l;"pause"===t.type&&e&&(this.Kn=!0),this.Xn=s.now(),this.rt.info("[%s] Loading Phenix Real-Time stream player stalling caused by [%s] event.",this.qe,t.type)}function v(){this.rt.info("[%s] Phenix Real-Time stream ended.",this.qe)}function g(){if(this.z){var t=!1,e=s.now()-this.Xn<l;s.yt(this.z.playing)?t=this.z.playing:s.yt(this.z.paused)&&(t=!this.z.paused),!t&&e&&(t=!0),this.Kn=t,this.Qn=s.now()}}function y(){if(this.z){var e=this;if(this.Qn=0,this.Xn=0,this.Kn){if(this.rt.info("[%s] Resume playing after entering foreground [%s]",this.qe,this.pi.browser),"Safari"===this.pi.browser&&n.isIOS()){var t=function(){e.rt.info("Rendered was paused after entering foreground"),e.se.fire(f.rendererEvents.failedToPlay.name,["paused-by-background"])};s.addEventListener(e.z,"pause",t);var i=setTimeout(function(){s.removeEventListener(e.z,"pause",t)},l);this.g.add(new a.Disposable(function(){clearTimeout(i)})),setTimeout(function(){e.z.play().catch(function(t){e.rt.info("[%s] Unable to resume playback after entering foreground",e.qe,t),e.z.src="",e.rt.info("[%s] (Re)starting renderer",e.qe),e.start(e.z)})},p)}}else this.rt.info("[%s] Entering foreground with paused renderer [%s]",this.qe,this.pi.browser)}}return i.prototype.on=function(t,e){if("userActionRequired"===t)throw new Error('"userActionRequired is no longer supported. See https://phenixrts.com/docs/web/#view-a-channel and https://phenixrts.com/docs/web/#channel-viewer');return this.se.listen(t,e)},i.prototype.start=function(e){var i=this,n=!!s.find(this.Ln.getTracks(),function(t){return"audio"===t.kind});return this.f.canPlaybackAudio||(this.f.disableAudioIfNoOutputFound&&this.f.forcedAudioDisabled?this.rt.warn("[%s] Missing audio playback device. Audio has been disabled on stream. Try setting up an audio device and re-subscribe in order to receive audio.",this.qe):!this.f.disableAudioIfNoOutputFound&&n&&this.rt.warn("[%s] Missing audio playback device. May experience audio and/or video failure. Try setting up an audio device OR pass the [disableAudioIfNoOutputFound] option when subscribing to disable audio playback when no devices are attached.",this.qe)),this.z=r.attachMediaStream(e,this.Ln,function(t){if(t){if(e.muted||!n)return i.rt.warn("[%s] Failed to play muted stream.",i.qe,t),i.se.fire(f.rendererEvents.failedToPlay.name,["failed-to-play"]);if(i.f.disableAutoMuting)return i.rt.warn("[%s] Failed to play unmuted stream.",i.qe,t),i.se.fire(f.rendererEvents.failedToPlay.name,["failed-to-play-unmuted"]);i.rt.debug("[%s] Failed to start playing stream. Auto muting the playback and trying again.",i.qe),e.muted=!0,i.z=r.attachMediaStream(e,i.Ln,function(t){if(t)return i.rt.warn("[%s] Failed to play even after auto muting.",i.qe,t),e.muted=!1,i.se.fire(f.rendererEvents.failedToPlay.name,["failed-to-play"]);i.rt.info("[%s] Successfully started playing stream after auto muting. User may manually unmute with user triggered action.",i.qe),i.se.fire(f.rendererEvents.autoMuted.name,["retry-play-muted"])})}else i.rt.debug("[%s] Successfully started playing stream.",i.qe)}),this.g.add(this.Ae.recordTimeToFirstFrame(e)),this.g.add(this.Ae.recordRebuffering(e)),this.g.add(this.Ae.recordVideoResolutionChanges(this,e)),this.g.add(this.Ae.recordVideoPlayingAndPausing(e)),!1===this.f.receiveAudio&&(e.muted=!0),s.addEventListener(e,"stalled",this.Yn,!1),s.addEventListener(e,"pause",this.Yn,!1),s.addEventListener(e,"suspend",this.Yn,!1),s.addEventListener(e,"ended",this.Cn,!1),this.Ne.start(this,e),e},i.prototype.stop=function(t){this.Ne.stop(),this.g.dispose(),this.z&&(s.removeEventListener(this.z,"stalled",this.Yn,!1),s.removeEventListener(this.z,"pause",this.Yn,!1),s.removeEventListener(this.z,"suspend",this.Yn,!1),s.removeEventListener(this.z,"ended",this.Cn,!1),s.it(this.z.pause)&&this.z.pause(),"Edge"===this.pi.browser&&(this.z.src=""),this.z.src&&("IE"===this.pi.browser?this.z.src=null:this.z.src=""),this.z.srcObject&&(this.z.srcObject=null),this.z=null),this.rt.info("[%s] Phenix real-time renderer has been destroyed",this.qe),this.se.fire(f.rendererEvents.ended.name,[t])},i.prototype.getStats=function(){if(!this.z)return{width:0,height:0,currentTime:0,lag:0,networkState:f.networkStates.networkNoSource.id};var t=(s.now()-this.f.originStartTime)/1e3,e=this.f.networkLag/1e3;return{width:this.z.videoWidth||this.z.width,height:this.z.videoHeight||this.z.height,currentTime:t,lag:e,networkState:this.z.networkState}},i.prototype.setDataQualityChangedCallback=function(t){e.it(t,"callback"),this.dataQualityChangedCallback=t},i.prototype.addVideoDisplayDimensionsChangedCallback=function(t,e){return this.Ne.addVideoDisplayDimensionsChangedCallback(t,e)},i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(l,n){"use strict";var p=[{"9x16":[{3840:2160},{1920:1080},{1366:768},{1280:720},{1024:576},{854:480},{640:360},{320:180}]},{"3x4":[{1600:1200},{1440:1080},{960:720},{800:600},{768:576},{640:480},{480:360},{352:288},{320:240},{176:144},{160:120}]},{"16x9":[{2160:3840},{1080:1920},{768:1366},{720:1280},{576:1024},{480:854},{360:640},{180:320}]},{"4x3":[{1200:1600},{1080:1440},{720:960},{600:800},{576:768},{480:640},{360:480},{288:352},{240:320},{144:176},{120:160}]}],r={fallbackToLower:{id:0,name:"fallbackToLower"},fallbackToHigher:{id:1,name:"fallbackToHigher"},fallbackToLowerThenHigher:{id:2,name:"fallbackToLowerThenHigher"},exact:{id:3,name:"exact"}};function t(t){n.nt(t,"options"),t.resolutionSelectionStrategy&&n.lt(t.resolutionSelectionStrategy,r,"options.resolutionSelectionStrategy"),t.aspectRatio&&n.mt(t.aspectRatio,"options.aspectRatio"),t.resolution&&n.dt(t.resolution,"options.resolution"),t.frameRate&&n.dt(t.frameRate,"options.frameRate"),this.Zn=t.resolutionSelectionStrategy||r.fallbackToLowerThenHigher.name,this._e=t.aspectRatio||"16x9",this.$n=parseInt(t.resolution,10)||720,this.tr=function(t,e){switch(n.mt(t,"aspectRatio"),n.dt(e,"resolution"),t){case"16x9":case"4x3":return e;case"9x16":return i(16/9*e);case"3x4":return i(4/3*e);default:throw new Error("Aspect Ratio not supported")}}.call(this,this._e,this.$n),this.er=t.frameRate||15}function i(t){return n.dt(t,"value"),2*Math.floor((t+1)/2)}function s(t,e){var i,n,r,s,o=m(e,p),a=v(e,p),u=v(t.toString(),o),c=0===u,h=p.length-1===a;if(u<0){if((u=d(t,o))<0)return null}else{if(c)return h?null:(n=m(i=g(++a,p),p),(u=d(this.tr,n))<0?null:(r=g(u,o),s=this.calculateLongerDimensionByAspectRatio(r,i),{resolution:Math.min(r,s),aspectRatio:i,height:parseInt(r,10),width:parseInt(s,10)}));u--}return i=g(a,p),r=g(u,n=y(a,p)),s=n[u][r],{resolution:Math.min(r,s),aspectRatio:i,height:parseInt(r,10),width:s}}function o(t,e){var i,n,r,s,o,a,u=m(e,p),c=v(e,p),h=v(t.toString(),u),d=h===u.length-1,f=p.length-1===c;if(l.dt(h)){if(d)return f?null:(i=g(++c,p),r=this.tr,s=this.calculateLongerDimensionByAspectRatio(r,i),{resolution:Math.min(r,s),aspectRatio:i,height:parseInt(r,10),width:parseInt(s,10)});h++}else if(o=t,a=u,!(h=l.keys(a[a.length-1])[0]>o?null:l.reduce(a,function(t,e,i){if(!t)return i;var n=l.keys(a[t])[0],r=l.keys(e)[0];return o<r?t:Math.abs(o-r)<Math.abs(o-n)?i:t})))return;return i=g(c,p),r=g(h,n=y(c,p)),s=n[h][r],{resolution:Math.min(r,s),aspectRatio:i,height:parseInt(r,10),width:parseInt(s,10)}}function m(e,t){var i=l.find(t,function(t){return t.hasOwnProperty(e)});return i?i[e]:null}function v(e,t){return l.findIndex(t,function(t){return t.hasOwnProperty(e)})}function g(t,e){return l.keys(e[t])[0]}function y(t,e){var i=l.keys(e[t]);return e[t][i[0]]}function d(s,o){return l.keys(o[0])[0]<s?-1:l.reduce(o,function(t,e,i){if(!t)return i;var n=l.keys(o[t])[0],r=l.keys(e)[0];return r<s?t:Math.abs(s-r)<Math.abs(s-n)?i:t})}return t.prototype.getDefaultResolution=function(){var t=this.calculateLongerDimensionByAspectRatio(this.$n,this._e);switch(this._e){case"9x16":case"3x4":return{resolution:this.$n,aspectRatio:this._e,height:t,width:this.$n};case"16x9":case"4x3":default:return{resolution:this.$n,aspectRatio:this._e,height:this.$n,width:t}}},t.prototype.getDefaultFrameRate=function(){return this.er},t.prototype.getNextResolution=function(t,e){switch(n.dt(t,"height"),n.mt(e,"aspectRatio"),this.Zn){case r.fallbackToLower.name:return o.call(this,t,e);case r.fallbackToHigher.name:return s.call(this,t,e);case r.fallbackToLowerThenHigher.name:var i=null;return t>this.tr?i=s.call(this,t,e):(i=o.call(this,t,e))&&i.height||(i=s.call(this,this.$n,this._e)),i;case r.exact.name:default:return}},t.prototype.canResolveNextResolution=function(){return this.Zn!==r.exact.name},t.prototype.calculateLongerDimensionByAspectRatio=function(t,e){switch(e){case"16x9":case"9x16":return i(16/9*t);case"4x3":case"3x4":return i(4/3*t);default:throw new Error("Aspect Ratio not supported")}},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(7),i(12),i(31),i(30),i(21),i(2),i(87)],void 0===(r=function(v,g,e,y,i,r,n,w,b){"use strict";var s=0,k="unauthorized",u=1e3,o={maxOfflineTime:18e4,maxReconnectFrequency:6e4};function t(t){if(g.nt(t,"options"),t.authToken&&g.mt(t.authToken,"options.authToken"),t.onError&&g.it(t.onError,"options.onError"),!v.isNullOrUndefined(t.onlineTimeout)&&(g.dt(t.onlineTimeout,"options.onlineTimeout"),t.onlineTimeout<0))throw new Error('"options.onlineTimeout" must be a positive number');t.reconnectOptions&&(g.nt(t.reconnectOptions,"options.reconnectOptions"),g.dt(t.reconnectOptions.maxOfflineTime,"options.reconnectOptions.maxOfflineTime"),g.dt(t.reconnectOptions.maxReconnectFrequency,"options.reconnectOptions.maxReconnectFrequency")),t.adminApiProxyClient&&(g.nt(t.adminApiProxyClient,"options.adminApiProxyClient"),g.it(t.adminApiProxyClient.createAuthenticationToken,"options.adminApiProxyClient.createAuthenticationToken")),this.ir=++s,this.nr=new e.Observable(null).extend({rateLimit:0}),this.Gt={},this.rr=t.adminApiProxyClient,this.sr=!1,this.or=0,this.ar=0,this.pe=!1,this.Wt=t.authToken,this.Un=t.onError,this.f=t,this.ur=v.dt(t.onlineTimeout)?t.onlineTimeout:2e4,this.cr=t.reconnectOptions||o,this.rt=null,this.hr={},this.rr||(this.rr=new i,this.rr.setBackendUri(t.backendUri),this.rr.setAuthenticationData(t.authenticationData)),c.call(this),t.adminApiProxyClient||((t.backendUri||v.ft(t.backendUri))&&this.rt.warn("Passing options.backendUri is deprecated. Please create an instance of the sdk.net.AdminApiProxyClient and pass that instead"),t.authenticationData&&this.rt.warn("Passing options.authenticationData is deprecated. Please create an instance of the sdk.net.AdminApiProxyClient and pass that instead"))}t.prototype.toString=function(){return"PCastExpress["+this.ir+"]"},t.prototype.dispose=function(){this.dr&&(this.dr.dispose(),this.dr=null),this.nr.getValue()&&(this.nr.getValue().stop(),this.nr.setValue(null)),v.dt(this.fr)&&(clearTimeout(this.fr),this.fr=null),this.rr.dispose(),this.or=0,this.ar=0,this.pe=!0,this.rt.info("[%s] Disposed PCast Express instance",this)},t.prototype.getPCast=function(){return this.nr.getValue()},t.prototype.getPCastObservable=function(){return this.nr},t.prototype.getAdminAPI=function(){return this.rr},t.prototype.getUserMedia=function(e,i){var n=this;if(g.nt(e.mediaConstraints,"options.mediaConstraints"),g.it(i,"callback"),e.resolution&&g.dt(e.resolution,"options.resolution"),e.frameRate&&g.dt(e.frameRate,"options.frameRate"),e.aspectRatio&&g.mt(e.aspectRatio,"options.aspectRatio"),e.onResolveMedia&&g.it(e.onResolveMedia,"options.onResolveMedia"),e.onScreenShare&&g.it(e.onScreenShare,"options.onScreenShare"),n.nr.getValue())return p.call(n,n.nr.getValue(),e,i);var r=n.nr.subscribe(function(t){t&&(r.dispose(),p.call(n,t,e,i))})},t.prototype.publish=function(i,n){g.nt(i,"options"),g.it(n,"callback"),i.capabilities&&g.isArray(i.capabilities,"options.capabilities"),i.connectOptions&&g.isArray(i.connectOptions,"options.connectOptions"),i.mediaConstraints?g.nt(i.mediaConstraints,"options.mediaConstraints"):g.nt(i.userMediaStream,"options.userMediaStream"),i.videoElement&&g.nt(i.videoElement,"options.videoElement"),i.monitor&&(g.nt(i.monitor,"options.monitor"),g.it(i.monitor.callback,"options.monitor.callback"),i.monitor.options&&g.nt(i.monitor.options,"options.monitor.options")),i.streamToken&&g.mt(i.streamToken,"options.streamToken");var r=this;this.waitForOnline(function(t){return t?n(t):i.userMediaStream?S.call(r,i.userMediaStream,i,!1,n):void r.getUserMedia(i,function(t,e){return t?n(t):"ok"!==e.status?n(null,e):void S.call(r,e.userMedia,i,!0,n)})},i.isContinuation)};var a=["streaming","low-latency","on-demand","uld","vvld","vld","ld","sd","hd","fhd","uhd"];function c(){var i=this;if(!this.nr.getValue()){var t=v.assign({logger:this.rt},this.f);this.nr.setValue(new n(t))}if(this.rt||(this.rt=this.nr.getValue().getLogger()),this.lr||(this.lr=this.nr.getValue().getObservableStatus().subscribe(v.bind(h,this))),this.Wt)return this.nr.getValue().start(this.Wt,v.noop,v.noop,v.noop);this.rr.createAuthenticationToken(function(t,e){return t&&"timeout"===t.message?h.call(i,t.message):t?l.call(i,t):"ok"!==e.status?h.call(i,e.status):void(i.nr.getValue()?i.nr.getValue().start(e.authenticationToken,v.noop,v.noop,v.noop):i.rt.warn("[%s] Unable to authenticate. PCast not instantiated.",this))})}function h(t){switch(t){case"timeout":case"critical-network-issue":return this.nr.getValue()&&(this.nr.getValue().stop("recovery"),this.nr.setValue(null)),this.lr&&(this.lr.dispose(),this.lr=null),this.or++,d.call(this);case"reconnect-failed":case"unauthorized":return delete this.Wt,this.ar++,1<this.ar?l.call(this,new Error(t)):(this.rt.info("[%s] Attempting to create new authToken and re-connect after [%s] response",this,k),f.call(this));case"capacity":case"network-unavailable":return this.or++,d.call(this);case"online":return this.sr?this.rt.info("[%s] Successfully reconnected (reconnectCount=[%s],reauthCount=[%s])",this,this.or,this.ar):this.rt.info("[%s] Successfully instantiated",this),this.ar=0,this.or=0,void(this.sr=!0);case"reconnecting":case"reconnected":case"connecting":break;case"offline":return;case"failed":default:return l.call(this,new Error(t))}}function d(){var t=this,e=Math.min(u*t.or*t.or,this.cr.maxReconnectFrequency),i=Math.min(e/1e4,5),n=e+Math.random()*i*1e3;this.rt.info("[%s] Waiting for [%s] ms before continuing to attempt to reconnect to PCast",this,n),this.fr=setTimeout(function(){return t.nr.getValue()&&t.nr.getValue().isStarted()?f.call(t):c.call(t)},n)}function f(){var i=this;this.rr.createAuthenticationToken(function(t,e){return t&&"timeout"===t.message?h.call(i,t.message):t?l.call(i,t):"ok"!==e.status?h.call(i,e.status):void(i.nr.getValue()?i.nr.getValue().reAuthenticate(e.authenticationToken):i.rt.warn("[%s] Unable to authenticate. PCast not instantiated.",this))})}function l(t){if(!this.Un)throw t;this.Un(t)}function p(t,i,n){new r(t,{aspectRatio:i.aspectRatio,resolution:i.resolution,frameRate:i.frameRate,resolutionSelectionStrategy:i.resolutionSelectionStrategy,onScreenShare:function(t){return(t=i.onScreenShare?i.onScreenShare(t):t).resolution&&g.dt(t.resolution,"clientOptions.resolution"),t.frameRate&&g.dt(t.frameRate,"screenOptions.frameRate"),t.aspectRatio&&g.mt(t.aspectRatio,"screenOptions.aspectRatio"),v.assign({resolution:t.resolution},t)}}).getUserMedia(i.mediaConstraints,function(t,e){if(t)return n(t);i.onResolveMedia&&i.onResolveMedia(e.options),n(null,v.assign({status:"ok"},e))})}function S(r,s,o,a){var u=this;if(g.isArray(s.capabilities,"options.capabilities"),s.streamToken)return m.call(u,s.streamToken,r,s,o,a);u.waitForOnline(function(t){if(t)return u.rt.error("[%s] Failed to create stream token for publishing after waiting for online status",this,t),a(t);var i=u.nr.getValue().getProtocol().getSessionId(),e=v.includes(s.capabilities,"egress"),n=v.bind(u.rr.createStreamTokenForPublishing,u.rr,i,s.capabilities);e&&(n=v.bind(u.rr.createStreamTokenForPublishingToExternal,u.rr,i,s.capabilities,s.streamId)),u.rt.info("[%s] [%s] Creating stream token for publishing",this,i),n(function(t,e){return t?(u.rt.error("[%s] [%s] Failed to create stream token for publishing",this,i,t),a(t)):"ok"!==e.status?(u.rt.warn("[%s] [%s] Failed to create stream token for publishing with status [%s]",this,i,e.status),a(null,e)):void m.call(u,e.streamToken,r,s,o,a)})},s.isContinuation)}function m(u,c,h,d,f){var l=this,p=!1,m=null;function e(t,e,i){function n(t){var e=v.assign({streamToken:u,isContinuation:!0},h);l.rt.warn("[%s] Retrying publisher after failure with reason [%s]",this,t),l.hr[i.getStreamId()]=!0,"camera-track-failure"===t?(i.stop(t,!1),l.publish(h,f)):(i.stop(t,!0),S.call(l,c,e,d,f))}if(e===k&&(h.streamToken||!h.authFailure)||"timeout"===e){l.rt.info("[%s] Attempting to create new streamToken and re-publish after [%s] response",this,k);var r=v.assign({isContinuation:!0,authFailure:!0},h);return delete r.streamToken,S.call(l,c,r,d,f)}if("ok"!==e)return l.rt.warn("[%s] Failure to publish with status [%s]",this,e),m&&(l.hr[m.getStreamId()]=!0),f(null,{status:e});delete h.authFailure,l.Gt[i.getStreamId()]=i,m=i;var s=v.bind(C,l,function(){},n,!0);if(h.monitor){var o=v.bind(x,l,h.monitor.callback,n);i.monitor(h.monitor.options||{},o),s=v.bind(C,l,h.monitor.callback,n,!0)}i.setPublisherEndedCallback(s);var a=function(n,r,s){var o=this,a=v.bind(n.stop,n);return n.stop=function(t,e){if(o.rt.info("[%s] [%s] Stopping publisher with reason [%s]",o,n.getStreamId(),t),a(t),r&&(r.src="",r.srcObject=null),s&&n.getStream()&&!e){var i=n.getStream();i&&i.getTracks().forEach(function(t){t.stop()})}},n.enableAudio=function(){return T(n.getStream(),!0)},n.disableAudio=function(){return T(n.getStream(),!1)},n.enableVideo=function(){return R(n.getStream(),!0)},n.disableVideo=function(){return R(n.getStream(),!1)},n.setPublisherEndedCallback=function(){},n}.call(l,i,h.videoElement,d);h.videoElement&&!p&&(w.attachMediaStream(h.videoElement,c,function(t){t&&l.rt.warn("[%s] [%s] Failed to attach publish media stream to video element.",this,i.getStreamId(),t)}),p=!0),f(null,{status:"ok",publisher:a})}h.tags&&g.isArray(h.tags,"options.tags"),h.connectOptions&&g.isArray(h.connectOptions,"options.connectOptions"),l.waitForOnline(function(t){if(t)return f(t);l.nr.getValue().publish(u,c,e,h.tags,{connectOptions:h.connectOptions})},h.isContinuation)}function I(d,f,l){function i(t,e,i){function r(t){var e=v.assign({isContinuation:!0},f);p.hr[i.getStreamId()]=!0,i.stop(t),p.rt.warn("[%s] [%s] Stream failure occurred with reason [%s]. Attempting to recover from failure.",this,f.streamId,t),I.call(p,d,e,l)}var n;if(!f.skipRetryOnUnauthorized&&e===k&&(f.streamToken||!f.authFailure)||"timeout"===e){p.rt.info("[%s] [%s] Attempting to create new streamToken and re-subscribe after [%s] response",this,f.streamId,k);var s=v.assign({isContinuation:!0,authFailure:!0},f);return delete s.streamToken,p.subscribe(s,l)}if("streaming-not-ready"===e)return p.rt.warn("[%s] Failure to subscribe with status [%s]. Try again in a few seconds.",this,e),l(null,{status:e,retry:v.bind(r,p,e)});if("ok"!==e)return p.rt.warn("[%s] Failure to subscribe with status [%s]",this,e),m&&(p.hr[m.getStreamId()]=!0),l(null,{status:e});delete f.authFailure,m=i,f.videoElement&&(n=i.createRenderer()).start(f.videoElement);var o=v.noop,a=v.bind(C,p,o,r,!1);if(f.monitor){var u=v.bind(x,p,f.monitor.callback,r);i.monitor(f.monitor.options||{},u),a=v.bind(C,p,f.monitor.callback,r,!1)}i.setStreamEndedCallback(a);var c=function(e,i){var n=this,r=v.bind(e.stop,e);return e.stop=function(t){n.rt.info("[%s] [%s] Stopping subscriber with reason [%s]",this,e,t),i&&i.stop(t),r(t)},e.enableAudio=function(){return T(e.getStream(),!0)},e.disableAudio=function(){return T(e.getStream(),!1)},e.enableVideo=function(){return R(e.getStream(),!0)},e.disableVideo=function(){return R(e.getStream(),!1)},e.setStreamEndedCallback=function(){},e}.call(p,i,n),h={status:"ok",mediaStream:c};i.setStreamErrorCallback(function(t,e,i){if("real-time"===e&&"connection-timeout"===i.message)return r.call(p,i.message);if("shaka"!==e||i.severity===b.errorSeverity.critical.id){if("phenix-player"!==e||i.severity!==y.errors.severity.RECOVERABLE)return p.rt.warn("[%s] [%s] Error occurred while playing stream with Express API. Stopping stream.",this,c.getStreamId(),i),c.stop(),l(i);p.rt.warn("[%s] [%s] Recoverable error occurred while playing stream with Express API. Attempting to subscribe again.",this,c.getStreamId(),i);var n=v.assign({isContinuation:!0},f);return delete n.streamToken,p.subscribe(n,l)}}),n&&(h.renderer=n),l(null,h)}var p=this,m=null;p.waitForOnline(function(t){if(t)return l(t);var e=v.clone(f.subscriberOptions||{});f.streamId&&(e.originStreamId=f.streamId),p.nr.getValue().subscribe(d,i,e)},f.isContinuation)}function T(t,e){if(t)return E(t.getAudioTracks(),e),e}function R(t,e){if(t)return E(t.getVideoTracks(),e),e}function E(t,e){g.isArray(t,"tracks"),v.forEach(t,function(t){t.enabled=e})}function x(t,e,i,n,r){switch(n){case"camera-track-failure":case"client-side-failure":t(null,v.assign({status:n,retry:v.bind(e,null,n)},r))}}function C(t,e,i,n,r,s){var o={status:"stream-ended",reason:r,description:s};if(this.hr[n.getStreamId()])this.rt.info("[%s] Ignoring stream end due to recovery in progress [%s]",this,n.getStreamId());else switch(r){case"egress-setup-failed":case"ended":case"censored":var a={status:r,reason:r,description:s};return i?a.publisher=n:a.mediaStream=n,t(null,a);case"custom":return t(null,o);case"egress-failed":case"capacity":return void setTimeout(function(){if(!this.pe)return e(r)},u);case"failed":case"maintenance":case"overload":return e(r);case"app-background":default:return o.retry=e,t(null,o)}}return t.prototype.publishRemote=function(i,n){if(g.nt(i,"options"),g.it(n,"callback"),g.mt(i.streamUri,"options.streamUri"),i.capabilities&&g.isArray(i.capabilities,"options.capabilities"),i.connectOptions&&g.isArray(i.connectOptions,"options.connectOptions"),i.mediaConstraints)throw new Error("Invalid argument: mediaConstraints, passed on publishRemote. Local media not allowed when publishing remote content.");if(i.videoElement)throw new Error("May not view remote stream publisher. Please subscribe to view.");i.prerollSkipDuration&&g.dt(i.prerollSkipDuration,"options.prerollSkipDuration"),i.monitor&&(g.nt(i.monitor,"options.monitor"),g.it(i.monitor.callback,"options.monitor.callback"),i.monitor.options&&g.nt(i.monitor.options,"options.monitor.options")),i.frameRate&&(g.nt(i.frameRate,"options.frameRate"),i.frameRate.exact&&g.dt(i.frameRate.exact,"options.frameRate.exact"),i.frameRate.max&&g.dt(i.frameRate.max,"options.frameRate.max")),i.streamToken&&g.mt(i.streamToken,"options.streamToken");var r=this;this.waitForOnline(function(t){if(t)return n(t);var e=v.assign({connectOptions:[],capabilities:[]},i);v.includes(e.capabilities,"publish-uri")||e.capabilities.push("publish-uri"),v.forEach(a,function(t){v.includes(e.capabilities,t)&&e.connectOptions.push("publisher-capability="+t)}),i.frameRate&&i.frameRate.exact&&e.connectOptions.push("source-uri-video-fps="+i.frameRate.exact),i.frameRate&&i.frameRate.max&&e.connectOptions.push("source-uri-video-fps-max="+i.frameRate.max),e.connectOptions.push("source-uri-preroll-skip-duration="+(v.dt(i.prerollSkipDuration)?i.prerollSkipDuration:500).toString()),S.call(r,e.streamUri,e,!1,n)})},t.prototype.publishStreamToExternal=function(i,n){if(g.nt(i,"options"),g.it(n,"callback"),g.mt(i.streamId,"options.streamId"),g.mt(i.externalUri,"options.externalUri"),i.capabilities&&g.isArray(i.capabilities,"options.capabilities"),i.connectOptions&&g.isArray(i.connectOptions,"options.connectOptions"),i.mediaConstraints)throw new Error("Invalid argument: mediaConstraints, passed on publishStreamToExternal. Local media not allowed when publishing remote content.");if(i.videoElement)throw new Error("May not view remote stream publisher. Please subscribe to view.");i.monitor&&(g.nt(i.monitor,"options.monitor"),g.it(i.monitor.callback,"options.monitor.callback"),i.monitor.options&&g.nt(i.monitor.options,"options.monitor.options")),i.streamToken&&g.mt(i.streamToken,"options.streamToken");var r=this;this.waitForOnline(function(t){if(t)return n(t);var e=v.assign({connectOptions:[],capabilities:[]},i);v.includes(e.capabilities,"egress")||e.capabilities.push("egress"),v.includes(e.capabilities,"egress-own-stream")||e.capabilities.push("egress-own-stream"),S.call(r,e.externalUri,e,!1,n)})},t.prototype.publishScreen=function(t,e){var i=v.assign({mediaConstraints:{screen:!0}},t);return v.set(i,["monitor","options"],v.assign({},{monitorFrameRate:!1,videoBitRateThreshold:100,conditionCountForNotificationThreshold:8},v.get(i,["monitor","options"],{}))),this.publish(i,e)},t.prototype.subscribe=function(i,n){g.nt(i,"options"),g.it(n,"callback"),g.mt(i.streamId,"options.streamId"),g.nt(i.capabilities,"options.capabilities"),i.videoElement&&g.nt(i.videoElement,"options.videoElement"),i.monitor&&(g.nt(i.monitor,"options.monitor"),g.it(i.monitor.callback,"options.monitor.callback"),i.monitor.options&&g.nt(i.monitor.options,"options.monitor.options")),i.streamToken&&g.mt(i.streamToken,"options.streamToken"),i.subscriberOptions&&g.nt(i.subscriberOptions,"options.subscriberOptions");var r=this;this.waitForOnline(function(t){return t?(r.rt.error("[%s] Failed to subscribe after error waiting for online status",this,t),n(t)):i.streamToken?I.call(r,i.streamToken,i,n):(r.rt.info("[%s] [%s] Generating stream token for subscribing to origin [%s]",this,r.nr.getValue().getProtocol().getSessionId(),i.streamId),void r.rr.createStreamTokenForSubscribing(r.nr.getValue().getProtocol().getSessionId(),i.capabilities,i.streamId,null,function(t,e){return t?(r.rt.error("[%s] Failed to create stream token for subscribing",this,t),n(t)):"ok"!==e.status?(r.rt.warn("[%s] Failed to create stream token for subscribing with status [%s]",this,e.status),n(null,e)):void I.call(r,e.streamToken,i,n)}))},i.isContinuation)},t.prototype.subscribeToScreen=function(t,e){var i=v.assign({},t);return v.set(i,["monitor","options"],v.assign({},{monitorFrameRate:!1,videoBitRateThreshold:100,conditionCountForNotificationThreshold:8},v.get(i,["monitor","options"],{}))),this.subscribe(i,e)},t.prototype.waitForOnline=function(e,t){if(g.it(e,"callback"),this.nr.getValue()&&"online"===this.nr.getValue().getStatus())return e();var i=this,n=t?v.get(i.cr,["maxOfflineTime"]):this.ur,r=null,s=null,o=setTimeout(function(){i.rt.info("[%s] Disposing of online listener after [%s] ms",this,n),r&&r.dispose(),s&&s.dispose(),i.pe?i.rt.info("[%s] Instance was disposed while waiting for online, ignoring callback",this):e(new Error("timeout"))},n);this.rt.info("[%s] Waiting for online status before continuing. Timeout set to [%s]",this,n),r=this.nr.subscribe(function(t){s&&s.dispose(),t&&(s=t.getObservableStatus().subscribe(function(t){return i.pe?(i.rt.info("[%s] Instance was disposed while waiting for online, canceling waiting and skip triggering callback",this),clearTimeout(o),s.dispose(),void r.dispose()):"online"===t?(clearTimeout(o),s.dispose(),r.dispose(),e()):void i.rt.info("[%s] Still waiting for online status before continuing. Current status is [%s]",this,t)},{initial:"notify"}))},{initial:"notify"})},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{errorSeverity:{recoverable:{id:1,name:"RECOVERABLE"},critical:{id:2,name:"CRITICAL"}}}}.apply(e,[]))||(t.exports=n)}],f.c=e,f.d=function(t,e,i){f.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},f.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},f.t=function(e,t){if(1&t&&(e=f(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(f.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)f.d(i,n,function(t){return e[t]}.bind(null,n));return i},f.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return f.d(e,"a",e),e},f.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},f.p="",f(f.s=32);function f(t){if(e[t])return e[t].exports;var i=e[t]={i:t,l:!1,exports:{}};return d[t].call(i.exports,i,i.exports,f),i.l=!0,i.exports}var d,e});