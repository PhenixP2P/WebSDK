/**
 * Copyright 2020 Phenix Real Time Solutions, Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("phenix-web-sdk",[],e):"object"==typeof exports?exports["phenix-web-sdk"]=e():t["phenix-web-sdk"]=e()}(window,function(){return e={},f.m=d=[function(t,e,i){var n,r;n=[i(49)],void 0===(r=function(t){"use strict";return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(51)],void 0===(r=function(t){return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(52),i(53)],void 0===(r=function(t,e){return{Disposable:t,DisposableList:e}}.apply(e,n))||(t.exports=r)},function(Q,R,S){var X,Y,Z,$,_,aa,ba,da;function ca(t){if(da[t])return da[t].exports;var e=da[t]={i:t,l:!1,exports:{}};return ba[t].call(e.exports,e,e.exports,ca),e.l=!0,e.exports}Q.exports=(X=S(0),Y=S(16),Z=S(1),$=S(2),_=S(4),aa=S(5),ba=[function(i,n,t){(function(t){var e;void 0===(e=function(){"use strict";return"object"==typeof window?window:"object"==typeof t?t:{}}.apply(n,[]))||(i.exports=e)}).call(n,t(10))},function(t,e){t.exports=X},function(t,e){t.exports=Y},function(t,e,i){var n,r;n=[i(1),i(6),i(4),i(0),i(13)],void 0===(r=function(o,h,a,u,c){"use strict";function t(t,e,i,n){var r=this;this.e=t,this.a=e,this.u="phenix"===i,this.h="flash"===i,this.f=n||{},this.v={},this.g=new h.DisposableList,this.y=null;function s(t){r.w=!0,r.b=!0===t,t?d.call(r):m("Failed to create Phenix video element"),r.k&&r.k(r.b)}try{if(this.S=function(){var t=document.createElement("video");if(this.u&&((t=document.createElement("object")).type="application/x-phenix-video"),this.h){this.y=new c(this.e,this.a,this.f);var e=this;this.g.add(new h.Disposable(function(){e.y.destroy()})),t=this.y.getElement()}return t}.call(this),this.S.className=this.e.className,this.S.height=this.e.height,this.S.width=this.e.width,this.T=this.e.style.cssText,this.e.style.cssText="visibility:hidden !important;width:0px !important;height:0px !important;margin:0px !important;padding:0px !important;border-style:none !important;border-width:0px !important;max-width:0px !important;max-height:0px !important;outline:none !important",this.g.add(new h.Disposable(function(){r.e.style.cssText=r.T})),this.S.onunload=function(){r.w=!1},function(){var n=this;if(o.get(u,["MutationObserver"])){var t=new MutationObserver(function(t){t.forEach(function(t){if("childList"===t.type)for(var e=0;e<t.addedNodes.length;e++){var i=t.addedNodes[e];t.target!==n.S&&(i===n.e?(t.target.replaceChild(n.S,n.e),d.call(n)):l(t.target,n.e)&&(n.e.parentNode&&n.e.parentNode.replaceChild(n.S,n.e),d.call(n)))}})});t.observe(document.body,{childList:!0,attributes:!1,characterData:!1,subtree:!0}),n.g.add(new h.Disposable(function(){t.disconnect()}))}else{p("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details.");var e=function(){n.e.parentNode&&n.e.parentNode.replaceChild(n.S,n.e)};n.addEventListener("DOMNodeInserted",e,!1),n.g.add(new h.Disposable(function(){n.removeEventListener("DOMNodeInserted",e,!1)}))}}.call(this),document.body&&document.body.contains||p("document.body.contains is not supported"),document.body&&document.body.contains&&document.body.contains(this.e)&&(this.e.parentNode.replaceChild(this.S,this.e),this.h&&this.y&&(this.S=this.y.finishInitializationInDom()),this.g.add(new h.Disposable(function(){r.S.parentNode&&r.S.parentNode.replaceChild(r.e,r.S)}))),!this.u)return s(!0);(new a).waitForReady(this.S,s)}catch(t){m("Error while loading Phenix RTC"+t),s(!1)}}function r(i){var n=this;n.S.phenixSetEventListener(i,function(){var t=n.v[i];if(t)for(var e=0;e<t.length;e++)t[e].apply(n,arguments)})}function f(t,e){var i;document.createEvent?(i=document.createEvent("HTMLEvents")).initEvent(e,!0,!0):(i=document.createEventObject()).eventType=e,i.eventName=e,setTimeout(function(){document.createEvent?t.dispatchEvent(i):t.fireEvent("on"+i.eventType,i)})}function d(){for(var t=Object.keys(this.v),e=0;e<t.length;e++)r.call(this,t[e]);this.hookUpEvents(),function(){var e=this,i=["style"];if(o.get(u,["MutationObserver"])){var t=new MutationObserver(function(t){t.forEach(function(t){"attributes"===t.type&&t.target===e.e&&-1===i.indexOf(t.attributeName)&&(e.S[t.attributeName]=e.e[t.attributeName])})});t.observe(e.e,{attributes:!0}),e.g.add(new h.Disposable(function(){t.disconnect()}))}else{p("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details.");var n=function(t){e.S[t.target.tagName]=e.e[t.target.tagName]};e.e.addEventListener?(e.e.addEventListener("DOMAttrModified",n,!1),e.g.add(new h.Disposable(function(){e.e.removeEventListener("DOMAttrModified",n,!1)}))):(e.e.attachEvent("onpropertychange",n),e.g.add(new h.Disposable(function(){e.e.detachEvent("DOMAttrModified",n)})))}}.call(this),this.S.id=this.e.id,this.S.style.cssText=this.T,this.S.className=this.e.className,this.S.innerHtml=this.e.innerHtml,this.S.width=this.e.width,this.S.height=this.e.height,this.S.autoplay=this.e.autoplay,this.S.muted=this.e.muted,this.S.defaultMuted=this.e.defaultMuted,this.S.volume=this.e.volume,this.a&&!this.h&&(this.S.src=this.a)}function l(t,e){for(var i=e.parentNode;null!==i;){if(i===t)return!0;i=i.parentNode}return!1}function m(){console.error.apply(console,arguments)}var p=function(){console.log.apply(console,arguments)};return t.prototype.hookUpEvents=function(){function t(){f(u,"error")}function e(){u.muted=a.S.muted,f(u,"mute")}function i(){u.muted=a.S.muted,f(u,"unmute")}function n(){u.ended=a.S.ended,f(u,"ended")}function r(){u.width=a.S.width,u.height=a.S.height,f(u,"loadedmetadata")}function s(){u.width=a.S.width,u.height=a.S.height,f(u,"loadeddata")}function o(){u.width=a.S.width,u.height=a.S.height,f(u,"resize")}var a=this,u=this.e;this.addEventListener("error",t),this.addEventListener("mute",e),this.addEventListener("unmute",i),this.addEventListener("ended",n),this.addEventListener("loadedmetadata",r),this.addEventListener("loadeddata",s),this.addEventListener("resize",o);var c=new h.Disposable(function(){a.removeEventListener("error",t),a.removeEventListener("mute",e),a.removeEventListener("unmute",i),a.removeEventListener("ended",n),a.removeEventListener("loadedmetadata",r),a.removeEventListener("loadeddata",s),a.removeEventListener("resize",o)});return this.g.add(c),c},t.prototype.onReady=function(t){var e=this;this.w?setTimeout(function(){t(e.b)},1):this.k=t},t.prototype.getElement=function(){return this.S},t.prototype.addEventListener=function(t,e,i){(function(t,e,i){if(this.h)return this.y.addEventListener(t,e);if(this.u){var n=this.v[t];return n||(n=this.v[t]=[],this.w&&r.call(this,t)),n.push(e)}return this.S.addEventListener(t,e,i)}).call(this,t,e,i)},t.prototype.removeEventListener=function(t,e,i){(function(t,e,i){if(this.h)return this.y.removeEventListener(t,e);if(!this.u)return this.S.removeEventListener(t,e,i);var n=this.v[t];if(n){var r=n.indexOf(e);0<=r&&(0<(n=n.splice(r,1)).length?this.v[t]=n:delete this.v[t])}}).call(this,t,e,i)},t.prototype.destroy=function(){this.g.dispose()},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(2)],void 0===(r=function(t){"use strict";function e(t){this.I=t||15e3}function u(){console.error.apply(console,arguments)}var c=new t(navigator.userAgent).detect();return e.prototype.waitForReadyWithTimeout=function(e,i,n){function r(t){s||(s=!0,i(t))}var s=!1,o=1,a=o;e.hasOwnProperty&&e.hasOwnProperty("onload")||"IE"!==c.browser&&u("No means of detecting when <object> is loaded"),e.onload=function(){r(!0)},function t(){4===e.readyState?r(!0):e.phenixVersion?r(!0):(o=Math.min(o+1e3,2*o),(a+=o)>n?(u("Timed out while waiting for <object> to load"),r(!1)):setTimeout(t,o))}()},e.prototype.waitForReady=function(t,e){t.phenixVersion?e(!0):this.waitForReadyWithTimeout(t,e,this.I)},e}.apply(e,n))||(t.exports=r)},function(t,e){t.exports=Z},function(t,e){t.exports=$},function(t,e){t.exports=_},function(t,e,i){var n,r;n=[i(1),i(5),i(7),i(2),i(0),i(15),i(14)],void 0===(r=function(i,t,e,n,r,s,o){"use strict";function a(){if(i.assign(c,s()),o.isSupported()){c.phenixSupported=!0;var t=new o,e=function(){c.RTCPeerConnection=t.getRTCPeerConnectionConstructor(),c.RTCSessionDescription=t.getRTCSessionDescriptionConstructor(),c.RTCIceCandidate=t.getRTCIceCandidateConstructor(),c.getSources=t.getSourcesDelegate(),c.getUserMedia=t.getUserMediaDelegate(),c.getStats=t.getStatsDelegate(),Function.prototype.bind?(c.attachMediaStream=t.attachMediaStream.bind(t),c.reattachMediaStream=t.reattachMediaStream.bind(t),c.isPhenixEnabled=t.isEnabled.bind(t)):(c.attachMediaStream=function(){t.attachMediaStream.apply(t,arguments)},c.reattachMediaStream=function(){t.reattachMediaStream.apply(t,arguments)},c.isPhenixEnabled=function(){return t.isEnabled()}),c.webrtcSupported=!0,c.phenixSupported=!0,c.phenixVersion=t.getVersion(),c.onLoaded&&c.onLoaded.call()};t.isEnabled()?e():t.onReady(function(t){t&&(e(),c.onload&&"function"==typeof c.onload&&c.onload())}),t.onLoaded(function(){e()})}else c.phenixSupported=!1;return c}var u=new n(navigator.userAgent).detect(),c={browser:u.browser,browserVersion:u.version,phenixSupported:!1,isPhenixEnabled:function(){return!1},onLoaded:void 0,global:r};return i.assign(a(),{shim:a})}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0)],void 0===(r=function(e){"use strict";return function(t){e.RTCPeerConnection=t.RTCPeerConnection,e.RTCSessionDescription=t.RTCSessionDescription,e.RTCIceCandidate=t.RTCIceCandidate}}.apply(e,n))||(t.exports=r)},function(hd,id){var jd;jd=function(){return this}();try{jd=jd||Function("return this")()||eval("this")}catch(t){"object"==typeof window&&(jd=window)}hd.exports=jd},function(t,e,i){t.exports=function r(s,o,a){function u(e,t){if(!o[e]){if(!s[e]){if(c)return(void 0)(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var n=o[e]={exports:{}};s[e][0].call(n.exports,function(t){return u(s[e][1][t]||t)},n,n.exports,r,s,o,a)}return o[e].exports}for(var c=!1,t=0;t<a.length;t++)u(a[t]);return u}({1:[function(t,e,i){"use strict";var n=(0,t("./adapter_factory.js").adapterFactory)({window:window});e.exports=n},{"./adapter_factory.js":2}],2:[function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(i,"__esModule",{value:!0}),i.adapterFactory=function(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).window,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},i=s.log,n=s.detectBrowser(t),r={browserDetails:n,commonShim:h,extractVersion:s.extractVersion,disableLog:s.disableLog,disableWarnings:s.disableWarnings};switch(n.browser){case"chrome":if(!o||!o.shimPeerConnection||!e.shimChrome)return i("Chrome shim is not included in this adapter release."),r;if(null===n.version)return i("Chrome shim can not determine version, not shimming."),r;i("adapter.js shimming chrome."),(r.browserShim=o).shimGetUserMedia(t),o.shimMediaStream(t),o.shimPeerConnection(t),o.shimOnTrack(t),o.shimAddTrackRemoveTrack(t),o.shimGetSendersWithDtmf(t),o.shimGetStats(t),o.shimSenderReceiverGetStats(t),o.fixNegotiationNeeded(t),h.shimRTCIceCandidate(t),h.shimConnectionState(t),h.shimMaxMessageSize(t),h.shimSendThrowTypeError(t),h.removeAllowExtmapMixed(t);break;case"firefox":if(!u||!u.shimPeerConnection||!e.shimFirefox)return i("Firefox shim is not included in this adapter release."),r;i("adapter.js shimming firefox."),(r.browserShim=u).shimGetUserMedia(t),u.shimPeerConnection(t),u.shimOnTrack(t),u.shimRemoveStream(t),u.shimSenderGetStats(t),u.shimReceiverGetStats(t),u.shimRTCDataChannel(t),u.shimAddTransceiver(t),u.shimGetParameters(t),u.shimCreateOffer(t),u.shimCreateAnswer(t),h.shimRTCIceCandidate(t),h.shimConnectionState(t),h.shimMaxMessageSize(t),h.shimSendThrowTypeError(t);break;case"edge":if(!a||!a.shimPeerConnection||!e.shimEdge)return i("MS edge shim is not included in this adapter release."),r;i("adapter.js shimming edge."),(r.browserShim=a).shimGetUserMedia(t),a.shimGetDisplayMedia(t),a.shimPeerConnection(t),a.shimReplaceTrack(t),h.shimMaxMessageSize(t),h.shimSendThrowTypeError(t);break;case"safari":if(!c||!e.shimSafari)return i("Safari shim is not included in this adapter release."),r;i("adapter.js shimming safari."),(r.browserShim=c).shimRTCIceServerUrls(t),c.shimCreateOfferLegacy(t),c.shimCallbacksAPI(t),c.shimLocalStreamsAPI(t),c.shimRemoteStreamsAPI(t),c.shimTrackEventTransceiver(t),c.shimGetUserMedia(t),c.shimAudioContext(t),h.shimRTCIceCandidate(t),h.shimMaxMessageSize(t),h.shimSendThrowTypeError(t),h.removeAllowExtmapMixed(t);break;default:i("Unsupported browser!")}return r};var s=n(t("./utils")),o=n(t("./chrome/chrome_shim")),a=n(t("./edge/edge_shim")),u=n(t("./firefox/firefox_shim")),c=n(t("./safari/safari_shim")),h=n(t("./common_shim"))},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(t,e,i){"use strict";function u(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function c(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this.R=this.R||{},Object.keys(this.R).map(function(t){return e.R[t][0]})};var n=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(t,e){if(!e)return n.apply(this,arguments);this.R=this.R||{};var i=n.apply(this,arguments);return this.R[e.id]?-1===this.R[e.id].indexOf(i)&&this.R[e.id].push(i):this.R[e.id]=[e,i],i};var r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(t){var i=this;this.R=this.R||{},t.getTracks().forEach(function(e){if(i.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var e=this.getSenders();r.apply(this,arguments);var n=this.getSenders().filter(function(t){return-1===e.indexOf(t)});this.R[t.id]=[t].concat(n)};var e=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(t){return this.R=this.R||{},delete this.R[t.id],e.apply(this,arguments)};var s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(i){var n=this;return this.R=this.R||{},i&&Object.keys(this.R).forEach(function(t){var e=n.R[t].indexOf(i);-1!==e&&n.R[t].splice(e,1),1===n.R[t].length&&delete n.R[t]}),s.apply(this,arguments)}}Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=i.shimGetUserMedia=void 0;var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=t("./getusermedia");Object.defineProperty(i,"shimGetUserMedia",{enumerable:!0,get:function(){return n.shimGetUserMedia}});var r=t("./getdisplaymedia");Object.defineProperty(i,"shimGetDisplayMedia",{enumerable:!0,get:function(){return r.shimGetDisplayMedia}}),i.shimMediaStream=function(t){t.MediaStream=t.MediaStream||t.webkitMediaStream},i.shimOnTrack=function(s){if("object"!==(void 0===s?"undefined":a(s))||!s.RTCPeerConnection||"ontrack"in s.RTCPeerConnection.prototype)h.wrapPeerConnectionEvent(s,"track",function(t){return t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t});else{Object.defineProperty(s.RTCPeerConnection.prototype,"ontrack",{get:function(){return this.M},set:function(t){this.M&&this.removeEventListener("track",this.M),this.addEventListener("track",this.M=t)},enumerable:!0,configurable:!0});var t=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this.C||(this.C=function(n){n.stream.addEventListener("addtrack",function(e){var t;t=s.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(t){return t.track&&t.track.id===e.track.id}):{track:e.track};var i=new Event("track");i.track=e.track,i.receiver=t,i.transceiver={receiver:t},i.streams=[n.stream],r.dispatchEvent(i)}),n.stream.getTracks().forEach(function(e){var t;t=s.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(t){return t.track&&t.track.id===e.id}):{track:e};var i=new Event("track");i.track=e,i.receiver=t,i.transceiver={receiver:t},i.streams=[n.stream],r.dispatchEvent(i)})},this.addEventListener("addstream",this.C)),t.apply(this,arguments)}}},i.shimGetSendersWithDtmf=function(t){if("object"===(void 0===t?"undefined":a(t))&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){var n=function(t,e){return{track:e,get dtmf(){return void 0===this.x&&("audio"===e.kind?this.x=t.createDTMFSender(e):this.x=null),this.x},P:t}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this.D=this.D||[],this.D.slice()};var r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(t,e){var i=r.apply(this,arguments);return i||(i=n(this,t),this.D.push(i)),i};var i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(t){i.apply(this,arguments);var e=this.D.indexOf(t);-1!==e&&this.D.splice(e,1)}}var s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(t){var e=this;this.D=this.D||[],s.apply(this,[t]),t.getTracks().forEach(function(t){e.D.push(n(e,t))})};var e=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(t){var i=this;this.D=this.D||[],e.apply(this,[t]),t.getTracks().forEach(function(e){var t=i.D.find(function(t){return t.track===e});t&&i.D.splice(i.D.indexOf(t),1)})}}else if("object"===(void 0===t?"undefined":a(t))&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){var o=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=o.apply(this,[]);return t.forEach(function(t){return t.P=e}),t},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this.x&&("audio"===this.track.kind?this.x=this.P.createDTMFSender(this.track):this.x=null),this.x}})}},i.shimGetStats=function(t){if(t.RTCPeerConnection){var a=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){var i=this,t=Array.prototype.slice.call(arguments),e=t[0],n=t[1],r=t[2];if(0<arguments.length&&"function"==typeof e)return a.apply(this,arguments);if(0===a.length&&(0===arguments.length||"function"!=typeof e))return a.apply(this,[]);function s(t){var n={};return t.result().forEach(function(e){var i={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){i[t]=e.stat(t)}),n[i.id]=i}),n}function o(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))}if(2<=arguments.length){return a.apply(this,[function(t){n(o(s(t)))},e])}return new Promise(function(e,t){a.apply(i,[function(t){e(o(s(t)))},t])}).then(n,r)}}},i.shimSenderReceiverGetStats=function(t){if("object"===(void 0===t?"undefined":a(t))&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver){if(!("getStats"in t.RTCRtpSender.prototype)){var i=t.RTCPeerConnection.prototype.getSenders;i&&(t.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=i.apply(this,[]);return t.forEach(function(t){return t.P=e}),t});var e=t.RTCPeerConnection.prototype.addTrack;e&&(t.RTCPeerConnection.prototype.addTrack=function(){var t=e.apply(this,arguments);return t.P=this,t}),t.RTCRtpSender.prototype.getStats=function(){var e=this;return this.P.getStats().then(function(t){return h.filterStats(t,e.track,!0)})}}if(!("getStats"in t.RTCRtpReceiver.prototype)){var n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=n.apply(this,[]);return t.forEach(function(t){return t.P=e}),t}),h.wrapPeerConnectionEvent(t,"track",function(t){return t.receiver.P=t.srcElement,t}),t.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this.P.getStats().then(function(t){return h.filterStats(t,e.track,!1)})}}if("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype){var s=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(0<arguments.length&&arguments[0]instanceof t.MediaStreamTrack){var e=arguments[0],i=void 0,n=void 0,r=void 0;return this.getSenders().forEach(function(t){t.track===e&&(i?r=!0:i=t)}),this.getReceivers().forEach(function(t){return t.track===e&&(n?r=!0:n=t),t.track===e}),r||i&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return s.apply(this,arguments)}}}},i.shimAddTrackRemoveTrackWithNative=c,i.shimAddTrackRemoveTrack=function(o){function r(n,t){var r=t.sdp;return Object.keys(n.O||[]).forEach(function(t){var e=n.O[t],i=n.A[e.id];r=r.replace(new RegExp(i.id,"g"),e.id)}),new RTCSessionDescription({type:t.type,sdp:r})}if(o.RTCPeerConnection){var t=h.detectBrowser(o);if(o.RTCPeerConnection.prototype.addTrack&&65<=t.version)return c(o);var i=o.RTCPeerConnection.prototype.getLocalStreams;o.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=i.apply(this);return this.O=this.O||{},t.map(function(t){return e.O[t.id]})};var n=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(t){var i=this;if(this.A=this.A||{},this.O=this.O||{},t.getTracks().forEach(function(e){if(i.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this.O[t.id]){var e=new o.MediaStream(t.getTracks());this.A[t.id]=e,this.O[e.id]=t,t=e}n.apply(this,[t])};var e=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(t){this.A=this.A||{},this.O=this.O||{},e.apply(this,[this.A[t.id]||t]),delete this.O[this.A[t.id]?this.A[t.id].id:t.id],delete this.A[t.id]},o.RTCPeerConnection.prototype.addTrack=function(e,t){var i=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find(function(t){return t===e}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError");this.A=this.A||{},this.O=this.O||{};var r=this.A[t.id];if(r)r.addTrack(e),Promise.resolve().then(function(){i.dispatchEvent(new Event("negotiationneeded"))});else{var s=new o.MediaStream([e]);this.A[t.id]=s,this.O[s.id]=t,this.addStream(s)}return this.getSenders().find(function(t){return t.track===e})},["createOffer","createAnswer"].forEach(function(t){var e=o.RTCPeerConnection.prototype[t],i=u({},t,function(){var i=this,n=arguments;return arguments.length&&"function"==typeof arguments[0]?e.apply(this,[function(t){var e=r(i,t);n[0].apply(null,[e])},function(t){n[1]&&n[1].apply(null,t)},arguments[2]]):e.apply(this,arguments).then(function(t){return r(i,t)})});o.RTCPeerConnection.prototype[t]=i[t]});var s=o.RTCPeerConnection.prototype.setLocalDescription;o.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type&&(arguments[0]=(n=this,r=(t=t=arguments[0]).sdp,Object.keys(n.O||[]).forEach(function(t){var e=n.O[t],i=n.A[e.id];r=r.replace(new RegExp(e.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r}))),s.apply(this,arguments);var n,t,r};var a=Object.getOwnPropertyDescriptor(o.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(o.RTCPeerConnection.prototype,"localDescription",{get:function(){var t=a.get.apply(this);return""===t.type?t:r(this,t)}}),o.RTCPeerConnection.prototype.removeTrack=function(e){var i=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e.P)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e.P!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this.A=this.A||{};var n=void 0;Object.keys(this.A).forEach(function(t){i.A[t].getTracks().find(function(t){return e.track===t})&&(n=i.A[t])}),n&&(1===n.getTracks().length?this.removeStream(this.O[n.id]):n.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}},i.shimPeerConnection=function(n){var t=h.detectBrowser(n);if(!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection){var e=0===n.RTCPeerConnection.prototype.addIceCandidate.length;t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var e=n.RTCPeerConnection.prototype[t],i=u({},t,function(){return arguments[0]=new("addIceCandidate"===t?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),e.apply(this,arguments)});n.RTCPeerConnection.prototype[t]=i[t]});var i=n.RTCPeerConnection.prototype.addIceCandidate;n.RTCPeerConnection.prototype.addIceCandidate=function(){return e||arguments[0]?t.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},i.fixNegotiationNeeded=function(t){var i=h.detectBrowser(t);h.wrapPeerConnectionEvent(t,"negotiationneeded",function(t){var e=t.target;if(!(i.version<72||e.getConfiguration&&"plan-b"===e.getConfiguration().sdpSemantics)||"stable"===e.signalingState)return t})};var h=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(t("../utils.js"))},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=function(s,t){if(!(s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices)&&s.navigator.mediaDevices)return"function"!=typeof t?void console.error("shimGetDisplayMedia: getSourceId argument is not a function"):void(s.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(function(t){var e=r.video&&r.video.width,i=r.video&&r.video.height,n=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:n||3}},e&&(r.video.mandatory.maxWidth=e),i&&(r.video.mandatory.maxHeight=i),s.navigator.mediaDevices.getUserMedia(r)})})}},{}],5:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};i.shimGetUserMedia=function(t){var o=t&&t.navigator;if(o.mediaDevices){var a=s.detectBrowser(t),u=function(r){if("object"!==(void 0===r?"undefined":c(r))||r.mandatory||r.optional)return r;var s={};return Object.keys(r).forEach(function(e){if("require"!==e&&"advanced"!==e&&"mediaSource"!==e){var i="object"===c(r[e])?r[e]:{ideal:r[e]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var n=function(t,e){return t?t+e.charAt(0).toUpperCase()+e.slice(1):"deviceId"===e?"sourceId":e};if(void 0!==i.ideal){s.optional=s.optional||[];var t={};"number"==typeof i.ideal?(t[n("min",e)]=i.ideal,s.optional.push(t),(t={})[n("max",e)]=i.ideal):t[n("",e)]=i.ideal,s.optional.push(t)}void 0!==i.exact&&"number"!=typeof i.exact?(s.mandatory=s.mandatory||{},s.mandatory[n("",e)]=i.exact):["min","max"].forEach(function(t){void 0!==i[t]&&(s.mandatory=s.mandatory||{},s.mandatory[n(t,e)]=i[t])})}}),r.advanced&&(s.optional=(s.optional||[]).concat(r.advanced)),s},n=function(i,n){if(61<=a.version)return n(i);if((i=JSON.parse(JSON.stringify(i)))&&"object"===c(i.audio)){var t=function(t,e,i){e in t&&!(i in t)&&(t[i]=t[e],delete t[e])};t((i=JSON.parse(JSON.stringify(i))).audio,"autoGainControl","googAutoGainControl"),t(i.audio,"noiseSuppression","googNoiseSuppression"),i.audio=u(i.audio)}if(i&&"object"===c(i.video)){var r=i.video.facingMode;r=r&&("object"===(void 0===r?"undefined":c(r))?r:{ideal:r});var e=a.version<66;if(r&&("user"===r.exact||"environment"===r.exact||"user"===r.ideal||"environment"===r.ideal)&&(!o.mediaDevices.getSupportedConstraints||!o.mediaDevices.getSupportedConstraints().facingMode||e)){delete i.video.facingMode;var s=void 0;if("environment"===r.exact||"environment"===r.ideal?s=["back","rear"]:"user"!==r.exact&&"user"!==r.ideal||(s=["front"]),s)return o.mediaDevices.enumerateDevices().then(function(t){var e=(t=t.filter(function(t){return"videoinput"===t.kind})).find(function(e){return s.some(function(t){return e.label.toLowerCase().includes(t)})});return!e&&t.length&&s.includes("back")&&(e=t[t.length-1]),e&&(i.video.deviceId=r.exact?{exact:e.deviceId}:{ideal:e.deviceId}),i.video=u(i.video),h("chrome: "+JSON.stringify(i)),n(i)})}i.video=u(i.video)}return h("chrome: "+JSON.stringify(i)),n(i)},r=function(t){return 64<=a.version?t:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[t.name]||t.name,message:t.message,constraint:t.constraint||t.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(o.getUserMedia=function(t,e,i){n(t,function(t){o.webkitGetUserMedia(t,e,function(t){i&&i(r(t))})})}.bind(o),o.mediaDevices.getUserMedia){var i=o.mediaDevices.getUserMedia.bind(o.mediaDevices);o.mediaDevices.getUserMedia=function(t){return n(t,function(e){return i(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(t){t.stop()}),new DOMException("","NotFoundError");return t},function(t){return Promise.reject(r(t))})})}}}};var s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(t("../utils.js")),h=s.log},{"../utils.js":15}],6:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};i.shimRTCIceCandidate=function(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var r=e.RTCIceCandidate;e.RTCIceCandidate=function(t){if("object"===(void 0===t?"undefined":s(t))&&t.candidate&&0===t.candidate.indexOf("a=")&&((t=JSON.parse(JSON.stringify(t))).candidate=t.candidate.substr(2)),t.candidate&&t.candidate.length){var e=new r(t),i=c.default.parseCandidate(t.candidate),n=Object.assign(e,i);return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new r(t)},e.RTCIceCandidate.prototype=r.prototype,o.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},i.shimMaxMessageSize=function(t){if(t.RTCPeerConnection){var a=o.detectBrowser(t);"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this.q?null:this.q}});var u=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){var t,e;if(this.q=null,"chrome"===a.browser&&76<=a.version&&"plan-b"===this.getConfiguration().sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this.q?null:this.q},enumerable:!0,configurable:!0}),function(t){if(!t||!t.sdp)return!1;var e=c.default.splitSections(t.sdp);return e.shift(),e.some(function(t){var e=c.default.parseMLine(t);return e&&"application"===e.kind&&-1!==e.protocol.indexOf("SCTP")})}(arguments[0])){var i,n=function(t){var e=t.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===e||e.length<2)return-1;var i=parseInt(e[1],10);return i!=i?-1:i}(arguments[0]),r=(t=n,e=65536,"firefox"===a.browser&&(e=a.version<57?-1===t?16384:2147483637:a.version<60?57===a.version?65535:65536:2147483637),e),s=function(t,e){var i=65536;"firefox"===a.browser&&57===a.version&&(i=65535);var n=c.default.matchPrefix(t.sdp,"a=max-message-size:");return 0<n.length?i=parseInt(n[0].substr(19),10):"firefox"===a.browser&&-1!==e&&(i=2147483637),i}(arguments[0],n);i=0===r&&0===s?Number.POSITIVE_INFINITY:0===r||0===s?Math.max(r,s):Math.min(r,s);var o={};Object.defineProperty(o,"maxMessageSize",{get:function(){return i}}),this.q=o}return u.apply(this,arguments)}}},i.shimSendThrowTypeError=function(t){function e(i,n){var r=i.send;i.send=function(){var t=arguments[0],e=t.length||t.size||t.byteLength;if("open"===i.readyState&&n.sctp&&e>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return r.apply(i,arguments)}}if(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype){var i=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){var t=i.apply(this,arguments);return e(t,this),t},o.wrapPeerConnectionEvent(t,"datachannel",function(t){return e(t.channel,t.target),t})}},i.shimConnectionState=function(t){if(t.RTCPeerConnection&&!("connectionState"in t.RTCPeerConnection.prototype)){var i=t.RTCPeerConnection.prototype;Object.defineProperty(i,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(i,"onconnectionstatechange",{get:function(){return this.F||null},set:function(t){this.F&&(this.removeEventListener("connectionstatechange",this.F),delete this.F),t&&this.addEventListener("connectionstatechange",this.F=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(t){var e=i[t];i[t]=function(){return this.U||(this.U=function(t){var e=t.target;if(e.N!==e.connectionState){e.N=e.connectionState;var i=new Event("connectionstatechange",t);e.dispatchEvent(i)}return t},this.addEventListener("iceconnectionstatechange",this.U)),e.apply(this,arguments)}})}},i.removeAllowExtmapMixed=function(t){if(t.RTCPeerConnection){var e=o.detectBrowser(t);if(!("chrome"===e.browser&&71<=e.version||"safari"===e.browser&&605<=e.version)){var i=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(t){return t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")&&(t.sdp=t.sdp.split("\n").filter(function(t){return"a=extmap-allow-mixed"!==t.trim()}).join("\n")),i.apply(this,arguments)}}}};var n,r=t("sdp"),c=(n=r)&&n.__esModule?n:{default:n},o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(t("./utils"))},{"./utils":15,sdp:17}],7:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=i.shimGetUserMedia=void 0;var n=t("./getusermedia");Object.defineProperty(i,"shimGetUserMedia",{enumerable:!0,get:function(){return n.shimGetUserMedia}});var r=t("./getdisplaymedia");Object.defineProperty(i,"shimGetDisplayMedia",{enumerable:!0,get:function(){return r.shimGetDisplayMedia}}),i.shimPeerConnection=function(t){var e=o.detectBrowser(t);if(t.RTCIceGatherer&&(t.RTCIceCandidate||(t.RTCIceCandidate=function(t){return t}),t.RTCSessionDescription||(t.RTCSessionDescription=function(t){return t}),e.version<15025)){var i=Object.getOwnPropertyDescriptor(t.MediaStreamTrack.prototype,"enabled");Object.defineProperty(t.MediaStreamTrack.prototype,"enabled",{set:function(t){i.set.call(this,t);var e=new Event("enabled");e.enabled=t,this.dispatchEvent(e)}})}!t.RTCRtpSender||"dtmf"in t.RTCRtpSender.prototype||Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this.x&&("audio"===this.track.kind?this.x=new t.RTCDtmfSender(this):"video"===this.track.kind&&(this.x=null)),this.x}}),t.RTCDtmfSender&&!t.RTCDTMFSender&&(t.RTCDTMFSender=t.RTCDtmfSender);var n=(0,c.default)(t,e.version);t.RTCPeerConnection=function(t){return t&&t.iceServers&&(t.iceServers=(0,a.filterIceServers)(t.iceServers,e.version),o.log("ICE servers after filtering:",t.iceServers)),new n(t)},t.RTCPeerConnection.prototype=n.prototype},i.shimReplaceTrack=function(t){!t.RTCRtpSender||"replaceTrack"in t.RTCRtpSender.prototype||(t.RTCRtpSender.prototype.replaceTrack=t.RTCRtpSender.prototype.setTrack)};var s,o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(t("../utils")),a=t("./filtericeservers"),u=t("rtcpeerconnection-shim"),c=(s=u)&&s.__esModule?s:{default:s}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.filterIceServers=function(t,e){var n=!1;return(t=JSON.parse(JSON.stringify(t))).filter(function(t){if(t&&(t.urls||t.url)){var e=t.urls||t.url;t.url&&!t.urls&&r.deprecated("RTCIceServer.url","RTCIceServer.urls");var i="string"==typeof e;return i&&(e=[e]),e=e.filter(function(t){if(0===t.indexOf("stun:"))return!1;var e=t.startsWith("turn")&&!t.startsWith("turn:[")&&t.includes("transport=udp");return e&&!n?n=!0:e&&!n}),delete t.url,t.urls=i?e[0]:e,!!e.length}})};var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(t("../utils"))},{"../utils":15}],9:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=function(t){"getDisplayMedia"in t.navigator&&t.navigator.mediaDevices&&(t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||(t.navigator.mediaDevices.getDisplayMedia=t.navigator.getDisplayMedia.bind(t.navigator)))}},{}],10:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetUserMedia=function(t){var e=t&&t.navigator,i=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(t){return i(t).catch(function(t){return Promise.reject({name:{PermissionDeniedError:"NotAllowedError"}[(e=t).name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}});var e})}}},{}],11:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=i.shimGetUserMedia=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=t("./getusermedia");Object.defineProperty(i,"shimGetUserMedia",{enumerable:!0,get:function(){return r.shimGetUserMedia}});var s=t("./getdisplaymedia");Object.defineProperty(i,"shimGetDisplayMedia",{enumerable:!0,get:function(){return s.shimGetDisplayMedia}}),i.shimOnTrack=function(t){"object"===(void 0===t?"undefined":n(t))&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},i.shimPeerConnection=function(o){var r=u.detectBrowser(o);if("object"===(void 0===o?"undefined":n(o))&&(o.RTCPeerConnection||o.mozRTCPeerConnection)){if(!o.RTCPeerConnection&&o.mozRTCPeerConnection&&(o.RTCPeerConnection=o.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var e,i,n,r=o.RTCPeerConnection.prototype[t],s=(n=function(){return arguments[0]=new("addIceCandidate"===t?o.RTCIceCandidate:o.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)},(i=t)in(e={})?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n,e);o.RTCPeerConnection.prototype[t]=s[t]}),r.version<68){var t=o.RTCPeerConnection.prototype.addIceCandidate;o.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}var s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){var t=Array.prototype.slice.call(arguments),e=t[0],n=t[1],i=t[2];return a.apply(this,[e||null]).then(function(i){if(r.version<53&&!n)try{i.forEach(function(t){t.type=s[t.type]||t.type})}catch(t){if("TypeError"!==t.name)throw t;i.forEach(function(t,e){i.set(e,Object.assign({},t,{type:s[t.type]||t.type}))})}return i}).then(n,i)}}},i.shimSenderGetStats=function(t){if("object"===(void 0===t?"undefined":n(t))&&t.RTCPeerConnection&&t.RTCRtpSender&&!(t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)){var i=t.RTCPeerConnection.prototype.getSenders;i&&(t.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=i.apply(this,[]);return t.forEach(function(t){return t.P=e}),t});var e=t.RTCPeerConnection.prototype.addTrack;e&&(t.RTCPeerConnection.prototype.addTrack=function(){var t=e.apply(this,arguments);return t.P=this,t}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this.P.getStats(this.track):Promise.resolve(new Map)}}},i.shimReceiverGetStats=function(t){if("object"===(void 0===t?"undefined":n(t))&&t.RTCPeerConnection&&t.RTCRtpSender&&!(t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)){var i=t.RTCPeerConnection.prototype.getReceivers;i&&(t.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=i.apply(this,[]);return t.forEach(function(t){return t.P=e}),t}),u.wrapPeerConnectionEvent(t,"track",function(t){return t.receiver.P=t.srcElement,t}),t.RTCRtpReceiver.prototype.getStats=function(){return this.P.getStats(this.track)}}},i.shimRemoveStream=function(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){var i=this;u.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(t){t.track&&e.getTracks().includes(t.track)&&i.removeTrack(t)})})},i.shimRTCDataChannel=function(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)},i.shimAddTransceiver=function(t){if("object"===(void 0===t?"undefined":n(t))&&t.RTCPeerConnection){var s=t.RTCPeerConnection.prototype.addTransceiver;s&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var t=arguments[1],e=t&&"sendEncodings"in t;e&&t.sendEncodings.forEach(function(t){if("rid"in t){if(!/^[a-z0-9]{0,16}$/i.test(t.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in t&&!(1<=parseFloat(t.scaleResolutionDownBy)))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in t&&!(0<=parseFloat(t.maxFramerate)))throw new RangeError("max_framerate must be >= 0.0")});var i=s.apply(this,arguments);if(e){var n=i.sender,r=n.getParameters();"encodings"in r||(r.encodings=t.sendEncodings,n.sendEncodings=t.sendEncodings,this.setParametersPromises.push(n.setParameters(r).then(function(){delete n.sendEncodings}).catch(function(){delete n.sendEncodings})))}return i})}},i.shimGetParameters=function(t){if("object"===(void 0===t?"undefined":n(t))&&t.RTCRtpSender){var e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){var t=e.apply(this,arguments);return"sendEncodings"in this?Object.assign({},{encodings:this.sendEncodings},t):t})}},i.shimCreateOffer=function(t){if("object"===(void 0===t?"undefined":n(t))&&t.RTCPeerConnection){var i=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){var t=this,e=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return i.apply(t,e)}).finally(function(){t.setParametersPromises=[]}):i.apply(this,arguments)}}},i.shimCreateAnswer=function(t){if("object"===(void 0===t?"undefined":n(t))&&t.RTCPeerConnection){var i=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){var t=this,e=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return i.apply(t,e)}).finally(function(){t.setParametersPromises=[]}):i.apply(this,arguments)}}};var u=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(t("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=function(i,n){i.navigator.mediaDevices&&"getDisplayMedia"in i.navigator.mediaDevices||i.navigator.mediaDevices&&(i.navigator.mediaDevices.getDisplayMedia=function(t){if(t&&t.video)return!0===t.video?t.video={mediaSource:n}:t.video.mediaSource=n,i.navigator.mediaDevices.getUserMedia(t);var e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)})}},{}],13:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};i.shimGetUserMedia=function(t){var e=c.detectBrowser(t),n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(t,e,i){c.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(t).then(e,i)},!(55<e.version&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var r=function(t,e,i){e in t&&!(i in t)&&(t[i]=t[e],delete t[e])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(t){return"object"===(void 0===t?"undefined":u(t))&&"object"===u(t.audio)&&(t=JSON.parse(JSON.stringify(t)),r(t.audio,"autoGainControl","mozAutoGainControl"),r(t.audio,"noiseSuppression","mozNoiseSuppression")),s(t)},i&&i.prototype.getSettings){var o=i.prototype.getSettings;i.prototype.getSettings=function(){var t=o.apply(this,arguments);return r(t,"mozAutoGainControl","autoGainControl"),r(t,"mozNoiseSuppression","noiseSuppression"),t}}if(i&&i.prototype.applyConstraints){var a=i.prototype.applyConstraints;i.prototype.applyConstraints=function(t){return"audio"===this.kind&&"object"===(void 0===t?"undefined":u(t))&&(t=JSON.parse(JSON.stringify(t)),r(t,"autoGainControl","mozAutoGainControl"),r(t,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[t])}}}};var c=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(t("../utils"))},{"../utils":15}],14:[function(t,e,i){"use strict";function r(t){return t&&void 0!==t.video?Object.assign({},t,{video:o.compactObject(t.video)}):t}Object.defineProperty(i,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};i.shimLocalStreamsAPI=function(t){if("object"===(void 0===t?"undefined":n(t))&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this.j||(this.j=[]),this.j}),!("addStream"in t.RTCPeerConnection.prototype)){var s=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(e){var i=this;this.j||(this.j=[]),this.j.includes(e)||this.j.push(e),e.getAudioTracks().forEach(function(t){return s.call(i,t,e)}),e.getVideoTracks().forEach(function(t){return s.call(i,t,e)})},t.RTCPeerConnection.prototype.addTrack=function(t){for(var e=this,i=arguments.length,n=Array(1<i?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return n&&n.forEach(function(t){e.j?e.j.includes(t)||e.j.push(t):e.j=[t]}),s.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(t){var e=this;this.j||(this.j=[]);var i=this.j.indexOf(t);if(-1!==i){this.j.splice(i,1);var n=t.getTracks();this.getSenders().forEach(function(t){n.includes(t.track)&&e.removeTrack(t)})}})}},i.shimRemoteStreamsAPI=function(t){if("object"===(void 0===t?"undefined":n(t))&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this.L?this.L:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this.B},set:function(t){var i=this;this.B&&(this.removeEventListener("addstream",this.B),this.removeEventListener("track",this.z)),this.addEventListener("addstream",this.B=t),this.addEventListener("track",this.z=function(t){t.streams.forEach(function(t){if(i.L||(i.L=[]),!i.L.includes(t)){i.L.push(t);var e=new Event("addstream");e.stream=t,i.dispatchEvent(e)}})})}});var e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){var i=this;return this.z||this.addEventListener("track",this.z=function(t){t.streams.forEach(function(t){if(i.L||(i.L=[]),!(0<=i.L.indexOf(t))){i.L.push(t);var e=new Event("addstream");e.stream=t,i.dispatchEvent(e)}})}),e.apply(i,arguments)}}},i.shimCallbacksAPI=function(t){if("object"===(void 0===t?"undefined":n(t))&&t.RTCPeerConnection){var e=t.RTCPeerConnection.prototype,r=e.createOffer,s=e.createAnswer,o=e.setLocalDescription,a=e.setRemoteDescription,u=e.addIceCandidate;e.createOffer=function(t,e){var i=2<=arguments.length?arguments[2]:t,n=r.apply(this,[i]);return e?(n.then(t,e),Promise.resolve()):n},e.createAnswer=function(t,e){var i=2<=arguments.length?arguments[2]:t,n=s.apply(this,[i]);return e?(n.then(t,e),Promise.resolve()):n};var i=function(t,e,i){var n=o.apply(this,[t]);return i?(n.then(e,i),Promise.resolve()):n};e.setLocalDescription=i,i=function(t,e,i){var n=a.apply(this,[t]);return i?(n.then(e,i),Promise.resolve()):n},e.setRemoteDescription=i,i=function(t,e,i){var n=u.apply(this,[t]);return i?(n.then(e,i),Promise.resolve()):n},e.addIceCandidate=i}},i.shimGetUserMedia=function(t){var n=t&&t.navigator;if(n.mediaDevices&&n.mediaDevices.getUserMedia){var e=n.mediaDevices,i=e.getUserMedia.bind(e);n.mediaDevices.getUserMedia=function(t){return i(r(t))}}!n.getUserMedia&&n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=function(t,e,i){n.mediaDevices.getUserMedia(t).then(e,i)}.bind(n))},i.shimConstraints=r,i.shimRTCIceServerUrls=function(t){if(t.RTCPeerConnection){var s=t.RTCPeerConnection;t.RTCPeerConnection=function(t,e){if(t&&t.iceServers){for(var i=[],n=0;n<t.iceServers.length;n++){var r=t.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(o.deprecated("RTCIceServer.url","RTCIceServer.urls"),(r=JSON.parse(JSON.stringify(r))).urls=r.url,delete r.url,i.push(r)):i.push(t.iceServers[n])}t.iceServers=i}return new s(t,e)},t.RTCPeerConnection.prototype=s.prototype,"generateCertificate"in s&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:function(){return s.generateCertificate}})}},i.shimTrackEventTransceiver=function(t){"object"===(void 0===t?"undefined":n(t))&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},i.shimCreateOfferLegacy=function(t){var n=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(t){if(t){void 0!==t.offerToReceiveAudio&&(t.offerToReceiveAudio=!!t.offerToReceiveAudio);var e=this.getTransceivers().find(function(t){return"audio"===t.receiver.track.kind});!1===t.offerToReceiveAudio&&e?"sendrecv"===e.direction?e.setDirection?e.setDirection("sendonly"):e.direction="sendonly":"recvonly"===e.direction&&(e.setDirection?e.setDirection("inactive"):e.direction="inactive"):!0!==t.offerToReceiveAudio||e||this.addTransceiver("audio"),void 0!==t.offerToReceiveVideo&&(t.offerToReceiveVideo=!!t.offerToReceiveVideo);var i=this.getTransceivers().find(function(t){return"video"===t.receiver.track.kind});!1===t.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0!==t.offerToReceiveVideo||i||this.addTransceiver("video")}return n.apply(this,arguments)}},i.shimAudioContext=function(t){"object"!==(void 0===t?"undefined":n(t))||t.AudioContext||(t.AudioContext=t.webkitAudioContext)};var o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(t("../utils"))},{"../utils":15}],15:[function(t,e,i){"use strict";function n(t,e,i){var n=t.match(e);return n&&n.length>=i&&parseInt(n[i],10)}function h(t){return"[object Object]"===Object.prototype.toString.call(t)}function o(e,i,n){i&&!n.has(i.id)&&(n.set(i.id,i),Object.keys(i).forEach(function(t){t.endsWith("Id")?o(e,e.get(i[t]),n):t.endsWith("Ids")&&i[t].forEach(function(t){o(e,e.get(t),n)})}))}Object.defineProperty(i,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};i.extractVersion=n,i.wrapPeerConnectionEvent=function(t,n,r){if(t.RTCPeerConnection){var e=t.RTCPeerConnection.prototype,s=e.addEventListener;e.addEventListener=function(t,i){if(t!==n)return s.apply(this,arguments);function e(t){var e=r(t);e&&(i.handleEvent?i.handleEvent(e):i(e))}return this.W=this.W||{},this.W[n]||(this.W[n]=new Map),this.W[n].set(i,e),s.apply(this,[t,e])};var o=e.removeEventListener;e.removeEventListener=function(t,e){if(t!==n||!this.W||!this.W[n])return o.apply(this,arguments);if(!this.W[n].has(e))return o.apply(this,arguments);var i=this.W[n].get(e);return this.W[n].delete(e),0===this.W[n].size&&delete this.W[n],0===Object.keys(this.W).length&&delete this.W,o.apply(this,[t,i])},Object.defineProperty(e,"on"+n,{get:function(){return this["_on"+n]},set:function(t){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),t&&this.addEventListener(n,this["_on"+n]=t)},enumerable:!0,configurable:!0})}},i.disableLog=function(t){return"boolean"!=typeof t?new Error("Argument type: "+(void 0===t?"undefined":r(t))+". Please use a boolean."):(s=t)?"adapter.js logging disabled":"adapter.js logging enabled"},i.disableWarnings=function(t){return"boolean"!=typeof t?new Error("Argument type: "+(void 0===t?"undefined":r(t))+". Please use a boolean."):(a=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))},i.log=function(){if("object"===("undefined"==typeof window?"undefined":r(window))){if(s)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},i.deprecated=function(t,e){a&&console.warn(t+" is deprecated, please use "+e+" instead.")},i.detectBrowser=function(t){var e=t.navigator,i={browser:null,version:null};if(void 0===t||!t.navigator)return i.browser="Not a browser.",i;if(e.mozGetUserMedia)i.browser="firefox",i.version=n(e.userAgent,/Firefox\/(\d+)\./,1);else if(e.webkitGetUserMedia||!1===t.isSecureContext&&t.webkitRTCPeerConnection&&!t.RTCIceGatherer)i.browser="chrome",i.version=n(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.mediaDevices&&e.userAgent.match(/Edge\/(\d+).(\d+)$/))i.browser="edge",i.version=n(e.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.RTCPeerConnection||!e.userAgent.match(/AppleWebKit\/(\d+)\./))return i.browser="Not a supported browser.",i;i.browser="safari",i.version=n(e.userAgent,/AppleWebKit\/(\d+)\./,1),i.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype}return i},i.compactObject=function u(c){return h(c)?Object.keys(c).reduce(function(t,e){var i,n,r,s=h(c[e]),o=s?u(c[e]):c[e],a=s&&!Object.keys(o).length;return void 0===o||a?t:Object.assign(t,(r=o,(n=e)in(i={})?Object.defineProperty(i,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[n]=r,i))},{}):c},i.walkStats=o,i.filterStats=function(i,e,t){var n=t?"outbound-rtp":"inbound-rtp",r=new Map;if(null===e)return r;var s=[];return i.forEach(function(t){"track"===t.type&&t.trackIdentifier===e.id&&s.push(t)}),s.forEach(function(e){i.forEach(function(t){t.type===n&&t.trackId===e.id&&o(i,t,r)})}),r};var s=!0,a=!0},{}],16:[function(t,e,i){"use strict";function u(t,e,i,n,r){var s=j.writeRtpDescription(t.kind,e);if(s+=j.writeIceParameters(t.iceGatherer.getLocalParameters()),s+=j.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":r||"active"),s+="a=mid:"+t.mid+"\r\n",s+=t.rtpSender&&t.rtpReceiver?"a=sendrecv\r\n":t.rtpSender?"a=sendonly\r\n":t.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",t.rtpSender){var o=t.rtpSender.V||t.rtpSender.track.id;t.rtpSender.V=o;var a="msid:"+(n?n.id:"-")+" "+o+"\r\n";s+="a="+a,s+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+a,t.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+a,s+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+j.localCName+"\r\n",t.rtpSender&&t.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+j.localCName+"\r\n"),s}function U(c,h){function f(t,e){t=parseInt(t,10);for(var i=0;i<e.length;i++)if(e[i].payloadType===t||e[i].preferredPayloadType===t)return e[i]}var d={codecs:[],headerExtensions:[],fecMechanisms:[]};return c.codecs.forEach(function(i){for(var t=0;t<h.codecs.length;t++){var e=h.codecs[t];if(i.name.toLowerCase()===e.name.toLowerCase()&&i.clockRate===e.clockRate){if("rtx"===i.name.toLowerCase()&&i.parameters&&e.parameters.apt&&(n=i,r=e,s=c.codecs,o=h.codecs,u=a=void 0,a=f(n.parameters.apt,s),u=f(r.parameters.apt,o),!a||!u||a.name.toLowerCase()!==u.name.toLowerCase()))continue;(e=JSON.parse(JSON.stringify(e))).numChannels=Math.min(i.numChannels,e.numChannels),d.codecs.push(e),e.rtcpFeedback=e.rtcpFeedback.filter(function(t){for(var e=0;e<i.rtcpFeedback.length;e++)if(i.rtcpFeedback[e].type===t.type&&i.rtcpFeedback[e].parameter===t.parameter)return!0;return!1});break}}var n,r,s,o,a,u}),c.headerExtensions.forEach(function(t){for(var e=0;e<h.headerExtensions.length;e++){var i=h.headerExtensions[e];if(t.uri===i.uri){d.headerExtensions.push(i);break}}}),d}function s(t,e,i){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[e][t].indexOf(i)}function N(t,e){var i=t.getRemoteCandidates().find(function(t){return e.foundation===t.foundation&&e.ip===t.ip&&e.port===t.port&&e.priority===t.priority&&e.protocol===t.protocol&&e.type===t.type});return i||t.addRemoteCandidate(e),!i}function m(t,e){var i=new Error(e);return i.name=t,i.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[t],i}var j=t("sdp");e.exports=function(A,q){function F(t,e){e.addTrack(t),e.dispatchEvent(new A.MediaStreamTrackEvent("addtrack",{track:t}))}function r(t,e,i,n){var r=new Event("track");r.track=e,r.receiver=i,r.transceiver={receiver:i},r.streams=n,A.setTimeout(function(){t.H("track",r)})}function n(t){var e,n,r,i=this,s=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(t){i[t]=s[t].bind(s)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.G=null,this.K=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",t=JSON.parse(JSON.stringify(t||{})),this.usingBundle="max-bundle"===t.bundlePolicy,"negotiate"===t.rtcpMuxPolicy)throw m("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(t.rtcpMuxPolicy||(t.rtcpMuxPolicy="require"),t.iceTransportPolicy){case"all":case"relay":break;default:t.iceTransportPolicy="all"}switch(t.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:t.bundlePolicy="balanced"}if(t.iceServers=(e=t.iceServers||[],n=q,r=!1,(e=JSON.parse(JSON.stringify(e))).filter(function(t){if(t&&(t.urls||t.url)){var e=t.urls||t.url;t.url&&!t.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof e;return i&&(e=[e]),e=e.filter(function(t){return 0!==t.indexOf("turn:")||-1===t.indexOf("transport=udp")||-1!==t.indexOf("turn:[")||r?0===t.indexOf("stun:")&&14393<=n&&-1===t.indexOf("?transport=udp"):r=!0}),delete t.url,t.urls=i?e[0]:e,!!e.length}})),this.J=[],t.iceCandidatePoolSize)for(var o=t.iceCandidatePoolSize;0<o;o--)this.J.push(new A.RTCIceGatherer({iceServers:t.iceServers,gatherPolicy:t.iceTransportPolicy}));else t.iceCandidatePoolSize=0;this.X=t,this.transceivers=[],this.Q=j.generateSessionId(),this.$=0,this.Y=void 0,this.Z=!1}Object.defineProperty(n.prototype,"localDescription",{configurable:!0,get:function(){return this.G}}),Object.defineProperty(n.prototype,"remoteDescription",{configurable:!0,get:function(){return this.K}}),n.prototype.onicecandidate=null,n.prototype.onaddstream=null,n.prototype.ontrack=null,n.prototype.onremovestream=null,n.prototype.onsignalingstatechange=null,n.prototype.oniceconnectionstatechange=null,n.prototype.onconnectionstatechange=null,n.prototype.onicegatheringstatechange=null,n.prototype.onnegotiationneeded=null,n.prototype.ondatachannel=null,n.prototype.H=function(t,e){this.Z||(this.dispatchEvent(e),"function"==typeof this["on"+t]&&this["on"+t](e))},n.prototype.tt=function(){var t=new Event("icegatheringstatechange");this.H("icegatheringstatechange",t)},n.prototype.getConfiguration=function(){return this.X},n.prototype.getLocalStreams=function(){return this.localStreams},n.prototype.getRemoteStreams=function(){return this.remoteStreams},n.prototype.et=function(t,e){var i=0<this.transceivers.length,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:t,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&i)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var r=this.it();n.iceTransport=r.iceTransport,n.dtlsTransport=r.dtlsTransport}return e||this.transceivers.push(n),n},n.prototype.addTrack=function(e,t){if(this.Z)throw m("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(t){return t.track===e}))throw m("InvalidAccessError","Track already exists.");for(var i,n=0;n<this.transceivers.length;n++)this.transceivers[n].track||this.transceivers[n].kind!==e.kind||(i=this.transceivers[n]);return i=i||this.et(e.kind),this.nt(),-1===this.localStreams.indexOf(t)&&this.localStreams.push(t),i.track=e,i.stream=t,i.rtpSender=new A.RTCRtpSender(e,i.dtlsTransport),i.rtpSender},n.prototype.addStream=function(e){var i=this;if(15025<=q)e.getTracks().forEach(function(t){i.addTrack(t,e)});else{var n=e.clone();e.getTracks().forEach(function(t,e){var i=n.getTracks()[e];t.addEventListener("enabled",function(t){i.enabled=t.enabled})}),n.getTracks().forEach(function(t){i.addTrack(t,n)})}},n.prototype.removeTrack=function(e){if(this.Z)throw m("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(e instanceof A.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var t=this.transceivers.find(function(t){return t.rtpSender===e});if(!t)throw m("InvalidAccessError","Sender was not created by this connection.");var i=t.stream;t.rtpSender.stop(),t.rtpSender=null,t.track=null,t.stream=null,-1===this.transceivers.map(function(t){return t.stream}).indexOf(i)&&-1<this.localStreams.indexOf(i)&&this.localStreams.splice(this.localStreams.indexOf(i),1),this.nt()},n.prototype.removeStream=function(t){var i=this;t.getTracks().forEach(function(e){var t=i.getSenders().find(function(t){return t.track===e});t&&i.removeTrack(t)})},n.prototype.getSenders=function(){return this.transceivers.filter(function(t){return!!t.rtpSender}).map(function(t){return t.rtpSender})},n.prototype.getReceivers=function(){return this.transceivers.filter(function(t){return!!t.rtpReceiver}).map(function(t){return t.rtpReceiver})},n.prototype.rt=function(i,t){var n=this;if(t&&0<i)return this.transceivers[0].iceGatherer;if(this.J.length)return this.J.shift();var r=new A.RTCIceGatherer({iceServers:this.X.iceServers,gatherPolicy:this.X.iceTransportPolicy});return Object.defineProperty(r,"state",{value:"new",writable:!0}),this.transceivers[i].bufferedCandidateEvents=[],this.transceivers[i].bufferCandidates=function(t){var e=!t.candidate||0===Object.keys(t.candidate).length;r.state=e?"completed":"gathering",null!==n.transceivers[i].bufferedCandidateEvents&&n.transceivers[i].bufferedCandidateEvents.push(t)},r.addEventListener("localcandidate",this.transceivers[i].bufferCandidates),r},n.prototype.st=function(a,u){var c=this,h=this.transceivers[u].iceGatherer;if(!h.onlocalcandidate){var t=this.transceivers[u].bufferedCandidateEvents;this.transceivers[u].bufferedCandidateEvents=null,h.removeEventListener("localcandidate",this.transceivers[u].bufferCandidates),h.onlocalcandidate=function(t){if(!(c.usingBundle&&0<u)){var e=new Event("icecandidate");e.candidate={sdpMid:a,sdpMLineIndex:u};var i=t.candidate,n=!i||0===Object.keys(i).length;if(n)"new"!==h.state&&"gathering"!==h.state||(h.state="completed");else{"new"===h.state&&(h.state="gathering"),i.component=1,i.ufrag=h.getLocalParameters().usernameFragment;var r=j.writeCandidate(i);e.candidate=Object.assign(e.candidate,j.parseCandidate(r)),e.candidate.candidate=r,e.candidate.toJSON=function(){return{candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex,usernameFragment:e.candidate.usernameFragment}}}var s=j.getMediaSections(c.G.sdp);s[e.candidate.sdpMLineIndex]+=n?"a=end-of-candidates\r\n":"a="+e.candidate.candidate+"\r\n",c.G.sdp=j.getDescription(c.G.sdp)+s.join("");var o=c.transceivers.every(function(t){return t.iceGatherer&&"completed"===t.iceGatherer.state});"gathering"!==c.iceGatheringState&&(c.iceGatheringState="gathering",c.tt()),n||c.H("icecandidate",e),o&&(c.H("icecandidate",new Event("icecandidate")),c.iceGatheringState="complete",c.tt())}},A.setTimeout(function(){t.forEach(function(t){h.onlocalcandidate(t)})},0)}},n.prototype.it=function(){var t=this,e=new A.RTCIceTransport(null);e.onicestatechange=function(){t.ot(),t.at()};var i=new A.RTCDtlsTransport(e);return i.ondtlsstatechange=function(){t.at()},i.onerror=function(){Object.defineProperty(i,"state",{value:"failed",writable:!0}),t.at()},{iceTransport:e,dtlsTransport:i}},n.prototype.ut=function(t){var e=this.transceivers[t].iceGatherer;e&&(delete e.onlocalcandidate,delete this.transceivers[t].iceGatherer);var i=this.transceivers[t].iceTransport;i&&(delete i.onicestatechange,delete this.transceivers[t].iceTransport);var n=this.transceivers[t].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[t].dtlsTransport)},n.prototype.ct=function(t,e,i){var n=U(t.localCapabilities,t.remoteCapabilities);e&&t.rtpSender&&(n.encodings=t.sendEncodingParameters,n.rtcp={cname:j.localCName,compound:t.rtcpParameters.compound},t.recvEncodingParameters.length&&(n.rtcp.ssrc=t.recvEncodingParameters[0].ssrc),t.rtpSender.send(n)),i&&t.rtpReceiver&&0<n.codecs.length&&("video"===t.kind&&t.recvEncodingParameters&&q<15019&&t.recvEncodingParameters.forEach(function(t){delete t.rtx}),t.recvEncodingParameters.length?n.encodings=t.recvEncodingParameters:n.encodings=[{}],n.rtcp={compound:t.rtcpParameters.compound},t.rtcpParameters.cname&&(n.rtcp.cname=t.rtcpParameters.cname),t.sendEncodingParameters.length&&(n.rtcp.ssrc=t.sendEncodingParameters[0].ssrc),t.rtpReceiver.receive(n))},n.prototype.setLocalDescription=function(t){var e,f,d=this;if(-1===["offer","answer"].indexOf(t.type))return Promise.reject(m("TypeError",'Unsupported type "'+t.type+'"'));if(!s("setLocalDescription",t.type,d.signalingState)||d.Z)return Promise.reject(m("InvalidStateError","Can not set local "+t.type+" in state "+d.signalingState));if("offer"===t.type)e=j.splitSections(t.sdp),f=e.shift(),e.forEach(function(t,e){var i=j.parseRtpParameters(t);d.transceivers[e].localCapabilities=i}),d.transceivers.forEach(function(t,e){d.st(t.mid,e)});else if("answer"===t.type){e=j.splitSections(d.K.sdp),f=e.shift();var l=0<j.matchPrefix(f,"a=ice-lite").length;e.forEach(function(t,e){var i=d.transceivers[e],n=i.iceGatherer,r=i.iceTransport,s=i.dtlsTransport,o=i.localCapabilities,a=i.remoteCapabilities;if(!(j.isRejected(t)&&0===j.matchPrefix(t,"a=bundle-only").length)&&!i.rejected){var u=j.getIceParameters(t,f),c=j.getDtlsParameters(t,f);l&&(c.role="server"),d.usingBundle&&0!==e||(d.st(i.mid,e),"new"===r.state&&r.start(n,u,l?"controlling":"controlled"),"new"===s.state&&s.start(c));var h=U(o,a);d.ct(i,0<h.codecs.length,!1)}})}return d.G={type:t.type,sdp:t.sdp},"offer"===t.type?d.ht("have-local-offer"):d.ht("stable"),Promise.resolve()},n.prototype.setRemoteDescription=function(R){var M=this;if(-1===["offer","answer"].indexOf(R.type))return Promise.reject(m("TypeError",'Unsupported type "'+R.type+'"'));if(!s("setRemoteDescription",R.type,M.signalingState)||M.Z)return Promise.reject(m("InvalidStateError","Can not set remote "+R.type+" in state "+M.signalingState));var C={};M.remoteStreams.forEach(function(t){C[t.id]=t});var x=[],t=j.splitSections(R.sdp),P=t.shift(),D=0<j.matchPrefix(P,"a=ice-lite").length,O=0<j.matchPrefix(P,"a=group:BUNDLE ").length;M.usingBundle=O;var e=j.matchPrefix(P,"a=ice-options:")[0];return M.canTrickleIceCandidates=!!e&&0<=e.substr(14).split(" ").indexOf("trickle"),t.forEach(function(t,e){var i=j.splitLines(t),n=j.getKind(t),r=j.isRejected(t)&&0===j.matchPrefix(t,"a=bundle-only").length,s=i[0].substr(2).split(" ")[2],o=j.getDirection(t,P),a=j.parseMsid(t),u=j.getMid(t)||j.generateIdentifier();if(r||"application"===n&&("DTLS/SCTP"===s||"UDP/DTLS/SCTP"===s))M.transceivers[e]={mid:u,kind:n,protocol:s,rejected:!0};else{!r&&M.transceivers[e]&&M.transceivers[e].rejected&&(M.transceivers[e]=M.et(n,!0));var c,h,f,d,l,m,p,v,g,y,w,b=j.parseRtpParameters(t);r||(y=j.getIceParameters(t,P),(w=j.getDtlsParameters(t,P)).role="client"),p=j.parseRtpEncodingParameters(t);var k=j.parseRtcpParameters(t),S=0<j.matchPrefix(t,"a=end-of-candidates",P).length,E=j.matchPrefix(t,"a=candidate:").map(function(t){return j.parseCandidate(t)}).filter(function(t){return 1===t.component});if(("offer"===R.type||"answer"===R.type)&&!r&&O&&0<e&&M.transceivers[e]&&(M.ut(e),M.transceivers[e].iceGatherer=M.transceivers[0].iceGatherer,M.transceivers[e].iceTransport=M.transceivers[0].iceTransport,M.transceivers[e].dtlsTransport=M.transceivers[0].dtlsTransport,M.transceivers[e].rtpSender&&M.transceivers[e].rtpSender.setTransport(M.transceivers[0].dtlsTransport),M.transceivers[e].rtpReceiver&&M.transceivers[e].rtpReceiver.setTransport(M.transceivers[0].dtlsTransport)),"offer"!==R.type||r){if("answer"===R.type&&!r){h=(c=M.transceivers[e]).iceGatherer,f=c.iceTransport,d=c.dtlsTransport,l=c.rtpReceiver,m=c.sendEncodingParameters,v=c.localCapabilities,M.transceivers[e].recvEncodingParameters=p,M.transceivers[e].remoteCapabilities=b,M.transceivers[e].rtcpParameters=k,E.length&&"new"===f.state&&(!D&&!S||O&&0!==e?E.forEach(function(t){N(c.iceTransport,t)}):f.setRemoteCandidates(E)),O&&0!==e||("new"===f.state&&f.start(h,y,"controlling"),"new"===d.state&&d.start(w)),!U(c.localCapabilities,c.remoteCapabilities).codecs.filter(function(t){return"rtx"===t.name.toLowerCase()}).length&&c.sendEncodingParameters[0].rtx&&delete c.sendEncodingParameters[0].rtx,M.ct(c,"sendrecv"===o||"recvonly"===o,"sendrecv"===o||"sendonly"===o),!l||"sendrecv"!==o&&"sendonly"!==o?delete c.rtpReceiver:(g=l.track,a?(C[a.stream]||(C[a.stream]=new A.MediaStream),F(g,C[a.stream]),x.push([g,l,C[a.stream]])):(C.default||(C.default=new A.MediaStream),F(g,C.default),x.push([g,l,C.default])))}}else{(c=M.transceivers[e]||M.et(n)).mid=u,c.iceGatherer||(c.iceGatherer=M.rt(e,O)),E.length&&"new"===c.iceTransport.state&&(!S||O&&0!==e?E.forEach(function(t){N(c.iceTransport,t)}):c.iceTransport.setRemoteCandidates(E)),v=A.RTCRtpReceiver.getCapabilities(n),q<15019&&(v.codecs=v.codecs.filter(function(t){return"rtx"!==t.name})),m=c.sendEncodingParameters||[{ssrc:1001*(2*e+2)}];var T,I=!1;"sendrecv"===o||"sendonly"===o?(I=!c.rtpReceiver,l=c.rtpReceiver||new A.RTCRtpReceiver(c.dtlsTransport,n),I&&(g=l.track,a&&"-"===a.stream||(T=a?(C[a.stream]||(C[a.stream]=new A.MediaStream,Object.defineProperty(C[a.stream],"id",{get:function(){return a.stream}})),Object.defineProperty(g,"id",{get:function(){return a.track}}),C[a.stream]):(C.default||(C.default=new A.MediaStream),C.default)),T&&(F(g,T),c.associatedRemoteMediaStreams.push(T)),x.push([g,l,T]))):c.rtpReceiver&&c.rtpReceiver.track&&(c.associatedRemoteMediaStreams.forEach(function(t){var e,i,n=t.getTracks().find(function(t){return t.id===c.rtpReceiver.track.id});n&&(e=n,(i=t).removeTrack(e),i.dispatchEvent(new A.MediaStreamTrackEvent("removetrack",{track:e})))}),c.associatedRemoteMediaStreams=[]),c.localCapabilities=v,c.remoteCapabilities=b,c.rtpReceiver=l,c.rtcpParameters=k,c.sendEncodingParameters=m,c.recvEncodingParameters=p,M.ct(M.transceivers[e],!1,I)}}}),void 0===M.Y&&(M.Y="offer"===R.type?"active":"passive"),M.K={type:R.type,sdp:R.sdp},"offer"===R.type?M.ht("have-remote-offer"):M.ht("stable"),Object.keys(C).forEach(function(t){var n=C[t];if(n.getTracks().length){if(-1===M.remoteStreams.indexOf(n)){M.remoteStreams.push(n);var e=new Event("addstream");e.stream=n,A.setTimeout(function(){M.H("addstream",e)})}x.forEach(function(t){var e=t[0],i=t[1];n.id===t[2].id&&r(M,e,i,[n])})}}),x.forEach(function(t){t[2]||r(M,t[0],t[1],[])}),A.setTimeout(function(){M&&M.transceivers&&M.transceivers.forEach(function(t){t.iceTransport&&"new"===t.iceTransport.state&&0<t.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),t.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},n.prototype.close=function(){this.transceivers.forEach(function(t){t.iceTransport&&t.iceTransport.stop(),t.dtlsTransport&&t.dtlsTransport.stop(),t.rtpSender&&t.rtpSender.stop(),t.rtpReceiver&&t.rtpReceiver.stop()}),this.Z=!0,this.ht("closed")},n.prototype.ht=function(t){this.signalingState=t;var e=new Event("signalingstatechange");this.H("signalingstatechange",e)},n.prototype.nt=function(){var e=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,A.setTimeout(function(){if(e.needNegotiation){e.needNegotiation=!1;var t=new Event("negotiationneeded");e.H("negotiationneeded",t)}},0))},n.prototype.ot=function(){var t,e={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(t){t.iceTransport&&!t.rejected&&e[t.iceTransport.state]++}),t="new",0<e.failed?t="failed":0<e.checking?t="checking":0<e.disconnected?t="disconnected":0<e.new?t="new":0<e.connected?t="connected":0<e.completed&&(t="completed"),t!==this.iceConnectionState){this.iceConnectionState=t;var i=new Event("iceconnectionstatechange");this.H("iceconnectionstatechange",i)}},n.prototype.at=function(){var t,e={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(t){t.iceTransport&&t.dtlsTransport&&!t.rejected&&(e[t.iceTransport.state]++,e[t.dtlsTransport.state]++)}),e.connected+=e.completed,t="new",0<e.failed?t="failed":0<e.connecting?t="connecting":0<e.disconnected?t="disconnected":0<e.new?t="new":0<e.connected&&(t="connected"),t!==this.connectionState){this.connectionState=t;var i=new Event("connectionstatechange");this.H("connectionstatechange",i)}},n.prototype.createOffer=function(){var a=this;if(a.Z)return Promise.reject(m("InvalidStateError","Can not call createOffer after close"));var e=a.transceivers.filter(function(t){return"audio"===t.kind}).length,i=a.transceivers.filter(function(t){return"video"===t.kind}).length,t=arguments[0];if(t){if(t.mandatory||t.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==t.offerToReceiveAudio&&(e=!0===t.offerToReceiveAudio?1:!1===t.offerToReceiveAudio?0:t.offerToReceiveAudio),void 0!==t.offerToReceiveVideo&&(i=!0===t.offerToReceiveVideo?1:!1===t.offerToReceiveVideo?0:t.offerToReceiveVideo)}for(a.transceivers.forEach(function(t){"audio"===t.kind?--e<0&&(t.wantReceive=!1):"video"===t.kind&&--i<0&&(t.wantReceive=!1)});0<e||0<i;)0<e&&(a.et("audio"),e--),0<i&&(a.et("video"),i--);var n=j.writeSessionBoilerplate(a.Q,a.$++);a.transceivers.forEach(function(t,e){var i=t.track,n=t.kind,r=t.mid||j.generateIdentifier();t.mid=r,t.iceGatherer||(t.iceGatherer=a.rt(e,a.usingBundle));var s=A.RTCRtpSender.getCapabilities(n);q<15019&&(s.codecs=s.codecs.filter(function(t){return"rtx"!==t.name})),s.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),t.remoteCapabilities&&t.remoteCapabilities.codecs&&t.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),s.headerExtensions.forEach(function(e){(t.remoteCapabilities&&t.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var o=t.sendEncodingParameters||[{ssrc:1001*(2*e+1)}];i&&15019<=q&&"video"===n&&!o[0].rtx&&(o[0].rtx={ssrc:o[0].ssrc+1}),t.wantReceive&&(t.rtpReceiver=new A.RTCRtpReceiver(t.dtlsTransport,n)),t.localCapabilities=s,t.sendEncodingParameters=o}),"max-compat"!==a.X.bundlePolicy&&(n+="a=group:BUNDLE "+a.transceivers.map(function(t){return t.mid}).join(" ")+"\r\n"),n+="a=ice-options:trickle\r\n",a.transceivers.forEach(function(t,e){n+=u(t,t.localCapabilities,"offer",t.stream,a.Y),n+="a=rtcp-rsize\r\n",!t.iceGatherer||"new"===a.iceGatheringState||0!==e&&a.usingBundle||(t.iceGatherer.getLocalCandidates().forEach(function(t){t.component=1,n+="a="+j.writeCandidate(t)+"\r\n"}),"completed"===t.iceGatherer.state&&(n+="a=end-of-candidates\r\n"))});var r=new A.RTCSessionDescription({type:"offer",sdp:n});return Promise.resolve(r)},n.prototype.createAnswer=function(){var r=this;if(r.Z)return Promise.reject(m("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(m("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var s=j.writeSessionBoilerplate(r.Q,r.$++);r.usingBundle&&(s+="a=group:BUNDLE "+r.transceivers.map(function(t){return t.mid}).join(" ")+"\r\n"),s+="a=ice-options:trickle\r\n";var o=j.getMediaSections(r.K.sdp).length;r.transceivers.forEach(function(t,e){if(!(o<e+1)){if(t.rejected)return"application"===t.kind?s+="DTLS/SCTP"===t.protocol?"m=application 0 DTLS/SCTP 5000\r\n":"m=application 0 "+t.protocol+" webrtc-datachannel\r\n":"audio"===t.kind?s+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===t.kind&&(s+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(s+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+t.mid+"\r\n");var i;t.stream&&("audio"===t.kind?i=t.stream.getAudioTracks()[0]:"video"===t.kind&&(i=t.stream.getVideoTracks()[0]),i&&15019<=q&&"video"===t.kind&&!t.sendEncodingParameters[0].rtx&&(t.sendEncodingParameters[0].rtx={ssrc:t.sendEncodingParameters[0].ssrc+1}));var n=U(t.localCapabilities,t.remoteCapabilities);!n.codecs.filter(function(t){return"rtx"===t.name.toLowerCase()}).length&&t.sendEncodingParameters[0].rtx&&delete t.sendEncodingParameters[0].rtx,s+=u(t,n,"answer",t.stream,r.Y),t.rtcpParameters&&t.rtcpParameters.reducedSize&&(s+="a=rtcp-rsize\r\n")}});var t=new A.RTCSessionDescription({type:"answer",sdp:s});return Promise.resolve(t)},n.prototype.addIceCandidate=function(u){var c,h=this;return u&&void 0===u.sdpMLineIndex&&!u.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(t,e){if(!h.K)return e(m("InvalidStateError","Can not add ICE candidate without a remote description"));if(u&&""!==u.candidate){var i=u.sdpMLineIndex;if(u.sdpMid)for(var n=0;n<h.transceivers.length;n++)if(h.transceivers[n].mid===u.sdpMid){i=n;break}var r=h.transceivers[i];if(!r)return e(m("OperationError","Can not add ICE candidate"));if(r.rejected)return t();var s=0<Object.keys(u.candidate).length?j.parseCandidate(u.candidate):{};if("tcp"===s.protocol&&(0===s.port||9===s.port))return t();if(s.component&&1!==s.component)return t();if((0===i||0<i&&r.iceTransport!==h.transceivers[0].iceTransport)&&!N(r.iceTransport,s))return e(m("OperationError","Can not add ICE candidate"));var o=u.candidate.trim();0===o.indexOf("a=")&&(o=o.substr(2)),(c=j.getMediaSections(h.K.sdp))[i]+="a="+(s.type?o:"end-of-candidates")+"\r\n",h.K.sdp=j.getDescription(h.K.sdp)+c.join("")}else for(var a=0;a<h.transceivers.length&&(h.transceivers[a].rejected||(h.transceivers[a].iceTransport.addRemoteCandidate({}),(c=j.getMediaSections(h.K.sdp))[a]+="a=end-of-candidates\r\n",h.K.sdp=j.getDescription(h.K.sdp)+c.join(""),!h.usingBundle));a++);t()})},n.prototype.getStats=function(e){if(e&&e instanceof A.MediaStreamTrack){var i=null;if(this.transceivers.forEach(function(t){t.rtpSender&&t.rtpSender.track===e?i=t.rtpSender:t.rtpReceiver&&t.rtpReceiver.track===e&&(i=t.rtpReceiver)}),!i)throw m("InvalidAccessError","Invalid selector.");return i.getStats()}var n=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&n.push(e[t].getStats())})}),Promise.all(n).then(function(t){var e=new Map;return t.forEach(function(t){t.forEach(function(t){e.set(t.id,t)})}),e})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var e=A[t];if(e&&e.prototype&&e.prototype.getStats){var i=e.prototype.getStats;e.prototype.getStats=function(){return i.apply(this).then(function(i){var n=new Map;return Object.keys(i).forEach(function(t){var e;i[t].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(e=i[t]).type]||e.type,n.set(t,i[t])}),n})}}});var t=["createOffer","createAnswer"];return t.forEach(function(t){var i=n.prototype[t];n.prototype[t]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?i.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):i.apply(this,arguments)}}),(t=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(t){var i=n.prototype[t];n.prototype[t]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?i.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):i.apply(this,arguments)}}),["getStats"].forEach(function(t){var e=n.prototype[t];n.prototype[t]=function(){var t=arguments;return"function"==typeof t[1]?e.apply(this,arguments).then(function(){"function"==typeof t[1]&&t[1].apply(null)}):e.apply(this,arguments)}}),n}},{sdp:17}],17:[function(t,e,i){"use strict";var h={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};h.localCName=h.generateIdentifier(),h.splitLines=function(t){return t.trim().split("\n").map(function(t){return t.trim()})},h.splitSections=function(t){return t.split("\nm=").map(function(t,e){return(0<e?"m="+t:t).trim()+"\r\n"})},h.getDescription=function(t){var e=h.splitSections(t);return e&&e[0]},h.getMediaSections=function(t){var e=h.splitSections(t);return e.shift(),e},h.matchPrefix=function(t,e){return h.splitLines(t).filter(function(t){return 0===t.indexOf(e)})},h.parseCandidate=function(t){for(var e,i={foundation:(e=0===t.indexOf("a=candidate:")?t.substring(12).split(" "):t.substring(10).split(" "))[0],component:parseInt(e[1],10),protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],address:e[4],port:parseInt(e[5],10),type:e[7]},n=8;n<e.length;n+=2)switch(e[n]){case"raddr":i.relatedAddress=e[n+1];break;case"rport":i.relatedPort=parseInt(e[n+1],10);break;case"tcptype":i.tcpType=e[n+1];break;case"ufrag":i.ufrag=e[n+1],i.usernameFragment=e[n+1];break;default:i[e[n]]=e[n+1]}return i},h.writeCandidate=function(t){var e=[];e.push(t.foundation),e.push(t.component),e.push(t.protocol.toUpperCase()),e.push(t.priority),e.push(t.address||t.ip),e.push(t.port);var i=t.type;return e.push("typ"),e.push(i),"host"!==i&&t.relatedAddress&&t.relatedPort&&(e.push("raddr"),e.push(t.relatedAddress),e.push("rport"),e.push(t.relatedPort)),t.tcpType&&"tcp"===t.protocol.toLowerCase()&&(e.push("tcptype"),e.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(e.push("ufrag"),e.push(t.usernameFragment||t.ufrag)),"candidate:"+e.join(" ")},h.parseIceOptions=function(t){return t.substr(14).split(" ")},h.parseRtpMap=function(t){var e=t.substr(9).split(" "),i={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),i.name=e[0],i.clockRate=parseInt(e[1],10),i.channels=3===e.length?parseInt(e[2],10):1,i.numChannels=i.channels,i},h.writeRtpMap=function(t){var e=t.payloadType;void 0!==t.preferredPayloadType&&(e=t.preferredPayloadType);var i=t.channels||t.numChannels||1;return"a=rtpmap:"+e+" "+t.name+"/"+t.clockRate+(1!==i?"/"+i:"")+"\r\n"},h.parseExtmap=function(t){var e=t.substr(9).split(" ");return{id:parseInt(e[0],10),direction:0<e[0].indexOf("/")?e[0].split("/")[1]:"sendrecv",uri:e[1]}},h.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&"sendrecv"!==t.direction?"/"+t.direction:"")+" "+t.uri+"\r\n"},h.parseFmtp=function(t){for(var e,i={},n=t.substr(t.indexOf(" ")+1).split(";"),r=0;r<n.length;r++)i[(e=n[r].trim().split("="))[0].trim()]=e[1];return i},h.writeFmtp=function(e){var t="",i=e.payloadType;if(void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+i+" "+n.join(";")+"\r\n"}return t},h.parseRtcpFb=function(t){var e=t.substr(t.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},h.writeRtcpFb=function(t){var e="",i=t.payloadType;return void 0!==t.preferredPayloadType&&(i=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(function(t){e+="a=rtcp-fb:"+i+" "+t.type+(t.parameter&&t.parameter.length?" "+t.parameter:"")+"\r\n"}),e},h.parseSsrcMedia=function(t){var e=t.indexOf(" "),i={ssrc:parseInt(t.substr(7,e-7),10)},n=t.indexOf(":",e);return-1<n?(i.attribute=t.substr(e+1,n-e-1),i.value=t.substr(n+1)):i.attribute=t.substr(e+1),i},h.parseSsrcGroup=function(t){var e=t.substr(13).split(" ");return{semantics:e.shift(),ssrcs:e.map(function(t){return parseInt(t,10)})}},h.getMid=function(t){var e=h.matchPrefix(t,"a=mid:")[0];if(e)return e.substr(6)},h.parseFingerprint=function(t){var e=t.substr(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1]}},h.getDtlsParameters=function(t,e){return{role:"auto",fingerprints:h.matchPrefix(t+e,"a=fingerprint:").map(h.parseFingerprint)}},h.writeDtlsParameters=function(t,e){var i="a=setup:"+e+"\r\n";return t.fingerprints.forEach(function(t){i+="a=fingerprint:"+t.algorithm+" "+t.value+"\r\n"}),i},h.parseCryptoLine=function(t){var e=t.substr(9).split(" ");return{tag:parseInt(e[0],10),cryptoSuite:e[1],keyParams:e[2],sessionParams:e.slice(3)}},h.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+("object"==typeof t.keyParams?h.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+"\r\n"},h.parseCryptoKeyParams=function(t){if(0!==t.indexOf("inline:"))return null;var e=t.substr(7).split("|");return{keyMethod:"inline",keySalt:e[0],lifeTime:e[1],mkiValue:e[2]?e[2].split(":")[0]:void 0,mkiLength:e[2]?e[2].split(":")[1]:void 0}},h.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},h.getCryptoParameters=function(t,e){return h.matchPrefix(t+e,"a=crypto:").map(h.parseCryptoLine)},h.getIceParameters=function(t,e){var i=h.matchPrefix(t+e,"a=ice-ufrag:")[0],n=h.matchPrefix(t+e,"a=ice-pwd:")[0];return i&&n?{usernameFragment:i.substr(12),password:n.substr(10)}:null},h.writeIceParameters=function(t){return"a=ice-ufrag:"+t.usernameFragment+"\r\na=ice-pwd:"+t.password+"\r\n"},h.parseRtpParameters=function(t){for(var e={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=h.splitLines(t)[0].split(" "),n=3;n<i.length;n++){var r=i[n],s=h.matchPrefix(t,"a=rtpmap:"+r+" ")[0];if(s){var o=h.parseRtpMap(s),a=h.matchPrefix(t,"a=fmtp:"+r+" ");switch(o.parameters=a.length?h.parseFmtp(a[0]):{},o.rtcpFeedback=h.matchPrefix(t,"a=rtcp-fb:"+r+" ").map(h.parseRtcpFb),e.codecs.push(o),o.name.toUpperCase()){case"RED":case"ULPFEC":e.fecMechanisms.push(o.name.toUpperCase())}}}return h.matchPrefix(t,"a=extmap:").forEach(function(t){e.headerExtensions.push(h.parseExtmap(t))}),e},h.writeRtpDescription=function(t,e){var i="";i+="m="+t+" ",i+=0<e.codecs.length?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=e.codecs.map(function(t){return void 0!==t.preferredPayloadType?t.preferredPayloadType:t.payloadType}).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",e.codecs.forEach(function(t){i+=h.writeRtpMap(t),i+=h.writeFmtp(t),i+=h.writeRtcpFb(t)});var n=0;return e.codecs.forEach(function(t){t.maxptime>n&&(n=t.maxptime)}),0<n&&(i+="a=maxptime:"+n+"\r\n"),i+="a=rtcp-mux\r\n",e.headerExtensions&&e.headerExtensions.forEach(function(t){i+=h.writeExtmap(t)}),i},h.parseRtpEncodingParameters=function(t){var i,n=[],e=h.parseRtpParameters(t),r=-1!==e.fecMechanisms.indexOf("RED"),s=-1!==e.fecMechanisms.indexOf("ULPFEC"),o=h.matchPrefix(t,"a=ssrc:").map(function(t){return h.parseSsrcMedia(t)}).filter(function(t){return"cname"===t.attribute}),a=0<o.length&&o[0].ssrc,u=h.matchPrefix(t,"a=ssrc-group:FID").map(function(t){return t.substr(17).split(" ").map(function(t){return parseInt(t,10)})});0<u.length&&1<u[0].length&&u[0][0]===a&&(i=u[0][1]),e.codecs.forEach(function(t){if("RTX"===t.name.toUpperCase()&&t.parameters.apt){var e={ssrc:a,codecPayloadType:parseInt(t.parameters.apt,10)};a&&i&&(e.rtx={ssrc:i}),n.push(e),r&&((e=JSON.parse(JSON.stringify(e))).fec={ssrc:a,mechanism:s?"red+ulpfec":"red"},n.push(e))}}),0===n.length&&a&&n.push({ssrc:a});var c=h.matchPrefix(t,"b=");return c.length&&(c=0===c[0].indexOf("b=TIAS:")?parseInt(c[0].substr(7),10):0===c[0].indexOf("b=AS:")?1e3*parseInt(c[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(t){t.maxBitrate=c})),n},h.parseRtcpParameters=function(t){var e={},i=h.matchPrefix(t,"a=ssrc:").map(function(t){return h.parseSsrcMedia(t)}).filter(function(t){return"cname"===t.attribute})[0];i&&(e.cname=i.value,e.ssrc=i.ssrc);var n=h.matchPrefix(t,"a=rtcp-rsize");e.reducedSize=0<n.length,e.compound=0===n.length;var r=h.matchPrefix(t,"a=rtcp-mux");return e.mux=0<r.length,e},h.parseMsid=function(t){var e,i=h.matchPrefix(t,"a=msid:");if(1===i.length)return{stream:(e=i[0].substr(7).split(" "))[0],track:e[1]};var n=h.matchPrefix(t,"a=ssrc:").map(function(t){return h.parseSsrcMedia(t)}).filter(function(t){return"msid"===t.attribute});return 0<n.length?{stream:(e=n[0].value.split(" "))[0],track:e[1]}:void 0},h.parseSctpDescription=function(t){var e,i=h.parseMLine(t),n=h.matchPrefix(t,"a=max-message-size:");0<n.length&&(e=parseInt(n[0].substr(19),10)),isNaN(e)&&(e=65536);var r=h.matchPrefix(t,"a=sctp-port:");if(0<r.length)return{port:parseInt(r[0].substr(12),10),protocol:i.fmt,maxMessageSize:e};if(0<h.matchPrefix(t,"a=sctpmap:").length){var s=h.matchPrefix(t,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:e}}},h.writeSctpDescription=function(t,e){var i=[];return i="DTLS/SCTP"!==t.protocol?["m="+t.kind+" 9 "+t.protocol+" "+e.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+e.port+"\r\n"]:["m="+t.kind+" 9 "+t.protocol+" "+e.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+e.port+" "+e.protocol+" 65535\r\n"],void 0!==e.maxMessageSize&&i.push("a=max-message-size:"+e.maxMessageSize+"\r\n"),i.join("")},h.generateSessionId=function(){return Math.random().toString().substr(2,21)},h.writeSessionBoilerplate=function(t,e,i){var n=void 0!==e?e:2;return"v=0\r\no="+(i||"thisisadapterortc")+" "+(t||h.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},h.writeMediaSection=function(t,e,i,n){var r=h.writeRtpDescription(t.kind,e);if(r+=h.writeIceParameters(t.iceGatherer.getLocalParameters()),r+=h.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":"active"),r+="a=mid:"+t.mid+"\r\n",r+=t.direction?"a="+t.direction+"\r\n":t.rtpSender&&t.rtpReceiver?"a=sendrecv\r\n":t.rtpSender?"a=sendonly\r\n":t.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",t.rtpSender){var s="msid:"+n.id+" "+t.rtpSender.track.id+"\r\n";r+="a="+s,r+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+s,t.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+s,r+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return r+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+h.localCName+"\r\n",t.rtpSender&&t.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+h.localCName+"\r\n"),r},h.getDirection=function(t,e){for(var i=h.splitLines(t),n=0;n<i.length;n++)switch(i[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[n].substr(2)}return e?h.getDirection(e):"sendrecv"},h.getKind=function(t){return h.splitLines(t)[0].split(" ")[0].substr(2)},h.isRejected=function(t){return"0"===t.split(" ",2)[1]},h.parseMLine=function(t){var e=h.splitLines(t)[0].substr(2).split(" ");return{kind:e[0],port:parseInt(e[1],10),protocol:e[2],fmt:e.slice(3).join(" ")}},h.parseOLine=function(t){var e=h.matchPrefix(t,"o=")[0].substr(2).split(" ");return{username:e[0],sessionId:e[1],sessionVersion:parseInt(e[2],10),netType:e[3],addressType:e[4],address:e[5]}},h.isValidSDP=function(t){if("string"!=typeof t||0===t.length)return!1;for(var e=h.splitLines(t),i=0;i<e.length;i++)if(e[i].length<2||"="!==e[i].charAt(1))return!1;return!0},"object"==typeof e&&(e.exports=h)},{}]},{},[1])(1)},function(t,e,i){"use strict";var n,r;n=[i(8),i(9),i(3)],void 0===(r=function(t,e,i){return t.PhenixVideo=i,t.onLoaded=function(){e(t)},t.onLoaded(),t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(2),i(6),i(16),i(4),i(0)],void 0===(r=function(r,t,s,o,e,a){"use strict";function i(t,e,i){this.g=new s.DisposableList,this.v=new o.NamedEvents,this.ft="video"===t.tagName,this.dt=i.swfSrc,this.lt=t.id||i.streamId,this.mt=t.clientWidth,this.pt=t.clientHeight,this.e=t,this.vt=null,this.gt=[],this.yt=["uid="+this.lt,"autoplay="+(!!r.isUndefined(t.autoplay)||t.autoplay),"muted="+(!r.isUndefined(t.muted)&&t.muted),"allowScriptAccess=always","preload=true","src="+JSON.stringify(e)];var n=this;this.g.add(new s.Disposable(function(){f.call(n,"fire_stop")}));try{this.vt=v||g?function(){return document.createElement("div")}.call(this):function(){var t=document.createElement("embed");return t.setAttribute("id","__"+this.lt),t.setAttribute("name","__"+this.lt),t.setAttribute("play","true"),t.setAttribute("loop","false"),t.setAttribute("quality","high"),t.setAttribute("bgcolor","#000000"),t.setAttribute("wmode","transparent"),t.setAttribute("allowScriptAccess","always"),t.setAttribute("allowFullScreen","true"),t.setAttribute("type","application/x-shockwave-flash"),t.setAttribute("pluginspage","//www.macromedia.com/go/getflashplayer"),t.setAttribute("src",this.dt),t.setAttribute("flashvars",this.yt.join("&")),this.ft&&(t.setAttribute("width",this.mt.toString()),t.setAttribute("height",this.pt.toString())),t}.call(this),c.call(this)}catch(t){!function(){console.error.apply(console,arguments)}("Error while loading Flash Player"+t)}}function n(e,i){return r.findIndex(this.gt,function(t){return t.name===e&&t.listener===i})}function u(t,e){var i=document.createElement("param");return i.setAttribute("name",t),i.setAttribute("value",e),i}function c(){r.assign(this.vt,l,{id:this.lt,width:this.mt,height:this.pt,videoWidth:this.mt,videoHeight:this.pt}),function(){var n=this;a["__event__"+this.lt]=function(t,e){var i=function(t,e){var i=t.match(/([a-z]+\.([a-z]+))/i),n={target:e};if(null!==i&&(t=i[1],n.namespace=i[2]),"IE"===p.browser&&8<p.version){var r=a.document.createEvent("CustomEvent");return r.initCustomEvent(t,!1,!1,n),r}return a.CustomEvent?new a.CustomEvent(t,{detail:n}):n}(t,n.vt);if(e)try{i.data=JSON.parse(e),i.details.data=i.data}catch(t){i.message=e}switch(t){case"ended":break;case"error":n.vt.error=i.data,n.vt.dispatchEvent&&n.vt.dispatchEvent(new Error(e));break;case"loadeddata":case"loadedmetadata":case"loadstart":n.vt.dispatchEvent&&n.vt.dispatchEvent(i);break;case"pause":n.vt.paused=!0;break;case"play":case"playing":n.vt.paused=!1;break;case"progress":case"seeked":case"seeking":case"stalled":case"suspend":n.vt.dispatchEvent&&n.vt.dispatchEvent(i);break;case"timeupdate":n.vt.currentTime=function(t){return(this.vt["get_"+t]||r.noop).call(this.vt)}.call(n,"currentTime"),n.vt.dispatchEvent&&n.vt.dispatchEvent(i)}n.v.fireAsync(t,[i])};var e=this.vt.requestFullscreen||this.vt.mozRequestFullScreen||this.vt.webkitRequestFullScreen||this.vt.msRequestFullscreen;function t(){f.call(n,"set_size",n.wt?screen.width:n.vt.clientWidth,n.wt?screen.height:n.vt.clientHeight)}this.g.add(new s.Disposable(function(){delete a["__event__"+n.lt]})),this.vt.play=function(){f.call(n,"fire_play")},this.vt.load=function(){f.call(n,"fire_load")},this.vt.seek=function(){f.call(n,"fire_seek")},this.vt.pause=function(){f.call(n,"fire_pause")},this.vt.requestFullscreen=function(){if(n.wt=!0,function(){function i(){document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement||(document.removeEventListener("webkitfullscreenchange",i),document.removeEventListener("mozfullscreenchange",i),document.removeEventListener("fullscreenchange",i),document.removeEventListener("MSFullscreenChange",i),document.removeEventListener("keydown",t),e.wt=!1,e.vt.style.position=e.bt,e.vt.style.height=e.kt,e.vt.style.width=e.St)}function t(t){var e=t||a.event;("key"in e?"Escape"===e.key||"Esc"===e.key:27===e.keyCode)&&i()}var e=this;document.addEventListener("webkitfullscreenchange",i,!1),document.addEventListener("mozfullscreenchange",i,!1),document.addEventListener("fullscreenchange",i,!1),document.addEventListener("MSFullscreenChange",i,!1),document.addEventListener("keydown",t,!1)}.call(n),n.kt=n.vt.style.height,n.St=n.vt.style.width,n.bt=n.vt.style.position,n.vt.style.position="absolute",n.vt.style.height="100%",n.vt.style.width="100%",void 0!==a.ActiveXObject){var t=new a("WScript.Shell");null!==t&&t.SendKeys("{F11}")}e.call(n.vt)},r.addEventListener(a,"resize",t),this.g.add(new s.Disposable(function(){r.removeEventListener(a,"resize",t)}))}.call(this),function(){var e=this,i=["currentTime","paused","error","src"];if(r.get(a,["MutationObserver"])){var t=new MutationObserver(function(t){t.forEach(function(t){"attributes"!==t.type||t.target!==e.vt||r.includes(i,t.attributeName)||h.call(e,t.attributeName,e.vt[t.attributeName])})});t.observe(e.vt,{attributes:!0}),e.g.add(new s.Disposable(function(){t.disconnect()}))}else{d("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details.");var n=function(t){r.includes(i,t.target.tagName)||h.call(e,t.target.tagName,e.vt[t.target.tagName])};e.vt.addEventListener?(e.vt.addEventListener("DOMAttrModified",n,!1),e.g.add(new s.Disposable(function(){e.vt.removeEventListener("DOMAttrModified",n,!1)}))):(e.vt.attachEvent("onpropertychange",n),e.g.add(new s.Disposable(function(){e.vt.detachEvent("DOMAttrModified",n)})))}}.call(this),function(){var t=function(){var i=this,n=i.e.muted,r=i.vt.muted;return function(){var t=i.vt.muted,e=i.vt.muted;t===n&&e===r||(t!==n&&(e=r=n=t),e!==r&&(r=n=t),i.vt.muted=e,i.e.muted=e,h.call(i,"muted",e))}}.call(this),e=function(){var i=this,n=i.e.volume,r=i.vt.volume;return function(){var t=i.vt.volume,e=i.vt.volume;t===n&&e===r||(t!==n&&(e=r=n=t),e!==r&&(r=n=t),i.vt.volume=e,i.e.volume=e,h.call(i,"volume",e))}}.call(this),i=setInterval(function(){t(),e()},m);this.g.add(new s.Disposable(function(){clearInterval(i)}))}.call(this)}function h(t,e){return(this.vt["set_"+t]||r.noop).call(this.vt,e)}function f(t){var e=this.vt[t];if([].shift.apply(arguments),e)return e.apply(this.vt,arguments)}var d=function(){console.log.apply(console,arguments)},l={width:480,height:360,videoWidth:480,videoHeight:360,muted:!1,volume:1,currentTime:0,duration:1/0,readyState:0,ended:!1,buffered:null,autoplay:!0},m=300,p=new t(navigator.userAgent).detect(),v="IE"===p.browser&&/(trident|microsoft)/i.test(r.get(a.navigator,["appName"],"")),g="Edge"===p.browser&&r.get(a.navigator,"msLaunchUri")&&!r.get(a.document,"documentMode");return i.prototype.finishInitializationInDom=function(){return function(){if(!v&&!g)return this.vt;var t=(g?"__"+this.lt:this.lt)+r.uniqueId(),i=document.createElement("object"),e=document.createElement("div"),n=[u("movie",this.dt+"?x="+r.now()),u("flashvars",this.yt.join("&")),u("quality",2),u("bgcolor","#000000"),u("wmode","transparent"),u("allowScriptAccess","always"),u("allowFullScreen","true"),e];return e.innerHTML="You are using a browser that does not have Flash player enabled or installed. Please turn on your Flash player plugin or download the latest version from https://get.adobe.com/flashplayer/",g?(i.setAttribute("type","application/x-shockwave-flash"),i.setAttribute("data",this.dt),i.setAttribute("id",t),i.setAttribute("width","__"+this.mt.toString()),i.setAttribute("height","__"+this.pt.toString())):(i.setAttribute("classid","clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"),i.setAttribute("codebase","//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab"),i.setAttribute("id",t),i.setAttribute("width",this.mt.toString()),i.setAttribute("height",this.pt.toString())),i.object?(r.forEach(n,function(t){r.isNullOrUndefined(r.get(i.object,[t.name]))||(i.object[t.name]=t.value)}),i.appendChild(e)):r.forEach(n,function(e){var t=r.find(i.children,function(t){return t.name===e.name});return t?i.replaceChild(e,t):i.appendChild(e)}),this.vt.outerHTML=i.outerHTML,a.document.getElementById&&(this.vt=a.document.getElementById(t),c.call(this)),this.vt}.call(this)},i.prototype.getElement=function(){return this.vt},i.prototype.addEventListener=function(t,e){if(!(-1<n.call(this,t,e))){var i=this.v.listen(t,e);this.g.add(i),this.gt.push({name:t,listener:e,disposable:i})}},i.prototype.removeEventListener=function(t,e){var i=n.call(this,t,e);-1<i&&this.gt.splice(i,1)[0].disposable.dispose()},i.prototype.destroy=function(){this.g.dispose()},i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(5),i(7),i(4),i(3)],void 0===(r=function(r,i,s,o,n){"use strict";function t(){var t,e,i,n=this;this.Et=((t=document.createElement("div")).id="phenixRTC",t.style.cssText="visibility:hidden !important;width:0px !important;height:0px !important;margin:0px !important;padding:0px !important;border-style:none !important;border-width:0px !important;max-width:0px !important;max-height:0px !important;outline:none !important",document.body.appendChild(t),t),this.Tt="?";try{this.It=(e=this.Et,(i=document.createElement("object")).type="application/x-phenix-rtc",e.appendChild(i),i),this.It.onunload=function(){n.w=!1},(new o).waitForReady(this.It,function(t){n.w=!0,n.b=!0===t,n.Tt=n.It.phenixVersion||"?.?.?.?",function(){console.log.apply(console,arguments)}(t?"Phenix RTC "+n.Tt:"No Phenix RTC"),n.k&&n.k(n.b)})}catch(t){!function(){console.error.apply(console,arguments)}("Error while loading Phenix RTC"+t)}}function a(){this.Et&&document.getElementById("phenixRTC")!==this.Et&&(document.body.appendChild(this.Et),this.Rt&&this.Rt.call(this))}function e(e){function i(){var t=null;switch(arguments.length){case 0:t=new e;break;case 1:t=new e(arguments[0]);break;case 2:t=new e(arguments[0],arguments[1]);break;case 3:t=new e(arguments[0],arguments[1],arguments[2]);break;case 4:t=new e(arguments[0],arguments[1],arguments[2],arguments[3]);break;case 5:t=new e(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);break;default:throw new Error("Unsupported number of arguments in Phenix Object Constructor")}return t.phenixAddEventListener=r.bind(u,t),t.phenixRemoveEventListener=r.bind(c,t),t}return r.forOwn(e,function(t,e){i[e]=t}),i}function u(t,e){i.Mt(t,"name"),i.Ct(e,"listener"),function(i){if(!this.events||!this.events[i]){this.events||(this.events={});var n=this.events;n[i]={observable:(new s.Observable).extend({timeout:0}),subscription:null,listeners:[]},this.phenixSetEventListener(i,r.bind(n[i].observable.setValue,n[i].observable)),n[i].subscription=n[i].observable.subscribe(function(e){var t=n[i].listeners;r.forEach(t,function(t){t(e)})})}}.call(this,t),function(t,e){if(!this.events||!this.events[t])throw new Error("No event observable for event: "+name);this.events[t].listeners.push(e)}.call(this,t,e)}function c(t,e){(function(t,e){this.events&&this.events.events[t]&&(this.events[t].listeners=r.filter(this.events[t].listeners,function(t){return e!==t}))}).call(this,t,e)}return t.prototype.onReady=function(t){var e=this;this.w?setTimeout(function(){t(e.b)},1):this.k=t},t.prototype.onLoaded=function(t){this.Rt=t},t.prototype.isLoaded=function(){return!0===this.w},t.isSupported=function(){if(navigator.plugins)for(var t=navigator.plugins,e=0;e<t.length;e++)if(0<=t[e].name.indexOf("PhenixRTC"))return!0;if(navigator.userAgent&&(navigator.userAgent.match(/MSIE/)||navigator.userAgent.match(/Trident/)))try{return new window.ActiveXObject("PhenixP2P.RTC"),!0}catch(t){return!1}return!1},t.prototype.isEnabled=function(){return a.call(this),this.It&&void 0!==this.It.phenixVersion},t.prototype.getVersion=function(){return a.call(this),this.Tt},t.prototype.getRTCPeerConnectionConstructor=function(){return a.call(this),e(this.It.RTCPeerConnection)},t.prototype.getRTCSessionDescriptionConstructor=function(){return a.call(this),e(this.It.RTCSessionDescription)},t.prototype.getRTCIceCandidateConstructor=function(){return a.call(this),e(this.It.RTCIceCandidate)},t.prototype.getSourcesDelegate=function(){var e=this;return function(t){return a.call(e),e.It.getSources(t)}},t.prototype.getUserMediaDelegate=function(){var n=this;return function(t,e,i){return a.call(n),n.It.getUserMedia(t,e,i)}},t.prototype.getStatsDelegate=function(){return function(t,e,i,n){return t.getStats(e,i,n)}},t.prototype.attachMediaStream=function(t,e){return a.call(this),function(t,e){if(!t)throw new Error("Can not attach a stream to a undefined element");if(t.phenixVersion)return t.src=e,t;var i=new n(t,e,!0);return(i.getElement().phenixPresenter=i).getElement()}.call(this,t,e)},t.prototype.reattachMediaStream=function(t,e){return a.call(this),this.attachMediaStream(t,e.src)},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(2),i(11),i(0),i(3)],void 0===(r=function(o,t,e,r,i){"use strict";function n(t,e,i){var n=o.bind(s,this,t,e,i);return navigator&&navigator.mediaDevices&&o.Ct(navigator.mediaDevices.getUserMedia)?navigator.mediaDevices.getUserMedia(t).then(function(t){return n(t)}).catch(function(t){return i(t)}):navigator&&o.Ct(navigator.getUserMedia)?navigator.getUserMedia(t,n,i):r&&o.Ct(r.getUserMedia)?r.getUserMedia(t,n,i):void 0}function s(r,s,o,a){setTimeout(function(){for(var t=a.getTracks(),e=0;e<t.length;e++){var i=t[e];if(i.onended=function(t){m(t.timeStamp,"Track",i.id,i.label,"ended")},m("Track",i.id,i.label,t[e].kind,"readyState=",t[e].readyState),"ended"===i.readyState)return u("User media not available",o,t)}var n=(r.audio?1:0)+(r.video?1:0);return t.length!==n?u("Unable to get all requested user media.",o,t):void s(a)},100)}function u(t,e,i){try{var n=new Error(t);n.code="unavailable",e(n)}finally{!function(t){for(var e=0;e<t.length;e++)t[e].stop()}(i)}}function a(i,n){if("input"!==i&&"output"!==i)throw new Error("Unsupported device type "+i);navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices().then(function(t){var e=[];t.forEach(function(t){t.kind==="audio"+i?e.push({kind:"audio",id:t.deviceId,label:t.label}):t.kind==="video"+i&&e.push({kind:"video",id:t.deviceId,label:t.label})}),n(e)})}function c(t,e,i){void 0!==t.srcObject?t.srcObject=e:void 0!==t.mozSrcObject?t.mozSrcObject=e:void 0!==t.src?t.src=URL.createObjectURL(e):m("Error attaching stream to element.");var n=t.play();return void 0===n?"function"==typeof i&&i():n.then(function(){"function"==typeof i&&i()}).catch(function(t){m("Play() failed: "+t),"function"==typeof i&&i(t)}),t}function h(t,e){return t.src=e,t.play(),t}function f(t,e){return t.src=e.src,t}function d(t,e,i){e(function(e,t){switch(p.browser){case"Edge":t.forEach(function(t){t.mediaType=function(t,i){var n,e,r,s;if(i)return r=(e=e=t).localDescription.sdp.split("m="),s=e.remoteDescription.sdp.split("m="),r.length===s.length&&o.findIndex(r,function(t,e){return function(t){o.startsWith(t,"video")&&o.includes(t.toLowerCase(),i.toLowerCase())&&(n="video"),o.startsWith(t,"audio")&&o.includes(t.toLowerCase(),i.toLowerCase())&&(n="audio")}(t)}),n}(e,t.codecId),t.bytesSent=l(t.packetsSent,t.mediaType),t.bytesReceived=l(t.packetsReceived,t.mediaType)});break;case"Safari":t.forEach(function(t){o.includes(t.id.toLowerCase(),"audio")&&o.includes(t.id.toLowerCase(),"rtp")&&(t.mediaType="audio"),o.includes(t.id.toLowerCase(),"video")&&o.includes(t.id.toLowerCase(),"rtp")&&(t.mediaType="video")})}return t}(t,i))}function l(t,e){var i=parseInt(t)||0;return"audio"===e?100*i:"video"===e?1080*i:void 0}var m=function(){console.log.apply(console,arguments)},p=new t(navigator.userAgent).detect(),v=r.RTCPeerConnection,g=r.RTCSessionDescription,y=r.RTCIceCandidate,w=null,b=null,k=null,S=null,E=null,T=null,I=null,R=!1;return function(){!function(){if(v=r.RTCPeerConnection,g=r.RTCSessionDescription,y=r.RTCIceCandidate,navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(w=o.bind(a,null,"input")),navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(b=o.bind(a,null,"output")),(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||r.getUserMedia)&&(k=n),!r.RTCPeerConnection)return m("[%s] browser version [%s] does not appear to be WebRTC-capable",p.browser,p.version);switch(p.browser){case"Firefox":m("Firefox detected",p),E=c,I=f,S=function(t,e,i,n){t.getStats(e,o.bind(d,this,t,i),n)},R=!0;break;case"Opera":m("Opera detected",p),E=c,I=f,S=function(t,e,i,n){t.getStats(o.bind(d,this,t,i),e,n)},R=!0;break;case"Chrome":m("Webkit detected",p),E=c,I=f,S=function(t,e,i,n){t.getStats(o.bind(d,this,t,i),e,n)},R=!0;break;case"Edge":m("Edge detected",p),E=c,I=f,S=function(t,e,i,n){t.getStats(e,o.bind(d,this,t,i),n)},R=!0;break;case"Safari":m("Safari detected",p),E=function(t,e,i){return o.xt(e)&&(t.__phenixHasPlayedWebRtc=!0),c(t,e,i)},T=function(t,e){return t.__phenixHasPlayedWebRtc?((t=new i(t,e,!1).getElement()).play(),t):h(t,e)},I=f,S=function(t,e,i,n){t.getStats(e).then(o.bind(d,this,t,i),n)},R=!0;break;case"ReactNative":m("React Native detected",p),E=function(){m("attachMediaStream not supported in React Native environment")},T=function(){m("attachUriStream not supported in React Native environment")},I=function(){m("reattachMediaStream not supported in React Native environment")},S=function(t,e,i,n){t.getStats(e).then(o.bind(d,this,t,i),n)},R=!0;break;default:m("Browser does not appear to be WebRTC-capable",p)}}();var t={RTCPeerConnection:v,RTCSessionDescription:g,RTCIceCandidate:y,getSources:w,getDestinations:b,getUserMedia:k,getStats:S,attachMediaStream:E,attachUriStream:T||h,reattachMediaStream:I,webrtcSupported:R,exportGlobal:function(){r.RTCPeerConnection=t.RTCPeerConnection,r.RTCSessionDescription=t.RTCSessionDescription,r.RTCIceCandidate=t.RTCIceCandidate}};return t}}.apply(e,n))||(t.exports=r)},function(t,e){t.exports=aa}],da={},ca.m=ba,ca.c=da,ca.i=function(t){return t},ca.d=function(t,e,i){ca.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},ca.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return ca.d(e,"a",e),e},ca.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},ca.p="",ca(ca.s=12))},function(t,e,i){var n,r;n=[i(25),i(54),i(55)],void 0===(r=function(t,e,i){"use strict";return{Observable:t,ObservableArray:e,ObservableMonitor:i}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(26),i(56)],void 0===(r=function(t,e){return{Event:t,NamedEvents:e}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(77)],void 0===(r=function(t){"use strict";return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{networkStates:{networkEmpty:{id:0,name:"NETWORK_EMPTY"},networkIdle:{id:1,name:"NETWORK_IDLE"},networkLoading:{id:2,name:"NETWORK_LOADING"},networkNoSource:{id:3,name:"NETWORK_NO_SOURCE"}},types:{realTime:{id:0,name:"real-time"},dash:{id:1,name:"dash"},hls:{id:2,name:"hls"},rtmp:{id:0,name:"rtmp"}},streamEvents:{playerEnded:{id:0,name:"playerended"},playerError:{id:1,name:"playererror"},stopped:{id:2,name:"stopped"}},rendererEvents:{ended:{id:0,name:"ended"},error:{id:1,name:"error"},autoMuted:{id:2,name:"autoMuted"},failedToPlay:{id:3,name:"failedToPlay"}}}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(58)],void 0===(r=function(t){"use strict";return t()}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(57),i(60),i(17)],void 0===(r=function(t,e,i){"use strict";return{createLogger:function(){return new t},Logger:t,ConsoleAppender:e,level:i.level}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(79)],void 0===(r=function(t){"use strict";return new t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5)],void 0===(r=function(i,n,r){"use strict";function t(t,e){n.xt(t,"logger"),this.Pt=t,this.Dt=new r.Event,this.Ot=null,this.At=!1,this.qt=null,this.Ft={pollFrequency:500,previousWidth:0,previousHeight:0},e&&e.pollFrequency&&(this.Ft.pollFrequency=15<=e.pollFrequency?e.pollFrequency:15),this.Ut=null}function s(){if(this.At&&!this.Ot&&0!==this.Dt.size()){var t=this;this.Ft.previousWidth=this.qt.videoWidth,this.Ft.previousHeight=this.qt.videoHeight,this.Ot=setInterval(function(){t.qt.videoWidth===t.Ft.previousWidth&&t.qt.videoHeight===t.Ft.previousHeight||(t.Ft.previousWidth=t.qt.videoWidth,t.Ft.previousHeight=t.qt.videoHeight,t.Dt.fireAsync([t.Ut,{width:t.qt.videoWidth,height:t.qt.videoHeight}]))},t.Ft.pollFrequency)}}return t.prototype.start=function(t,e){(function(t,e){e&&!i.isUndefined(e.videoWidth)||this.Pt.warn("Attempting to start dimensions changed monitor without providing proper 'video' element."),this.Ut=t,this.qt=e,this.At=!0,s.call(this)}).call(this,t,e)},t.prototype.stop=function(){(function(){this.At=!1,this.Ot&&(clearInterval(this.Ot),this.Ot=null),this.Dt.dispose()}).call(this)},t.prototype.addVideoDisplayDimensionsChangedCallback=function(t){return n.Ct(t,"addVideoDisplayDimensionsChangedCallback"),s.call(this),this.Dt.listen(t)},t.prototype.toString=function(){return"DimensionsChangedMonitor[pollFrequency="+this.Ft.pollFrequency+", previousHeight="+this.Ft.previousHeight+", previousWidth="+this.Ft.previousHeight+", state="+(this.Ot?"running":"stopped")+"]"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r,s,o,a,u,c,h,f,d,l;function m(t){if(l[t])return l[t].exports;var e=l[t]={i:t,l:!1,exports:{}};return d[t].call(e.exports,e,e.exports,m),e.l=!0,e.exports}t.exports=(n=i(1),r=i(0),s=i(9),o=i(5),a=i(2),u=i(3),c=i(6),h=i(16),f=i(10),l={},m.m=d=[function(t,e){t.exports=n},function(t,e){t.exports=r},function(t,e){t.exports=s},function(t,e){t.exports=o},function(t,e){t.exports=a},function(t,e,i){var n,r;n=[i(1),i(0),i(2),i(3),i(4),i(10),i(7),i(23),i(24),i(13),i(15),i(26),i(6)],void 0!==(r=function(u,n,i,r,s,c,o,h,f,d,l,m,a){"use strict";function t(t,e){e&&n.Nt(e,"playlistUrl"),this.parsedPlaylist=null,this.Pt=t||new i.Logger,this.playlistUrl=e,this.baseUrl=e?e.substring(0,e.lastIndexOf("/")+1):"",this.jt=e?e.substring(e.lastIndexOf("/"),e.length):"",this.Lt=new r.Event,this._t={},this.Bt=[],this.zt=g(this.playlistUrl),this.Wt=null,this.Vt=0,this.g=new s.DisposableList,this.g.add(this.Lt)}function p(t,s){return 0===u.keys(s).length?t:u.filter(t,function(t){return i=s,n=(e=t).getHeight()||0,r=e.getBandwidth()||0,u.reduce(i,function(t,e,i){switch(i){case"maxHeight":return n<=e;case"minHeight":return e<=n;case"maxBandwidth":return r<=e;case"minBandwidth":return e<=r;default:throw new Error("Unknown restriction "+i)}},!1);var e,i,n,r})}function v(t,e){n.Ht(t,o,"track"),e=e||u.noop,n.Ct(e,"eventCallback");var i=t.getMimeType();this._t[i]||(this._t[i]=[]),u.includes(this._t[i],t)||this._t[i].push(t),u.includes(this.Bt,i)||this.Bt.push(i),this.g.add(new s.Disposable(function(){t.dispose()})),this.Lt.fireAsync([t],this,e)}function g(t){return/[.]mpd\??[^\s]*/i.test(t)?"Dash":/[.]m3u8\??[^\s]*/i.test(t)?"Hls":null}function y(t,e,i,n){if(i&&5===i.attempts){var r="Failed to get playlist ["+t+"] with max retries of [5 after ["+u.get(i,["stats","totalResponseTimeForAllAttempts"],0)+"] ms";return this.Pt.warn(r),n(w(a.name.playlistNotFound.name,a.severity.CRITICAL,r))}if(0!==e.code)return this.Pt.warn("Failed to load playlist [%s]. Status code: [%s] (status text: [%s])",t,e.code,e.message),n(w(a.name.error.name,a.severity.CRITICAL,e));var s="Failed to get playlist ["+t+"] with timeout after ["+u.get(i,["stats","totalResponseTimeForAllAttempts"],0)+"]";return this.Pt.warn(s),n(w(a.name.timeout.name,a.severity.RECOVERABLE,s))}function w(t,e,i){return{category:a.category.PLAYLIST,name:t,severity:e,error:"Error"===i.constructor.name?i:new Error(i)}}return t.prototype.toString=function(){return"Playlist [playlistUrl="+this.playlistUrl+", baseUrl="+this.baseUrl+", mimeTypes="+this.Bt+", trackAddedEvent(size)="+this.Lt.size()+", playlistTracks="+this.getAllPlaylistTracks()+"]"},t.prototype.dispose=function(){this._t={},this.g.dispose()},t.prototype.getPlaylistTracksByMimeType=function(t){return this._t[t]},t.prototype.fetch=function(t){(function(i){var n=this;c.getWithRetry(n.playlistUrl,{retryOptions:{backoff:1,delay:1e3,maxAttempts:5,additionalRetryErrorCodes:[0]}},function(t,e){if(t)return y.call(n,n.playlistUrl,t,e,i);(function(t,e,r){var s=null,i=[],o=this;switch(this.zt){case"Dash":s=new d(o.Pt,t);var n=new m(o.Pt,s.timeSources,e);o.g.add(n),o.parsedPlaylist=s,o.Gt=o.parsedPlaylist.availabilityStartTime?o.parsedPlaylist.availabilityStartTime.getTime():null,o.Kt=o.parsedPlaylist.publishTime?o.parsedPlaylist.publishTime.getTime():null,o.Jt=u.get(o.parsedPlaylist,["suggestedPresentationDelay","totalMillis"],null),o.Xt=u.get(o.parsedPlaylist,["mediaPresentationDuration","totalMillis"],1/0),o.Qt=u.get(o.parsedPlaylist,["minBufferTime","totalMillis"],null),o.Wt=o.parsedPlaylist.type,i=function(t){var e=this;return u.map(t.representations,function(t){return{chunkDuration:t.duration,dataChunkUrlTemplate:t.media,codec:t.mseCodec,bandwidth:t.bandwidth,height:t.height,trackId:t.id,initUrl:t.initialization,mimeType:t.mimeType,totalNumberOfChunks:Math.ceil(e.Xt/t.duration)}})}.call(o,o.parsedPlaylist),u.forEach(i,function(t){v.call(o,new h(o.Pt,t))}),n.calculateOffset(function(t,e){o.Vt=e,r()}),n.setInterval(function t(e,i){if(e)return o.$t("Unable to get server local time offset",e),n.setInterval(t);o.Vt=i});break;case"Hls":s=new l(o.Pt,o.jt,t),o.parsedPlaylist=s,o.Gt=null,o.Qt=0,o.Jt=0,o.Xt=1/0;var a=0;u.forEach(s.streamVariants,function(t){var i=o.baseUrl+t.name,n=new f(o.Pt,{mediaSegmentPlaylistUrl:i,codecs:t.codecs.join(","),bandwidth:t.bandwidth,trackId:t.name,mimeType:"application/octet-stream",height:null});c.getWithRetry(i,{retryOptions:{maxAttempts:5,backoff:1}},function(t,e){if(t)return y.call(o,i,t,e,r);n.updateMediaSegments(e.data),v.call(o,n),++a===s.streamVariants.length&&(o.Wt=n.isComplete()?"static":"dynamic","static"===o.Wt&&(o.Xt=1e3*n.getPlayableDuration()),r())})});break;default:throw o.Pt.error("[%s] Unsupported Delivery Type [%s]",o.playlistUrl,g(o.playlistUrl)),new Error("Unsupported Delivery Type "+g(o.playlistUrl))}}).call(n,e.data,e.stats.successResponseTime,function(){i(t,{raw:e,parsed:n.parsedPlaylist})})})}).call(this,t)},t.prototype.getType=function(){return this.Wt},t.prototype.getDeliveryType=function(){return this.zt},t.prototype.getPlaylistTracksByBandwidthPerMimeType=function(r,s){n.xt(s,"restrictions");var o=this,t=u.map(this.Bt,function(t){var e=p(o.getPlaylistTracksByMimeType(t),s),i=u.reduce(e,function(t,e){return e.getBandwidth()>r?t:t&&t.getBandwidth()>e.getBandwidth()?t:e},null)||o.getPlaylistTrackByMimeTypeAndNextHighestBandwidth(0,t,s);if(i)return i;var n=u.get(u.filter(e,function(t){return!t.getBandwidth()}),"0");if(n)return o.Pt.debug("Unable to get track with bandwidth [%s] and restrictions [%s]. Falling back to track [%s].",r,JSON.stringify(s),n.getTrackId()),n;o.Pt.warn("Unable to get track with bandwidth [%s] and restrictions [%s]. No other tracks to fallback on.",r,JSON.stringify(s))});return u.filter(t,function(t){return!u.isNullOrUndefined(t)})},t.prototype.getPlaylistTrackByBandwidthAndMimeType=function(t,e){return u.find(this.getPlaylistTracksByBandwidthPerMimeType(t,{}),function(t){return t.getMimeType()===e})},t.prototype.getPlaylistTrackByMimeTypeAndNextHighestBandwidth=function(i,t,e){var n=p(this.getPlaylistTracksByMimeType(t),e);return u.reduce(n,function(t,e){return e.getBandwidth()<=i?t:t?t.getBandwidth()>e.getBandwidth()?e:t:e},null)},t.prototype.getAllPlaylistTracks=function(){return[].concat.apply([],u.values(this._t))},t.prototype.getMimeTypes=function(){return this.Bt},t.prototype.getPlaybackDurationSinceAvailable=function(){return this.currentServerTime()-this.Gt},t.prototype.getPlaybackDurationSincePublish=function(){return this.currentServerTime()-this.Kt},t.prototype.getSuggestedPresentationDelayTotalMillis=function(){return this.Jt},t.prototype.getTotalMediaTimeInMillis=function(){return this.Xt},t.prototype.getMinBufferTimeTotalMillis=function(){return this.Qt},t.prototype.getLocalToServerTimeOffset=function(){return this.Vt},t.prototype.currentServerTime=function(){return u.now()-this.Vt},t.prototype.getMaxChunkDuration=function(){return u.reduce(this.getAllPlaylistTracks(),function(t,e){return Math.max(e.getChunkDuration(),t)},0)},t.prototype.addEventListener=function(t,e){switch(n.Yt(t,"eventName"),n.Ct(e,"listener"),t){case"trackadded":return this.Lt.listen(e);default:throw new Error('Event "'+t+'" is unknown.')}},t}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n;void 0!==(n=function(){"use strict";return{name:{chunkNotFound:{id:0,name:"chunk-not-found"},timeout:{id:1,name:"timeout"},error:{id:2,name:"error"},playlistNotFound:{id:3,name:"playlist-not-found"},progressTimeOut:{id:4,name:"progress-timeout"},hlsNativeError:{id:5,name:"hls-native-error"}},category:{PLAYLIST:4,STREAMING:5,DRM:6},severity:{RECOVERABLE:1,CRITICAL:2}}}.apply(e,[]))&&(t.exports=n)},function(t,e,i){var n,r;n=[i(0)],void 0!==(r=function(n){"use strict";function t(t,e,i){n.xt(t,"logger")}return t.prototype.toString=function(){return"IPlaylistTrack[]"},t.prototype.dispose=function(){throw new Error("Must be implemented")},t.prototype.getMseCodec=function(){throw new Error("Must be implemented")},t.prototype.getTrackId=function(){throw new Error("Must be implemented")},t.prototype.getChunkDuration=function(){throw new Error("Must be implemented")},t.prototype.getBandwidth=function(){throw new Error("Must be implemented")},t.prototype.getHeight=function(){throw new Error("Must be implemented")},t.prototype.getMimeType=function(){throw new Error("Must be implemented")},t.prototype.getTotalNumberOfChunks=function(){throw new Error("Must be implemented")},t.prototype.getCurrentChunkId=function(){throw new Error("Must be implemented")},t.prototype.setCurrentChunkId=function(t){throw new Error("Must be implemented")},t.prototype.incrementCurrentChunkId=function(){throw new Error("Must be implemented")},t.prototype.addDataChunk=function(t,e,i){throw new Error("Must be implemented")},t.prototype.getChunks=function(){throw new Error("Must be implemented")},t.prototype.addEventListener=function(t,e){throw new Error("Must be implemented")},t}.apply(e,n))&&(t.exports=r)},function(t,e){t.exports=u},function(t,e,i){var n,r;n=[i(1),i(2)],void 0!==(r=function(s,i){"use strict";function t(t,e){this.f=e||{},this.Pt=t||new i.Logger,this.Zt={},this.te=e.ewmaPeriods||null,this.ee=this.te?2/(this.te+1):null}function o(t,e,i,n,r){var s=(i*(t.length-1)+r(e))/t.length;if(0<n)for(;e.added-t[0].added>n;){var o=t.shift();s=(s*(t.length+1)-r(o))/t.length}return s}return t.prototype.toString=function(){var i=this;return"StatsProvider [rateDataPoints(keys)="+s.keys(this.Zt)+", rateDataPoints="+s.toString(s.map(this.Zt,function(t,e){return i.getRateAverages(e)}))+", options="+this.f+"]"},t.prototype.dispose=function(){delete this.Zt},t.prototype.addRateDataPoint=function(t,e,i,n){if(!s.isNullOrUndefined(this.Zt)){this.Zt[t]||(this.Zt[t]={tenSecDataPoints:[],thirtySecDataPoints:[],oneMinDataPoints:[],twoMinDataPoints:[],ewmaDataPoints:[],tenSecAverageRate:0,thirtySecAverageRate:0,oneMinAverageRate:0,twoMinAverageRate:0,ewmaRate:0,smaRate:0,tenSecAverageDuration:0,thirtySecAverageDuration:0,oneMinAverageDuration:0,twoMinAverageDuration:0,ewmaDuration:0,smaDuration:0});var r={duration:e,amount:i,durationToSecondsFactor:n,rate:i/(e*n),added:s.now()};(function(t,e){function i(t){return t.rate}function n(t){return t.duration}t.tenSecDataPoints.push(e),t.thirtySecDataPoints.push(e),t.oneMinDataPoints.push(e),t.twoMinDataPoints.push(e),t.tenSecAverageRate=o.call(this,t.tenSecDataPoints,e,t.tenSecAverageRate,1e4,i),t.thirtySecAverageRate=o.call(this,t.thirtySecDataPoints,e,t.thirtySecAverageRate,3e4,i),t.oneMinAverageRate=o.call(this,t.oneMinDataPoints,e,t.oneMinAverageRate,6e4,i),t.twoMinAverageRate=o.call(this,t.twoMinDataPoints,e,t.twoMinAverageRate,12e4,i),t.tenSecAverageDuration=o.call(this,t.tenSecDataPoints,e,t.tenSecAverageDuration,1e4,n),t.thirtySecAverageDuration=o.call(this,t.thirtySecDataPoints,e,t.thirtySecAverageDuration,3e4,n),t.oneMinAverageDuration=o.call(this,t.oneMinDataPoints,e,t.oneMinAverageDuration,6e4,n),t.twoMinAverageDuration=o.call(this,t.twoMinDataPoints,e,t.twoMinAverageDuration,12e4,n),this.ee&&(t.ewmaDataPoints.push(e),t.smaRate=o.call(this,t.ewmaDataPoints,e,t.smaRate,-1,i),t.smaDuration=o.call(this,t.ewmaDataPoints,e,t.smaDuration,-1,n),t.ewmaDataPoints.length>=this.te&&(t.ewmaDataPoints.shift(),t.ewmaDataPoints.length===this.te?(t.ewmaRate=t.smaRate,t.ewmaDuration=t.smaDuration):(t.ewmaRate=this.ee*(t.smaRate-t.ewmaRate)+t.ewmaRate,t.ewmaDuration=this.ee*(t.smaDuration-t.ewmaDuration)+t.ewmaDuration)))}).call(this,this.Zt[t],r)}},t.prototype.getRateAverages=function(t){if(!s.get(this.Zt,[t]))return{tenSecAverageRate:0,thirtySecAverageRate:0,oneMinAverageRate:0,twoMinAverageRate:0,ewmaRate:0,tenSecAverageDuration:0,thirtySecAverageDuration:0,oneMinAverageDuration:0,twoMinAverageDuration:0,ewmaDuration:0};var e=this.Zt[t];return{tenSecAverageRate:e.tenSecAverageRate,thirtySecAverageRate:e.thirtySecAverageRate,oneMinAverageRate:e.oneMinAverageRate,twoMinAverageRate:e.twoMinAverageRate,ewmaRate:e.ewmaRate,tenSecAverageDuration:e.tenSecAverageDuration,thirtySecAverageDuration:e.thirtySecAverageDuration,oneMinAverageDuration:e.oneMinAverageDuration,twoMinAverageDuration:e.twoMinAverageDuration,ewmaDuration:e.ewmaDuration}},t}.apply(e,n))&&(t.exports=r)},function(t,e){t.exports=c},function(t,e){t.exports=h},function(t,e,i){var n,r;n=[i(0)],void 0!==(r=function(r){"use strict";function t(t,e,i,n){r.xt(t,"logger")}return t.prototype.toString=function(){return"IPlaylistChunkFeeder[]"},t.prototype.dispose=function(){throw new Error("Must be implemented")},t.prototype.initialize=function(t,e,i,n){throw new Error("Must be implemented")},t.prototype.setActiveTracks=function(t){throw new Error("Must be implemented")},t.prototype.initializePlaylistTracks=function(t,e,i,n){throw new Error("Must be implemented")},t.prototype.startRequestingDataForActiveTracks=function(){throw new Error("Must be implemented")},t.prototype.isFetchingData=function(){throw new Error("Must be implemented")},t.prototype.seekToChunk=function(t){throw new Error("Must be implemented")},t.prototype.stopRequestingAllData=function(){throw new Error("Must be implemented")},t}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(14)],void 0!==(r=function(y,w,b){"use strict";function t(t,e){w.Nt(e,"mpdXml"),w.xt(t,"logger"),this.ie=e,this.Pt=t,this.minBufferTime=0,this.type=null,this.publishTime=null,this.availabilityStartTime=null,this.timeShiftBufferDepth=0,this.suggestedPresentationDelay=0,this.minimumUpdatePeriod=0,this.maxSegmentDuration=0,this.profiles=null,this.moreInfoUrl=null,this.programInfoTitle=null,this.representations=[],function(){w.Nt(this.ie,"mpdXml");var t,e=b.parseXml(this.ie),i=e.getElementsByTagName("parsererror");if(i&&0<i.length)throw t="Failed to parse MPD Playlist XML: "+i.item(0).innerText+" (source xml: "+this.ie+")",this.Pt.error(t),new Error(t);if("MPD"!==e.documentElement.nodeName)throw t='Invalid MPD Playlist XML. Does not start with "MPD": '+this.ie,this.Pt.error(t),new Error(t);this.minBufferTime=k(E(e.documentElement,"minBufferTime")),this.type=E(e.documentElement,"type"),this.publishTime=S(E(e.documentElement,"publishTime")),this.availabilityStartTime=S(E(e.documentElement,"availabilityStartTime")),this.timeShiftBufferDepth=k(E(e.documentElement,"timeShiftBufferDepth")),this.suggestedPresentationDelay=k(E(e.documentElement,"suggestedPresentationDelay")),this.minimumUpdatePeriod=k(E(e.documentElement,"minimumUpdatePeriod")),this.maxSegmentDuration=k(E(e.documentElement,"maxSegmentDuration")),this.mediaPresentationDuration=k(E(e.documentElement,"mediaPresentationDuration")),this.profiles=E(e.documentElement,"profiles");var n=e.getElementsByTagName("ProgramInformation"),r=e.getElementsByTagName("UTCTiming");if(n&&1<=n.length){var s=n.item(0);this.programInfoTitle=T(s,"Title").childNodes[0].nodeValue,this.moreInfoUrl=E(s,"moreInformationURL")}var o=e.getElementsByTagName("ContentProtection");if(this.contentProtectionTags=[],0<o.length)for(var a=0;a<o.length;a++){var u=o.item(a),c=y.reduce(u.attributes,function(t,e){return t[e.name]=e.value,t},{});this.contentProtectionTags.push(c)}for(var h=e.getElementsByTagName("Representation"),f=0;f<h.length;f++){var d=function(t){var e={};if(e.id=E(t,"id"),e.mimeType=E(t,"mimeType"),e.codecs=E(t,"codecs"),e.mseCodec=b.getMSECodec(e.mimeType,e.codecs),e.isAudio=0<=e.mimeType.indexOf("audio"),e.isVideo=0<=e.mimeType.indexOf("video"),!b.isCodecSupported(e.mseCodec))return this.Pt.debug("MPD representation has unsupported codec. Skipping stream id [%s] (mimeType=[%s], codecs=[%s])",e.id,e.mimeType,e.codecs),null;var i=E(t,"bandwidth");e.bandwidth=i?parseInt(i,10):null;var n=E(t,"height");e.height=n?parseInt(n,10):null;var r=T(t,"SegmentTemplate");return r&&(e.timescale=parseInt(E(r,"timescale")),e.media=E(r,"media"),e.startNumber=parseInt(E(r,"startNumber")),e.duration=parseInt(E(r,"duration")),e.initialization=E(r,"initialization")),e}.call(this,h.item(f));d&&this.representations.push(d)}this.timeSources=[];for(var l=0;l<r.length;l++){var m=r.item(l),p=E(m,"schemeIdUri"),v=E(m,"value"),g=S(v);this.timeSources.push({name:p,value:isNaN(g.getTime())?v:g.getTime()})}}.call(this)}function k(t){if(!t)return null;var e=/^(-)?P(?:(-?[0-9,.]*)Y)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)W)?(?:(-?[0-9,.]*)D)?(?:T(?:(-?[0-9,.]*)H)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)S)?)?$/.exec(t);if(e){var i="-"===e[1]?-1:1,n={year:r(e[2],i),month:r(e[3],i),week:r(e[4],i),day:r(e[5],i),hour:r(e[6],i),minute:r(e[7],i),second:r(e[8],i)};return n.totalMillis=1e3*(n.second+60*(n.minute+60*(n.hour+24*n.day))),n}return null}function r(t,e){var i=t&&parseFloat(t.replace(",","."));return(isNaN(i)?0:i)*e}function S(t){if(!t)return null;var e=new Date;return e.setTime(Date.parse(t)),e}function E(t,e){var i=t.attributes.getNamedItem(e);return i?i.value:null}function T(t,e){for(var i=0;i<t.childNodes.length;i++){var n=t.childNodes.item(i);if(n.nodeName===e)return n}return null}return t.prototype.toString=function(){return"Mpd [minBufferTime="+this.minBufferTime+", type="+this.type+", publishTime="+this.publishTime+", availabilityStartTime="+this.availabilityStartTime+", timeShiftBufferDepth="+this.timeShiftBufferDepth+", suggestedPresentationDelay="+this.suggestedPresentationDelay+", minimumUpdatePeriod="+this.minimumUpdatePeriod+", maxSegmentDuration="+this.maxSegmentDuration+", profiles="+this.profiles+", moreInfoUrl="+this.moreInfoUrl+", programInfoTitle="+this.programInfoTitle+", representations="+JSON.stringify(this.representations)+"]"},t}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(8)],void 0!==(r=function(a,i,n){"use strict";function t(){}return t.prototype.isCodecSupported=function(t){return i.Nt(t,"codec"),n.global.MediaSource&&"function"==typeof n.global.MediaSource.isTypeSupported&&n.global.MediaSource.isTypeSupported(t)},t.prototype.parseXml=function(t){if(i.Nt(t,"xmlString"),void 0!==n.global.DOMParser)return(new n.global.DOMParser).parseFromString(t,"text/xml");if(void 0!==n.global.ActiveXObject&&new n.global.ActiveXObject("Microsoft.XMLDOM")){var e=new n.global.ActiveXObject("Microsoft.XMLDOM");return e.async="false",e.loadXML(t),e}throw new Error("No XML parser found")},t.prototype.getMSECodec=function(t,e){return i.Nt(t,"mpdMimeType"),i.Nt(e,"mpdCodecs"),t+'; codecs="'+e+'"'},t.prototype.getChunkIndexFromSegmentTemplate=function(t,e){var i=t.match(/\$Number.*\$/),n=t.match(/\$Number%(\d\d)d\$/),r=a.get(n,[1],"0"),s=parseInt(r,10),o=a.pad(e,s);if(!i)throw new Error("Unable to match template Url ["+t+"]");return t.replace(i[0],o)},new t}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0)],void 0!==(r=function(m,n){"use strict";function t(t,e,i){n.Nt(i,"M3u8VariantPlaylistString"),n.Nt(e,"name"),n.xt(t,"logger"),this.ne=i,this.jt=e,this.Pt=t,function(t){var d=t.match(/[^\r\n]+/g),l=this;return m.forEach(d,function(t,e){var i,n,r,s,o,a,u=t.match(/(?!#)EXT.+?(?=[:\n\r])/),c=m.get(u,["0"],null),h=t.trim().substring(c?c.length+2:0,t.length);switch(c){case"EXT-X-STREAM-INF":l.streamVariants=l.streamVariants||[];var f=[h,d[e+1]];l.streamVariants.push((o=(n=(i=f)[0],r=m.get(n.match(/(?:CODECS=).*?",/),["0"],""),(s=m.get(r.split("="),["1"],"")).substring(1,s.length-2)||"").split(","),a=(p(i[0],"FRAME-RATE")||"").trim(),{programId:p(i[0],"PROGRAM-ID"),codecs:o,bandwidth:parseInt(p(i[0],"BANDWIDTH")),averageBandwidth:parseInt(p(i[0],"AVERAGE-BANDWIDTH")),frameRate:parseInt(parseInt(a)||0),name:m.get(i,["1"],"").trim()}));break;case"EXT-X-ALLOW-CACHE":l.allowCache="YES"===h;break;case"#EXT-X-COMBINED":l.combined="YES"===h;break;case"EXTM3U":case null:break;default:return l.Pt.debug("[%s] [Variant] Playlist unsupported key type [%s]",l.jt,c)}}),l}.call(this,this.ne)}function p(t,e){var i=new RegExp("(?:"+e+"=).*?(?=[,\n\r])"),n=new RegExp("(?:"+e+"=).*?$"),r=m.get(t.match(i)||t.match(n),["0"],"");return m.get(r.split("="),["1"])}return t.prototype.toString=function(){return"M3u8VariantPlaylist[name="+this.jt+",numberOfStreamVariants="+this.streamVariants.length+"]"},t}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(2),i(3),i(17),i(12),i(5),i(7),i(9),i(13),i(14),i(6)],void 0!==(r=function(u,o,r,s,a,t,c,h,f,d,l,m){"use strict";function e(t,e,i,n){o.Ht(e,c,"playlist"),o.Ht(e.parsedPlaylist,d,"playlist.parsedPlaylist"),o.Ht(i,f,"statsProvider"),o.Nt(e.playlistUrl,"playlist.playlistUrl"),o.Nt(e.baseUrl,"playlist.baseUrl"),o.re(n.targetLatency,"options.targetLatency"),n&&n.defaultPresentationDelay&&o.re(n.defaultPresentationDelay,"options.defaultPresentationDelay"),this.se=e,this.oe=this.se.baseUrl,this.ae=i,this.Pt=t||new r.Logger,this.ue=new a(this.Pt),this.ce=new s.Event,this.he=[],this.fe=0,this.de=!1,this.le=u.get(n,"defaultPresentationDelay",0),this.me=1e3*n.targetLatency,this.pe={average:0,values:[],maxSize:10}}function p(t){var e=Math.max(this.me?this.me:0,0),i=this.se.getPlaybackDurationSinceAvailable(),n=Math.max(Math.ceil((i-e)/t),0);return"static"===this.se.getType()&&(n=0),this.Pt.trace("Getting chunk index to start: [%s], playbackTimePassed=[%s], duration=[%s]",n,i,t),n}function i(){var e=this;u.forEach(e.he,function(t){t.setCurrentChunkId(v.call(e,t.getChunkDuration()))})}function v(t){var e=t/1e3;return Math.floor(this.fe/e)}function g(t){var e=1e3*this.fe+2*t.getChunkDuration()-this.se.getPlaybackDurationSinceAvailable(),i=Math.max(e,0);return Math.min(t.getChunkDuration(),i)+this.pe.average}function y(e,i,n,r){var s=this;(function(r,s,o){var a=this,u=l.getChunkIndexFromSegmentTemplate(a.oe+r.getDataChunkUrlTemplate(),r.getCurrentChunkId()),c=r.getCurrentChunkId();a.Pt.trace("Fetching data chunk for [%s]: [%s], nextChunkId=[%s]",r.getMseCodec(),u,r.getCurrentChunkId());var h=r.getMseCodec();w.call(a,u,s,S,function(t,e){if(a.Pt.trace("DONE Fetching data chunk for [%s] : [%s], nextChunkId=[%s]",h,u,r.getCurrentChunkId()+(t?": FAILED: "+t.code:": data="+e.data.byteLength)),!t){a.ae.addRateDataPoint(h,e.stats.successResponseTime,e.data.byteLength,.001);var i=e.stats.totalResponseTimeForAllAttempts-e.stats.successResponseTime-Math.max(s,0);if(a.pe.values.push(i),a.pe.average=(a.pe.average*(a.pe.values.length-1)+i)/a.pe.values.length,a.pe.values.length>a.pe.maxSize){var n=a.pe.values.shift();a.pe.average=(a.pe.average*(a.pe.values.length+1)-n)/a.pe.values.length}}if(!t&&c===r.getCurrentChunkId())return r.incrementCurrentChunkId(),a.fe=r.getChunkDuration()*r.getCurrentChunkId()/1e3,r.addDataChunk(e.data,c,function(){o(t)});t?(t.feederReason=404===t.code?"not yet available":"other",o(t)):o(null,e.data)})}).call(s,e,n,function(t){return t&&s.Pt.trace('Failed to fetch data chunk of stream for config [%s]". Error: [%s]',e,t),!t&&1<i&&y.call(s,e,i-1,n,r),r(t)})}function w(r,t,e,s){var o=this,i={responseType:"arraybuffer",retryOptions:{delay:e,maxAttempts:k},timeout:E};if(u.re(t)&&0!==t)i.delay=t;else if(!u.isNullOrUndefined(t)&&0!==t)throw new Error('"delay" must be a positive number greater than or equal to 0 or null or undefined');return this.ue.getWithRetry(r,i,function(t,e){if(t){if(e&&e.attempts===k){var i="Failed to get chunk ["+r+"] with max retries of ["+k+" after ["+u.get(e,["stats","totalResponseTimeForAllAttempts"],0)+"] ms";return o.Pt.warn(i),o.ce.fire([b(m.name.chunkNotFound.name,m.severity.CRITICAL,i)])}if(0!==t.code)return o.Pt.warn("Failed to load data chunk [%s]. Status code: [%s] (status text: [%s])",r,t.code,t.message),o.ce.fire([b(m.name.error.name,m.severity.CRITICAL,t)]);var n="Failed to get chunk ["+r+"]  with timeout after ["+u.get(e,["stats","totalResponseTimeForAllAttempts"],0)+"] ms with chunk timeout of ["+E+"]";return o.Pt.warn(n),o.ce.fire([b(m.name.timeout.name,m.severity.RECOVERABLE,n)])}s(t,e)})}function b(t,e,i){return{category:m.category.STREAMING,name:t,severity:e,error:"Error"===i.constructor.name?i:new Error(i)}}var k=15,S=150,E=5e3;return((e.prototype=Object.create(t.prototype)).constructor=e).prototype.toString=function(){return"MpdPlaylistChunkFeeder [mpdPlaylistUrl="+this.se.playlistUrl+", baseUrl="+this.oe+", defaultPresentationDelay="+this.le+"]"},e.prototype.addEventListener=function(t,e){switch(o.Yt(t,"eventName"),o.Ct(e,"listener"),t){case"error":return this.ce.listen(e);default:throw new Error('Event "'+t+'" is unknown.')}},e.prototype.dispose=function(){this.stopRequestingAllData(u.noop),this.ue.dispose(),this.se.dispose(),this.ae.dispose(),this.ce.dispose(),this.he=null,this.fe=0},e.prototype.initializeActiveTracks=function(e){var i=this;o.Ct(e,"callback");var t=u.filter(this.he,function(t){return!t.getInitChunkData()});if(0===t.length)return e();(function(e,i){o.isArray(e,"tracks"),o.Ct(i,"callback");var n=0,r=this;u.forEach(e,function(t){o.Ht(t,h,"track"),t.setCurrentChunkId(p.call(r,t.getChunkDuration())),function(n,r){var s=this;(function(i,n){var r=this;r.Pt.trace("Fetching init chunk for [%s]: [%s], nextChunkId=[%s]",i.getMseCodec(),r.oe+i.getInitUrl(),i.getCurrentChunkId()),w.call(r,r.oe+i.getInitUrl(),null,500,function(t,e){r.Pt.trace("DONE Fetching init chunk for [%s]: [%s], nextChunkId=[%s]",i.getMseCodec(),r.oe+i.getInitUrl(),i.getCurrentChunkId()+(t?": FAILED: "+t.code:": data="+e.data.byteLength)),n(t,e.data)})}).call(s,n,function(t,e){if(t){var i=new Error("Failed to fetch init chunk of stream for config [%s]",n);return i.cause=t,s.Pt.error("[%s] (Cause: [%s])",i.message,t),r(i)}n.setInitChunkData(e),s.Pt.debug("Got init chunk for track [%s]",n.getTrackId()),r()})}.call(r,t,function(t){if(t)return i(t);++n===e.length&&i()})})}).call(i,t,e,function(t){return i.Pt.error("Unable to initialize active tracks",t),e(t)})},e.prototype.fetchNChunks=function(i,n){if(o.re(i,"chunksToFetch"),o.Ct(n,"done"),this.isFetchingData())return this.Pt.debug("Unable to fetch requesting data. Feeder is already fetching data.");var r=this,s=0;r.Pt.debug("Fetching [%s] chunks for [%s] active tracks",i,this.he.length),u.forEach(this.he,function(e){return o.Ht(e,h,"track"),e.setCurrentChunkId(p.call(r,e.getChunkDuration())),y.call(r,e,i,null,function(t){return t?(r.Pt.warn("Failed to get [%s] chunks for track [%s]",i,e.getTrackId(),t),n(t)):++s===r.he.length?(r.Pt.info("Got [%s] chunks for [%s] active tracks",i,r.he.length),n()):void 0})})},e.prototype.setActiveTracks=function(t){this.he=t},e.prototype.getActiveTracks=function(){return this.he},e.prototype.startRequestingDataForActiveTracks=function(){if(this.isFetchingData())return this.Pt.debug("Unable to start requesting data. Feeder is already fetching data.");this.de=!0,this.Pt.debug("Starting requesting data at timestamp [%s]",this.fe),i.call(this),function r(s){var o=this,a=o.he.length;u.forEach(o.he,function(t,e){!function(i,t){if(u.find(o.he,function(t){return t.getMimeType()===i.getMimeType()})===i){var n=v.call(o,i.getChunkDuration()),e=n>=i.getTotalNumberOfChunks();if("static"===o.se.getType()&&e)return t===a-1&&(o.de=!1),o.Pt.info("Finished getting chunks for [static] track [%s] [%s]",i.getTrackId(),i.getMimeType());u.isNullOrUndefined(s)&&"dynamic"===o.se.getType()&&(s=g.call(o,i)),y.call(o,i,1,s,function(t){if(t&&t.causes&&0<t.causes.length&&"not yet available"===t.causes[0].feederReason?o.Pt.info("Failed to get next chunk (packet not yet available) for [%s]|[%s]. Trying to fetch again in [%s] ms.",i.getMseCodec(),i.getBandwidth(),S):(t&&o.Pt.warn("Failed to get next chunk (# of errors=[%s], errors=[%s]). Moving on.",t.causes?t.causes.length:"n/a",t),a--),a<=0&&o.de){if("dynamic"===o.se.getType()){var e=g.call(o,i);return o.Pt.debug("Done fetching chunk with index [%s] for each active track. Waiting for [%s] ms before moving on to next chunk.",n,e),r.call(o,e)}o.Pt.debug("Done fetching chunk with index [%s] for each active track. Moving on to next chunk",n),r.call(o,null)}})}}(t,e)})}.call(this,null)},e.prototype.isFetchingData=function(){return this.de},e.prototype.seekToChunk=function(t){this.fe=Math.floor(t),this.Pt.debug("Seeking to timestamp [%s]",this.fe),i.call(this)},e.prototype.seekToCurrent=function(){var t=u.reduce(this.he,function(t,e){return e.getChunkDuration()>t?e.getChunkDuration():t},0),e=(Math.max(this.se.getPlaybackDurationSinceAvailable(),0)-Math.max(this.me?this.me:0,t))/1e3;return this.Pt.info("Seeking to most recent chunk"),this.seekToChunk(e),e},e.prototype.stopRequestingAllData=function(){this.de&&(this.de=!1,this.Pt.debug("Pausing requesting of data at timestamp [%s]",this.fe),this.ue.disposePendingRequests())},e}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(10),i(4)],void 0!==(r=function(e,s,o,i){"use strict";function t(t){s.xt(t,"logger"),this.Pt=t,this.ve=new i.DisposableList}return t.prototype.toString=function(){return"HttpRequestManager"},t.prototype.disposePendingRequests=function(){this.ve.dispose(),this.ve=new i.DisposableList},t.prototype.dispose=function(){this.disposePendingRequests()},t.prototype.getWithRetry=function(i,t,n){s.Nt(i,"url"),s.xt(t,"options"),s.Ct(n,"callback");var r=this;t.retryOptions=e.assign({delay:0,backoff:1,maxAttempts:1,additionalRetryErrorCodes:[404,0]},t.retryOptions),this.ve.add(o.getWithRetry(i,t,function(t,e){return t&&4e3===t.code?r.Pt.debug("Request handler disposed of before response received for get [%s]",i):(t&&r.Pt.debug("Status code: [%s] (status text: [%s]) for get [%s]",t.code,t.message,i),n(t,e))}))},t}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(2),i(3),i(17),i(12),i(5),i(7),i(9),i(15),i(6)],void 0!==(r=function(u,r,s,o,a,t,c,e,i,h,f){"use strict";function n(t,e,i,n){r.Ht(e,c,"playlist"),r.Ht(e.parsedPlaylist,h,"playlist.parsedPlaylist"),r.Nt(e.playlistUrl,"playlist.playlistUrl"),r.Nt(e.baseUrl,"playlist.baseUrl"),n&&n.targetLatencyInMilliseconds&&r.re(n.targetLatencyInMilliseconds,"options.targetLatencyInMilliseconds"),this.se=e,this.oe=this.se.baseUrl,this.ae=i,this.Pt=t||new s.Logger,this.ue=new a(this.Pt),this.f=n,this.ce=new o.Event,this.he=[],this.fe=0,this.de=!1,this.me=u.get(n,"targetLatencyInMS",0),this.ge=Math.max(this.se.getSuggestedPresentationDelayTotalMillis(),this.se.getMinBufferTimeTotalMillis(),this.le),this.ye=Math.max(this.se.getPlaybackDurationSinceAvailable()-this.ge,0)}function d(){var t=this;u.re(t.we)||(t.we=setTimeout(function(){(function(r){var s=this,o=0;u.forEach(this.he,function(i){var n=i.getMediaSegmentPlaylistUrlInfo(),t=u.assign({version:u.now()},n.queryParameters),e={retryOptions:{delay:w,maxAttempts:b},queryParameters:t};s.ue.getWithRetry(n.url,e,function(t,e){if(t)return s.Pt.debug("Unable to get media segment playlist [%s]",n.url);e&&i.updateMediaSegments(e.data),++o===s.he.length&&r()})},y)}).call(t,function(){u.isNullOrUndefined(t.we)||(t.we=null,d.call(t))})},y))}function l(n){var r=this,s=r.he.length;r.be=!1,u.forEach(r.he,function(t,e){var i;i=t,u.find(r.he,function(t){return t.getMimeType()===i.getMimeType()})!==i?r.Pt.debug("Wrong track type [%s]. Pausing fetching for track [%s]",i.getMimeType(),i.getTrackId()):i.isLastMediaSegment(r.fe)?("dynamic"===r.se.getType()&&(r.be=!0),r.Pt.debug("No more chunks. Pausing fetching for track [%s]",i.getMimeType(),i.getTrackId())):m.call(r,i,1,n,function(t){if(t&&t.causes&&0<t.causes.length&&"not yet available"===t.causes[0].feederReason?r.Pt.info("Failed to get next chunk (packet not yet available) for [%s]|[%s]. Trying to fetch again in [%s] ms.",i.getMseCodec(),i.getBandwidth(),g):(t&&r.Pt.warn("Failed to get next chunk (# of errors=[%s], errors=[%s]). Moving on.",t.causes?t.causes.length:"n/a",JSON.stringify(t)),s--),s<=0){r.Pt.debug("Done fetching chunk for timestamp [%s] for each active track. Moving on to next chunk. (keep fetching=[%s])",r.fe,r.de);var e=i.isLastMediaSegment(r.fe);if("static"===r.se.getType()&&e)return r.de=!1,r.Pt.info("Finished getting chunks for [static] track [%s] [%s]",i.getTrackId(),i.getMimeType());if(e)return r.be=!0,r.Pt.debug("Waiting for new segment on the Segment Playlist for [dynaimic] track [%s] [%s]",i.getTrackId(),i.getMimeType());r.de&&l.call(r,null)}})})}function m(e,i,n,r){var s=this;(function(i,t,n){var r=this,s=i.getSegmentByTimestamp(r.fe),o=r.oe+s.name;r.Pt.trace("Fetching data chunk for [%s]: [%s], next segment=[%s]",i.getMseCodec(),o,s.name);var a=i.getMseCodec();(function(r,t,s){var o=this,e={responseType:"arraybuffer",retryOptions:{delay:g,maxAttempts:v},timeout:k};if(u.re(t))e.delay=t;else if(!u.isNullOrUndefined(t))throw new Error('"delay" must be a number or null or undefined');return this.ue.getWithRetry(r,e,function(t,e){if(t){if(e&&e.attempts===v){var i="Failed to get chunk ["+r+"] with max retries of ["+v+" after ["+u.get(e,["stats","totalResponseTimeForAllAttempts"],0)+"] ms";return o.Pt.warn(i),o.ce.fire([p(f.name.chunkNotFound.name,f.severity.CRITICAL,i)])}if(0!==t.code)return o.Pt.warn("Failed to load [%s]. Status code: [%s] (status text: [%s])",r,t.code,t.message),o.ce.fire([p(f.name.error.name,f.severity.CRITICAL,t)]);var n="Failed to get chunk ["+r+"] with timeout after ["+u.get(e,["stats","totalResponseTimeForAllAttempts"],0)+"] ms with chunk timeout of ["+k+"]";return o.Pt.warn(n),o.ce.fire([p(f.name.timeout.name,f.severity.RECOVERABLE,n)])}s(t,e)})}).call(r,o,t,function(t,e){if(r.Pt.trace("DONE Fetching data chunk for [%s] : [%s], next segment=[%s]",a,o,s.name+(t?": FAILED: "+t.code:": data="+e.data.byteLength)),t||r.ae.addRateDataPoint(a,e.stats.successResponseTime,e.data.byteLength,.001),!t)return r.Pt.debug("Finished fetching [%s]. Updating timestamp to fetch to [%s]",s.name,s.timestamp+s.duration),r.fe=s.timestamp+s.duration,i.addDataChunk(e.data,s.name,function(){n(t)});t?(t.feederReason=404===t.code?"not yet available":"other",n(t)):n(null,e.data)})}).call(s,e,n,function(t){return t&&s.Pt.trace('Failed to fetch data chunk of stream for config [%s]". Error: [%s]',JSON.stringify(e),t),!t&&1<i&&m.call(s,e,i,n,r),r(t)})}function p(t,e,i){return{category:f.category.STREAMING,name:t,severity:e,error:"Error"===i.constructor.name?i:new Error(i)}}var v=15,g=700,y=500,w=10,b=2,k=5e3;return((n.prototype=Object.create(t.prototype)).constructor=n).prototype.toString=function(){return"M3u8PlaylistChunkFeeder [mpdPlaylistUrl="+this.se.playlistUrl+", baseUrl="+this.oe+", defaultPresentationDelay="+this.le+"]"},n.prototype.addEventListener=function(t,e){switch(r.Yt(t,"eventName"),r.Ct(e,"listener"),t){case"error":return this.ce.listen(e);default:throw new Error('Event "'+t+'" is unknown.')}},n.prototype.dispose=function(){this.stopRequestingAllData(u.noop),this.ue.dispose(),this.se.dispose(),this.ae.dispose(),this.he=null,this.fe=0,this.ke&&(this.ke.dispose(),this.ke=null)},n.prototype.initializeActiveTracks=function(t,e){r.Ct(e,"callback"),"dynamic"===this.se.getType()&&d.call(this),this.be=!1;var i=this;if(1!==this.he.length)throw new Error("Unable to support multiple active tracks");u.forEach(this.he,function(t){i.ke=t.addEventListener("segmentsready",function(){i.be&&(i.Pt.debug("Continuing fetching of track [%s] segments after wait",t.getTrackId()),l.call(i,null))})}),e()},n.prototype.fetchNChunks=function(t,e){if(r.re(t,"chunksToFetch"),r.Ct(e,"callback"),this.isFetchingData())return this.Pt.debug("Unable to fetch requesting data. Feeder is already fetching data.");var i=this,n=0;i.Pt.debug("Fetching [%s] chunks for [%s] active tracks",t,this.he.length),u.forEach(this.he,function(t){m.call(i,t,1,null,function(t){if(t)return e(t);++n===i.he.length&&(i.Se=u.now(),e())})})},n.prototype.setActiveTracks=function(t){this.he=t;var e=u.map(t,function(t){return t.getTrackId()});this.Pt.debug("Setting active tracks [%s]",e)},n.prototype.getActiveTracks=function(){return this.he},n.prototype.startRequestingDataForActiveTracks=function(){if(this.isFetchingData())return this.Pt.debug("Unable to start requesting data. Feeder is already fetching data.");this.de=!0,this.Pt.debug("Starting requesting data at timestamp [%s]",this.fe),"dynamic"===this.se.getType()&&d.call(this),l.call(this,null)},n.prototype.isFetchingData=function(){return this.de},n.prototype.seekToChunk=function(t){var e=u.get(this.he,["0"]),i=e.getClosestSegmentNotGreaterThanTimestamp(t),n=u.get(i,["timestamp"]);u.isUndefined(n)?e||(this.fe=t):this.fe=Math.floor(i.timestamp),this.Pt.debug("Seeking to timestamp [%s]",this.fe)},n.prototype.seekToCurrent=function(){var t=u.reduce(this.he,function(t,e){var i=u.get(e.getLastSegment(),["duration"],0);return t<i?i:t},0),e=(u.reduce(this.he,function(t,e){var i=e.getLastSegment().timestamp;return i<t?i:t},0)-Math.max(this.me?this.me-t:0,t))/1e3;return this.Pt.info("Seeking to most recent chunk"),this.seekToChunk(e),e},n.prototype.stopRequestingAllData=function(){this.de&&(this.de=!1,this.be=!1,this.Pt.debug("Pausing requesting of data at timestamp [%s]",this.fe),this.ue.disposePendingRequests(),clearTimeout(this.we),this.we=null)},n}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(2),i(3),i(10),i(4),i(11),i(8),i(6)],void 0!==(r=function(d,l,a,u,m,p,t,v,g){"use strict";function e(t,e,i,n){l.xt(e,"videoElement");var r=this;this.qt=e,this.Pt=t||new a.Logger,this.Ee=null,this.Te=null,this.Ie=null,this.g=new p.DisposableList;var s,o=d.bind(x,this);"Safari"===k.browser&&(o=d.bind(function(t,e){var i,n,r=this;if(e=e||1,!this.Re){if(e<=20)return r.Pt.debug("Attempt [%s] for checking if the certificate have been set",e),void(r.Ie=setTimeout(function(){x.call(r,t,e+1)},200));var s="Unable to find fairplay certificate after "+(e-1)+" attempts";return r.Pt.warn(s),r.Me.fire([b("NoCertificate",g.severity.RECOVERABLE,s)])}this.Pt.info("Key requested by Webkit browser"),r.Ce=(i=t.initData,"https://"+(n=i,String.fromCharCode.apply(null,new v.global.Uint16Array(n.buffer))).split("skd://")[1]);var o="phenix-fairplay-"+d.now(),a=function(t,e,i){var n=function(t){for(var e=new v.global.ArrayBuffer(2*t.length),i=new v.global.Uint16Array(e),n=0,r=t.length;n<r;n++)i[n]=t.charCodeAt(n);return i}(e),r=0,s=new v.global.ArrayBuffer(t.byteLength+4+n.byteLength+4+i.byteLength),o=new v.global.DataView(s);new Uint8Array(s,r,t.byteLength).set(t),r+=t.byteLength,o.setUint32(r,n.byteLength,!0),r+=4;var a=new v.global.Uint16Array(s,r,n.length);return a.set(n),r+=a.byteLength,o.setUint32(r,i.byteLength,!0),r+=4,new Uint8Array(s,r,i.byteLength).set(i),new Uint8Array(s,0,s.byteLength)}(t.initData,o,r.Re);if(r.qt.webkitKeys||r.qt.webkitSetMediaKeys(new v.global.WebKitMediaKeys(I)),!r.qt.webkitKeys)return r.Me.fire([b("webkitKeys",g.severity.RECOVERABLE,new Error("Could not create MediaKeys"))]);var u=r.qt.webkitKeys.createSession("video/mp4",a);if(!u)return r.Me.fire([b("webkitKeySession",g.severity.RECOVERABLE,new Error("Could not create key session"))]);var c=d.bind(y,r);u.addEventListener("webkitkeymessage",c,!1),r.g.add(new p.Disposable(function(){u.removeEventListener("webkitkeymessage",c,!1)}));function h(){r.Pt.info("Decryption key was added")}u.addEventListener("webkitkeyadded",h,!1),r.g.add(new p.Disposable(function(){u.removeEventListener("webkitkeyadded",h,!1)}));function f(t){r.Me.fire([b("webkitkeyerror",g.severity.RECOVERABLE,t)])}u.addEventListener("webkitkeyerror",f,!1),r.g.add(new p.Disposable(function(){u.removeEventListener("webkitkeyerror",f,!1)}))},this)),this.qt.addEventListener(C,o,!1),this.g.add(new p.Disposable(function(){r.qt.removeEventListener(C,o,!1)})),this.g.add(new p.Disposable(function(){null!==r.Te&&v.global.clearTimeout(r.Te)})),this.g.add(new p.Disposable(function(){null!==r.Ie&&v.global.clearTimeout(r.Ie)})),this.xe={initDataTypes:["cenc"],videoCapabilities:[{contentType:'video/mp4; codecs="avc1.42c01f"'}],audioCapabilities:[{contentType:'audio/mp4; codecs="mp4a.40.2"'}],persistentState:"optional",distinctiveIdentifier:"optional"},this.X={},"Edge"===k.browser||"IE"===k.browser?this.Pe=E:"Safari"===k.browser?this.Pe=I:this.Pe=S,function(e,i){var t,n=this,r=(t=d.keys(e).concat(d.keys(i)),d.keys(d.reduce(t,function(t,e){return t[e]=1,t},{})));d.forEach(r,function(t){d.set(n.X,[t],d.assign({},d.get(e,[t],{}),d.get(i,[t],{}))),d.set(n.X,[t,"mediaKeySystemConfiguration"],d.assign({},n.xe,d.get(e,[t,"mediaKeySystemConfiguration"],{}),d.get(i,[t,"mediaKeySystemConfiguration"],{})))})}.call(this,(s=i,d.reduce(s,function(i,t){var n="com.phenixp2p.widevine"===t.schemeIdUri||"com.phenixrts.widevine"===t.schemeIdUri?S:t.schemeIdUri===T?E:t.schemeIdUri,e="",r="";return"com.phenixp2p.widevine"!==t.schemeIdUri&&"com.phenixrts.widevine"!==t.schemeIdUri||(e=t.widevineLicenseServerUrl||t.licenseServerUrl,r=t.serverCertificateUrl),i[n]={licenseServerUrl:e?c(e):"",serverCertificateUrl:r?c(r):""},d.forOwn(t,function(t,e){d.startsWith(e,"mediaKeySystemConfiguration.")&&d.set(i[n],e,t)}),i},{})),n||{}),function(){l.xt(this.X,"this._config");var i=this;d.forOwn(this.X,function(t,e){l.De(e,R,e),e===i.Pe&&(e!==S&&e!==I||l.Nt(t.serverCertificateUrl,e+"[serverCertificateUrl]"),l.xt(t.mediaKeySystemConfiguration,e+"[mediaKeySystemConfiguration]"),l.Oe(t.mediaKeySystemConfiguration.initDataTypes,e+"[mediaKeySystemConfiguration][initDataTypes]"),l.isArray(t.mediaKeySystemConfiguration.videoCapabilities,e+"[mediaKeySystemConfiguration][videoCapabilities]"),l.isArray(t.mediaKeySystemConfiguration.audioCapabilities,e+"[mediaKeySystemConfiguration][audioCapabilities]"),l.Nt(t.mediaKeySystemConfiguration.persistentState,e+"[mediaKeySystemConfiguration][persistentState]"),l.Nt(t.mediaKeySystemConfiguration.distinctiveIdentifier,e+"[mediaKeySystemConfiguration][distinctiveIdentifier]"))})}.call(this),this.Me=new u.Event,this.Ae=new u.Event,this.g.add(this.Me),this.g.add(this.Ae),M&&function(){var r=this;if(!this.qt.mediaKeys){var t=d.get(this.X,[this.Pe,"mediaKeySystemConfiguration"]);v.global.navigator.requestMediaKeySystemAccess(this.Pe,[t]).then(function(t){t.createMediaKeys().catch(function(t){r.Me.fire([b("CreateMediaKeys",g.severity.CRITICAL,t)]),r.Pt.error("Unable to create MediaKeys",t)}).then(function(t){return r.Ee=t,r.qt.setMediaKeys(t)}).catch(function(t){r.Me.fire([b("SetMediaKeys",g.severity.CRITICAL,t)]),r.Pt.error("Unable to set MediaKeys",t)}).then(function(){return new v.global.Promise(function(n){var t=d.get(r.X,[r.Pe,"serverCertificateUrl"]);if(!t)return r.Pt.info("Not fetching server certificate because [%s] -> [serverCertificateUrl] is not set",r.Pe),n();f(t,function(t,e){if(t)return r.Pt.warn("Failed to get service certificate",t),n();var i=w(e.data);return r.Ee.setServerCertificate(i).then(n).catch(function(t){r.Pt.warn("Failed to set service certificate",t)})})})})}).catch(function(t){r.Me.fire([b("RequestMediaKeySystemAccess",g.severity.CRITICAL,t)]),r.Pt.error("[%s] Unable to request MediaKeySystemAccess with error [%s]",r.Pe,t)})}}.call(this),"Safari"===k.browser&&(v.global.WebKitMediaKeys.isTypeSupported("com.apple.fps.1_0","video/mp4")||r.Me.fire([b("isTypeSupported",g.severity.CRITICAL,new Error("com.apple.fps.1_0 Key System not supported"))]),f(d.get(r.X,[r.Pe,"serverCertificateUrl"]),function(t,e){t&&(r.Me.fire([b("getServerCertificateFairplay",g.severity.CRITICAL,t)]),r.Pt.error("[Fairplay] Failed to get service certificate",t)),r.Re=w(e.data)}))}function c(t){l.Nt(t,"xmlSafeUrl");var e=t.split("?"),i=d.get(e,[0]),n=d.get(e,[1],"");return i+(n?"?"+decodeURIComponent(n):"")}function y(t){var n=this,r=t.target;h.call(this,t.message,function(t,e){if(t)return n.Me.fire([b("LicenseRetrieval",g.severity.RECOVERABLE,t)]);try{var i=r.update(e)}catch(t){return n.Me.fire([b("KeySessionUpdate",g.severity.CRITICAL,t)])}d.Ct(d.get(i,["catch"]))&&i.catch(function(t){n.Me.fire([b("KeySessionUpdate",g.severity.CRITICAL,t)]),n.Pt.error("Update of keySession with license failed [%s]",t)})})}function h(t,s){var e,o=this,i=d.get(this.X,[this.Pe,"licenseServerUrl"],this.Ce),n={};if(l.Nt(i,"licenseServerUrl"),this.Pe===E){var r=(new DOMParser).parseFromString(String.fromCharCode.apply(null,new v.global.Uint16Array(t)),"application/xml");if(!r.getElementsByTagName("Challenge")[0])return s(new Error("[Playready] Cannot find `challenge` in key message"));e=atob(r.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue);var a=r.getElementsByTagName("name"),u=r.getElementsByTagName("value");if(a.length!==u.length)return s(new Error("[Playready] Mismatched header name/value pair in key message"));n.headers={};for(var c=0;c<a.length;c++){var h=d.get(a,[c,"childNodes",0,"nodeValue"]),f=d.get(u,[c,"childNodes",0,"nodeValue"]);h&&f&&(n.headers[h]=f)}n.responseType="arraybuffer"}else n.contentType="application/octet-stream",e=t;m.post(i,e,n,function(t,e){if(t)return o.Pt.error("Failed to get license with [%s] [%s]",t,e),s(t);if(o.Pe===E)return s(null,e.data);var i=e.data,n=null,r=null;try{o.Pt.debug("Attempting to unwrap license response"),n=(i=JSON.parse(i)).license||i.ckc,i.trackRestrictions&&o.Ae.fire([i.trackRestrictions])}catch(t){if(!(t instanceof SyntaxError))return o.Pt.error("Unexpected error [%s]",t),s(t);o.Pt.debug("Unwrapping of license failed. Assuming that license response is already unwrapped"),n=i}"<ckc>"===n.substr(0,5)&&"</ckc>"===n.substr(-6)&&(n=n.slice(5,-6));try{r=function(t){for(var e=v.global.atob(t),i=new Uint8Array(e.length),n=0;n<e.length;++n)i[n]=e.charCodeAt(n);return i}(n)}catch(t){o.Pt.error("Failed to convert base64 license string [%s] to binary",n),s(t)}s(null,r)})}function f(t,e){m.get(t,{mimeType:"text/plain; charset=x-user-defined"},e)}function w(t){for(var e=t.length,i=new v.global.Uint8Array(e),n=0;n<e;n++)i[n]=t.charCodeAt(n);return i}function b(t,e,i){return{category:g.category.DRM,name:t,severity:e,error:"Error"===i.constructor.name?i:new Error(i)}}var k=new t(v.global.navigator.userAgent).detect(),S="com.widevine.alpha",E="com.microsoft.playready",T="urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",I="com.apple.fps.1_0",R=d.freeze([{id:1,name:"org.w3.clearkey"},{id:2,name:S},{id:3,name:E},{id:4,name:T},{id:5,name:I}]),M=!!v.global.navigator.requestMediaKeySystemAccess,C="encrypted";M||"Edge"!==k.browser&&"IE"!==k.browser||(C="msneedkey"),"Safari"===k.browser&&(C="webkitneedkey"),e.isSupported=function(){return!(("IE"!==k.browser||11!==k.version)&&("Safari"===k.browser?d.isNullOrUndefined(v.global.WebKitMediaKeys)||d.isNullOrUndefined(v.global.Uint16Array)||d.isNullOrUndefined(v.global.Uint8Array)||d.isNullOrUndefined(v.global.ArrayBuffer)||d.isNullOrUndefined(v.global.DataView):d.isNullOrUndefined(v.global.navigator.requestMediaKeySystemAccess)||d.isNullOrUndefined(v.global.Promise)||d.isNullOrUndefined(v.global.Uint8Array)||d.isNullOrUndefined(v.global.atob)))},e.prototype.addEventListener=function(t,e){switch(l.Yt(t,"eventName"),l.Ct(e,"listener"),t){case"trackRestrictionsAvailable":return this.Ae.listen(e);case"error":return this.Me.listen(e);default:throw new Error('Event "'+t+'" is unknown.')}},e.prototype.toString=function(){return"EncryptedMediaHandler [config="+JSON.stringify(this.X)+"]"},e.prototype.dispose=function(){this.g.dispose(),delete this.Ee};var x=function(t,e){var i=this;if(e=e||1,!M)try{this.qt.msSetMediaKeys(new v.global.MSMediaKeys(this.Pe))}catch(n){return i.Me.fire([b("RequestMediaKeySystemAccess",g.severity.CRITICAL,new Error('Unable to create MediaKeys ("'+this.Pe+'"). Error: '+n.message))])}if(!this.Ee&&!i.qt.msKeys){if(e<=20)return i.Pt.debug("Attempt [%s] for checking if the media keys have been set",e),void(i.Te=setTimeout(function(){x.call(i,t,e+1)},200));var n="Unable to find media keys after "+(e-1)+" attempts";return i.Pt.warn(n),i.Me.fire([b("NoMediaKeys",g.severity.RECOVERABLE,n)])}if(i.qt.msKeys){var r=i.qt.msKeys.createSession("video/mp4",t.initData);r||i.Me.fire([b("NoKeySession",g.severity.CRITICAL,new Error("Could not create key session"))]);var s=function(t){h.call(i,t.message.buffer,function(t,e){if(t)return i.Me.fire([b("getLicense",g.severity.RECOVERABLE,t)]);r.update(new Uint8Array(e))})};r.addEventListener("mskeymessage",s,!1),i.g.add(new p.Disposable(function(){r.removeEventListener("mskeymessage",s,!1)}));var o=function(){i.Me.fire([b("MicrosoftKeyError",g.severity.CRITICAL,new Error("Unexpected `keyerror` event from key session. Code: "+r.error.code+", systemCode: "+r.error.systemCode))])};return r.addEventListener("mskeyerror",o,!1),void i.g.add(new p.Disposable(function(){r.removeEventListener("mskeyerror",o,!1)}))}var a=i.Ee.createSession(),u=d.bind(y,i);return a.addEventListener("message",u,!1),i.g.add(new p.Disposable(function(){a.removeEventListener("message",u,!1)})),a.generateRequest(t.initDataType,t.initData).then(function(){i.Pt.info("passing the media data to CDM")}).catch(function(t){i.Me.fire([b("InitKeySessionFailure",g.severity.CRITICAL,t)]),i.Pt.error("Unable to create or initialize key session [%s]",t)})};return e}.apply(e,n))&&(t.exports=r)},function(t,e){t.exports=f},function(t,e,i){var n,r;n=[i(1),i(0),i(2),i(4),i(20),i(5),i(9)],void 0!==(r=function(a,r,s,o,u,c,h){"use strict";function t(t,e,i,n){r.Ht(e,c,"playlist"),r.qe(i,"webPlayer"),r.Ht(n,h,"statsProvider"),this.se=e,this.Fe=i,this.ae=n,this.Pt=t||new s.Logger,this.Ue={nextSwitchCheckTime:a.now()+5e3,oldBandwidth:-1},this.g=new o.DisposableList,this.Fe.addEventListener("started",a.bind(function(){var s=this;this.Ne=a.reduce(this.se.getMimeTypes(),function(t,e){var i=s.se.getPlaylistTracksByMimeType(e)||[],n=a.filter(i,function(t){return a.re(t.getBandwidth())}),r=a.map(n,function(t){return t.getBandwidth()});return i.length>n.length&&s.Pt.info("Excluding [%s] tracks without Bandwidth from ABR switching.",i.length-n.length),t[e]={max:Math.max.apply(null,r),min:Math.min.apply(null,r)},t},{}),this.Pt.debug("Listening for bandwidth changes with max and min bandwidths of [%s]",this.Ne),this.Fe.addEventListener("playbacktimeleft",a.bind(function(t,e){if(!this.Ue.isInProgress&&u.isForeground()){var i=this.Ne[e.getMimeType()],n=this;if(0<this.Ue.nextSwitchCheckTime){if(this.Ue.nextSwitchCheckTime>a.now())return;this.Ue.nextSwitchCheckTime=0,this.Ue.oldBandwidth=-1}var r=a.bind(function(){this.Ue.isInProgress=!1},this);if(f.call(n,e,t)&&e.getBandwidth()<i.max){this.Ue.isInProgress=!0;var s=this.se.getPlaylistTrackByMimeTypeAndNextHighestBandwidth(e.getBandwidth(),e.getMimeType(),{});this.je=setTimeout(function(){f.call(n,e,n.Fe.getTimeLeft())?(n.Pt.info("Switching to higher quality track with [%s] time left in buffer and ewma of [%s].",n.Fe.getTimeLeft(),l.call(n,e)),n.Ue.nextSwitchCheckTime=a.now()+1e3*t+v,n.Ue.oldBandwidth=e.getBandwidth(),n.Fe.changeBandwidthLimit(s.getBandwidth(),r)):n.Ue.isInProgress=!1},500)}else if(d.call(n,e,t)&&e.getBandwidth()>i.min){this.Ue.isInProgress=!0;var o=this.se.getPlaylistTrackByBandwidthAndMimeType(e.getBandwidth()-1,e.getMimeType());this.je=setTimeout(function(){d.call(n,e,n.Fe.getTimeLeft())?(n.Pt.info("Switching to lower quality track with [%s] time left in buffer and ewma of [%s].",n.Fe.getTimeLeft(),l.call(n,e)),n.Ue.nextSwitchCheckTime=a.now()+1e3*t+5e3,n.Ue.oldBandwidth=e.getBandwidth(),n.Fe.changeBandwidthLimit(o.getBandwidth(),r)):n.Ue.isInProgress=!1},500)}}},this))},this)),this.g.add(u.onBackground(a.bind(m,this,!1))),this.g.add(u.onForeground(a.bind(m,this,!0))),this.Le=null,this._e=null}function f(t,e){var i=this.ae.getRateAverages(t.getMseCodec()).ewmaDuration,n=t.getChunkDuration();return 3.5<e||0<i&&i<=3*n/4&&2<e/(n/1e3)}function d(t,e){var i=this.ae.getRateAverages(t.getMseCodec()).ewmaDuration,n=t.getChunkDuration();return e<.7||0<i&&7*n/8<=i&&e/(n/1e3)<=1.5}function l(t){return this.ae.getRateAverages(t.getMseCodec()).ewmaDuration}function m(t){null!==this.je&&(clearTimeout(this.je),this.je=null);var e=this.Fe.getVideoElement();if(t){if(clearTimeout(this.Le),(this.Le=null)===this._e)return;var i=this._e;return this._e=null,i!==this.Fe.getBandwidthLimit()&&(this.Ue.nextSwitchCheckTime=a.now()+v,this.Pt.info("Detected change to [foreground] for tab. Reverting to [%s] previous bandwidth limit from [%s]",i,this.Fe.getBandwidthLimit()),this.Fe.changeBandwidthLimit(i)),void(p(e)||"dynamic"!==this.se.getType()||(this.Pt.info("Detecting application [foreground] with muted video. Resuming playback at most recent available chunk."),this.Fe.play()))}var n=this;this.Le=setTimeout(function(){u.isForeground()||(n._e=n.Fe.getBandwidthLimit(),p(e)||"dynamic"!==n.se.getType()||(n.Pt.info("Detecting application [background] with muted video. Pausing playback until application focused again."),n.Fe.pause()))},g)}function p(t){return!t.muted&&0!==t.volume&&(0<a.get(t,["webkitAudioDecodedByteCount"],0)||0<a.get(t,["audioTracks","length"],0)||t.mozHasAudio||t.hasAudio||t.webkitHasAudio)}var v=15e3,g=3e3;return t.prototype.dispose=function(){null!==this.je&&clearTimeout(this.je),null!==this.Le&&clearTimeout(this.Le),this.g.dispose(),this.Le=null,this.je=null},t}.apply(e,n))&&(t.exports=r)},function(t,e,i){"use strict";var n,r;n=[i(5),i(16),i(18),i(27),i(9),i(21),i(6)],void 0!==(r=function(t,e,i,n,r,s,o){return{Playlist:t,MpdPlaylistChunkFeeder:e,M3u8PlaylistChunkFeeder:i,WebPlayer:n,StatsProvider:r,AdaptiveStreamingManager:s,isSupported:n.isSupported,errors:o}}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(3),i(2),i(7)],void 0!==(r=function(r,n,s,t){"use strict";function e(t,e,i){if(r.xt(t,"logger"),r.xt(e,"playlistTrackConfig"),r.Nt(e.codec,"playlistTrackConfig.codec"),r.Nt(e.mimeType,"playlistTrackConfig.mimeType"),r.re(e.bandwidth,"playlistTrackConfig.bandwidth"),r.re(e.chunkDuration,"playlistTrackConfig.chunkDuration"),r.Nt(e.trackId,"playlistTrackConfig.trackId"),r.Nt(e.initUrl,"playlistTrackConfig.initUrl"),r.Nt(e.dataChunkUrlTemplate,"playlistTrackConfig.dataChunkUrlTemplate"),r.re(e.chunkDuration,"playlistTrackConfig.chunkDuration"),i=i||{},this.Pt=t||new s.Logger,this.Be=e.codec,this.ze=e.chunkDuration,this.We=e.bandwidth,this.pt=e.height,this.Ve=e.trackId,this.He=e.mimeType,this.Ge=e.initUrl,this.Ke=e.dataChunkUrlTemplate,this.Je=e.totalNumberOfChunks,this.Xe=null,this.Qe=i.maxChunksToCache||20,this.$e=i.lowWaterMaxChunks||15,r.re(this.Qe,"options.maxChunksToCache"),r.re(this.$e,"options.lowWaterMaxChunks"),this.$e>=this.Qe)throw new Error('The "maxChunksToCache" cannot be less than or equal to the "lowWaterMaxChunks"');this.Ye=null,this.Ze=[],this.ti=new n.Event}return((e.prototype=Object.create(t.prototype)).constructor=e).prototype.toString=function(){return"MpdPlaylistTrack [mseCodec="+this.Be+", maxChunksToCache="+this.Qe+", lowWaterMaxChunks="+this.$e+", initChunk="+this.Ye+", dataChunks(size)="+this.Ze.length+", chunkAddedEvent(size)="+this.ti.size()+", trackId="+(this.Ve?this.Ve:"n/a")+", bandwidth="+(this.bandwidth?this.bandwidth:"n/a")+"]"},e.prototype.dispose=function(){this.Ze=[],this.ti.dispose()},e.prototype.getMseCodec=function(){return this.Be},e.prototype.getTrackId=function(){return this.Ve},e.prototype.getChunkDuration=function(){return this.ze},e.prototype.getBandwidth=function(){return this.We},e.prototype.getHeight=function(){return this.pt},e.prototype.getMimeType=function(){return this.He},e.prototype.getTotalNumberOfChunks=function(){return this.Je},e.prototype.getInitChunkData=function(){return this.Ye},e.prototype.setInitChunkData=function(t){this.Ye=t},e.prototype.getCurrentChunkId=function(){return this.Xe},e.prototype.setCurrentChunkId=function(t){this.Xe=t},e.prototype.incrementCurrentChunkId=function(){null===this.Xe&&this.Pt.error("[%s] Attempting to increment `CurrentChunkId` that is not initialized",this.Ve),this.Xe++},e.prototype.getInitUrl=function(){return this.Ge},e.prototype.getDataChunkUrlTemplate=function(){return this.Ke},e.prototype.addDataChunk=function(t,e,i){r.qe(t,"dataChunk"),i=i||function(){},r.Ct(i,"eventCallback");var n={data:t,chunkId:e,timestamp:e*this.ze/1e3};if(this.Ze.push(n),this.Ze.length>this.Qe)for(;this.Ze.length>this.$e;)this.Ze.shift();this.ti.fireAsync([n],this,i)},e.prototype.getChunks=function(){return this.Ze},e.prototype.addEventListener=function(t,e){if(r.Yt(t,"eventName"),r.Ct(e,"listener"),"chunkadded"!==t)throw new Error('Event "'+t+'" is unknown.');return this.ti.listen(e)},e}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(3),i(2),i(7),i(25)],void 0!==(r=function(a,u,c,h,t,f){"use strict";function e(t,e,i){if(u.xt(t,"logger"),u.xt(e,"playlistTrackConfig"),u.Nt(e.codecs,"playlistTrackConfig.codecs"),u.re(e.bandwidth,"playlistTrackConfig.bandwidth"),u.Nt(e.trackId,"playlistTrackConfig.trackId"),i=i||{},this.Pt=t||new h.Logger,this.Be=1<(o=e.codecs).split(",").length?"video/mp4; codecs="+o:"audio/mp4; codecs="+o,this.We=e.bandwidth,this.pt=e.height,this.Ve=e.trackId,this.He=e.mimeType,this.Je=e.totalNumberOfChunks,this.ei=[],this.ii=!1,this.ni=0,this.ze=0,this.ri=(n=e.mediaSegmentPlaylistUrl,r=n.split("?")[0],s=a.get(n.split("?"),[1],""),{url:r,queryParameters:a.reduce(s.split("&"),function(t,e){var i=e.split("=")[0];return i&&(t[i]=e.split("=")[1]),t},{})}),this.Xe=null,this.Qe=i.maxChunksToCache||20,this.$e=i.lowWaterMaxChunks||15,u.re(this.Qe,"options.maxChunksToCache"),u.re(this.$e,"options.lowWaterMaxChunks"),this.$e>=this.Qe)throw new Error('The "maxChunksToCache" cannot be less than or equal to the "lowWaterMaxChunks"');var n,r,s,o;this.Ye=null,this.Ze=[],this.ti=new c.Event,this.si=new c.Event}return((e.prototype=Object.create(t.prototype)).constructor=e).prototype.toString=function(){return"M3u8PlaylistTrack"},e.prototype.dispose=function(){this.Ze=[],this.ti.dispose()},e.prototype.getMseCodec=function(){return this.Be},e.prototype.getTrackId=function(){return this.Ve},e.prototype.getChunkDuration=function(){return this.ze},e.prototype.getBandwidth=function(){return this.We},e.prototype.getHeight=function(){return this.pt},e.prototype.getMimeType=function(){return this.He},e.prototype.getTotalNumberOfChunks=function(){return this.Je},e.prototype.getPlayableDuration=function(){return this.ni},e.prototype.isComplete=function(){return this.ii},e.prototype.hasSegments=function(){return 0<this.ei.length},e.prototype.getSegmentByTimestamp=function(e){return a.find(this.ei,function(t){return t.timestamp<=e&&e<t.timestamp+t.duration})},e.prototype.getLastSegment=function(){return a.get(this.ei,[this.ei.length-1],null)},e.prototype.getMediaSegmentPlaylistUrlInfo=function(){return this.ri},e.prototype.getClosestSegmentNotGreaterThanTimestamp=function(t){return t>this.ni?this.ei[this.ei.length-1]:this.getSegmentByTimestamp(t)},e.prototype.isLastMediaSegment=function(t){var e=this.getSegmentByTimestamp(t),i=!this.ii&&a.get(e,["timestamp"],0)+a.get(e,["duration"],0)===this.ni,n=!this.ii&&t>this.ni;return this.ni===t||i||n},e.prototype.updateMediaSegments=function(t){var e=new f(this.Pt,this.Ve,t),i=this.Je||0,n=a.map(this.ei,function(t){return t.name}),r=this,s=a.get(this.ei,[this.ei.length-1]),o=a.get(s,["timestamp"])+a.get(s,["duration"])||void 0;a.forEach(e.mediaSegments,function(t){a.includes(n,t.name)||(t.timestamp=a.isUndefined(o)?0:o,r.ei.push(t),r.ni+=t.duration,o=t.timestamp+t.duration,t.duration>r.ze&&(r.ze=t.duration),r.Pt.trace("[%s]:[%s]:[%s] Got new segment from playlist [%s]",(new Date).getHours(),(new Date).getMinutes(),(new Date).getSeconds(),t.name))}),i!==this.ei.length&&(this.ii=e.isComplete,this.Je=this.ei.length,this.si.fireAsync([this.ei],null,a.noop))},e.prototype.addDataChunk=function(t,e,i){u.qe(t,"dataChunk"),i=i||function(){},u.Ct(i,"eventCallback");var n={data:t,chunkId:e,timestamp:e*this.ze/1e3};if(this.Ze.push(n),this.Ze.length>this.Qe)for(;this.Ze.length>this.$e;)this.Ze.shift();this.ti.fireAsync([n],this,i)},e.prototype.getChunks=function(){return this.Ze},e.prototype.addEventListener=function(t,e){switch(u.Yt(t,"eventName"),u.Ct(e,"listener"),t){case"chunkadded":return this.ti.listen(e);case"segmentsready":return this.si.listen(e);default:throw new Error('Event "'+t+'" is unknown.')}},e}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0)],void 0!==(r=function(u,r){"use strict";function t(t,e,i){r.Nt(i,"m3u8String"),r.xt(t,"logger"),this.oi=i,this.Pt=t,this.jt=e,this.mediaSegments=[],function(t){var o=t.match(/[^\r\n]+/g),a=this;return u.forEach(o,function(t,e){var i=t.match(/(?!#)EXT.+?(?=[:\n\r])/),n=u.get(i,["0"],null),r=t.trim().substring(n?n.length+2:0,t.length);switch("#EXT-X-ENDLIST"===t&&(n="EXT-X-ENDLIST"),n){case"EXT-X-VERSION":a.version=parseFloat(r);break;case"EXT-X-PROGRAM-DATE-TIME":a.programDateTime=r?new Date(r.trim()):null;break;case"EXT-X-TARGETDURATION":a.targetDuration=1e3*parseFloat(r)||0;break;case"EXT-X-MEDIA-SEQUENCE":a.mediaSequence=parseInt(r);break;case"EXTINF":var s=[r,o[e+1]];a.mediaSegments.push(c(s,a.mediaSegments+1));break;case"EXT-X-ENDLIST":a.isComplete=!0;break;case"EXTM3U":case null:break;default:return a.Pt.debug("[%s] [Segment] Playlist unsupported key type [%s]",a.jt,n)}}),a}.call(this,this.oi);var n=0;u.forEach(this.mediaSegments,function(t){t.timestamp=n,n+=t.duration}),this.playableDuration=n,this.isComplete=!!this.isComplete}t.prototype.toString=function(){return"vod"};var c=function(t){var e=u.get(t,["0"],"").split(","),i=u.get(e,["0"],0),n=u.get(e,["1"],"").trim(),r=u.get(t,["1"],"").trim();return{duration:parseFloat(i),title:n,name:r}};return t}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(4),i(10)],void 0!==(r=function(u,c,h,f){"use strict";function t(t,e,i){c.xt(t,"logger"),this.Pt=t,this.ai=e.sort(function(t,e){return n[t.name]-n[e.name]}),this.ui=i,this.g=new h.DisposableList}function d(t){return(Math.random()-.5)*(t/20)+t}function l(i,n){n=n||0;var r=this,t=u.get(this.ai,[n],{});(function(s,o){var a=this;switch(s.name){case"urn:mpeg:dash:utc:http-head:2014":var t=f.getWithRetry(s.value,u.assign({contentType:"text/plain"},m),function(t,e){var i=u.get(e,["headers","date"],""),n=new Date(i).getTime();if(t||isNaN(n))return a.Pt.warn("Unable to resolve dash timing via [%s]",s.value,t),o(t||new Error("invalid-server-time"));var r=u.now()-n-e.stats.successResponseTime/2;return a.Pt.info("Resolved [%s] local to server timestamp offset [%s]",s.name,r),o(null,r)});return this.g.add(t),t;case"urn:mpeg:dash:utc:direct:2014":var e=u.now()-s.value-this.ui/2;return a.Pt.info("Resolved [%s] local to server timestamp offset [%s]",s.name,e),o(null,e);default:return a.Pt.info("Unable to resolve mpd Timing Sources. Defaulting to local time"),o(null,0)}}).call(this,t,function(t,e){if(!u.re(e))return l.call(r,i,n+1);i(t,e)})}var n={"urn:mpeg:dash:utc:http-head:2014":0,"urn:mpeg:dash:utc:direct:2014":1},m={retryOptions:{backoff:2,delay:2e3,maxAttempts:3,additionalRetryErrorCodes:[0]}};return t.prototype.calculateOffset=function(t){l.call(this,t)},t.prototype.setInterval=function(n,r){c.Ct(n,"callback"),u.isUndefined(r)||c.re(r,"interval");var s=this,o=d(r||3e5),a=setTimeout(function i(){s.Pt.debug("Syncing local to server time"),l.call(s,function(t,e){if(t)return n(t);o=d(r||3e5),n(t,e),s.Pt.debug("Waiting [%s] ms before next time sync",o),a=setTimeout(i,o)})},o),t=new h.Disposable(function(){clearTimeout(a)});return this.Pt.debug("Waiting [%s] ms before next time sync",o),this.g.add(t),t},t.prototype.dispose=function(){return this.Pt.debug("Disposing of mdp time sync"),this.g.dispose()},t.prototype.toString=function(){return"MpdTimeSync [Time Source Number: "+this.ai.length+", Direct Source Offset: "+this.ui+"]"},t}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(2),i(3),i(4),i(11),i(8),i(28),i(29),i(5),i(9),i(21),i(16),i(18)],void 0!==(r=function(o,n,r,s,a,u,c,h,e,i,f,d,l,m){"use strict";function t(t,e,i){n.qe(e,"videoElement"),n.qe(e.videoWidth,"videoElement.videoWidth"),this.Pt=t||new r.Logger,this.f=o.assign({targetLatency:8},i),this.qt=e,this.g=new a.DisposableList,this.ci=new u(c.global.navigator.userAgent).detect(),this.hi=this.f.preferNative||!1,this.fi=null,this.di=!1,this.li=!1,this.di=!1,this.mi=new s.Event,this.pi=new s.Event,this.vi=new s.Event,this.g.add(this.mi),this.g.add(this.pi),this.g.add(this.vi)}function p(){var e=this;"Edge"===e.ci.browser||"IE"===e.ci.browser?(e.qt.play(),e.di=!0,e.pi.fireAsync([],e),e.Pt.debug("Playback Started")):e.qt.play().then(function(){e.di=!0,e.pi.fireAsync([],e),e.Pt.debug("Playback Started")}).catch(function(t){e.Pt.error("Playback Failed [%s]",t)})}return t.prototype.toString=function(){return o.toString(this)},t.prototype.start=function(t){if(n.Nt(t,"uri"),this.fi)return this.Pt.warn("Already started Phenix Web Player");var s=this;if(e.isSupported){if(this.hi||!h.isSupported)return this.Pt.info("HLS native player selected"),this.fi=new e(this.Pt,this.qt,this.f),this.fi.addEventListener("error",function(t){s.vi.fire([t])}),this.g.add(this.fi),this.fi.start(t,function(){p.call(s)})}else this.hi&&this.Pt.warn("HLS native player is not supported");this.Pt.info("MSE player selected");var o=new i(this.Pt,t);s.g.add(o),o.fetch(function(t){if(t)return s.vi.fire([t]);var e,i=new f(s.Pt,{ewmaPeriods:30});"Dash"===o.getDeliveryType()?e=new l(s.Pt,o,i,s.f):"Hls"===o.getDeliveryType()&&(e=new m(s.Pt,o,i,s.f));var n=new h(s.Pt,o,s.qt,e,s.f),r=new d(s.Pt,o,s,i);n.start(),p.call(s),s.fi=n,s.fi.addEventListener("playbacktimeleft",function(t,e){s.mi.fire([t,e])}),s.fi.addEventListener("error",function(t){s.vi.fire([t])}),s.g.add(s.fi),s.g.add(i),s.g.add(r)})},t.prototype.play=function(){p.call(this),this.fi&&this.fi.play()},t.prototype.pause=function(){this.Pt.info("Pausing web player"),this.fi&&this.fi.pause()},t.prototype.getVideoElement=function(){return this.qt},t.prototype.dispose=function(){this.g.dispose(),this.qt&&(this.qt.load(),this.qt.src="",this.qt.mediaKeys&&this.qt.setMediaKeys(null)),this.fi=null,this.qt=null},t.prototype.getBandwidthLimit=function(){this.fi.getBandwidthLimit()},t.prototype.getTimeLeft=function(){return this.qt?function(t){var e=this.qt.currentTime,i=this.qt.duration,n=function(t,e){for(var i=0;i<t.buffered.length;i++){var n=t.buffered.start(i),r=t.buffered.end(i);if(n<=e&&e<=r)return i}}(t,e),r=o.re(n)?t.buffered.end(n):0,s=0===r?0:r-e;return{bufferedLength:t.buffered.length,current:e,bufferEnd:r,timeBufferedButNotPlayed:s,duration:i,timestampOffset:t.timestampOffset}}.call(this,this.qt).timeBufferedButNotPlayed:0},t.prototype.changeBandwidthLimit=function(t,e){this.fi.changeBandwidthLimit(t,e)},t.prototype.addEventListener=function(t,e){switch(n.Yt(t,"eventName"),n.Ct(e,"listener"),t){case"playbacktimeleft":return this.mi.listen(e);case"started":var i=this.pi.listen(e);return this.di&&setTimeout(o.bind(e,this),0),i;case"error":return this.vi.listen(e);default:throw new Error('Event "'+t+'" is unknown.')}},t.prototype.getStats=function(){return this.fi?this.fi.getStats():{}},t.isSupported=e.isSupported||h.isSupported,t.deviceSupportsHlsPlayback=e.isSupported||h.isSupported,t.deviceSupportsDashPlayback=h.isSupported,t}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(2),i(3),i(4),i(11),i(8),i(5),i(12),i(19),i(6)],void 0!==(r=function(d,a,u,c,l,h,f,m,p,v,g){"use strict";function t(t,e,i,n,r){a.Ht(e,m,"playlist"),a.qe(i,"videoElement"),a.qe(i.videoWidth,"videoElement.videoWidth"),a.qe(n,"playlistChunkFeeder"),a.Ht(n,p,"playlistChunkFeeder"),a.re(r.targetLatency,"options.targetLatency"),d.isUndefined(d.get(r,"bandwidthToStartAt"))||a.re(r.bandwidthToStartAt,"options.bandwidthToStartAt"),d.isUndefined(d.get(r,"trackRestrictions"))||a.xt(r.trackRestrictions,"options.trackRestrictions"),d.isUndefined(d.get(r,"bufferSizeToPauseFetch"))||a.re(r.bufferSizeToPauseFetch,"options.bufferSizeToPauseFetch"),d.isUndefined(d.get(r,"bufferSizeToResumeFetch"))||a.re(r.bufferSizeToResumeFetch,"options.bufferSizeToResumeFetch"),d.isUndefined(d.get(r,"maximumFrequencyForAlteringPlaybackRate"))||a.re(r.maximumFrequencyForAlteringPlaybackRate,"options.maximumFrequencyForAlteringPlaybackRate"),d.isUndefined(d.get(r,"playbackRateToRecover"))||a.re(r.playbackRateToRecover,"options.playbackRateToRecover");var s=this;this.f=r,this.qt=i,this.gi=n,this.se=e,this.g=new l.DisposableList,this.Pt=t||new u.Logger,this.yi=d.get(r,"bandwidthToStartAt",2e6),this.wi=d.get(r,"trackRestrictions",{}),this.bi=d.get(r,"playbackMode",C.name),this.ki=d.get(r,"bufferSizeToPauseFetch",60),this.Si=d.get(r,"bufferSizeToResumeFetch",30),this.me=1e3*r.targetLatency,this.di=!1,this.li=!1,this.Ei=[],this.ci=new h(f.global.navigator.userAgent).detect();var o=(this.me-(this.se.getMaxChunkDuration()||1e3)-500)/this.me;this.Ti=d.get(r,"playbackRateToDecreaseBuffer",1.03),this.Ii=d.get(r,"playbackRateToIncreaseBuffer",.97),this.Ri=d.get(r,"minimumIntervalBetweenPlaybackRateChange",300),this.Mi=this.me/1e3*o,this.Ci=this.me/1e3/4,this.xi=this.me/1e3/2,this.Pt.info("Target latency set to [%s] MS ([%s]/[%s] rates at most every [%s] with target buffers [%s] - [%s] - [%s])",this.me,this.Ii,this.Ti,this.Ri,this.Ci,this.xi,this.Mi),function(){var i=this,t=d.get(this.se,["parsedPlaylist","contentProtectionTags"],[]);return 0===t.length?this.Pt.info("No Content Protection Tags found in the playlist so skipping initialization of EncryptedMediaHandler"):v.isSupported()?(this.Pi=new v(this.Pt,this.qt,t,d.get(this.f,"drm")),this.Pi.addEventListener("error",function(t){i.vi.fire([t])}),this.Pi.addEventListener("trackRestrictionsAvailable",function(t){if(0<d.keys(t).length){if(i.wi=t,0===y.call(i).length)return i.vi.fire([(e="DRM Track restrictions not met",{category:g.category.DRM,name:"UnmetDRMRestrictions",severity:g.severity.CRITICAL,error:"Error"===e.constructor.name?e:new Error(e)})]);i.qt.play()}var e}),void this.g.add(this.Pi)):this.Pt.error("DRM not supported by the browser")}.call(this),this.di=!1,this.Di={},this.Oi={},this.mi=new c.Event,this.vi=new c.Event,this.gi.addEventListener("error",function(t){s.vi.fire([t])}),this.g.add(this.gi),this.g.add(this.mi),this.g.add(this.vi),this.g.add(new l.Disposable(function(){null!==s.Ai&&f.global.clearTimeout(s.Ai)}))}function y(){var t=this.se.getPlaylistTracksByBandwidthPerMimeType(this.yi,this.wi);return this.gi.setActiveTracks(t),t}function w(t,e,i){this.Pt.debug("VIDEO EVENT: [%s]",t,i),e&&e.call(this,i)}function b(e,i){var n=d.bind(w,this,"durationchange",function(){var t=this;if("dynamic"!==t.se.getType())return t.qt.removeEventListener("durationchange",n,!1),t.qi=null;0!==d.get(t.qt,["buffered","length"],0)&&function(o,a){var u=this;o=d.re(o)?o:(u.se.getPlaybackDurationSinceAvailable()-u.me)/1e3,this.bi===C.name&&(o=(u.se.getPlaybackDurationSinceAvailable()-u.me)/1e3),"Firefox"===this.ci.browser&&(o-=1),setTimeout(function(){var t=u.qt.buffered.start(u.qt.buffered.length-1),e=u.qt.buffered.end(u.qt.buffered.length-1),i=u.qt.currentTime<o||u.qt.currentTime>o+1,n=t<=o&&o<=e,r=2<=u.Fi;if(u.qi||!n&&!r&&u.Ui)u.Fi++;else{if(i&&!u.Ni&&(n||r||!u.Ui)){var s=r?(e-t)/2+t:t;u.Ui||n||(s=t),u.Pt.debug("Setting video current time to [%s], attempt [%s]",s,u.Fi),u.qt.currentTime=s,u.Ni=!0,u.Ui||(u.Ui=!0)}t<=u.qt.currentTime&&u.qt.currentTime<=e&&(n||r)&&(u.qi=d.now(),u.Ni=!1,u.Pt.debug("Successfully updated video current time [%s] after [%s] attempts",u.qt.currentTime,u.Fi),a())}},10)}.call(t,e,function(){t.qt.removeEventListener("durationchange",n,!1),i&&i()})});return this.Fi=0,n}function k(r){var s=this,o=this.gi.getActiveTracks(),a=y.call(this);(function(t){if("static"===this.se.getType()&&this.ji.duration!==this.se.getTotalMediaTimeInMillis()/1e3)this.ji.duration=this.se.getTotalMediaTimeInMillis()/1e3;else if("Hls"===this.se.getDeliveryType()&&this.ji.duration!==1/0){this.ji.duration=1/0;var e=d.reduce(t,function(t,e){var i=d.get(e.getLastSegment(),["timestamp"],0);return d.isNullOrUndefined(t)?i:i<t?i:t})||0;this.gi.seekToChunk(e)}}).call(this,a),this.gi.initializeActiveTracks(function(t){if(t)return s.Pt.error("Unable to initialize playlist tracks",t),s.vi.fire([t]),r(t);var e=d.filter(a,function(t){return!s.Oi[M(t)]});if(0<e.length){var i=d.map(e,function(t){return t.getTrackId()});s.Pt.info("Initializing source buffers for [%s] tracks [%s]",e.length,i),function(t){this.Pt.debug("Creating MSE buffers for all tracks."),d.forEach(t,d.bind(function(t){(function(t){var r=this,s={track:t,chunks:[],chunkAddRequested:!1},e=R(t),i=!d.includes(d.keys(r.Di),e),o=i?r.ji.addSourceBuffer(t.getMseCodec()):r.Di[e].buffer,n=M(t);r.Oi[n]=s,i&&(o.mode="segments","static"===r.se.getType()&&(o.appendWindowEnd=r.se.getTotalMediaTimeInMillis()/1e3),r.Pt.debug("Creating MSE Buffer for [%s] with mode [%s]",r.se.getType(),o.mode),r.Di[e]={buffer:o,updateEnd:function(t){o.updating||I.call(this,t,!0)}},r.g.add(new l.Disposable(function(){r.Pt.debug("Cleaning up sourceBuffer [%s]",e),r.ji.removeSourceBuffer(o)})));var a=t.addEventListener("chunkadded",d.bind(function(t,e){s.addInitChunkFirst&&"Dash"===r.se.getDeliveryType()&&(s.addInitChunkFirst=!1,this.Pt.debug("Pushing track [%s] chunk [%s] into buffer",t.getTrackId(),"Init"),s.chunks.push(t.getInitChunkData())),this.Pt.debug("Pushing track [%s] chunk [%s] into buffer",t.getTrackId(),e.chunkId),s.chunks.push(e.data),s.chunkAddRequested&&(s.chunkAddRequested=!1,o.updating||I.call(this,t,!1));var i=1e3<=d.now()-this.Li,n=500<=d.now()-this._i;this.li&&i&&n&&!this.qt.paused&&!this.Bi&&(this.Pt.trace("Starting after wait [%s]",d.now()-this.Li),this._i=d.now(),this.qt.play())},r,t));r.g.add(a)}).call(this,t)},this))}.call(s,e)}var n=d.filter(a,function(e){return!d.find(o,function(t){return t.getTrackId()===e.getTrackId()})});d.forEach(n,function(t){(function(t){var e=this.Di[R(t)],i=d.bind(function(t){this.Pt.warn("Buffer Error [%s]",t)},this),n=!!e.track;if(e.track!==t){var r=this.Oi[M(t)];if(e.track&&e.track!==t&&n&&(e.buffer.removeEventListener("updateend",e.updateEndListener),e.buffer.removeEventListener("error",i),r&&(r.addInitChunkFirst=!0,r.chunkAddRequested=!0,r.chunks=[])),e.track=t,e.updateEndListener=d.bind(e.updateEnd,this,t),e.buffer.addEventListener("updateend",e.updateEndListener),e.buffer.addEventListener("error",i),e.buffer.onerror=i,!n){var s="Dash"===this.se.getDeliveryType()?[t.getInitChunkData()]:[];r.chunks=[].concat(s,d.map(t.getChunks(),function(t){return t.data})),"static"===this.se.getType()&&"Edge"!==this.ci.browser&&"IE"!==this.ci.browser&&this.ji.setLiveSeekableRange(0,this.se.getTotalMediaTimeInMillis()/1e3),I.call(this,t,!1)}}}).call(s,t),s.Pt.info("Switched [%s] to track [%s] with [%s] bandwidth limit",R(t),t.getTrackId(),s.yi)}),r()})}function S(t){var e=this.qt.currentTime,i=this.qt.duration,n=E(t,e),r=d.re(n)?t.buffered.end(n):0,s=0===r?0:r-e;return{bufferedLength:t.buffered.length,current:e,bufferEnd:r,timeBufferedButNotPlayed:s,duration:i,timestampOffset:t.timestampOffset}}function E(t,e){for(var i=0;i<t.buffered.length;i++){var n=t.buffered.start(i),r=t.buffered.end(i);if(n<=e&&e<=r)return i}}function T(){var n=!0,r=!1;d.forOwn(this.Di,d.bind(function(t){var e=S.call(this,t.buffer),i=parseFloat(e.timeBufferedButNotPlayed);i<this.ki&&(n=!1),i<this.Si&&(r=!0)},this)),n&&this.gi.isFetchingData()&&(this.Pt.debug("Pausing feeder due to excess buffer"),s.call(this)),!r||this.gi.isFetchingData()||this.Bi||(this.Pt.debug("Starting feeder due to limited buffer"),x.call(this))}function I(t,e){var i=this.Di[R(t)],n=this.Oi[M(t)];if(!n)return this.Pt.warn("Unable to add chunk for non existent buffer");if("dynamic"===this.se.getType()&&this.Bi&&!this.zi&&0<i.buffer.buffered.length)i.buffer.remove(0,i.buffer.buffered.end(i.buffer.buffered.length-1)),i.cleared=!0,d.reduce(this.Di,function(t,e){return t?e.cleared:t},!0)&&(this.Ui=!1,this.qi=null,this.Ni=!1,this.zi=!0);else if(0<n.chunks.length){if(this.qt.error)return this.Pt.error("Unable to continue appending to buffer. Video element error code [%s] and message [%s]",this.qt.error.code,this.qt.error.message),s.call(this),this.vi.fire([this.qt.error]);var r=n.chunks.shift();i.cleared=!1,this.Pt.debug("Appending chunk to buffer for track [%s]",t.getTrackId()),i.buffer.appendBuffer(new Uint8Array(r))}else e&&(this._i&&T.call(this),n.chunkAddRequested=!0)}function R(t){return 0<=t.getMseCodec().indexOf("video")?"video":0<=t.getMseCodec().indexOf("audio")?"audio":"other"}function M(t){return t.getTrackId()+"_"+t.getMseCodec()}var C={id:1,name:"strict"};t.prototype.toString=function(){return d.toString(this)},t.prototype.play=function(){if("dynamic"===this.se.getType()){var t=this.gi.seekToCurrent();x.call(this);var e=this,i=b.call(this,t,function(){e.Bi=0,e.qt&&e.qt.play()});return setTimeout(function(){e.qt.addEventListener("durationchange",i,!1)},300),this.g.add(new l.Disposable(function(){e.qt.removeEventListener("durationchange",i,!1)}))}x.call(this),this.qt&&this.qt.play()},t.prototype.pause=function(){this.Pt.info("Pausing web player"),s.call(this);var e=this;this.qt&&(this.qt.pause(),this.Bi=d.now(),this.zi=!1,d.forOwn(this.gi.getActiveTracks(),function(t){e.Di[R(t)].buffer.updating||I.call(e,t,!1)}))},t.prototype.dispose=function(){this.g.dispose(),this.di=!1,this.Di={},this.Oi={},this.Ei=[],this.ji=null,this.se=null,this.qt=null},t.prototype.start=function(t){(function(t){var e=this;e.ji=new MediaSource;function i(){(function(s){var o=this;k.call(o,function t(e){if(e)return s(e);var i=o.gi.getActiveTracks(),n=d.map(i,function(t){return t.getTrackId()});o.Pt.debug("Initializing tracks [%s]",n);var r=setTimeout(function(){return o.gi.stopRequestingAllData(),o.yi=o.yi/2,k.call(o,t)},o.se.getMaxChunkDuration());o.gi.fetchNChunks(1,function(t){if("timeout"!==d.get(t,["message"])){if(clearTimeout(r),t)return s(t);"Hls"===o.se.getDeliveryType()&&d.forEach(o.gi.getActiveTracks(),function(t){o.Oi[M(t)].chunkAddRequested=!0}),o.Pt.info("Initializing feeder with [%s] [%s] playlist of duration [%s]",o.se.getType(),o.se.getDeliveryType(),o.se.getTotalMediaTimeInMillis()/1e3),function(t){var e=this,i=d.bind(function(){this.li=!1,this.Li=d.now();var i,t=4e3<d.now()-this.Wi;d.forOwn(this.Di,d.bind(function(t){var e=S.call(this,t.buffer);(!i||i>e.timeBufferedButNotPlayed)&&(i=e.timeBufferedButNotPlayed),this.mi.fire([e.timeBufferedButNotPlayed,t.track],this)},this)),T.call(this),t&&(function(t){this.Ei.push({size:t,timestamp:d.now()});for(var e=d.get(this.Ei,[0,"timestamp"],d.now());3e5<d.now()-e;)this.Ei.shift(),e=d.get(this.Ei,[0,"timestamp"],d.now());this.Vi=Math.min.apply(null,d.map(this.Ei,function(t){return t.size}))}.call(this,i),function(t){if("Dash"===this.se.getDeliveryType()||"dynamic"===this.se.getType()){var e=this.Mi,i=this.Hi,n=4e3<d.now()-this.Wi,r=!i||d.now()-i>1e3*this.Ri,s=this.me/1e3,o=this.Vi>this.Ci,a=this.Vi<=.1+s&&this.Vi>=s-.1,u=t>=this.xi&&this.qt.playbackRate===this.Ii;e<=t&&o&&this.qt.playbackRate<=1&&n&&r?(this.Pt.info("Adjusting playback rate to [%s] to reduce buffer size from [%s] with minimum buffer size of [%s]",this.Ti,t,this.Vi),this.qt.playbackRate=this.Ti):!o&&!a&&1<=this.qt.playbackRate&&r?(this.Pt.info("Adjusting playback rate to [%s] to increase buffer size from [%s] with minimum buffer size of [%s]",this.Ii,t,this.Vi),this.qt.playbackRate=this.Ii):(u||a)&&1!==this.qt.playbackRate&&(this.Pt.info("Resuming normal playback rate with buffer size of [%s] and minimum buffer size of [%s]",t,this.Vi),this.qt.playbackRate=1,this.Hi=d.now())}}.call(this,i||0))},e),n=d.bind(w,e,"stalled",null),r=d.bind(w,e,"suspend",null),s=d.bind(w,e,"ended",null),o=d.bind(w,e,"error",null),a=d.bind(w,e,"pause",null),u=d.bind(w,e,"play",function(){this.Bi&&this.qt.pause()}),c=d.bind(w,e,"waiting",function(){this.di&&(this.Pt.debug("Waiting for new chunk or end of track"),this.li=!0)}),h=d.bind(w,e,"seeking",function(t){var e=d.keys(this.Di),i=d.get(e,"0",null),n=this.Di[i],r=d.now()-this.qi,s=this;if(!(n&&500<r&&"Hls"!==this.se.getDeliveryType()))return this.Pt.debug("Ignoring video seek event during initialization");var o=E(n.buffer,t.timeStamp/1e3),a=E(n.buffer,this.qt.currentTime),u=d.reduce(this.Di,function(t,e){var i=E(e.buffer,s.qt.currentTime),n=d.re(i)?e.buffer.buffered.end(i):0;return t?n<t?n:t:n})||this.qt.currentTime;if(this.gi.stopRequestingAllData(),this.Pt.debug("Pausing of feeder completed."),this.gi.seekToChunk("dynamic"===this.se.getType()?this.qt.currentTime:u),o!==a||d.isNullOrUndefined(a)){if(this.gi.isFetchingData())return;this.gi.startRequestingDataForActiveTracks(this.yi)}}),f=b.call(e);e.qt.addEventListener("timeupdate",i,!1),e.qt.addEventListener("ended",s,!1),e.qt.addEventListener("error",o,!1),e.qt.addEventListener("pause",a,!1),e.qt.addEventListener("stalled",n,!1),e.qt.addEventListener("suspend",r,!1),e.qt.addEventListener("play",u,!1),e.qt.addEventListener("waiting",c,!1),e.qt.addEventListener("seeking",h,!1),e.qt.addEventListener("durationchange",f,!1),e.g.add(new l.Disposable(function(){e.Pt.debug("Cleaning up videoElement listeners"),e.qt.removeEventListener("timeupdate",i,!1),e.qt.removeEventListener("ended",s,!1),e.qt.removeEventListener("error",o,!1),e.qt.removeEventListener("pause",a,!1),e.qt.removeEventListener("stalled",n,!1),e.qt.removeEventListener("suspend",r,!1),e.qt.removeEventListener("play",u,!1),e.qt.removeEventListener("waiting",c,!1),e.qt.removeEventListener("seeking",h,!1),e.qt.removeEventListener("durationchange",f,!1)})),x.call(e),e._i=d.now(),d.Ct(t)&&t()}.call(o,s)}})})}).call(e,t)}e.ji.addEventListener("sourceopen",i),e.g.add(new l.Disposable(function(){e.Pt.debug("Cleaning up sourceopen listener"),e.ji.removeEventListener("sourceopen",i)})),e.qt.src=f.global.URL.createObjectURL(e.ji)}).call(this,t),this.Wi=d.now()},t.prototype.getBandwidthLimit=function(){return this.yi},t.prototype.changeBandwidthLimit=function(t,e){this.Pt.debug("Changing playback bandwidth limit: [%s], current limit: [%s]",t,this.yi),this.yi=t,this.Ai=setTimeout(d.bind(function(n){var o=this;k.call(this,function(t){if(t)return n(t);var e=o.gi.getActiveTracks(),i=d.reduce(e,function(t,e){var i=o.Di[R(e)],n=E(i.buffer,o.qt.currentTime),r=e.getChunkDuration()/1e3;if(!d.re(n))return!d.re(t)||t>o.qt.currentTime?o.qt.currentTime:t;var s=Math.round(i.buffer.buffered.end(n)/r)*r;return!d.re(t)||s<t?s:t});return d.re(i)||(i=o.qt.currentTime),o.gi.stopRequestingAllData(),o.gi.seekToChunk(i),o.Pt.debug("Pausing of feeder completed."),o.gi.isFetchingData()||o.gi.startRequestingDataForActiveTracks(o.yi),n()})},this,e||d.noop),250)},t.prototype.addEventListener=function(t,e){switch(a.Yt(t,"eventName"),a.Ct(e,"listener"),t){case"playbacktimeleft":return this.mi.listen(e);case"error":return this.vi.listen(e);default:throw new Error('Event "'+t+'" is unknown.')}},t.prototype.getStats=function(){return{currentTime:d.get(this.vt,["currentTime"],0),width:d.get(this.vt,["videoWidth"],0)||d.get(this.vt,["width"],0),height:d.get(this.vt,["videoHeight"],0)||d.get(this.vt,["height"],0),lag:0,deliveryType:this.se.getDeliveryType(),isNative:!1}},t.isSupported=!!f.global.MediaSource;var s=function(){this.gi.stopRequestingAllData(),this.Pt.debug("Pausing of feeder completed.")},x=function(){if(this.gi.isFetchingData())return this.Pt.debug("Unable to start requesting data. Feeder is already fetching data.");this.gi.startRequestingDataForActiveTracks()};return t}.apply(e,n))&&(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(2),i(3),i(4),i(11),i(20),i(8),i(5),i(19),i(6)],void 0!==(r=function(u,n,r,s,o,a,i,c,h,f,d){"use strict";function t(t,e,i){n.qe(e,"videoElement"),n.qe(e.videoWidth,"videoElement.videoWidth"),this.f=i,this.qt=e,this.g=new o.DisposableList,this.Pt=t||new r.Logger,this.ci=new a(c.global.navigator.userAgent).detect(),this.vi=new s.Event,this.g.add(this.vi),this.Gi=u.bind(function(){var e=this,i=this.vt.currentTime,n=function(){return 1.5*this.Ki.averageLength<4e3?4e3:1.5*this.Ki.averageLength}.call(e);e.vt.paused||(setTimeout(function(){if(0===e.Ki.count&&!e.vt.paused&&e.vt.currentTime===i){var t="Stream has not started within ["+n/1e3+"] seconds";e.Pt.warn(t),p.call(e,d.name.progressTimeOut.name,t)}},n),setTimeout(function(){if(e.vt&&e.vt.currentTime===i&&!e.vt.paused&&l.call(e)){var t="Stream has been stalled for [6] seconds";e.Pt.warn(t),m.call(e,d.name.progressTimeOut.name,t)}},6e3))},this),this.Ji=u.bind(function(){if(this.Ki.time=u.now(),0===this.vt.buffered.length)return this.Pt.debug("[%s] Hls stream progress event fired without any buffered content",this.Xi);var t=this.vt.buffered.end(this.vt.buffered.length-1);if(this.Ki.buffered!==t){if(null!==this.Ki.buffered){var e=this.Ki.averageLength*this.Ki.count+(t-this.Ki.buffered);if(this.Ki.count+=1,this.Ki.averageLength=e/this.Ki.count,this.Ki.lastCurrentTime!==this.vt.currentTime&&(this.Ki.lastCurrentTimeOccurrenceTimestamp=u.now()),this.Ki.lastCurrentTimeOccurrenceTimestamp&&6e3<u.now()-this.Ki.lastCurrentTimeOccurrenceTimestamp&&this.vt&&!this.vt.paused&&l.call(this)){var i="Reloading stream after current time has not changed for [6] seconds due to unregistered stall.";this.Pt.warn(i),m.call(this,d.name.progressTimeOut.name,i)}}this.Ki.buffered=t,this.Ki.lastCurrentTime=this.vt.currentTime}},this),this.Qi=u.bind(function(){this.Pt.info("[%s] Hls stream ended",this.$i),this.stop("ended")},this),this.Yi=u.bind(function(t){var e=0===this.Ki.count;4===u.get(this.vt,["error","code"])&&e&&p.call(this,d.name.hlsNativeError.name,t),v.call(this,d.name.hlsNativeError.name,t)},this),this.Ki={time:0,buffered:null,averageLength:0,count:0,lastCurrentTime:0,lastCurrentTimeOccurrenceTimestamp:0},this.Zi=[],function(){var e=this,t=u.get(this.f,["drm","com.apple.fps.1_0"],{});return 0===u.keys(t).length?this.Pt.info("DRM config is empty so skipping initialization of EncryptedMediaHandler"):f.isSupported()?(this.Pi=new f(this.Pt,this.qt,[],u.get(this.f,"drm")),this.Pi.addEventListener("error",function(t){e.vi.fire([t])}),this.Pi.addEventListener("trackRestrictionsAvailable",function(t){0<u.keys(t).length&&(e.wi=t)}),void this.g.add(this.Pi)):this.Pt.error("DRM not supported by the browser")}.call(this),setTimeout(u.bind(function(){this.se=new h(this.Pt,this.Xi),this.g.add(this.se),this.se.fetch(u.noop)},this),2e3)}function l(){return this.vt&&0!==this.vt.buffered.length}function m(t,e){if(!l.call(this))return v.call(this,t,e);p.call(this,t,e)}function p(t,e){this.vi.fire([g(t,d.severity.RECOVERABLE,e)])}function v(t,e){this.vi.fire([g(t,d.severity.CRITICAL,e)])}function e(t){if(t){if(clearTimeout(this.Le),this.Le=null,!this.tn)return;return this.tn=!1,void this.start(this.vt)}var e=this;this.Le=setTimeout(function(){var t;i.isForeground()||!(t=e.vt).muted&&(0<u.get(t,["webkitAudioDecodedByteCount"],0)||0<u.get(t,["audioTracks","length"],0)||t.webkitHasAudio)||(e.Pt.info("Detecting application [background] with muted video. Pausing playback until application focused again."),e.vt.pause(),e.tn=!0)},3e3)}function g(t,e,i){return{category:d.category.STREAMING,name:t,severity:e,error:"Error"===i.constructor.name?i:new Error(i)}}return t.prototype.toString=function(){return u.toString(this)},t.prototype.play=function(){this.qt.play()},t.prototype.pause=function(){this.qt.pause()},t.prototype.dispose=function(){this.g.dispose()},t.prototype.start=function(t){if(this.Xi)return this.Pt.warn("Already started player");this.Xi=t,this.g.add(i.onBackground(u.bind(e,this,!1))),this.g.add(i.onForeground(u.bind(e,this,!0))),function(t){c.attachUriStream(t,this.Xi),!1===this.f.receiveAudio&&(t.muted=!0),u.addEventListener(t,"error",this.Yi,!0),u.addEventListener(t,"stalled",this.Gi,!1),u.addEventListener(t,"pause",this.Gi,!1),u.addEventListener(t,"suspend",this.Gi,!1),u.addEventListener(t,"progress",this.Ji,!1),u.addEventListener(t,"ended",this.Qi,!1),this.vt=t}.call(this,this.qt)},t.prototype.getBandwidthLimit=function(){return this.Pt.warn("getBandwidthLimit not supported for HLS Native")},t.prototype.changeBandwidthLimit=function(){return this.Pt.warn("changeBandwidthLimit not supported for HLS Native")},t.prototype.addEventListener=function(t,e){switch(n.Yt(t,"eventName"),n.Ct(e,"listener"),t){case"error":return this.vi.listen(e);default:throw new Error('Event "'+t+'" is unknown.')}},t.prototype.getStats=function(){if(!this.qt)return{width:0,height:0,currentTime:0,lag:0,deliveryType:"Hls",isNative:!0};var t=u.get(this.vt,["currentTime"],0),e=this.vt&&this.vt.buffered&&0<this.vt.buffered.length?this.vt.buffered.end(this.vt.buffered.length-1):0,i=Math.max(0,e-t);this.Zi.push(i),15<this.Zi.length&&this.Zi.shift();for(var n=0,r=0,s=this.Zi.length;r<s;r++)n=Math.max(n,this.Zi[r]);var o=2;this.se&&0<this.se.getAllPlaylistTracks().length&&(o=this.se.getAllPlaylistTracks()[0].getChunkDuration());var a=2*o+n;return{width:this.vt.videoWidth||this.vt.width,height:this.vt.videoHeight||this.vt.height,currentTime:t,lag:a,deliveryType:"Hls",isNative:!0}},t.isSupported="object"==typeof document&&"maybe"===document.createElement("video").canPlayType("application/vnd.apple.mpegURL"),t}.apply(e,n))&&(t.exports=r)}],m.c=l,m.d=function(t,e,i){m.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},m.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return m.d(e,"a",e),e},m.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},m.p="",m(m.s=22))},function(t,e,i){var n,r;n=[i(0),i(1),i(3),i(8),i(35),i(7)],void 0===(r=function(o,i,e,n,r,a){"use strict";var s=[a.types.realTime.name,a.types.dash.name,a.types.hls.name];function u(t){t=t||s,i.isArray(t,"features"),o.forEach(t,function(t,e){i.De(t,a.types,"FeatureType["+e+"]")}),this.en=o.map(t,o.bind(o.getEnumName,o,a.types))}function c(){var t=o.get(n,["navigator","userAgent"],"");return/iPad|iPhone|iPod/.test(t)&&!n.MSStream}function t(){var t=o.get(n,["navigator","userAgent"],"");return/SamsungBrowser/.test(t)}function h(t,e){return o.includes(t,e)||t.push(e),t}return u.isFeatureSupported=function(t){switch(t&&i.Nt(t,"feature"),o.getEnumName(a.types,t)){case a.types.realTime.name:return e.webrtcSupported;case a.types.dash.name:case a.types.hls.name:case a.types.rtmp.name:return r.canPlaybackType(t);default:return!1}},u.mapFeatureToPCastCapability=function(t){switch(t&&i.Nt(t,"feature"),o.getEnumName(a.types,t)){case a.types.realTime.name:return"real-time";case a.types.dash.name:case a.types.hls.name:return"streaming";case a.types.rtmp.name:return"rtmp";default:return""}},u.mapPCastCapabilitiesToFeatures=function(t){return i.isArray(t,"capabilities"),o.reduce(t,function(t,e){return t.concat(u.mapPCastCapabilityToFeatures(e))},[])},u.mapPCastCapabilityToFeatures=function(t){return t&&i.Nt(t,"capability"),"real-time"===t?[a.types.realTime.name]:"streaming"===t?[a.types.dash.name,a.types.dash.name]:"rtmp"===t?[a.types.rtmp.name]:[]},u.prototype.getFeatures=function(){return this.en},u.prototype.getFeaturePCastCapabilities=function(){var t=o.map(this.en,u.mapFeatureToPCastCapability);return o.reduce(t,h,[])},u.prototype.getPreferredFeatureFromPublisherCapabilities=function(r,s){i.isArray(r,"capabilities");var t=o.reduce(this.en,function(t,e){var i=u.mapFeatureToPCastCapability(e),n=u.isFeatureSupported(e)&&(o.includes(r,i)||"real-time"===e&&!s);return t||(n?e:null)},null);return t===a.types.dash.name&&u.shouldUseNativeHls&&o.includes(r,u.mapFeatureToPCastCapability(a.types.hls.name))&&o.includes(this.en,a.types.hls.name)?t=a.types.hls.name:t===a.types.hls.name&&!u.shouldUseNativeHls&&o.includes(r,u.mapFeatureToPCastCapability(a.types.dash.name))&&o.includes(this.en,a.types.dash.name)&&(t=a.types.dash.name),t},u.shouldUseNativeHls=c()||"Safari"===e.browser||t(),u.isIOS=c,u.isSamsungBrowser=t,u.isAndroid=function(){var t=o.get(n,["navigator","userAgent"],"");return/(android)/i.test(t)},u.isMobile=function(){var t=o.get(n,["navigator","userAgent"],"");return c()||/Android|webOS|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(t)},u.getIOSVersion=function(){var t=o.get(n,["navigator","userAgent"],"");if(/iP(hone|od|ad)/.test(t)){var e=t.match(/.*OS (\d+)_(\d+)_?(\d+)? like Mac OS X/);return{major:parseInt(o.get(e,[1],0),10),minor:parseInt(o.get(e,[2],0),10),patch:parseInt(o.get(e,[3],0),10)}}},u}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{roles:{participant:{id:0,name:"Participant"},moderator:{id:1,name:"Moderator"},presenter:{id:2,name:"Presenter"},audience:{id:3,name:"Audience"}},states:{active:{id:0,name:"Active"},passive:{id:1,name:"Passive"},handRaised:{id:2,name:"HandRaised"},inactive:{id:3,name:"Inactive"},offline:{id:4,name:"Offline"}}}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{types:{directChat:{id:0,name:"DirectChat"},multiPartyChat:{id:1,name:"MultiPartyChat"},moderatedChat:{id:2,name:"ModeratedChat"},townHall:{id:3,name:"TownHall"},channel:{id:4,name:"Channel"}},events:{memberJoined:{id:0,name:"MemberJoined"},memberLeft:{id:1,name:"MemberLeft"},memberUpdated:{id:2,name:"MemberUpdated"},roomUpdated:{id:3,name:"RoomUpdated"},roomEnded:{id:4,name:"RoomEnded"}}}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(50)],void 0===(r=function(t){return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{level:{TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,FATAL:5}}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(0),i(1),i(9),i(61)],void 0===(r=function(t,r,s,o){"use strict";function e(){}return e.prototype.createPCastLogger=function(t,e){t&&r.Nt(t,"baseUri");var i=new s.Logger,n=o.getAppender(t);return n.setThreshold(s.level.INFO),e||i.addAppender(new s.ConsoleAppender),i.addAppender(n),i.isPCastLogger=!0,i},new e}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0)],void 0===(r=function(e){"use strict";return{parseEnvFromPcastBaseUri:function(t){return t=t.toLowerCase(),e.includes(t,"local")?"local":e.includes(t,"stg")?"staging":"production"}}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(63),i(74),i(29)],void 0===(r=function(t,e,i){return{MQWebSocket:t,BatchHttpProto:e,MQService:i}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(0),i(6),i(2),i(83)],void 0===(r=function(r,a,u,s,c){"use strict";function t(t,e,i,n){r.Nt(t,"version"),r.Nt(e,"baseUri"),r.xt(i,"logger"),this.Tt=t,this.in=e,this.Pt=i,this.g=new s.DisposableList,this.nn=n}return t.DefaultPCastUri="https://pcast.phenixrts.com",t.prototype.getBaseUri=function(){return this.in},t.prototype.resolveUri=function(t){return function(t,n){var e=0===t.lastIndexOf("wss:",0),i=0===t.lastIndexOf("ws:",0),r=0===t.lastIndexOf("https:",0),s=0===t.lastIndexOf("http:",0);if(e||i)n(void 0,{uri:t+"/ws",roundTripTime:0});else if(r||s){var o=this;(function(t,n){var e=u.getWithRetry(t+"/pcast/endPoints",{timeout:15e3,queryParameters:{version:"2020-07-14T03:13:57Z",_:a.now()},retryOptions:{maxAttempts:4}},function(t,e){if(t)return n(new Error("Failed to resolve an end point",t));var i=e.data.split(",");i.length<1&&n(new Error("Failed to discover end points")),n(void 0,i)});this.g.add(e)}).call(o,t,function(t,e){if(t)return n(t);var i=new c({logger:o.Pt,version:o.Tt},n,function(t,e){if(t)503===t.code?o.Pt.debug("The end point [%s] is temporarily disabled",a.get(e,["endPoint"])):o.Pt.warn("An error occurred in resolving an endpoint [%s]",a.get(e,["endPoint"]),t);else{var i=0===e.endPoint.lastIndexOf("https:",0);o.nn.recordMetric("RoundTripTime",{uint64:e.time},null,{resource:e.endPoint,kind:i?"https":"http"})}});i.resolveAll(e),o.g.add(i)})}else n(new Error("Uri not supported ["+t+"]"))}.call(this,this.in,t)},t.prototype.dispose=function(){this.g.dispose()},t.prototype.toString=function(){return"PCastEndPoint["+this.in+"]"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(3)],void 0===(r=function(h,r){"use strict";function t(){}function f(t,e,i,n,r){return h.re(t)?t:h.re(e)?e:h.re(i)?i:h.re(n)?n:r}function d(t,e,i,n,r){return h.Yt(t)?t:h.Yt(e)?e:h.Yt(i)?i:h.re(n)?n:r}function l(t,e){var i=parseInt(t,e);if(!isNaN(i))return i}function m(t){var e=parseFloat(t);if(!isNaN(e))return e}function p(t){return h.includes(t.id,"send")||h.includes(t.id,"outbound")||"outboundrtp"===t.type||"outbound-rtp"===t.type||"kOutboundRtp"===t.type}function v(t){return h.includes(t.id,"recv")||"inboundrtp"===t.type||"inbound-rtp"===t.type||"kInboundRtp"===t.type}return t.convertPeerConnectionStats=function(i,t){return function(t,u){if(!i)return null;var c=[],e=function(e){var n={};switch(r.browser){case"Firefox":return h.forOwn(e,function(i,t){h.includes(t,"rtcp")&&h.forOwn(e,function(t,e){h.includes(e,"rtp")&&i.mediaType===t.mediaType&&(t.jitter=1e3*(i.jitter||t.jitter),t.roundTripTime=i.roundTripTime)})}),e;case"IE":return h.forOwn(e,function(t,e){h.startsWith(e,"ssrc")&&(n[t.id]=t)}),n;case"Edge":return e.forEach(function(t){n[t.id]=t,h.hasIndexOrKey(t,"jitter")&&(t.jitter*=1e3)}),h.forOwn(n,function(e){"track"===e.type&&h.hasIndexOrKey(e,"framesPerSecond")&&h.forOwn(n,function(t){"video"===t.mediaType&&(t.framesPerSecond=parseInt(e.framesPerSecond,10))})}),n;case"Safari":return e.forEach(function(t){n[t.id]=t}),h.forOwn(n,function(e){if(h.hasIndexOrKey(e,"id")&&v(e)){var t=parseInt(h.get(e.id.split("_"),[1]),10);e.ssrc=t||e.ssrc}h.hasIndexOrKey(e,"jitter")&&(e.jitter*=1e3),"candidate-pair"===e.type&&h.forOwn(n,function(t){"audio"!==t.mediaType&&"video"!==t.mediaType||(t.currentRoundTripTime=1e3*e.currentRoundTripTime)}),"track"===e.type&&h.forOwn(n,function(t){"audio"===t.mediaType&&v(t)?t.audioOutputLevel=1e5*e.audioLevel:"audio"===t.mediaType&&p(t)&&(t.audioInputLevel=1e5*e.audioLevel)})}),n;case"ReactNative":return(h.Yt(e)?JSON.parse(e):e).forEach(function(t){var i={id:t.id,type:t.type};t.values.forEach(function(e){h.keys(e).forEach(function(t){i[t]=e[t]})}),i.timestamp=t.timestamp,n[i.id]=i}),n;case"Chrome":default:return e.result().forEach(function(e){var i={id:e.id,type:e.type};e.names().forEach(function(t){i[t]=e.stat(t)}),i.timestamp=e.timestamp.getTime(),n[i.id]=i}),n}}(i);return h.forOwn(e,function(t){if(h.hasIndexOrKey(t,"ssrc")&&t.ssrc&&!h.includes(t.id,"rtcp")){var e=t.id||t.ssrc;h.hasIndexOrKey(u,e)||(u[e]={timestamp:h.now()});var i="?",n=parseFloat(t.timestamp)-u[e].timestamp,r=function(t,e,i){if(!h.isUndefined(e))return t?8*(t-(e||0))/i:0}(parseFloat(t.bytesSent),u[e].bytesSent,n),s=function(t,e,i){if(!h.isUndefined(e))return t?8*(t-(e||0))/i:0}(parseFloat(t.bytesReceived),u[e].bytesReceived,n),o=function(t,e,i){if(!h.isUndefined(e))return(t-e)/(i/1e3)}(f(l(t.framesEncoded),l(t.framesDecoded)),u[e].framesEncoded||u[e].framesDecoded,n);p(t)&&(i="upload"),v(t)&&(i="download");var a={uploadRate:r,downloadRate:s,mediaType:t.mediaType,ssrc:t.ssrc,direction:i,nativeReport:t,rtt:f(l(t.rtt),l(t.googRtt),l(t.roundTripTime),l(t.currentRoundTripTime)),bitrateMean:l(t.bitrateMean,10)||1e3*(p(t)?r:s),targetDelay:l(d(t.targetDelay,t.googTargetDelayMs),10),currentDelay:l(d(t.currentDelay,t.currentDelayMs,t.googCurrentDelayMs),10)};h.assign(u[e],t),"video"===t.mediaType&&(a=h.assign(a,{droppedFrames:l(t.droppedFrames,10)||0,framerateMean:f(t.framerateMean,t.framesPerSecond,o)||0,cpuLimitedResolution:d(t.cpuLimitedResolution,t.googCpuLimitedResolution),avgEncode:l(d(t.avgEncode,t.avgEncodeMs,t.googAvgEncodeMs),10)})),"audio"===t.mediaType&&(a=h.assign(a,{audioInputLevel:d(t.audioInputLevel,t.googAudioInputLevel),audioOutputLevel:d(t.audioOutputLevel,t.googAudioOutputLevel),jitter:l(d(t.jitter,t.jitterReceived,t.googJitterReceived),10),jitterBuffer:l(d(t.jitterBuffer,t.jitterBufferMs,t.googJitterBufferMs),10),totalSamplesDuration:m(t.totalSamplesDuration),totalAudioEnergy:m(t.totalAudioEnergy)})),c.push(a)}}),c}(0,t)},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(24),i(41)],void 0===(r=function(r,s,o,t,e){"use strict";var i=t.types,a=e.states,n="pcast://phenixp2p.com/";function u(t,e,i,n){this.init(t,e,i,n)}function c(t){return r.includes(t,n)?n:"pcast://phenixrts.com/"}function h(t){var n={},e=t.split("?");if(2!==e.length)return n;var i=e[1].split("&");return r.forEach(i,function(t){var e=t.split("="),i=e[0];n[i]=e[1],"capabilities"===i&&(n[i]=e[1]&&e[1].split(",")||[])}),n}function f(t){return s.De(t,i,"streamType"),r.getEnumName(i,t)}function d(t){return s.De(t,a,"trackState"),r.getEnumName(a,t)}return u.prototype.init=function(t,e,i,n){s.Yt(t,"uri"),this.Xi=new o.Observable(t),this.Wt=new o.Observable(e,f),this.rn=new o.Observable(i||a.trackEnabled.name,d),this.sn=new o.Observable(n||a.trackEnabled.name,d),this.$i=u.parsePCastStreamIdFromStreamUri(t)},u.prototype.getUri=function(){return this.Xi.getValue()},u.prototype.getType=function(){return this.Wt.getValue()},u.prototype.getObservableAudioState=function(){return this.rn},u.prototype.getObservableVideoState=function(){return this.sn},u.prototype.toJson=function(){return{uri:this.Xi.getValue(),type:this.Wt.getValue(),audioState:this.rn.getValue(),videoState:this.sn.getValue()}},u.prototype.an=function(t){var e,i;r.xt(t)&&(t.hasOwnProperty("uri")&&t.uri!==this.Xi.getValue()&&(e=t.uri,i=this.Xi.getValue(),u.parsePCastStreamIdFromStreamUri(e)===u.parsePCastStreamIdFromStreamUri(i))&&(this.Xi.setValue(t.uri),this.$i=u.parsePCastStreamIdFromStreamUri(t.uri)),t.hasOwnProperty("audioState")&&this.rn.setValue(t.audioState),t.hasOwnProperty("videoState")&&this.sn.setValue(t.videoState))},u.prototype.isPCastStream=function(){return!!this.$i},u.prototype.getPCastStreamId=function(){return this.$i},u.prototype.getInfo=function(){return h(this.Xi.getValue())},u.getPCastPrefix=function(){return n},u.parsePCastStreamIdFromStreamUri=function(t){return r.includes(t,c(t))?t.replace(c(t),"").split("?")[0]:null},u.getInfoFromStreamUri=function(t){return h(t)},u}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{types:{user:{id:0,name:"User"},presentation:{id:1,name:"Presentation"},audio:{id:2,name:"Audio"}}}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(0),i(1),i(2)],void 0===(r=function(s,o,a){"use strict";function t(t,e){this.latestValue=null,this.subscribeCallbacks={},this.subscriptionTimeout=100,this.subscriptionCount=0,this.resetOnChange=!1,this.lastChangeTime=0,this.isPendingChanges=!1,this.beforeChange=e,n.call(this,t)}function i(t){return null==t?t:s.isArray(t)?t.slice():t}function n(t){var e=t;this.beforeChange&&(e=this.beforeChange(t)),this.latestValue=i(e)}function u(t,e){if(this.lastChangeTime=s.now(),!this.isPendingChanges&&0!==this.subscriptionCount){if(this.isPendingChanges=!0,e)return r.call(this);(function e(t){var i=this;setTimeout(function(){var t=s.now()-i.lastChangeTime;i.resetOnChange&&t<i.subscriptionTimeout?e.call(i,i.subscriptionTimeout-t):r.call(i)},t)}).call(this,t)}}function r(){try{(function(){var e=this;s.forOwn(e.subscribeCallbacks,function(t){s.Ct(t)&&t(e.latestValue)})}).call(this)}finally{this.isPendingChanges=!1}}return t.prototype.getValue=function(){return i(this.latestValue)},t.prototype.setValue=function(t){t!==this.latestValue&&(n.call(this,t),u.call(this,this.subscriptionTimeout))},t.prototype.subscribe=function(t,e){o.Ct(t,"callback"),e&&o.xt(e,"options");var i,n=this,r=s.uniqueId();return n.subscribeCallbacks[r]=t,n.subscriptionCount+=1,e&&("notify"===e.initial&&u.call(n,n.subscriptionTimeout,!0),e.listenForChanges&&(i=setInterval(function(){var t=e.listenForChanges.callback();t!==n.latestValue&&n.setValue(t)},e.listenForChanges.timeout))),new a.Disposable(function(){delete n.subscribeCallbacks[r],i&&(clearInterval(i),i=null),n.subscriptionCount-=1})},t.prototype.extend=function(t){switch(o.xt(t,"options"),t.method){case"notifyWhenChangesStop":this.subscriptionTimeout=t.timeout,this.resetOnChange=!0;break;case"notifyAtFixedRate":this.subscriptionTimeout=t.timeout}return s.re(t.rateLimit)&&(this.subscriptionTimeout=t.rateLimit),this},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(2)],void 0===(r=function(s,o,i){"use strict";function t(){this.un=[]}function n(e,i,t){var n=this;function r(){s.forEach(n.un,function(t){t.apply(i,e)})}s.isNullOrUndefined(e)&&(e=[]),o.isArray(e,"args"),t?setTimeout(function(){r(),t()},0):r()}return t.prototype.fire=function(t,e){n.call(this,t,e)},t.prototype.fireAsync=function(t,e,i){n.call(this,t,e,i||function(){})},t.prototype.listen=function(e){var t=this;return o.Ct(e,"listener"),t.un.push(e),new i.Disposable(function(){t.un=s.remove(t.un,function(t){return t===e})})},t.prototype.size=function(){return this.un.length},t.prototype.dispose=function(){this.un=[]},t.prototype.toString=function(){return"Event|"+this.size()},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(2),i(18),i(6),i(10),i(19),i(32),i(80),i(21),i(85),i(86),i(33),i(11),i(87),i(89),i(90),i(22),i(92),i(35),i(96),i(13),i(7),i(36),i(3),i(34)],void 0===(r=function(S,E,r,s,o,t,a,T,e,u,c,h,n,b,i,f,l,d,k,v,m,g,I,R,M,C,y){"use strict";var p=50;function w(t){function e(t){var e=t?t.error:"Unknown Error";i.Pt.error("Window Error Event Triggered with pcast in [%s] state [%s]",i.cn.getValue(),e,e)}t=t||{},E.xt(t,"options"),t.streamingSourceMapping&&(E.xt(t.streamingSourceMapping,"options.streamingSourceMapping"),E.Nt(t.streamingSourceMapping.replacement,"options.streamingSourceMapping.replacement"),t.streamingSourceMapping.patternToReplace instanceof RegExp||E.Nt(t.streamingSourceMapping.patternToReplace,"options.streamingSourceMapping.patternToReplace")),S.isNullOrUndefined(t.disableMultiplePCastInstanceWarning)||E.hn(t.disableMultiplePCastInstanceWarning,"options.disableMultiplePCastInstanceWarning"),S.isNullOrUndefined(t.disableGlobalErrorListener)||E.hn(t.disableGlobalErrorListener,"options.disableGlobalErrorListener"),S.isNullOrUndefined(t.disableBeforeUnload)||E.hn(t.disableBeforeUnload,"options.disableBeforeUnload"),S.isNullOrUndefined(t.disableConsoleLogging)||E.hn(t.disableConsoleLogging,"options.disableConsoleLogging"),S.isNullOrUndefined(t.treatBackgroundAsOffline)||E.hn(t.treatBackgroundAsOffline,"options.treatBackgroundAsOffline"),S.isNullOrUndefined(t.reAuthenticateOnForeground)||E.hn(t.reAuthenticateOnForeground,"options.reAuthenticateOnForeground"),!0===t.treatBackgroundAsOffline&&!1===t.reAuthenticateOnForeground&&this.Pt.warn('Conflicting options "reAuthenticateOnForeground" can not be false when "treatBackgroundAsOffline" is true. Will reauthenticate upon entering foreground.'),this.cn=new r.Observable("offline"),this.in=t.uri||c.DefaultPCastUri,this.fn=t.deviceId||"",this.Tt="2020-07-14T03:13:57Z",this.Pt=t.logger||o.createPCastLogger(this.in,t.disableConsoleLogging),this.dn=t.metricsTransmitter||f.createMetricsTransmitter(this.in),this.ln=new h(t,this.Pt),this.mn=t.shaka,this.pn=t.videojs||C.global.videojs,this.vn=t.rtmp||{},this.gn=t.streamingSourceMapping,this.g=new s.DisposableList,this.yn=t.disableMultiplePCastInstanceWarning,this.wn=!0===t.treatBackgroundAsOffline,this.bn=!0===t.reAuthenticateOnForeground,this.kn=0,this.Sn=0,this.En=!0,this.Tn=[],this.In=[],this.Rn=new I(t.features),this.Mn={},this.Cn={};var i=this,n=S.filter(this.Rn.getFeatures(),I.isFeatureSupported);this.Pt.info("Device supports features [%s], user selected [%s]",n,this.Rn.getFeatures()),S.addEventListener(C.global,"unload",function(){return i.Pt.info("Window Unload Event Triggered"),i.stop("window-unload")}),t.disableGlobalErrorListener||(S.addEventListener(C.global,"error",e),C.global.__phenixGlobalErrorListenerDisposable&&C.global.__phenixGlobalErrorListenerDisposable.dispose(),C.global.__phenixGlobalErrorListenerDisposable=new s.Disposable(function(){S.removeEventListener(C.global,"unload",e)})),t.disableBeforeUnload||S.addEventListener(C.global,"beforeunload",function(){return i.Pt.info("Window Before Unload Event Triggered"),i.stop("window-beforeunload")}),C.webrtcSupported||"ReactNative"!==C.browser||C.shim(),C.webrtcSupported&&(function(){var i=this,n=new C.RTCPeerConnection;"Safari"===C.browser&&10<C.browserVersion&&(n.addTransceiver("audio"),n.addTransceiver("video"));try{var t=function(t){var e=y.getH264ProfileIds(t.sdp);if(i.In=y.getSupportedCodecs(t.sdp),i.Pt.info("Supported WebRTC video codecs [%s]",i.In),0===e.length)return i.Pt.info("Unable to find local h264 profile level id",t.sdp);i.Pt.info("Found local h264 profile level ids [%s]",e,t.sdp),i.Tn=e,n.close&&n.close()},e=function(t){i.Pt.error("Unable to create offer to get local h264 profile level id",t),n.close&&n.close()},r={offerToReceiveAudio:!0,offerToReceiveVideo:!0};if("function"==typeof C.global.Promise)return n.createOffer(r).then(t).catch(e);n.createOffer(t,e,r)}catch(t){i.Pt.error("Failed to set environment defaults. Creating the Offer failed",t),n.close&&n.close()}}.call(this),_.call(this))}function x(){var i=this;if(i.xn)i.Pt.warn("[%s] Skip connect due to stopped state",i);else{A.call(i)&&"offline"===i.cn.getValue()&&(this.Pt.warn("[PCast] connected after being offline. Reconnecting."),P.call(i)),this.Pn=!0;var n=i.Dn,r=++i.kn;n.authenticate(i.On,function(t,e){n===i.Dn?r===i.kn?i.An&&(t?(i.Pt.error("Failed to authenticate [%s]",t),Q.call(i,"unauthorized"),i.An.call(i,i,"unauthorized","")):"ok"!==e.status?(i.Pt.warn("Failed to authenticate, status [%s]",e.status),Q.call(i,"unauthorized"),i.An.call(i,i,"unauthorized","")):(Q.call(i,"online"),i.An.call(i,i,e.status,e.sessionId))):i.Pt.info("Ignoring authentication response as a latter request is already underway"):i.Pt.info("Ignoring authentication response as reset took place")})}}function P(){Q.call(this,"reconnecting")}function D(t){t&&E.Yt("reason",t),Q.call(this,"reconnected",t),this.Pt.info("Attempting to re-authenticate after reconnected event [%s]",t),function(){var r=this;if(r.xn)r.Pt.info("Skip re-authentication due to stopped state");else{var s=r.Dn,o=++r.Sn;s.authenticate(r.On,function(t,e){var i=!0===r.Pn;if(s===r.Dn){if(o===r.Sn){if(t)return r.Pt.error("Unable to authenticate after reconnect to WebSocket [%s]",t),Q.call(r,"reconnect-failed");if("ok"===e.status)return r.Pn=!0,r.Pt.info("Successfully authenticated after reconnect to WebSocket"),Q.call(r,"online",null,i);r.Pt.warn("Unable to authenticate after reconnect to WebSocket, status [%s]",e.status);var n="capacity"===e.status?e.status:"reconnect-failed";return Q.call(r,n)}r.Pt.info("Ignoring re-authentication response as a latter request is already underway")}else r.Pt.info("Ignoring re-authentication response as reset took place")})}}.call(this)}function O(){if(A.call(this)&&"reconnecting"===this.cn.getValue())return this.Pt.warn("[PCast] disconnected after attempting to reconnect. Going offline."),Q.call(this,"critical-network-issue"),this.stop("critical-network-issue");this.Pn=!1,Q.call(this,"offline")}function A(){return S.reduce(this.qn,function(t,e){return t?"closed"===e.iceConnectionState:t},!0)}function q(t){var e=t.streamId,i=t.reason;return U.call(this,e,i)}function F(t){var e=t.streamId,i=t.status,n=t.reason,r=this.Fn[e];r&&r.dataQualityChangedCallback(i,n);var s=this.Un[e];s&&S.Ct(s.dataQualityChangedCallback)&&s.dataQualityChangedCallback(s,i,n)}function U(t,e){this.Pt.info("[%s] Stream ended with reason [%s]",t,e);var i=this.Fn[t];i&&i.streamEndedCallback(v.getStreamEndedStatus(e),e,!0),delete this.Fn[t];var n=this.Un[t];n&&S.Ct(n.publisherEndedCallback)&&n.publisherEndedCallback(n,v.getStreamEndedStatus(e),e),delete this.Un[t];var r=this.qn[t];r&&$.call(this,t,r,"ended"),delete this.qn[t]}function N(a,u,c,h,f,d){function t(t){if(!u.failed&&!p){var e=y.getNumberOfActiveSections(c),i=t.stream||S.get(t,["streams",0]),n="real-time";if(!i)return u.failed=!0,m.Pt.warn("[%s] No remote stream",a),f.call(m,void 0,"failed");if(l&&clearTimeout(l),e===i.getTracks().length||"ReactNative"===C.browser){p=!0,m.Pt.info("[%s] Got remote stream",a),h.setProperty("kind",n);var r=S.assign({networkLag:m.Nn},d),s=new g(a,i,c,h,r,m.Pt),o=new v(n,s,m.Pt);o.on(R.streamEvents.playerError.name,function(t,e){m.Pt.info("Phenix Real-Time stream error [%s] [%s]",t,e),o.streamErrorCallback(n,e)}),o.on(R.streamEvents.stopped.name,function(t){!u.stopped&&m.Dn&&(m.Pt.info("[%s] media stream has stopped with reason [%s]",a,t),$.call(m,a,c,"stop"),m.Dn.destroyStream(a,t||"",function(t,e){t?m.Pt.error("[%s] failed to destroy stream [%s]",a,t):"ok"===e.status?m.Pt.info("[%s] destroyed stream",a):m.Pt.warn("[%s] failed to destroy stream, status [%s]",a,e.status)}),u.stopped=!0)}),m.Fn[a]=o,f.call(m,s)}else l=setTimeout(function(){return u.failed=!0,m.Pt.warn("[%s] Did not receive all tracks within [%s] ms",a,3e3),f.call(m,void 0,"failed")},3e3)}}var l,m=this,p=!1;S.addEventListener(c,"addstream",t),S.addEventListener(c,"track",t)}function j(i,t,n){var r=this;S.addEventListener(t,"icecandidate",function(t){var e=t.candidate;e?r.Pt.info("[%s] ICE candidate: [%s] [%s] [%s]",i,e.sdpMid,e.sdpMLineIndex,e.candidate):r.Pt.info("[%s] ICE candidate discovery complete",i),n&&n(e)})}function L(e,i){var n=this;S.addEventListener(i,"negotiationneeded",function(t){n.Pt.info("[%s] Negotiation needed",e)}),S.addEventListener(i,"iceconnectionstatechange",function(t){n.Pt.info("[%s] ICE connection state changed [%s]",e,i.iceConnectionState)}),S.addEventListener(i,"icegatheringstatechange ",function(t){n.Pt.info("[%s] ICE gathering state changed [%s]",e,i.iceGatheringState)}),S.addEventListener(i,"signalingstatechange",function(t){n.Pt.info("[%s] Signaling state changed [%s]",e,i.signalingState)}),S.addEventListener(i,"connectionstatechange",function(t){n.Pt.info("[%s] Connection state changed [%s]",e,i.connectionState)})}function _(e){var i=this;switch(C.browser){case"Edge":return C.getDestinations(function(t){0===S.filter(t,function(t){return"audio"===t.kind}).length?(i.En&&i.Pt.info("Detected no audio devices attached to machine"),i.En=!1):i.En=!0,e&&e()});default:e&&e()}}function B(t,n,e,i,r,s){if("IE"===C.browser)throw new Error("Subscribing in real-time not supported on IE");var o=this,a={failed:!1,stopped:!1},u=e.match(/a=crypto:/i),c=e.match(/m=application /i),h=new C.RTCPeerConnection(t,{optional:[{DtlsSrtpKeyAgreement:!u},{RtpDataChannels:c}]});if(nt(h),o.qn[n]=h,"Firefox"===C.browser||"Edge"===C.browser){if(e.match(/(\nm=video)/g)&&e.match(/(\nm=audio)/g)){var f=/(a=candidate)((.|\n)*)(?=m=)/g;e=e.replace(f,e.match(f)+"a=end-of-candidates\n")}e=(e+="a=end-of-candidates").replace(/(\na=ice-options:trickle)/g,"")}function d(t){a.failed||(t instanceof Error&&(o.Pt.info("[%s] Failed to setup peer connection",n,t),t="failed"),a.failed=!0,a.stopped=!0,delete o.qn[n],delete o.Fn[n],delete o.jn[n],$.call(o,n,h,"failure"),r.call(o,void 0,t||"failed"))}"ReactNative"===C.browser&&(e=y.setGroupLineOrderToMatchMediaSectionOrder(e)),N.call(o,n,a,h,i,r,s),j.call(o,n,h,function(t){o.jn[n]&&o.jn[n](t)}),L.call(o,n,h);var l=new C.RTCSessionDescription({type:"offer",sdp:e}),m={mandatory:{}};if("Chrome"===C.browser||"ReactNative"===C.browser?(m.mandatory.OfferToReceiveVideo=!1!==s.receiveVideo,m.mandatory.OfferToReceiveAudio=!1!==s.receiveAudio):(m.mandatory.offerToReceiveVideo=!1!==s.receiveVideo,m.mandatory.offerToReceiveAudio=!1!==s.receiveAudio),"function"==typeof C.global.Promise)return h.setRemoteDescription(l).then(S.bind(W,o,h)).then(function(){return h.createAnswer(m)}).then(S.bind(V,o)).then(function(i){return new C.global.Promise(function(t,e){H.call(o,n,i,t,e)})}).then(function(t){return h.setLocalDescription(t)}).then(S.bind(z,o,h)).catch(d);h.setRemoteDescription(l,function(){W.call(o,h),h.createAnswer(function(t){V.call(o,t),H.call(o,n,t,function(t){h.setLocalDescription(t,S.bind(z,o,h),d)},d)},d,m)},d)}function z(t){this.Pt.debug("Set local description [%s] [%s]",S.get(t,["localDescription","type"]),S.get(t,["localDescription","sdp"]))}function W(t){this.Pt.debug("Set remote description [%s] [%s]",S.get(t,["localDescription","type"]),S.get(t,["remoteDescription","sdp"]))}function V(t){return this.Pt.info("Created answer [%s]",t.sdp),t}function H(s,t,o,a){var u=this;u.Dn.setAnswerDescription(s,t.sdp,function(t,e){if(t)return u.Pt.error("Failed to set answer description [%s]",t),a();if("ok"!==e.status)return u.Pt.warn("Failed to set answer description, status [%s]",e.status),a(e.status);e&&S.includes(e.options,"ice-candidates")&&(u.jn[s]=S.bind(G,u,s));var i=e.sessionDescription.sdp;if(I.isIOS()){var n=S.get(I.getIOSVersion(),["major"]);u.Pt.info("iOS Version is [%s]",n),n<11&&(i=i.replace("BUNDLE audio video","BUNDLE video audio"))}var r=new C.RTCSessionDescription({type:"answer",sdp:i});o(r)})}function G(t,e){var i=this,n=this.Mn[t];n=n||(this.Mn[t]=[]),e&&S.get(e,["candidate"])?n.push(e):(i.Cn[t]&&(i.Pt.debug("[%s] Dismissing scheduled batch for adding ICE candidates. Sending candidates immediately because there are no more candidates.",t),clearTimeout(i.Cn[t])),K.call(i,t,["completed"]),delete this.Mn[t],delete this.Cn[t]),this.Cn[t]?i.Pt.debug("[%s] Using existing batch for adding ICE candidates",t):(this.Cn[t]=setTimeout(function(){K.call(i,t,[]),delete i.Cn[t]},p),this.g.add(new s.Disposable(function(){i.Cn[t]&&clearTimeout(i.Cn[t]),delete i.Mn[t],delete i.Cn[t]})))}function K(i,t){var e=this.Mn[i]||[];if(0!==e.length||0!==t.length){var n=this;delete n.Mn[i],this.Pt.info("[%s] Adding [%s] ICE Candidates with Options [%s]",i,e.length,t),this.Dn.addIceCandidates(i,e,t,function(t,e){return t?n.Pt.error("Failed to add ICE candidate [%s]",t):"ok"!==e.status?n.Pt.warn("Failed to add ICE candidate, status [%s]",e.status):void(S.includes(e.options,"cancel")&&delete n.jn[i])})}}function J(t,e,i,n,r){var s=/a=x-rtmp:(rtmp:\/\/[^\n]*)/m,o=e.match(s),a=e.match(/a=x-playlist:([^\n]*[.]mpd\??[^\s]*)/m),u=e.match(/a=x-playlist:([^\n]*[.]m3u8\??[^\s]*)/m),c=S.get(a,[1],""),h=S.get(u,[1],""),f=a&&2===a.length,d=u&&2===u.length,l=!!o,m=[];(f||d)&&m.push("streaming"),l&&m.push("rtmp");var p=this.Rn.getPreferredFeatureFromPublisherCapabilities(m,!0);switch(this.gn&&(c=c.replace(this.gn.patternToReplace,this.gn.replacement),h=h.replace(this.gn.patternToReplace,this.gn.replacement)),p){case R.types.rtmp.name:var v=[],g=T.parseEnvFromPcastBaseUri(this.in);for(this.Pt.info("Selecting flash playback for rtmp.");o;){var y=S.get(o,[1],""),w=S.get(y.match(/(rtmp:\/\/[^\n\s]*)/),[0]),b=S.get(y.match(/bitrate=([^\n\s;]*)/),[1]),k=S.get(y.match(/resolution=([^\n\s;]*)/),[1]);e=e.replace(y,""),w&&v.push({uri:w,bitrate:b,resolution:k}),o=e.match(s)}return X.call(this,t,v,R.types.rtmp.name,i,n,S.assign({env:g},this.vn,r));case R.types.dash.name:return this.Pt.info("Selecting dash playback for live stream."),r.isDrmProtectedContent=/[?&]drmToken=([^&]*)/.test(c)||/x-widevine-service-certificate/.test(e),r.isDrmProtectedContent&&(r.widevineServiceCertificateUrl=e.match(/a=x-widevine-service-certificate:([^\n][^\s]*)/m)[1],r.playreadyLicenseUrl=e.match(/a=x-playready-license-url:([^\n][^\s]*)/m)[1]),this.mn&&!this.mn.Player.isBrowserSupported()?(this.Pt.warn("[%s] Shaka does not support this browser",t),n.call(this,void 0,"browser-unsupported")):X.call(this,t,c,R.types.dash.name,i,n,r);case R.types.hls.name:return this.Pt.info("Selecting hls playback for live stream."),r.isDrmProtectedContent=/[?&]drmToken=([^&]*)/.test(h),r.hlsTargetDuration&&(E.re(r.hlsTargetDuration,"options.hlsTargetDuration"),h=h+(-1<h.indexOf("?")?"&":"?")+"targetDuration="+r.hlsTargetDuration),X.call(this,t,h,R.types.hls.name,i,n,S.assign({preferNative:I.shouldUseNativeHls},r))}return this.Pt.warn("[%s] Device does not support [%s] playback. Creating live viewer stream failed.",t,I.mapPCastCapabilitiesToFeatures(m)),n.call(this,void 0,"failed")}function X(i,t,e,n,r,s){var o=this,a=new m(e,i,t,n,s,this.mn,this.Pt),u=new v(e,a,this.Pt);n.setProperty("kind",e),u.on(R.streamEvents.playerError.name,function(t,e){o.Pt.warn("Phenix Live Stream Player Error [%s] [%s]",t,e),u.streamErrorCallback(t,e)}),u.on(R.streamEvents.stopped.name,function(t){if(!o.Dn)return o.Pt.warn("Unable to destroy stream [%s]",i);o.Dn.destroyStream(i,t||"",function(t,e){t?o.Pt.error("[%s] failed to destroy stream, [%s]",i,t):"ok"===e.status||o.Pt.warn("[%s] failed to destroy stream, status [%s]",i,e.status)})}),this.Fn[i]=u,r.call(this,u.getPhenixMediaStream())}function Q(t,e,i){var n=this.getStatus();if(n!==t&&("critical-network-issue"!==n&&"offline"!==n||"offline"!==t)){this.cn.setValue(t);var r=this.getProtocol(),s=r?r.getSessionId():"";if(this.Pt.debug("[%s] Transition from [%s] to [%s] with reason [%s]",s,n,t,e),i)return;switch(t){case"connecting":case"reconnecting":case"reconnected":break;case"critical-network-issue":case"unauthorized":case"reconnect-failed":case"offline":return this.Ln.call(this);case"online":return this._n.call(this)}}}function $(t,e,i){"closed"===e.signalingState||e.__closing?this.Pt.debug("[%s] Peer connection is already closed [%s]",t,i):(this.Pt.debug("[%s] close peer connection [%s]",t,i),e.close(),e.__closing=!0)}function Y(){(this.wn||this.bn)&&D.call(this,"entered-foreground")}function Z(){this.wn&&Q.call(this,"offline","entered-background")}function tt(t){if(!t)return t;var e=S.isArray(t)?[]:{},i=S.bind(et,null,e);return S.isArray(t)?S.forEach(t,i):S.forOwn(t,i),e}function et(t,e,i){if(null!==e){if(S.xt(e)||S.isArray(e))return t[i]=tt(e);if(!S.Yt(e)||!S.Yt(i))return t[i]=e;var n=S.startsWith(e.toLowerCase(),i.toLowerCase())?e.substring(i.length,e.length).toLowerCase():e;t[i]=n}}function it(t){switch(C.browser){case"Firefox":(i=t)&&S.forEach(i.iceServers,function(t){t.urls=S.filter(t.urls,function(t){return!S.startsWith(t,"turns")})});break;case"Edge":(e=t)&&S.forEach(e.iceServers,function(t){t.urls=S.map(t.urls,function(t){return t.replace("transport=tcp","transport=udp")})})}var e,i;return t}w.prototype.getBaseUri=function(){return this.in},w.prototype.getStatus=function(){return this.cn.getValue()},w.prototype.getObservableStatus=function(){return this.cn},w.prototype.isStarted=function(){return this.Bn},w.prototype.reAuthenticate=function(t){if(E.Nt(t,"authToken"),"online"===this.cn.getValue())return this.Pt.warn("Already authenticated. Denying request to re-authenticate");this.Pt.info("Attempting to re-authenticate with new auth token [%s]",t),this.On=t,D.call(this)},w.prototype.start=function(t,e,i,n){if(E.Nt(t,"authToken"),E.Ct(e,"authenticationCallback"),E.Ct(i,"onlineCallback"),E.Ct(n,"offlineCallback"),this.Bn)throw new Error('"Already started"');S.re(C.global.__phenixInstantiatedPCastCount)?C.global.__phenixInstantiatedPCastCount++:C.global.__phenixInstantiatedPCastCount=1,1<C.global.__phenixInstantiatedPCastCount&&!this.yn&&this.Pt.warn("Avoid using multiple instances of PCast as this uses unnecessary resources and will reduce performance. This is your [%s] simultaneous instance. Remember to dispose all resources when done with them by calling .stop() or .dispose()",C.global.__phenixInstantiatedPCastCount),this.xn=!1,this.Bn=!0,this.On=t,this.An=e,this._n=i,this.Ln=n,this.nn=new d(this.Pt,this.dn),this.zn=new c(this.Tt,this.in,this.Pt,this.nn),Q.call(this,"connecting"),this.qn={},this.Fn={},this.jn={},this.Un={},this.Wn=[],this.g.add(this.zn),this.g.add(this.nn),this.g.add(a.onBackground(S.bind(Z,this))),this.g.add(a.onForeground(S.bind(Y,this)));var r=this;r.zn.resolveUri(function(t,e){if(t){if(r.Pt.error("Failed to connect to [%s]",r.in,t),Q.call(r,"offline"),r.An)switch(t.code){case 0:r.An.call(r,r,"network-unavailable","");break;case 503:r.An.call(r,r,"capacity","");break;default:r.An.call(r,r,"failed","")}return r.xn=!0,void(r.Bn=!1)}r.Pt.info("Discovered end point [%s] with RTT [%s]",e.uri,e.roundTripTime),r.Nn=e.roundTripTime/2,r.Vn=e.uri,r.Bn&&function(t){this.Dn=new u(t,this.fn,this.Tt,this.Pt),this.Dn.onEvent("connected",S.bind(x,this)),this.Dn.onEvent("reconnecting",S.bind(P,this)),this.Dn.onEvent("reconnected",S.bind(D,this)),this.Dn.onEvent("disconnected",S.bind(O,this)),this.Dn.onEvent("pcast.StreamEnded",S.bind(q,this)),this.Dn.onEvent("pcast.StreamDataQuality",S.bind(F,this)),this.Pt.setObservableSessionId&&this.Pt.setObservableSessionId(this.Dn.getObservableSessionId()),this.Hn&&(this.Hn.dispose(),this.nn.setSessionId(null)),this.Hn=this.Dn.getObservableSessionId().subscribe(S.bind(this.nn.setSessionId,this.nn))}.call(r,e.uri)})},w.prototype.stop=function(i){if(i=i||"",E.Yt(i,"reason"),this.Bn){this.Pt.info("Stopping pcast instance with reason [%s]",i),this.xn=!0,this.Bn=!1,delete this.An;try{var n=this;S.forOwn(this.Fn,function(t,e){U.call(n,e,i)}),S.forOwn(this.Un,function(t,e){U.call(n,e,i),S.includes(t.getOptions(),"detached")||t.stop(i,!0)}),S.forOwn(this.qn,function(t,e){U.call(n,e,i)}),S.forEach(this.Wn,function(t){var e=t.getTracks();S.forEach(e,function(t){t.stop()})})}finally{if(this.Dn){try{this.Dn.disconnect()}catch(t){n.Pt.warn("Failed to disconnect pcast",t)}this.Dn=null}this.Pt.setObservableSessionId&&this.Pt.setObservableSessionId(null),this.Hn&&(this.Hn.dispose(),this.nn.setSessionId(null)),C.global.__phenixInstantiatedPCastCount--,this.g.dispose()}}},w.prototype.getUserMedia=function(t,e,i){if("IE"===C.browser)throw new Error("Publishing not supported on IE");return E.xt(t,"options"),E.Ct(e,"callback"),i&&E.Ct(i,"onScreenShare"),new n(this.Pt,this.ln,i).getUserMedia(t,e)},w.prototype.publish=function(t,a,u,e,c){if("IE"===C.browser)throw new Error("Publishing not supported on IE");if(!this.Bn)throw new Error("PCast not started. Unable to publish. Please start pcast first.");if(e=e||[],c=c||{},E.Nt(t,"streamToken"),E.Ct(u,"callback"),E.isArray(e,"tags"),E.xt(c,"options"),!S.xt(a)&&!S.Yt(a))throw new Error('"streamToPublish" must be an object or URI');var h=this,f=S.assign({},c,{negotiate:!0});S.Yt(a)?(f.negotiate=!1,f.connectUri=a):f.connectUri=c.connectUri,0<e.length&&(f.tags=e);var d=new l(this.getProtocol().getSessionId(),this.Pt,this.dn);d.setProperty("resource","upload"),this.Dn.setupStream("upload",t,f,2*h.Nn,function(t,e){if(t)return h.Pt.error("Failed to create uploader [%s]",t),u.call(h,h,"failed");if("ok"===e.status){var i=e.createStreamResponse.streamId;if(d.setStreamId(i),d.setStartOffset(e.createStreamResponse.offset),d.recordMetric("Provisioned"),d.recordMetric("RoundTripTime",{uint64:2*h.Nn},null,{resource:h.Vn,kind:"https"}),!0!==f.negotiate)return function(i,t,e){var n=this,r={stopped:!1},s={getStreamId:function(){return i},getStream:function(){return n.Pt.debug("[%s] Unable to get stream on publisher of remote origin.",i),null},getStats:function(){return n.Pt.debug("[%s] Unable to get stream stats on publisher of remote origin.",i),null},isActive:function(){return!r.stopped},hasEnded:function(){return r.stopped},stop:function(t){r.stopped||(n.Pt.info("[%s] stopping publisher with reason [%s]",i,t),n.Dn.destroyStream(i,t||"",function(t,e){t?n.Pt.error("[%s] failed to destroy stream [%s]",i,t):"ok"===e.status?n.Pt.info("[%s] destroyed stream",i):n.Pt.warn("[%s] failed to destroy stream, status [%s]",i,e.status)}),r.stopped=!0)},setPublisherEndedCallback:function(t){E.Ct(t,"callback"),this.publisherEndedCallback=t},setDataQualityChangedCallback:function(t){E.Ct(t,"callback"),this.dataQualityChangedCallback=t},getOptions:function(){return e},monitor:function(t,e){E.xt(t,"options"),E.Ct(e,"callback")},getMonitor:function(){return null}};t(n.Un[i]=s)}.call(h,i,function(t,e){d.recordMetric("SetupCompleted",{string:e?"failed":"ok"}),e?u.call(h,h,"failed",null):u.call(h,h,"ok",t)},e.createStreamResponse.options);var n=e.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,r=it(tt(e.createStreamResponse.rtcConfiguration));if("Opera"===C.browser&&0<h.Tn.length){var s=S.get(y.getH264ProfileIds(n),[0]),o=y.getH264ProfileIdWithSameProfileAndEqualToOrHigherLevel(h.Tn,s);o?s!==o&&(h.Pt.info("[%s] Replacing publisher h264 profile level id [%s] with new value [%s] in offer sdp",i,s,o),n=y.replaceH264ProfileId(n,s,o)):h.Pt.warn("[%s] Unable to find new publisher h264 profile level id to replace [%s]. Rejected environment defaults of [%s]",i,s,h.Tn)}return function(t,s,u,e,i,c,n,h){var f=this,d={failed:!1,stopped:!1},r=e.match(/a=crypto:/i),o=e.match(/m=application /i),l=new C.RTCPeerConnection(t,{optional:[{DtlsSrtpKeyAgreement:!r},{RtpDataChannels:o}]}),m=null,p=null;if(nt(l),(f.qn[u]=l).addStream(s),"Firefox"===C.browser||"Edge"===C.browser){if(e.match(/(\nm=video)/g)&&e.match(/(\nm=audio)/g)){var a=/(a=candidate)((.|\n)*)(?=m=)/g;e=e.replace(a,e.match(a)+"a=end-of-candidates\n")}e=(e+="a=end-of-candidates").replace(/(\na=ice-options:trickle)/g,"")}function v(t){d.failed||(t instanceof Error&&(f.Pt.info("[%s] Failed to setup peer connection",u,t),t="failed"),d.failed=!0,d.stopped=!0,delete f.qn[u],delete f.Un[u],delete f.jn[u],$.call(f,u,l,"failure"),c.call(f,void 0,t||"failed"))}function g(){var r=/(b=AS:([0-9]*)[\n\r]*)/gi,o=/(mid:video)([\n\r]*)/gi,a=0,t=r.exec(e);t&&3<=t.length&&(a=1e3*t[2]);var n={getStreamId:function(){return u},getStream:function(){return s},isActive:function(){return!d.stopped},hasEnded:function(){switch(l.iceConnectionState){case"new":case"checking":case"connected":case"completed":return!1;case"disconnected":case"failed":case"closed":default:return!0}},stop:function(t){!d.stopped&&f.Dn&&(f.Pt.info("[%s] stopping publisher with reason [%s]",u,t||"client-action"),$.call(f,u,l,"closed"),f.Dn.destroyStream(u,t||"",function(t,e){t?f.Pt.error("[%s] failed to destroy stream [%s]",u,t):"ok"===e.status?f.Pt.info("[%s] destroyed stream",u):f.Pt.warn("[%s] failed to destroy stream, status [%s]",u,e.status)}),d.stopped=!0)},setPublisherEndedCallback:function(t){E.Ct(t,"callback"),this.publisherEndedCallback=t},setDataQualityChangedCallback:function(t){E.Ct(t,"callback"),this.dataQualityChangedCallback=t},limitBandwidth:function(t){if("Edge"===C.browser)return f.Pt.warn("Limit bandwidth not support on [%s]",C.browser);E.re(t,"bandwidthLimit");var s=a?Math.min(t,a):t,e=l.remoteDescription;f.Pt.info("Changing bandwidth limit to [%s]",s);var i=e.sdp.replace(r,"");i=i.replace(o,function(t,e,i,n,r){return[e,i,"b=AS:",Math.ceil(s/1e3),i].join("")});var n=new C.RTCSessionDescription({type:e.type,sdp:i});return l.setRemoteDescription(n),{dispose:function(){l.setRemoteDescription(e)}}},getMonitor:function(){return p},monitor:function(t,i){E.xt(t,"options"),E.Ct(i,"callback");var e=new b(u,l,f.Pt);return t.direction="outbound",e.start(t,function(){return f.Un[u]===n&&!d.stopped},function(t,e){return t&&f.Pt.warn("[%s] Publisher monitor triggered unrecoverable error [%s]",t),f.Pt.warn("[%s] Publisher triggered monitor condition for [%s]",u,e.reasons),i(n,"client-side-failure",e)}),S.forEach(s.getTracks(),function(t){S.addEventListener(t,"readystatechange",function(){if("ended"===t.readyState)return f.Pt.warn("[%s] Publisher track has failed [%s]",u,t),i(n,"camera-track-failure",{type:t.kind+"-track-ended",message:"Publisher "+t.kind+" track has ended in an unrecoverable way. This may require reconfiguring your camera or microphone."})})}),p=e},addBitRateThreshold:function(t,e){return new M("Publisher",p,function(){return a}).addThreshold(t,e)},setRemoteMediaStreamCallback:function(t){E.Ct(t,"callback"),this.remoteMediaStreamCallback=t,m&&t(n,m)},getOptions:function(){return h},getStats:function(e){E.Ct(e,"callback"),this.Gn||(this.Gn={});var i=this;return C.getStats(l,null,function(t){e(k.convertPeerConnectionStats(t,i.Gn))})}};f.Un[u]=n,c.call(f,n)}N.call(f,u,d,l,i,function(t){var e=f.Un[u];m=t,e&&e.remoteMediaStreamCallback&&e.remoteMediaStreamCallback(e,t)},n),j.call(f,u,l,function(t){f.jn[u]&&f.jn[u](t)}),L.call(f,u,l);var y=new C.RTCSessionDescription({type:"offer",sdp:e}),w={mandatory:{}};if("Chrome"===C.browser||"ReactNative"===C.browser?(w.mandatory.OfferToReceiveVideo=!0===n.receiveVideo,w.mandatory.OfferToReceiveAudio=!0===n.receiveAudio):(w.mandatory.offerToReceiveVideo=!0===n.receiveVideo,w.mandatory.offerToReceiveAudio=!0===n.receiveAudio),"function"==typeof C.global.Promise)return l.setRemoteDescription(y).then(S.bind(W,f,l)).then(function(){return l.createAnswer(w)}).then(S.bind(V,f)).then(function(i){return new C.global.Promise(function(t,e){H.call(f,u,i,t,e)})}).then(function(t){return l.setLocalDescription(t)}).then(S.bind(z,f,l)).then(g).catch(v);f.Pt.info("[%s] Using legacy callback api",u),l.setRemoteDescription(y,function(){W.call(f,l),l.createAnswer(function(t){V.call(f,t),H.call(f,u,t,function(t){l.setLocalDescription(t,function(){z.call(f,l),g()},v)},v)},v,w)},v)}.call(h,r,a,i,n,d,function(t,e){d.recordMetric("SetupCompleted",{string:e?"failed":"ok"}),e?u.call(h,h,"failed",null):u.call(h,h,"ok",t)},c,e.createStreamResponse.options)}switch(h.Pt.warn("Failed to create uploader, status [%s]",e.status),e.status){case"timeout":case"capacity":case"unauthorized":return u.call(h,h,e.status);default:return u.call(h,h,"failed")}})},w.prototype.subscribe=function(e,f,i){if(!this.Bn)throw new Error("PCast not started. Unable to subscribe. Please start pcast first.");i=i||{},E.Nt(e,"streamToken"),E.Ct(f,"callback"),E.xt(i,"options");var d=this;_.call(d,function(){var t=S.assign({},i,{negotiate:!1!==i.negotiate}),c=new l(d.getProtocol().getSessionId(),d.Pt,d.dn),h=S.assign({},i);h.canPlaybackAudio=d.En,!d.En&&i.disableAudioIfNoOutputFound&&!1!==i.receiveAudio&&(t.receiveAudio=!1,h.receiveAudio=!1,h.forcedAudioDisabled=!0),i.originStreamId&&(t.originStreamId=i.originStreamId),c.setProperty("resource","download"),d.Dn.setupStream("download",e,t,2*d.Nn,function(t,e){if(t)return d.Pt.error("Failed to create downloader [%s]",t),f.call(d,d,"failed");if("ok"!==e.status)return d.Pt.warn("Failed to create downloader, status [%s]",e.status),f.call(d,d,e.status);var i=e.createStreamResponse.streamId,n=e.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,r=it(tt(e.createStreamResponse.rtcConfiguration)),s=S.bind(B,d,r),o=n.match(/a=x-playlist:/)||n.match(/a=x-rtmp:/);if(o&&(s=J),c.setStreamId(i),c.setStartOffset(e.createStreamResponse.offset),c.recordMetric("Provisioned"),c.recordMetric("RoundTripTime",{uint64:2*d.Nn},null,{resource:d.getBaseUri(),kind:"https"}),h.originStartTime=S.now()-e.createStreamResponse.offset+d.Nn,!o&&("Chrome"===C.browser&&62<=C.browserVersion&&I.isMobile()||"Opera"===C.browser)&&0<d.Tn.length){var a=S.get(y.getH264ProfileIds(n),[0]),u=y.getH264ProfileIdWithSameOrHigherProfileAndEqualToOrHigherLevel(d.Tn,a);u?a!==u&&(d.Pt.info("[%s] Replacing subscriber h264 profile level id [%s] with new value [%s] in offer sdp",i,a,u),n=y.replaceH264ProfileId(n,a,u)):d.Pt.warn("[%s] Unable to find new subscriber h264 profile level id to replace [%s]. Rejected environment defaults of [%s]",i,a,d.Tn)}return s.call(d,i,n,c,function(t,e){c.recordMetric("SetupCompleted",{string:e?"failed":"ok"}),e?f.call(d,d,"failed",null):f.call(d,d,"ok",t)},h)})})},w.prototype.getProtocol=function(){return this.Dn},w.prototype.getLogger=function(){return this.Pt},w.prototype.toString=function(){var t=this.getProtocol();return"PCast["+(t?t.getSessionId():"")||!1};var nt=function(i){if(S.isUndefined(i.onaddstream)){var e=[],t=[];S.addEventListener(i,"track",function(t){S.forEach(t.streams,function(t){S.includes(e,t)||e.push(t)})}),i.getRemoteStreams=function(){return e},i.getLocalStreams=function(){return t},i.addStream=function(e){S.includes(t,e)||t.push(e),S.forEach(e.getTracks(),function(t){i.addTrack(t,e)})}}};return w}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(66)],void 0===(r=function(t){"use strict";return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5),i(2),i(30),i(71)],void 0===(r=function(c,o,s,n,a,u){"use strict";var h="continuation",f=18e3;function t(t,e,i,n,r){o.xt(t,"logger"),o.Ct(e,"sendCallback"),o.Ct(i,"receiveCallback"),this.Pt=t,this.Kn=new a(n,r),this.Jn=0,this.Xn=new s.NamedEvents,this.Qn={},this.$n={},this.Yn={},this.Zn={},this.tr={},this.er={},this.ir=i,this.nr=e,i(c.bind(d,this))}function d(t){if(this.rr)return this.Pt.warn("Proto already disposed of. Unable process message");var e,i,n;try{e=this.Kn.decode("mq.Message",u.toByteArray(t.data)),n=this.Qn[e.requestId],this.Pt.info(">> [%s] [%s]",e.messageType,e.type),i=this.Kn.decode(e.type,e.payload)}catch(t){if(this.Pt.error(t),n)return n(t);throw t}switch(function(t,e,i){var n=c.now(),r=this.tr[t.requestId];if(c.re(r)){var s=n-r;t.wallTime=[s].concat(t.wallTime)}this.Xn.fireAsync("received",[{key:t.requestId,messageType:t.messageType,type:t.type,wallTime:t.wallTime,received:n,bytes:i,payload:e}]),delete this.tr[t.requestId]}.call(this,e,i,t.data.length),e.messageType){case"Response":if(i.status!==h&&delete this.Qn[e.requestId],clearTimeout(this.Zn[e.requestId]),delete this.Zn[e.requestId],!n)return;return"mq.Error"!==e.type?n(null,i):n(i,null);case"Request":var r=c.bind(this.sendResponse,this,e.requestId,e.type+"Response"),s=this.Yn[e.type];this.$n[e.requestId]=c.now(),s?s(i,r):this.Pt.info("Received request without a subscribed listener");break;case"Event":return function(t,e){this.Xn.fire(t,e,this)}.call(this,e.type,[i]);default:return this.Pt.warn(">> Unsupported message type [%s]",e.messageType)}}function l(t,e,i,n,r,s,o){return o&&o.status===h?(!this.er[t]&&this.Qn[t]&&(this.er[t]=function(t,e){return setTimeout(c.bind(v,this,t,3e5,e),3e5)}.call(this,t,r)),function(t,e,i,n,r,s){if(!n||!n.continuationId&&!n.routeKey)return this.Pt.warn("Received request for continuation without a continuationId or routeKey"),s();var o=c.assign({},i,{continuationId:n.continuationId,routeKey:n.routeKey}),a={requestId:t,type:e,payload:this.Kn.encode(e,o),messageType:"Request"},u=this;return setTimeout(function(){if(u.Qn[t])return m.call(u,t,a,o,r,s)},2e3)}.call(this,t,e,i,o,n,r)):(clearTimeout(this.er[t]),delete this.er[t],r(s,o))}function m(t,e,i,n,r){this.Zn[t]&&clearTimeout(this.Zn[t]);var s=n||f;return this.Zn[t]=setTimeout(c.bind(v,this,t,s,r),s),p.call(this,e,i)}function p(t,e){var i=u.toString(this.Kn.encode("mq.Message",t));return function(t,e,i){var n=c.now();this.tr[t.requestId]=n,this.Xn.fireAsync("sent",[{key:t.requestId,messageType:t.messageType,type:t.type,received:n,bytes:i,payload:e}])}.call(this,t,e,i.length),this.nr(i)}function v(t,e,i){if(this.Qn[t])return function(t,e){this.Xn.fireAsync("timeout",[{key:t,timeout:e}]),delete this.tr[t]}.call(this,t,e),this.Pt.warn("Request [%s] has not completed in [%s] ms. Dropping request.",t,e),delete this.Qn[t],i(null,{status:"timeout"})}return t.prototype.onEvent=function(t,e){return this.rr?this.Pt.warn("Proto already disposed of. Unable to listen for event"):(o.Nt(t,"eventName"),o.Ct(e,"handler"),this.Xn.listen(t,e))},t.prototype.onRequest=function(t,e){if(this.rr)return this.Pt.warn("Proto already disposed of. Unable to listen for request");o.Nt(t,"requestName"),o.Ct(e,"handler"),this.Yn[t]&&this.Pt.warn("May not set multiple handlers for the same request. Overriding existing handlers for request [%s]",t),this.Yn[t]=e;var i=this;return new n.Disposable(function(){i.Yn[t]=null})},t.prototype.sendRequest=function(t,e,i,n){if(this.rr)return this.Pt.warn("Proto already disposed of. Unable to send request"),i(null,{status:"proto-disposed"});n=n||{},o.Nt(t,"type"),o.xt(e,"message"),o.xt(n,"settings"),i&&o.Ct(i,"callback"),n.timeout&&o.re(n.timeout,"settings.timeout");var r="C"+(this.Jn++).toString(),s={requestId:r,type:t,payload:this.Kn.encode(t,e),messageType:"Request"};return this.Qn[r]=c.bind(l,this,r,t,e,n.timeout,i),m.call(this,r,s,e,n.timeout,i)},t.prototype.sendResponse=function(t,e,i,n){if(this.rr)return this.Pt.warn("Proto already disposed of. Unable to send response"),n(null,{status:"proto-disposed"});o.Nt(t,"requestId"),o.Nt(e,"type"),o.xt(i,"message");var r=this.$n[t];r||(this.Pt.error("Already responded to request [%s]",t),n(new Error("no-response-handler")));var s={requestId:t,type:e,payload:this.Kn.encode(e,i),messageType:"Response",wallTime:[c.now()-r]};return p.call(this,s,i),delete this.$n[t],n(null,{status:"ok"})},t.prototype.disposeOfRequests=function(){c.forOwn(this.Zn,function(t){clearTimeout(t)}),c.forOwn(this.er,function(t){clearTimeout(t)}),this.Qn={},this.$n={},this.Yn={},this.Zn={},this.tr={},this.er={}},t.prototype.dispose=function(){this.rr=!0,this.ir=null,this.nr=null,this.disposeOfRequests(),this.Xn.dispose()},t.prototype.getApiVersion=function(){return this.Kn.getApiVersion()},t.prototype.toString=function(){return"Proto["+this.sr.toString()+"]"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(67),i(69),i(70)],void 0===(r=function(a,u,n,r){"use strict";function t(t,e){var i=this;this.or={},this.or[r.package]=new n(r),a.forEach(t,function(t){i.or[t.package]=new n(t)}),this.ar=e||3}return t.prototype.getApiVersion=function(){return this.ar},t.prototype.encode=function(t,e){if("string"!=typeof t)throw new Error("'type' must be a string");if("object"!=typeof e)throw new Error("'data' must be an object");var i=t.split("."),n=a.get(i,[0]),r=a.get(i,[1]),s=a.get(this.or,[n]),o=new u;return s.write(r,e,o),o.finish()},t.prototype.decode=function(t,e){if("string"!=typeof t)throw new Error("'type' must be a string");var i=t.split("."),n=a.get(i,[0]),r=a.get(i,[1]),s=a.get(this.or,[n]),o=new u(e);return s.read(r,o)},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{package:"telemetry",messages:[{name:"LogData",fields:[{rule:"required",type:"LogLevel",name:"level",id:1},{rule:"required",type:"string",name:"timestamp",id:2},{rule:"required",type:"string",name:"category",id:3},{rule:"required",type:"string",name:"message",id:4},{rule:"optional",type:"string",name:"source",id:5},{rule:"optional",type:"string",name:"fullQualifiedName",id:11},{rule:"optional",type:"string",name:"sessionId",id:6},{rule:"optional",type:"string",name:"userId",id:7},{rule:"optional",type:"string",name:"environment",id:8},{rule:"optional",type:"string",name:"version",id:9},{rule:"optional",type:"float",name:"runtime",id:10}]},{name:"StoreLogRecords",fields:[{rule:"repeated",type:"LogData",name:"records",id:1}]},{name:"StoreLogRecordsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"required",type:"uint64",name:"storedRecords",id:2}]},{name:"MetricValue",fields:[{rule:"optional",type:"string",name:"string",id:1},{rule:"optional",type:"float",name:"float",id:2},{rule:"optional",type:"uint64",name:"uint64",id:3},{rule:"optional",type:"int64",name:"int64",id:4},{rule:"optional",type:"bool",name:"boolean",id:5},{rule:"optional",type:"string",name:"timestamp",id:6}]},{name:"MetricData",fields:[{rule:"required",type:"string",name:"timestamp",id:1},{rule:"optional",type:"string",name:"sessionId",id:2},{rule:"optional",type:"string",name:"streamId",id:3},{rule:"optional",type:"string",name:"source",id:4},{rule:"optional",type:"string",name:"resource",id:5},{rule:"optional",type:"string",name:"kind",id:6},{rule:"required",type:"Metric",name:"metric",id:7},{rule:"optional",type:"MetricValue",name:"value",id:8},{rule:"optional",type:"MetricValue",name:"previousValue",id:9},{rule:"optional",type:"uint64",name:"elapsed",id:10},{rule:"optional",type:"string",name:"fullQualifiedName",id:11},{rule:"optional",type:"string",name:"environment",id:12},{rule:"optional",type:"string",name:"version",id:13},{rule:"optional",type:"string",name:"tool",id:14},{rule:"optional",type:"string",name:"toolVersion",id:15},{rule:"required",type:"float",name:"runtime",id:16}]},{name:"SubmitMetricRecords",fields:[{rule:"repeated",type:"MetricData",name:"records",id:1}]},{name:"SubmitMetricRecordsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"required",type:"uint64",name:"storedRecords",id:2}]}],enums:[{name:"LogLevel",values:[{name:"Trace",id:0},{name:"Debug",id:1},{name:"Info",id:2},{name:"Warn",id:3},{name:"Error",id:4},{name:"Fatal",id:5}]},{name:"Metric",values:[{name:"RoundTripTime",id:0},{name:"DownlinkThroughputCapacity",id:26},{name:"Initialized",id:1},{name:"Provisioned",id:2},{name:"SetupCompleted",id:3},{name:"Offset",id:4},{name:"TimeToFirstFrame",id:5},{name:"Playing",id:6},{name:"Stalled",id:7},{name:"Buffering",id:8},{name:"Seeking",id:22},{name:"Stopped",id:9},{name:"BitRateAdaptation",id:10},{name:"ResolutionChanged",id:11},{name:"DisplayResolutionChanged",id:23},{name:"VideoBitRate",id:28},{name:"AudioBitRate",id:29},{name:"FrameRateChanged",id:12},{name:"FramesDropped",id:13},{name:"PacketsLost",id:14},{name:"PictureLost",id:15},{name:"PlayoutDelayChanged",id:16},{name:"CodecChanged",id:17},{name:"PlayerEvent",id:21},{name:"MetricDropped",id:18},{name:"NetworkOffline",id:19},{name:"NetworkOnline",id:20},{name:"NetworkType",id:27},{name:"ApplicationForeground",id:24},{name:"ApplicationBackground",id:25}]}]}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(3)],void 0===(r=function(t){"use strict";function e(){this.init()}return e.prototype.init=function(){if(!t.global.AudioContext&&!t.global.webkitAudioContext)throw new Error("Browser does not support AudioContext");this.ur=new(t.global.AudioContext||t.global.webkitAudioContext)},e.prototype.getNativeAudioContext=function(){return this.ur},e.prototype.toString=function(){return"AudioContext"},e}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5),i(3),i(34),i(22)],void 0===(r=function(S,r,s,E,T,a){"use strict";function t(t,e,i){r.Yt(t,"name"),r.xt(e,"peerConnection"),r.xt(i,"logger"),this.jt=t,this.cr=e,this.Pt=i,this.Gn={}}function I(t){var e=function(t){var e=t.getSenders?S.map(t.getSenders(),function(t){return t.track}):[];if(0!==(e=S.filter(e,function(t){return!S.isNullOrUndefined(t)})).length)return e;var i=t.getLocalStreams?t.getLocalStreams():[];return S.reduce(i,function(t,e){return t.concat(e.getTracks())},[])}(t),i=function(t){var e=t.getReceivers?S.map(t.getReceivers(),function(t){return t.track}):[];if(0!==(e=S.filter(e,function(t){return!S.isNullOrUndefined(t)})).length)return e;var i=t.getRemoteStreams?t.getRemoteStreams():[];return S.reduce(i,function(t,e){return t.concat(e.getTracks())},[])}(t);if(0===e.length||0===i.length)return 0!==e.length?e:0!==i.length?i:[];var n=[];return S.forEach(e,function(t){n.push(t)}),S.forEach(i,function(t){n.push(t)}),n}function R(e){var t=I.call(this,this.cr),i=S.filter(t,function(t){return t.kind===e}),n=S.filter(this.hr,function(t){return t.kind===e});return S.reduce(i,function(t,e){if(!t)return t;var i=!!S.find(n,function(t){return t.id===e.id});return!e.enabled||i},!0)}return t.prototype.start=function(t,e,i){if(r.xt(t,"options"),r.Ct(e,"activeCallback"),r.Ct(i,"monitorCallback"),"inbound"!==t.direction&&"outbound"!==t.direction)throw new Error("Invalid monitoring direction");if(!t.hasOwnProperty("monitoringInterval")||0<t.monitoringInterval){if(this.fr=t.frameRateThreshold||2,this.dr=t.videoBitRateThreshold||1e3,this.lr=t.audioBitRateThreshold||5e3,this.mr=t.conditionCountForNotificationThreshold||3,this.pr=Math.max(500,t.monitoringInterval||4e3),this.vr=Math.max(500,t.conditionMonitoringInterval||1500),this.gr=!t.hasOwnProperty("monitorFrameRate")||t.monitorFrameRate,this.yr=!t.hasOwnProperty("monitorBitRate")||t.monitorBitRate,this.wr=!t.hasOwnProperty("monitorState")||t.monitorState,this.hr=[],this.br=new s.Event,"Edge"===E.browser){var n=this.vr*this.mr;this.pr=Math.max(this.pr,6e3),this.vr=Math.max(this.vr,6e3),this.mr=Math.max(Math.ceil(n/this.pr),2),this.Pt.info("Using modified options for optimal monitoring of PeerConnection on [Edge]. Monitor Interval [%s], Condition Monitor Interval [%s], Condition Count For Notification [%s]",this.pr,this.vr,this.mr)}return function(d,l,m,p,v){var g=this,y=0,w=void 0,b=void 0,k=void 0;setTimeout(function f(){(function(t,i,e,n,r,s){if(!n())return this.Pt.info("[%s] Finished monitoring of peer connection",this.jt);var o=this;E.getStats(t,null,function(t){var e=a.convertPeerConnectionStats(t,o.Gn);e=S.filter(e,function(t){return"inbound"===i.direction&&"download"===t.direction||"outbound"===i.direction&&"upload"===t.direction}),r(e)},function(t){s(t)})}).call(g,l,m,null,p,function(t){var e=!1,i=!1,n=!1;if(!p())return g.Pt.info("[%s] Finished monitoring of peer connection",d);if(!t)throw new Error("Report must be a valid PeerConnection.getStats Report");if(S.forEach(t,function(t){if("outbound"===m.direction&&"upload"===t.direction)switch(t.mediaType){case"video":g.Pt.debug("[%s] [%s] [%s] [%s] with RTT [%s], bitrate [%s], dropped frames [%s], frame rate [%s] and average encoding time [%s] ms (CPU limited=[%s])",d,m.direction,t.mediaType,t.ssrc,t.rtt,t.bitrateMean,t.droppedFrames,t.framerateMean,t.avgEncode,t.cpuLimitedResolution),w=t.framerateMean,b=t.uploadRate?1e3*t.uploadRate:t.uploadRate,i=e=!0,"Edge"===E.browser&&(e=!1);break;case"audio":g.Pt.debug("[%s] [%s] [%s] [%s] with RTT [%s], jitter [%s] and audio input level [%s]",d,m.direction,t.mediaType,t.ssrc,t.rtt,t.jitter,t.audioInputLevel),n=!0,k=t.uploadRate?1e3*t.uploadRate:t.uploadRate}if("inbound"===m.direction&&"download"===t.direction)switch(t.mediaType){case"video":g.Pt.debug("[%s] [%s] [%s] [%s] with framerate [%s], current delay [%s] ms and target delay [%s] ms",d,m.direction,t.mediaType,t.ssrc,t.framerateMean,t.currentDelay,t.targetDelay),e=!0,w=t.framerateMean||0,i=!0,b=t.downloadRate?1e3*t.downloadRate:t.downloadRate,"Edge"===E.browser&&(e=!1);break;case"audio":g.Pt.debug("[%s] [%s] [%s] [%s] with jitter [%s], jitter buffer [%s] ms, audio output level [%s], total audio energy [%s] and total samples duration [%s]",d,m.direction,t.mediaType,t.ssrc,t.jitter,t.jitterBuffer,t.audioOutputLevel,t.totalAudioEnergy,t.totalSamplesDuration),n=!0,k=t.downloadRate?1e3*t.downloadRate:t.downloadRate}}),S.isUndefined(k)&&S.isUndefined(b))return setTimeout(f,g.pr);var r=T.hasActiveAudio(l),s=T.hasActiveVideo(l);(i&&0===b||n&&0===k||e&&0===w)&&(i=i&&s,n=n&&r,e=e&&s),(n||i||e)&&(g.Pt.debug("[%s] [%s] Current bit rate is [%s] bps for audio and [%s] bps for video with [%s] FPS",d,m.direction,Math.ceil(k||0),Math.ceil(b||0),w||"?"),0<S.values(g.Gn).length&&g.br.fire([{videoBitRate:b,audioBitRate:k,frameRate:w}]));var o=[];if(g.wr&&("closed"===l.connectionState||"disconnected"===l.connectionState||"failed"===l.connectionState||"disconnected"===l.iceConnectionState||"failed"===l.iceConnectionState)){var a=r&&s,u=I.call(g,l);if(!a&&T.hasMediaSectionsInLocalSdp(l))return void g.Pt.info("[%s] [%s] Finished monitoring of peer connection with [%s] inactive tracks",d,m.direction,u.length);o.push("connection")}function c(){g.Pt.info("[%s] [%s] Failure has been acknowledged",d,m.direction),y=Number.MIN_VALUE,setTimeout(f,g.pr)}if(g.gr&&e&&w<=g.fr&&!R.call(g,"video")&&o.push("frameRate"),g.yr&&n&&k<=g.lr&&!R.call(g,"audio")&&o.push("audioBitRate"),g.yr&&i&&b<=g.dr&&!R.call(g,"video")&&o.push("videoBitRate"),0===b&&s&&!R.call(g,"video")&&o.push("noVideoData"),0===k&&r&&!R.call(g,"audio")&&o.push("noAudioData"),0<o.length?y++:y=0,y>=g.mr){var h="["+d+"] ["+m.direction+"] Failure detected with frame rate ["+w+"] FPS, audio bit rate ["+k+"] bps, video bit rate ["+b+"] bps, connection state ["+l.connectionState+"], and ice connection state ["+l.iceConnectionState+"] after ["+y+"] checks";v(null,{type:"condition",reasons:o,message:h,report:t,frameRate:w,videoBitRate:b,audioBitRate:k,acknowledgeFailure:c})?c():g.Pt.info(h+": [%s]",t)}else setTimeout(f,0<y?g.vr:g.pr)},function(t){v(t,{type:"error",message:"Unable to get Connection statistics. Connection may have failed."})})},g.pr)}.call(this,this.jt,this.cr,t,e,i)}this.Pt.info("[%s] Monitoring is disabled",name)},t.prototype.setMonitorTrackState=function(e,t){r.xt(e,"track"),r.hn(t,"state");try{var i=I.call(this,this.cr);if(!S.find(i,function(t){return t.id===e.id}))return this.Pt.warn("[%s] Unable to find track [%s] [%s] in peer connection",this.jt,e.kind,e.id)}catch(t){"Firefox"===E.browser&&"InvalidStateError: Peer connection is closed"===t.message?this.Pt.debug("Failed to verify monitor track due to closed peer connection"):this.Pt.warn("Failed to verify monitor track due to [%s]",t.message)}if(!t)return this.Pt.info("[%s] Pausing monitoring of track [%s] [%s]",this.jt,e.kind,e.id),this.hr.push(e);var n=this.hr.length;this.hr=S.filter(this.hr,function(t){return t.id!==e.id}),n!==this.hr.length&&this.Pt.info("[%s] Starting monitoring of track [%s] [%s] after it was paused",this.jt,e.kind,e.id)},t.prototype.on=function(t,e){switch(r.Nt(t,"eventName"),r.Ct(e,"listener"),t){case"calculatedmetrics":return this.br.listen(e);default:throw new Error("Unsupported event "+t)}},t.prototype.toString=function(){return"PeerConnectionMonitor["+this.jt+"]"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(s,o){"use strict";var a=/profile-level-id=[^;\n]*/,i=/vp8/i,n=/vp9/i,r=/h264/i,u=/h265/i;function t(){}return t.prototype.getH264ProfileIds=function(t){o.Nt(t,"offerSdp");for(var e=[],i=t.match(a),n=t;i;){var r=s.get(i,"0","");e.push(r.split("=")[1]),i=(n=n.substring(i.index+r.length,t.length)).match(a)}return e},t.prototype.replaceH264ProfileId=function(t,e,i){o.Nt(t,"offerSdp"),o.Nt(i,"newProfileId");var n=this.getH264ProfileIds(t);return s.includes(n,e)?t.replace("profile-level-id="+e,"profile-level-id="+i):t},t.prototype.getH264ProfileIdWithSameProfileAndEqualToOrHigherLevel=function(t,e){if(s.includes(t,e))return e;var i=s.reduce(t,function(t,e){var i=parseInt(t.substring(0,2),16),n=parseInt(t.substring(4,6),16),r=parseInt(e.substring(0,2),16),s=parseInt(e.substring(4,6),16);return i!==r?t:s<=n?t:e},e);return i===e?null:i},t.prototype.getH264ProfileIdWithSameOrHigherProfileAndEqualToOrHigherLevel=function(t,e){var i=this.getH264ProfileIdWithSameProfileAndEqualToOrHigherLevel(t,e);if(i)return i;var n=s.reduce(t,function(t,e){var i=parseInt(t.substring(0,2),16),n=parseInt(t.substring(4,6),16),r=parseInt(e.substring(0,2),16),s=parseInt(e.substring(4,6),16);return i<r?e:r<i?t:s<n?t:e},e);return n===e?null:n},t.prototype.getSupportedCodecs=function(t){o.Nt(t,"offerSdp");var e=[];return i.test(t)&&e.push("VP8"),n.test(t)&&e.push("VP9"),r.test(t)&&e.push("H264"),u.test(t)&&e.push("H265"),e},t.prototype.hasMediaSectionsInLocalSdp=function(t){return this.findInSdpSections(t,function(t){return s.startsWith(t,"video")||s.startsWith(t,"audio")})<0},t.prototype.hasActiveAudio=function(t){return this.findInSdpSections(t,function(t,e,i){return!!s.startsWith(t,"audio")&&!s.includes(t,"a=inactive")&&!s.includes(i[e],"a=inactive")})<0},t.prototype.hasActiveVideo=function(t){return this.findInSdpSections(t,function(t,e,i){return!!s.startsWith(t,"video")&&!s.includes(t,"a=inactive")&&!s.includes(i[e],"a=inactive")})<0},t.prototype.findInSdpSections=function(t,i){var e=this.getLocalSdp(t).split("m="),n=this.getRemoteSdp(t).split("m=");return e.length===n.length&&s.findIndex(e,function(t,e){return i(t,e,n)})},t.prototype.getNumberOfActiveSections=function(t){var e=(this.getLocalSdp(t)||this.getRemoteSdp(t)).split("m=");return s.filter(e,function(t){return!s.includes(t,"a=inactive")&&(s.startsWith(t,"audio")||s.startsWith(t,"video"))}).length},t.prototype.getLocalSdp=function(t){return s.get(t,["localDescription","sdp"],"")},t.prototype.getRemoteSdp=function(t){return s.get(t,["remoteDescription","sdp"],"")},t.prototype.setGroupLineOrderToMatchMediaSectionOrder=function(i){var t=i.match(/(?=a=group:BUNDLE).*/),e=s.get(s.get(t,[0],"").split("a=group:BUNDLE "),[1],""),n=e.split(" ").sort(function(t,e){return i.indexOf("m="+t)-i.indexOf("m="+e)});return 0<n.length&&(i=i.replace(e,n.join(" "))),i},new t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5),i(3),i(12),i(93),i(94),i(95),i(7)],void 0===(r=function(n,i,a,t,e,r,s,o,u){"use strict";function c(t,e,i,n,r,s,o){this.Wt=t,this.$i=e,this.Xi=i,this.kr=n,this.f=r,this.mn=s,this.Pt=o,this.Sr=[],this.Er=null,this.Xn=new a.NamedEvents}return c.prototype.on=function(t,e){this.Xn.listen(t,e)},c.prototype.createRenderer=function(){var e=null;switch(this.Wt){case u.types.dash.name:e=this.mn?new r(this.$i,this.Xi,this.kr,this.f,this.mn,this.Pt):new s(this.$i,this.Xi,this.kr,this.f,this.Pt);break;case u.types.hls.name:e=new s(this.$i,this.Xi,this.kr,this.f,this.Pt);break;case u.types.rtmp.name:e=new o(this.$i,this.Xi,this.kr,this.f,this.Pt);break;default:throw new Error("Unsupported Live stream Type "+this.Wt)}var i=this;return e.on(u.rendererEvents.error.name,function(t,e){i.Xn.fire(u.streamEvents.playerError.name,[t,e])}),e.on(u.rendererEvents.ended.name,function(t){i.Sr=n.filter(i.Sr,function(t){return t!==e}),0===i.Sr.length&&(i.kr.stop(),i.Xn.fire(u.streamEvents.playerEnded.name,[t]))}),this.Sr.push(e),e},c.prototype.select=function(t){return this.Pt.warn("[%s] selection of tracks not supported for [%s] live streams",this.$i,this.Wt),this},c.prototype.setStreamEndedCallback=function(t){i.Ct(t,"callback"),this.streamEndedCallback=t},c.prototype.setStreamErrorCallback=function(t){i.Ct(t,"callback"),this.streamErrorCallback=t},c.prototype.stop=function(t){this.isActive()&&(this.Pt.info("[%s] stop [live] media stream with reason [%s]",this.$i,t),this.Xn.fire(u.streamEvents.stopped.name,[t]),this.Tr=!0)},c.prototype.monitor=function(t,e){i.xt(t,"options"),i.Ct(e,"callback")},c.prototype.getMonitor=function(){return null},c.prototype.addBitRateThreshold=function(t,e){i.Ct(e,"callback")},c.prototype.getStream=function(){return this.Pt.debug("[%s] [%s] This type of stream has no internal stream object",this.$i,this.Wt),null},c.prototype.isActive=function(){return!this.Tr},c.prototype.getStreamId=function(){return this.$i},c.prototype.getStats=function(){return this.Pt.debug("[%s] [%s] This type of stream has no stats",this.$i,this.Wt),null},c.prototype.getRenderer=function(){return n.get(this.Sr,[0],null)},c.canPlaybackType=function(t){switch(t){case u.types.dash.name:return e.WebPlayer.deviceSupportsDashPlayback;case u.types.hls.name:return e.WebPlayer.deviceSupportsHlsPlayback;case u.types.rtmp.name:return o.isSupported();default:return!1}},c}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(m,n){"use strict";function t(t,e,i){n.Nt(t,"name"),n.xt(e,"monitor"),n.Ct(i,"getLimit"),this.jt=t,this.Ir=e,this.Rr=i||m.noop}return t.prototype.addThreshold=function(t,h){var f=function(t){var e=[];if(m.isArray(t))m.forEach(t,function(t){n.re(t,"threshold")}),e=t.sort();else if(m.xt(t)){n.re(t.levels,"threshold.levels");for(var i=0;i<t.levels;i++)e.push(i/t.levels)}else n.re(t,"threshold"),e.push(t);return e.push(3),e}(t),d=null,l=this;return l.Ir.on("calculatedmetrics",function(t){var n,r,e=l.Rr(),i=t.videoBitRate+t.audioBitRate,s=(n=f,r=i/e,m.reduce(n,function(t,e,i){return null===t&&r<=e?i:e<n[t]&&r<=e?i:t},null)),o=m.get(f,[s]),a=o*e,u=m.get(f,[d],1),c=u*e;if(0!==e)return null===d?d=s:void(s!==d&&(s<d?h({isIncreasing:!1,bitRate:i,currentThreshold:a,targetBitRate:e,index:s,lastIndex:d,message:l.jt+" bit rate is below "+o+" * "+e+" threshold of "+a+" with a bit rate of "+i}):d<s&&h({isIncreasing:!0,bitRate:i,currentThreshold:c,targetBitRate:e,index:s,lastIndex:d,message:l.jt+" bit rate is above "+u+" * "+e+" threshold of "+c+" with a bit rate of "+i}),d=s))})},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(2),i(38),i(39),i(98),i(40),i(99),i(15),i(14)],void 0===(r=function(m,a,u,c,e,s,n,h,t,i,f){"use strict";var d=m.freeze({status:"not-in-room"}),p=m.freeze({status:"already-in-room"}),v=m.freeze({status:"in-another-room"});function r(t){this.Mr=new u.Observable(null),this.Cr=new u.Observable(null),this.xr=new u.Observable(null),this.Pr=null,this.Dr=new e(t),this.setPCast(t)}function o(){this.Mr.setValue(null),this.Cr.setValue(null),this.xr.setValue(null),this.Pr=null,this.g&&this.g.dispose(),this.g=null}function l(t){a.xt(t,"event"),a.Yt(t.roomId,"event.roomId"),a.Yt(t.eventType,"event.eventType"),a.isArray(t.members,"event.members"),m.forEach(t.members,function(t){a.xt(t,"member")});var e=this;switch(t.eventType){case i.events.memberJoined.name:return e.Pt.debug("[%s] Member joined [%s]",t.roomId,t.members),function(t,e){var i=this.Cr.getValue(),n=this.xr.getValue();if(i&&i.getRoomId()===t){i.Or(e),i.Ar(e),n.Or(e),n.Ar(e);var r=this,s=m.find(e,function(t){return t.sessionId===r.getSelf().getSessionId()}),o=!1;s&&(o=M.call(r,i),i.qr([s])),this.Pt.info("[%s] Room has now [%d] members (Self is present in room [%s])",t,i.getObservableMembers().getValue().length,o)}}.call(e,t.roomId,t.members);case i.events.memberLeft.name:return e.Pt.debug("[%s] Member left [%s]",t.roomId,t.members),function(t,e){var i=this.Cr.getValue(),n=this.xr.getValue();if(i&&i.getRoomId()===t){var r=this,s=m.find(e,function(t){return t.sessionId===r.getSelf().getSessionId()}),o=this.getSelf();o&&s&&o.getObservableLastUpdate().setValue(s.lastUpdate),i.Or(e),n.Or(e),this.Pt.info("[%s] Room has now [%d] members",t,i.getObservableMembers().getValue().length)}}.call(e,t.roomId,t.members);case i.events.memberUpdated.name:return e.Pt.debug("[%s] Member updated [%s]",t.roomId,t.members),function(t,e){var i=this.Cr.getValue(),n=this.xr.getValue();if(i&&i.getRoomId()===t){var r=function(t){var n=this;return m.map(t,function(t){var e=w(t.sessionId,n.xr),i=S(new h(n,t.state,t.sessionId,t.screenName,t.role,t.streams,t.lastUpdate),e);return i.lastUpdate=t.lastUpdate,i})}.call(this,e);i.qr(r),n.qr(r),this.Pt.info("[%s] Room has [%d] updated members",t,e.length)}}.call(e,t.roomId,t.members);case i.events.roomUpdated.name:return e.Pt.debug("[%s] Room updated [%s]",t.roomId,t.room),function(t,e){var i=this.Cr.getValue(),n=this.xr.getValue();i&&i.getRoomId()===t&&(n.an(e),i.an(e))}.call(e,t.roomId,t.room);case i.events.roomEnded.name:e.Pt.info("[%s] Room ended",t.roomId);break;default:e.Pt.warn("Unsupported room event [%s]",t.eventType)}}function g(t){this.getSelf()&&this.getSelf().getSessionId()===(t||"")?this.Pt.info("[%s] Skip session ID change since it is the same as in self model",t):function(t){var e=this.Mr.getValue().toJson();this.Pt.info("Resetting self after sessionId changed to [%s]",t),this.Mr.setValue(new h(this,e.state,t||"",e.screenName,e.role,e.streams,e.lastUpdate))}.call(this,t)}function y(t){var i=this;if(t&&t.getSessionId()){var n=i.Cr.getValue();n&&(i.Pt.info("[%s] Updating self in room after update",n.getRoomId()),T.call(this,this.getSelf(),function(t,e){"ok"===m.get(e,["status"])?i.Pt.info("[%s] Updated self in room after update",n.getRoomId()):i.Pt.info("[%s] Self was not updated in room after update",n.getRoomId())}))}}function w(t,e){return i=t,n=e.getValue().getObservableMembers().getValue(),m.find(n,function(t){return i===t.getSessionId()});var i,n}function b(t){this.Pt.info("PCast status changed from [%s] to [%s]",this.Fr,t),"online"===(this.Fr=t)&&function(){var t=this,e=t.Cr.getValue();if(m.xt(e)){var i=t.Mr.getValue();if(i&&i.getSessionId()){var n=e.getRoomId(),r=e.getObservableAlias().getValue();t.Pt.info("[%s] Re-entering room [%s]",n,r),t.Pr&&(t.Pt.info("Performing soft reset on room chat service for room [%s]",n),t.Pr.stop()),E.call(t,n,r,function(){t.Pr&&(t.Pt.info("[%s] Refreshing room chat service after re-entering room [%s]",n,r),t.Pr.start(t.Pr.getBatchSize())),t.Pt.info("[%s] Room [%s] completed reset",n,r)},{reenter:!0})}}}.call(this)}function k(){var t=this.Dn.onEvent("chat.RoomEvent",m.bind(l,this)),e=this.Mr.subscribe(m.bind(y,this)),i=this.Dr.getObservableStatus().subscribe(m.bind(b,this)),n=this.Dr.getObservableSessionId().subscribe(m.bind(g,this));this.g.add(t),this.g.add(e),this.g.add(i),this.g.add(n)}function S(t,e){var i=function(t,e){if(!e)return t.toJson();var i={},n=t.toJson(),r=e.toJson(),s=m.findDifferences(n,r,!0);return m.forEach(s,function(t){i[t]=n[t]}),i}(t,e);return i.sessionId=t.getSessionId(),i.lastUpdate=e?e.getLastUpdate():m.now(),i}function E(n,r,s,t){var e=!0===m.get(t,"reenter"),i=this.Cr.getValue();if(i){var o=n===i.getRoomId()||r===i.getObservableAlias().getValue();if(o&&!e)return this.Pt.info("Unable to join room. Already in [%s]/[%s] room.",i.getRoomId(),i.getObservableAlias().getValue()),s(null,m.assign({room:i},o?p:v))}this.Dr.assertAuthorized();var a=this.Mr.getValue(),u=a.getObservableScreenName().getValue(),c=a.getObservableRole().getValue(),h=S.call(this,a,null),f=[],d=m.now();e&&f.push("reenter"),this.Pt.info("Enter room [%s]/[%s] with screen name [%s] and role [%s]",n,r,u,c);var l=this;l.Ur?l.Pt.info("[%s] We are already entering the room [%s], skipping",n,r):(l.Ur=!0,this.Dn.enterRoom(n,r,h,f,d,function(t,e){if(l.Ur=!1,t)return l.Pt.error("Joining of room failed with error [%s]",t),s(t,null);var i={status:e.status};if("ok"!==e.status)return l.Pt.warn("Joining of room failed with status [%s]",e.status),s(null,i);i.room=function(t){var e=this.Cr.getValue(),i=this.xr.getValue(),n=R.call(this,t);if(M.call(this,n),e&&i)return this.Pt.debug("[%s] Updating existing room model.",e.getRoomId()),e.an(t.room),i.an(t.room),e.getObservableMembers().setValue(n.getObservableMembers().getValue()),i.getObservableMembers().setValue(n.getObservableMembers().getValue()),e;var r=R.call(this,t);return this.Cr.setValue(n),this.xr.setValue(r),n}.call(l,e),"ok"===e.status&&e.self&&l.getSelf().an(e.self),l.Pt.info("Successfully entered room [%s]/[%s]",n,r),s(null,i)}))}function T(t,n){if(!this.Cr.getValue())return this.Pt.warn("Not in a room. Please Enter a room before updating member."),n(null,d);this.Dr.assertAuthorized();var e=this.Cr.getValue().getRoomId(),i=t.getSessionId()===this.getSelf().getSessionId(),r=w(t.getSessionId(),this.xr),s=S.call(this,t,r),o=m.now(),a=i&&!r,u=i&&s.role===f.roles.audience.name;a&&(s.lastUpdate=t.getObservableLastUpdate().getValue()),this.Pt.info("Updating member info [%s] for active room [%s]",s,e);var c=this;this.Dn.updateMember(e,s,o,function(t,e){if(t)return c.Pt.error("Update of member failed with error [%s]",t),n(t,null);var i={status:e.status,lastUpdate:e.lastUpdate};"ok"!==e.status&&c.Pt.info("Update of member failed with status [%s]",e.status),"ok"===e.status&&u&&m.re(e.lastUpdate)&&c.getSelf().getObservableLastUpdate().setValue(e.lastUpdate),n(null,i)})}function I(t){var e=t.room,i=t.members||[];return new n(this,e.roomId,e.alias,e.name,e.description,e.type,i,e.bridgeId,e.pin)}function R(t){var e=t.room,i=t.members;return new s(this,e.roomId,e.alias,e.name,e.description,e.type,i,e.bridgeId,e.pin)}function M(t){var e=this.Mr.getValue(),i=t.getObservableMembers().getValue(),n=m.findIndex(i,function(t){return e.getSessionId()===t.getSessionId()});return n<0?(this.Pt.debug("Self not in server room model."),!1):(e.an(i[n].toJson()),i[n]=e,t.getObservableMembers().setValue(i),!0)}return r.prototype.setPCast=function(t){a.xt(t,"pcast"),a.Ct(t.getLogger,"pcast.getLogger"),a.Ct(t.getProtocol,"pcast.getProtocol"),this.Nr&&this.Pt.info("Resetting pcast instance for room service"),this.Nr=t,this.Pt=t.getLogger(),this.Dn=t.getProtocol(),a.xt(this.Pt,"this._logger"),a.xt(this.Dn,"this._protocol"),this.Dr.setPCast(t),this.Pr&&this.Pr.setPCast(t),this.Bn&&(this.g.dispose(),k.call(this))},r.prototype.start=function(t,e){if(!this.Bn){a.Nt(t,"role"),a.Nt(e,"screenName");var i=f.states.passive.name,n=this.Dr.getPCastSessionId(),r=e,s=m.now(),o=new h(this,i,n,r,t,[],s);return this.Mr=new u.Observable(o),this.g=new c.DisposableList,k.call(this),this.Bn=!0,o}this.Pt.warn("RoomService already started.")},r.prototype.getRoomInfo=function(t,e,i){t?a.Nt(t,"roomId"):a.Nt(e,"alias"),a.Ct(i,"callback"),function(t,e,n){this.Dr.assertAuthorized();var r=this;this.Dn.getRoomInfo(t,e,function(t,e){if(t)return r.Pt.error("Request to get room info failed with error [%s]",t),n(t,null);var i={status:e.status};if("ok"!==e.status)return r.Pt.warn("Request to get room info failed with status [%s]",e.status),n(null,i);i.room=m.freeze(I.call(r,e)),n(null,i)})}.call(this,t,e,i)},r.prototype.createRoom=function(t,e){a.xt(t,"room"),a.Nt(t.name,"room.name"),a.Nt(t.type,"room.type"),a.Yt(t.description,"room.description"),a.Ct(e,"callback"),function(t,n){this.Dr.assertAuthorized();var r=this,e=function(t){return new s(this,"",t.alias,t.name,t.description,t.type,[],t.bridgeId,t.pin).toJson()}.call(r,t);this.Dn.createRoom(e,function(t,e){if(t)return r.Pt.error("Creating room failed with error [%s]",t),n(t,null);var i={status:e.status};if("ok"!==e.status&&"already-exists"!==e.status)return r.Pt.warn("Creating room failed with status [%s]",e.status),n(null,i);i.room=m.freeze(I.call(r,e)),n(null,i)})}.call(this,t,e)},r.prototype.enterRoom=function(t,e,i){t?a.Nt(t,"roomId"):a.Nt(e,"alias"),a.Ct(i,"callback"),E.call(this,t,e,i)},r.prototype.leaveRoom=function(t){return function(n){var t=this.Cr.getValue();if(!t)return this.Pt.info("Not currently in a room."),n(null,d);if(""!==this.Dr.getPCastSessionId()){if(!this.jr){this.Dr.assertAuthorized();var e=t.getRoomId(),i=m.now();this.Pt.info("Leave room [%s]",e);var r=this;this.jr=!0,this.Dn.leaveRoom(e,i,function(t,e){if(r.jr=!1,r.Cr.setValue(null),r.xr.setValue(null),t)return r.Pt.error("Leaving room failed with error [%s]",t),n(t,null);var i={status:e.status};if("ok"!==e.status)return r.Pt.warn("Leaving room failed with status [%s]",e.status),n(null,i);n(null,i)})}}else this.Pt.warn("Unable to leave room. We are currently not connected. Status [%s]",this.Fr)}.call(this,t)},r.prototype.getChatService=function(){return!this.Pr&&this.Cr.getValue()&&(this.Pr=new t(this)),this.Pr},r.prototype.getSelf=function(){return this.Mr.getValue()},r.prototype.getObservableActiveRoom=function(){return this.Cr},r.prototype.updateSelf=function(t){a.Ct(t,"callback"),T.call(this,this.getSelf(),t)},r.prototype.updateMember=function(t,e){a.Ct(e,"callback"),a.xt(t,"member"),T.call(this,t,e)},r.prototype.updateRoom=function(t){a.Ct(t,"callback"),function(n){if(!this.Cr.getValue())return this.Pt.warn("Not in a room. Please Enter a room before updating member."),n(null,d);this.Dr.assertAuthorized();var t=this.Cr.getValue(),e=m.now(),r=this;this.Dn.updateRoom(t.toJson(),e,function(t,e){if(t)return r.Pt.error("Update of room failed with error [%s]",t),n(t,null);var i={status:e.status};"ok"!==e.status&&r.Pt.warn("Update of room failed with status [%s]",e.status),n(null,i)})}.call(this,t)},r.prototype.revertRoomChanges=function(){var t=this.Cr.getValue(),e=this.xr.getValue();if(!t||!e)return this.Pt.warn("Unable to revert changes to room. Not currently in a room.");t.an(e.toJson())},r.prototype.revertMemberChanges=function(t){a.xt(t,"member");var e=w(t.getSessionId(),this.xr),i=w(t.getSessionId(),this.Cr);if(!e||!i)return this.Pt.warn("Unable to revert changes to member. Member is currently not in room.");i.an(e.toJson())},r.prototype.isInRoom=function(){return!!this.Cr.getValue()},r.prototype.toString=function(){return"RoomService"},r.prototype.stop=function(t){var e=this.Cr.getValue(),i=this;if(this.Pt.info("Stopping room service with reason [%s]",t),e)return this.leaveRoom(function(t,e){t&&i.Pt.warn("Failure to stop room service. Unable to leave room",t),e&&"ok"!==e.status&&i.Pt.warn("Failure to stop room service. Unable to leave room. Status: [%s]",e.status),e&&"ok"===e.status&&(o.call(i),i.Bn=!1)});o.call(this),i.Bn=!1},r}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(t,e){"use strict";function i(t){this.setPCast(t)}function n(t){return null!=t&&""!==t}function r(t){return null!=t&&""!==t&&"offline"!==t.toLowerCase()}return i.prototype.setPCast=function(t){e.xt(t,"pcast"),e.Ct(t.getObservableStatus,"pcast.getObservableStatus"),e.Ct(t.getLogger,"pcast.getLogger"),e.Ct(t.getProtocol,"pcast.getProtocol"),t!==this.Nr&&(this.Nr=t,this.Pt=t.getLogger(),this.Dn=t.getProtocol(),e.xt(this.Pt,"this._logger"),e.xt(this.Dn,"this._protocol"),e.Ct(this.Dn.getObservableSessionId,"this._protocol.getObservableSessionId"),e.Ct(this.Nr.getObservableStatus,"this._pcast.getObservableStatus"),this.Lr=this.Dn.getObservableSessionId(),this._r=this.Nr.getObservableStatus())},i.prototype.checkAuthorized=function(){return!!r(this.getPCastStatus())&&!!n(this.getPCastSessionId())},i.prototype.assertAuthorized=function(){if(!r(this.getPCastStatus()))throw new Error("Unable to perform action. Status ["+this.getPCastStatus()+"]. Please wait to reconnect.");if(!n(this.getPCastSessionId()))throw new Error("Unable to perform action. Invalid sessionId ["+this.getPCastSessionId()+"] with status ["+this.getPCastStatus()+"]")},i.prototype.getObservableSessionId=function(){return this.Lr},i.prototype.getObservableStatus=function(){return this._r},i.prototype.getPCastSessionId=function(){return this.Lr.getValue()},i.prototype.getPCastStatus=function(){return this._r.getValue()},i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(40),i(15)],void 0===(r=function(n,c,h,i,t){"use strict";var e=t.types;function r(t,e,i,n,r,s,o,a,u){this.init(t,e,i,n,r,s,o,a,u)}function f(t,e){return n.map(t,function(t){return new i(e,t.state,t.sessionId,t.screenName,t.role,t.streams,t.lastUpdate)})}function d(t){if(!(t=n.getEnumName(e,t)))throw new Error('"type" must be a valid room type');return t}return r.prototype.init=function(t,e,i,n,r,s,o,a,u){c.xt(t,"roomService"),c.Nt(n,"name"),c.Yt(r,"description"),c.isArray(o,"members"),e&&c.Nt(e,"id"),i&&c.Nt(i,"alias"),a&&c.Nt(a,"bridgeId"),u&&c.Nt(u,"pin"),this.Br=new h.Observable(e),this.zr=new h.Observable(i),this.jt=new h.Observable(n),this.Wr=new h.Observable(r),this.Wt=new h.Observable(s,d),this.Vr=new h.ObservableArray([]).extend({method:"notifyWhenChangesStop",timeout:400}),this.f=new h.ObservableArray,this.Hr=new h.Observable(a),this.Gr=new h.Observable(u),this.Kr=t,function(t){var e=f(t,this.Kr);this.Vr.setValue(e)}.call(this,o)},r.prototype.getRoomId=function(){return this.Br.getValue()},r.prototype.getObservableAlias=function(){return this.zr},r.prototype.getObservableName=function(){return this.jt},r.prototype.getObservableDescription=function(){return this.Wr},r.prototype.getObservableType=function(){return this.Wt},r.prototype.getObservableMembers=function(){return this.Vr},r.prototype.getObservableBridgeId=function(){return this.Hr},r.prototype.getObservablePin=function(){return this.Gr},r.prototype.toString=function(){return this.Wt.getValue()+"["+this.Br.getValue()+"]"},r.prototype.toJson=function(){return{roomId:this.Br.getValue(),alias:this.zr.getValue(),name:this.jt.getValue(),description:this.Wr.getValue(),type:this.Wt.getValue(),pin:this.Gr.getValue(),bridgeId:this.Hr.getValue()}},r.prototype.commitChanges=function(t){c.xt(this.Kr,"this._roomService"),this.Kr.updateRoom(this,t)},r.prototype.reload=function(){c.xt(this.Kr,"this._roomService"),this.Kr.revertRoomChanges(this)},r.prototype.an=function(t){n.xt(t)&&(t.roomId&&this.Br.setValue(t.roomId),t.alias&&this.zr.setValue(t.alias),t.name&&this.jt.setValue(t.name),t.description&&this.Wr.setValue(t.description),t.type&&this.Wt.setValue(t.type),t.options&&this.f.setValue(t.options),t.bridgeId&&this.Hr.setValue(t.bridgeId),t.pin&&this.Gr.setValue(t.pin),t.members)},r.prototype.Ar=function(t){var e=this,i=f(t,this.Kr);n.forEach(i,function(t){e.Vr.push(t)})},r.prototype.Or=function(t){var i=this;n.forEach(t,function(e){i.Vr.remove(function(t){return e.sessionId===t.getSessionId()&&e.lastUpdate>=t.getObservableLastUpdate().getValue()})})},r.prototype.qr=function(i){n.forEach(this.Vr.getValue(),function(e){var t=n.find(i,function(t){return e.getSessionId()===t.sessionId&&t.lastUpdate>e.getObservableLastUpdate().getValue()});t&&e.an(t)})},r}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(23),i(14)],void 0===(r=function(a,u,c,n,t){"use strict";var e=t.roles,i=t.states;function r(t,e,i,n,r,s,o){this.init(t,e,i,n,r,s,o)}function o(t){return new n(t.uri,t.type,t.audioState,t.videoState)}function h(t){return u.De(t,e,"memberRole"),a.getEnumName(e,t)}function f(t){return u.De(t,i,"memberState"),a.getEnumName(i,t)}return r.prototype.init=function(t,e,i,n,r,s,o){u.xt(t,"roomService"),u.Yt(i,"sessionId"),u.Yt(n,"screenName"),u.isArray(s,"streams"),u.re(a.utc(o),"lastUpdate"),this.Lr=new c.Observable(i),this.Jr=new c.Observable(n),this.A=new c.ObservableArray([]),this.Xr=new c.Observable(e,f).extend({rateLimit:500}),this.Qr=new c.Observable(r,h),this.Li=new c.Observable(o,a.utc),this.Kr=t,this.setStreams(s)},r.prototype.getObservableState=function(){return this.Xr},r.prototype.getSessionId=function(){return this.Lr.getValue()},r.prototype.getObservableScreenName=function(){return this.Jr},r.prototype.getObservableRole=function(){return this.Qr},r.prototype.getObservableStreams=function(){return this.A},r.prototype.getObservableLastUpdate=function(){return this.Li},r.prototype.getLastUpdate=function(){return this.Li.getValue()},r.prototype.getStreams=function(){return a.map(this.A.getValue(),function(t){return t.toJson()})},r.prototype.getRoomService=function(){return this.Kr},r.prototype.commitChanges=function(t){u.xt(this.Kr,"this._roomService"),this.Kr.updateMember(this,t)},r.prototype.reload=function(){u.xt(this.Kr,"this._roomService"),this.Kr.revertMemberChanges(this)},r.prototype.setStreams=function(t){var e=a.map(t,function(t){return o(t)});this.A.setValue(e)},r.prototype.toString=function(){return this.getObservableRole().getValue()+"["+this.getObservableScreenName().getValue()+","+this.getSessionId()+"]"},r.prototype.toJson=function(){var e={sessionId:this.Lr.getValue(),screenName:this.Jr.getValue(),role:this.Qr.getValue(),state:this.Xr.getValue(),streams:[],lastUpdate:this.Li.getValue()};return a.forEach(this.A.getValue(),function(t){e.streams.push(t.toJson())}),e},r.prototype.an=function(t){a.xt(t)&&(t.hasOwnProperty("state")&&this.Xr.setValue(t.state),t.hasOwnProperty("screenName")&&this.Jr.setValue(t.screenName),t.hasOwnProperty("role")&&this.Qr.setValue(t.role),t.hasOwnProperty("lastUpdate")&&this.Li.setValue(t.lastUpdate),t.hasOwnProperty("streams")&&function(t){var e=this.A.getValue(),i=[];a.forEach(t,function(r){var s=n.parsePCastStreamIdFromStreamUri(r.uri),t=a.find(e,function(t){var e=t.getUri()===r.uri,i=t.isPCastStream()&&t.getPCastStreamId()===s,n=e||i;return t.getType()===r.type&&n});t?t.an(r):t=o(r),i.push(t)}),this.A.setValue(i)}.call(this,t.streams))},r}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{states:{trackEnabled:{id:0,name:"TrackEnabled"},trackDisabled:{id:1,name:"TrackDisabled"},trackEnded:{id:2,name:"TrackEnded"}}}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(0),i(1),i(3),i(107)],void 0===(r=function(v,s,O,o){"use strict";function t(t,e){s.xt(t,"pcast"),e&&s.xt(e,"options"),e&&e.screenShare&&s.Ct(e.screenShare,"options.screenShare"),this.Nr=t,this.Pt=t.getLogger(),this.f=e||{},this.$r=v.get(e,["onScreenShare"])}return t.prototype.getUserMedia=function(t,e){s.xt(t,"deviceOptions");var i=new o(this.f),n=i.getDefaultResolution(),r=i.getDefaultFrameRate();(function a(u,c,h,f,d){var l=this.getVendorSpecificConstraints(u,c||{},h),m=!!l.video,p=this;this.Nr.getUserMedia(l,function(t,e,i,n){if("ok"===e)return p.Pt.info("Acquired user media with constraints [%s]",l),d(null,{userMedia:i,options:{frameRate:m?h:null,resolution:m?v.get(c,["resolution"],null):null,aspectRatio:m?v.get(c,["aspectRatio"],null):null}});p.Pt.info("Failed to acquire user media with constraints [%s]",l);var r=c,s=h,o=function(t){return t.constraintName?t.constraintName:t.constraint?t.constraint:""}(n);if(n&&("ConstraintNotSatisfiedError"===n.name||"OverconstrainedError"===n.name||"OverconstrainedError"===n.constructor.name||"unavailable"===n.code&&"Edge"===O.browser))switch(o.toLowerCase()){case"width":case"height":if(!c||!f.canResolveNextResolution())break;return p.Pt.warn("Unable to get user media with constraint [%s] with height [%s] and width [%s]. Retrying with next closest resolution.",o,r.height,r.width),r=f.getNextResolution(c.height,c.aspectRatio),a.call(p,u,r,s,f,d);case"framerate":default:if(h)return p.Pt.warn("Unable to get user media with constraint [%s] and frame rate [%s]. Retrying without frame rate constraint.",o,h),a.call(p,u,r,s=null,f,d);if(!c||!f.canResolveNextResolution())break;return p.Pt.warn("Unable to get user media with constraint [%s] with height [%s] and width [%s]. Retrying with next closest resolution.",o,r.height,r.width),r=f.getNextResolution(c.height,c.aspectRatio),a.call(p,u,r,s,f,d)}return p.Pt.error("Unable to get user media with status [%s]",e,n),d(n)},function(t){var e=t;if(p.$r&&"Chrome"===O.browser){var i,n=function(t){var e=v.get(t,["video","mandatory","chromeMediaSource"]),i=v.get(t,["audio","mandatory","chromeMediaSource"]),n=v.get(t,["video","mandatory","chromeMediaSourceId"]),r=v.get(t,["audio","mandatory","chromeMediaSourceId"]),s={};return(e||r)&&(v.set(s,["screen","mediaSource"],e),v.set(s,["screen","mediaSourceId"],n)),(i||r)&&(v.set(s,["screenAudio","mediaSource"],i),v.set(s,["screenAudio","mediaSourceId"],r)),s}(t);if((e=p.$r(n)).resolution&&e.aspectRatio)switch(this.Yr){case"9x16":case"3x4":i={width:e.resolution,height:f.calculateLongerDimensionByAspectRatio(e.resolution,e.aspectRatio)};break;case"16x9":case"4x3":default:i={width:f.calculateLongerDimensionByAspectRatio(e.resolution,e.aspectRatio),height:e.resolution}}e=function(t,e,i){var n=this.getVendorSpecificConstraints(t,e,i);n.screen&&(n.video=n.screen,delete n.screen),n.screenAudio&&(n.audio=n.screenAudio,delete n.screenAudio);var r=v.get(n,["video","mandatory","mediaSource"]),s=v.get(n,["audio","mandatory","mediaSource"]),o=v.get(n,["video","mandatory","mediaSourceId"]),a=v.get(n,["audio","mandatory","mediaSourceId"]);return(r||o)&&(v.set(n,["video","mandatory","chromeMediaSource"],r),v.set(n,["video","mandatory","chromeMediaSourceId"],o),delete n.video.mandatory.mediaSource,delete n.video.mandatory.mediaSourceId),(s||a)&&(v.set(n,["audio","mandatory","chromeMediaSource"],s),v.set(n,["audio","mandatory","chromeMediaSourceId"],a),delete n.audio.mandatory.mediaSource,delete n.audio.mandatory.mediaSourceId),n}.call(p,n,i,e.frameRate)}return e})}).call(this,t,n,r,i,e)},t.prototype.getVendorSpecificConstraints=function(t,e,i){if(e=e||{},!t||!t.audio&&!t.video&&!t.screen&&!t.screenAudio)throw new Error("Invalid device options. Must pass in at least one device option.");return"Firefox"===O.browser&&38<O.browserVersion||"Chrome"===O.browser&&52<O.browserVersion&&!t.screen&&!t.screenAudio||"Safari"===O.browser&&10<O.browserVersion||"Opera"===O.browser&&40<O.browserVersion?(E=e,T=i,I=(S=t).video,R=S.audio,M=S.screen,C=S.screenAudio,x=E.width,P=E.height,D={},I&&(D.video={height:{min:P,ideal:P,max:P},width:{min:x,ideal:x,max:x},frameRate:{ideal:T,max:T}},I.deviceId&&(D.video.deviceId={exact:I.deviceId}),I.facingMode&&(D.video.facingMode=I.facingMode),x||delete D.video.width,P||delete D.video.height,T||delete D.video.frameRate,x||P||T||I.deviceId||I.facingMode||(D.video=!0)),R&&(D.audio={},R.deviceId&&(D.audio.deviceId={exact:R.deviceId}),R.mediaSource&&(D.audio.mediaSource=R.mediaSource),R.mediaSourceId&&(D.audio.mediaSourceId=R.mediaSourceId),R.deviceId||R.mediaSource||R.mediaSourceId||(D.audio=!0)),C&&(D.screenAudio={},C.deviceId&&(D.screenAudio.deviceId={exact:C.deviceId}),C.mediaSource&&(D.screenAudio.mediaSource=C.mediaSource),C.mediaSourceId&&(D.screenAudio.mediaSourceId=C.mediaSourceId),C.deviceId||C.mediaSource||C.mediaSourceId||(D.screenAudio=!0)),M&&(D.screen={height:{min:P,ideal:P,max:P},width:{min:x,ideal:x,max:x},frameRate:{ideal:T,max:T}},x||delete D.screen.width,P||delete D.screen.height,T||delete D.screen.frameRate,M.mediaSource&&(D.screen.mediaSource=M.mediaSource),x||P||T||M.mediaSource||(D.screen=!0)),M&&I&&(D.screen=!0),D):"Edge"===O.browser?(m=e,p=i,v=(l=t).video,g=l.audio,y=l.screen,w=m.width,b=m.height,k={},v&&(k.video={height:{min:b,max:b,exact:b},width:{min:w,max:w,exact:w},frameRate:p},v.deviceId&&(k.video.deviceId=v.deviceId),v.facingMode&&(k.video.facingMode=v.facingMode),w||delete k.video.width,b||delete k.video.height,p||delete k.video.frameRate,w||b||p||v.deviceId||v.facingMode||(k.video=!0)),g&&(k.audio=!0,g.deviceId&&(k.audio={deviceId:g.deviceId})),y&&(k.screen=!0),k):(r=e,s=i,o=(n=t).video,a=n.audio,u=n.screen,c=n.screenAudio,h=r.width,f=r.height,d={},o&&(d.video={mandatory:{minHeight:f,maxHeight:f,minWidth:h,maxWidth:h,maxFrameRate:s}},o.deviceId&&(d.video.mandatory.sourceId=o.deviceId),o.facingMode&&(d.video.facingMode=o.facingMode),o.mediaSource&&(d.video.mandatory.mediaSource=o.mediaSource),o.mediaSourceId&&(d.video.mandatory.mediaSourceId=o.mediaSourceId),h||(delete d.video.mandatory.minWidth,delete d.video.mandatory.maxWidth),f||(delete d.video.mandatory.minHeight,delete d.video.mandatory.maxHeight),s||delete d.video.mandatory.maxFrameRate,h||f||s||o.deviceId||o.facingMode||o.mediaSource||o.mediaSourceId||(d.video=!0)),a&&(d.audio={mandatory:{}},a.deviceId&&(d.audio.mandatory.sourceId=a.deviceId),a.mediaSource&&(d.audio.mandatory.mediaSource=a.mediaSource),a.mediaSourceId&&(d.audio.mandatory.mediaSourceId=a.mediaSourceId),a.deviceId||a.mediaSource||a.mediaSourceId||(d.audio=!0)),c&&(d.screenAudio={mandatory:{}},c.deviceId&&(d.screenAudio.mandatory.sourceId=c.deviceId),c.mediaSource&&(d.screenAudio.mandatory.mediaSource=c.mediaSource),c.mediaSourceId&&(d.screenAudio.mandatory.mediaSourceId=c.mediaSourceId),c.deviceId||c.mediaSource||c.mediaSourceId||(d.screenAudio=!0)),u&&(d.screen={mandatory:{minHeight:f,maxHeight:f,minWidth:h,maxWidth:h,maxFrameRate:s}},h||(delete d.screen.mandatory.minWidth,delete d.screen.mandatory.maxWidth),f||(delete d.screen.mandatory.minHeight,delete d.screen.mandatory.maxHeight),s||delete d.screen.mandatory.maxFrameRate,u.mediaSource&&(d.screen.mandatory.mediaSource=u.mediaSource),u.mediaSourceId&&(d.screen.mandatory.mediaSourceId=u.mediaSourceId),h||f||s||u.mediaSource||(d.screen=!0)),u&&o&&(d.screen=!0),d);var n,r,s,o,a,u,c,h,f,d,l,m,p,v,g,y,w,b,k,S,E,T,I,R,M,C,x,P,D},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(12),i(44),i(42),i(27),i(3),i(108)],void 0===(r=function(v,g,e,y,i,r,n,w,b){"use strict";var s=0,k="unauthorized",u=1e3,o={maxOfflineTime:18e4,maxReconnectFrequency:6e4};function t(t){if(g.xt(t,"options"),t.authToken&&g.Nt(t.authToken,"options.authToken"),t.onError&&g.Ct(t.onError,"options.onError"),!v.isNullOrUndefined(t.onlineTimeout)&&(g.re(t.onlineTimeout,"options.onlineTimeout"),t.onlineTimeout<0))throw new Error('"options.onlineTimeout" must be a positive number');t.reconnectOptions&&(g.xt(t.reconnectOptions,"options.reconnectOptions"),g.re(t.reconnectOptions.maxOfflineTime,"options.reconnectOptions.maxOfflineTime"),g.re(t.reconnectOptions.maxReconnectFrequency,"options.reconnectOptions.maxReconnectFrequency")),t.adminApiProxyClient&&(g.xt(t.adminApiProxyClient,"options.adminApiProxyClient"),g.Ct(t.adminApiProxyClient.createAuthenticationToken,"options.adminApiProxyClient.createAuthenticationToken")),this.Zr=++s,this.ts=new e.Observable(null).extend({rateLimit:0}),this.Un={},this.es=t.adminApiProxyClient,this.ns=!1,this.rs=0,this.ss=0,this.rr=!1,this.On=t.authToken,this.Yi=t.onError,this.f=t,this.os=v.re(t.onlineTimeout)?t.onlineTimeout:2e4,this.as=t.reconnectOptions||o,this.Pt=null,this.us={},this.es||(this.es=new i,this.es.setBackendUri(t.backendUri),this.es.setAuthenticationData(t.authenticationData)),c.call(this),t.adminApiProxyClient||((t.backendUri||v.Yt(t.backendUri))&&this.Pt.warn("Passing options.backendUri is deprecated. Please create an instance of the sdk.net.AdminApiProxyClient and pass that instead"),t.authenticationData&&this.Pt.warn("Passing options.authenticationData is deprecated. Please create an instance of the sdk.net.AdminApiProxyClient and pass that instead"))}t.prototype.toString=function(){return"PCastExpress["+this.Zr+"]"},t.prototype.dispose=function(){this.cs&&(this.cs.dispose(),this.cs=null),this.ts.getValue()&&(this.ts.getValue().stop(),this.ts.setValue(null)),v.re(this.hs)&&(clearTimeout(this.hs),this.hs=null),this.es.dispose(),this.rs=0,this.ss=0,this.rr=!0,this.Pt.info("[%s] Disposed PCast Express instance",this)},t.prototype.getPCast=function(){return this.ts.getValue()},t.prototype.getPCastObservable=function(){return this.ts},t.prototype.getAdminAPI=function(){return this.es},t.prototype.getUserMedia=function(e,i){var n=this;if(g.xt(e.mediaConstraints,"options.mediaConstraints"),g.Ct(i,"callback"),e.resolution&&g.re(e.resolution,"options.resolution"),e.frameRate&&g.re(e.frameRate,"options.frameRate"),e.aspectRatio&&g.Nt(e.aspectRatio,"options.aspectRatio"),e.onResolveMedia&&g.Ct(e.onResolveMedia,"options.onResolveMedia"),e.onScreenShare&&g.Ct(e.onScreenShare,"options.onScreenShare"),n.ts.getValue())return m.call(n,n.ts.getValue(),e,i);var r=n.ts.subscribe(function(t){t&&(r.dispose(),m.call(n,t,e,i))})},t.prototype.publish=function(i,n){g.xt(i,"options"),g.Ct(n,"callback"),i.capabilities&&g.isArray(i.capabilities,"options.capabilities"),i.connectOptions&&g.isArray(i.connectOptions,"options.connectOptions"),i.mediaConstraints?g.xt(i.mediaConstraints,"options.mediaConstraints"):g.xt(i.userMediaStream,"options.userMediaStream"),i.videoElement&&g.xt(i.videoElement,"options.videoElement"),i.monitor&&(g.xt(i.monitor,"options.monitor"),g.Ct(i.monitor.callback,"options.monitor.callback"),i.monitor.options&&g.xt(i.monitor.options,"options.monitor.options")),i.streamToken&&g.Nt(i.streamToken,"options.streamToken");var r=this;this.waitForOnline(function(t){return t?n(t):i.userMediaStream?S.call(r,i.userMediaStream,i,!1,n):void r.getUserMedia(i,function(t,e){return t?n(t):"ok"!==e.status?n(null,e):void S.call(r,e.userMedia,i,!0,n)})},i.isContinuation)};var a=["streaming","low-latency","on-demand","uld","vvld","vld","ld","sd","hd","fhd","uhd"];function c(){var i=this;if(!this.ts.getValue()){var t=v.assign({logger:this.Pt},this.f);this.ts.setValue(new n(t))}if(this.Pt||(this.Pt=this.ts.getValue().getLogger()),this.fs||(this.fs=this.ts.getValue().getObservableStatus().subscribe(v.bind(h,this))),this.On)return this.ts.getValue().start(this.On,v.noop,v.noop,v.noop);this.es.createAuthenticationToken(function(t,e){return t&&"timeout"===t.message?h.call(i,t.message):t?l.call(i,t):"ok"!==e.status?h.call(i,e.status):void(i.ts.getValue()?i.ts.getValue().start(e.authenticationToken,v.noop,v.noop,v.noop):i.Pt.warn("[%s] Unable to authenticate. PCast not instantiated.",this))})}function h(t){switch(t){case"timeout":case"critical-network-issue":return this.ts.getValue()&&(this.ts.getValue().stop("recovery"),this.ts.setValue(null)),this.fs&&(this.fs.dispose(),this.fs=null),this.rs++,f.call(this);case"reconnect-failed":case"unauthorized":return delete this.On,this.ss++,1<this.ss?l.call(this,new Error(t)):(this.Pt.info("[%s] Attempting to create new authToken and re-connect after [%s] response",this,k),d.call(this));case"capacity":case"network-unavailable":return this.rs++,f.call(this);case"online":return this.ns?this.Pt.info("[%s] Successfully reconnected (reconnectCount=[%s],reauthCount=[%s])",this,this.rs,this.ss):this.Pt.info("[%s] Successfully instantiated",this),this.ss=0,this.rs=0,void(this.ns=!0);case"reconnecting":case"reconnected":case"connecting":break;case"offline":return;case"failed":default:return l.call(this,new Error(t))}}function f(){var t=this,e=Math.min(u*t.rs*t.rs,this.as.maxReconnectFrequency),i=Math.min(e/1e4,5),n=e+Math.random()*i*1e3;this.Pt.info("[%s] Waiting for [%s] ms before continuing to attempt to reconnect to PCast",this,n),this.hs=setTimeout(function(){return t.ts.getValue()&&t.ts.getValue().isStarted()?d.call(t):c.call(t)},n)}function d(){var i=this;this.es.createAuthenticationToken(function(t,e){return t&&"timeout"===t.message?h.call(i,t.message):t?l.call(i,t):"ok"!==e.status?h.call(i,e.status):void(i.ts.getValue()?i.ts.getValue().reAuthenticate(e.authenticationToken):i.Pt.warn("[%s] Unable to authenticate. PCast not instantiated.",this))})}function l(t){if(!this.Yi)throw t;this.Yi(t)}function m(t,i,n){new r(t,{aspectRatio:i.aspectRatio,resolution:i.resolution,frameRate:i.frameRate,resolutionSelectionStrategy:i.resolutionSelectionStrategy,onScreenShare:function(t){return(t=i.onScreenShare?i.onScreenShare(t):t).resolution&&g.re(t.resolution,"clientOptions.resolution"),t.frameRate&&g.re(t.frameRate,"screenOptions.frameRate"),t.aspectRatio&&g.Nt(t.aspectRatio,"screenOptions.aspectRatio"),v.assign({resolution:t.resolution},t)}}).getUserMedia(i.mediaConstraints,function(t,e){if(t)return n(t);i.onResolveMedia&&i.onResolveMedia(e.options),n(null,v.assign({status:"ok"},e))})}function S(r,s,o,a){var u=this;if(g.isArray(s.capabilities,"options.capabilities"),s.streamToken)return p.call(u,s.streamToken,r,s,o,a);u.waitForOnline(function(t){if(t)return u.Pt.error("[%s] Failed to create stream token for publishing after waiting for online status",this,t),a(t);var i=u.ts.getValue().getProtocol().getSessionId(),e=v.includes(s.capabilities,"egress"),n=v.bind(u.es.createStreamTokenForPublishing,u.es,i,s.capabilities);e&&(n=v.bind(u.es.createStreamTokenForPublishingToExternal,u.es,i,s.capabilities,s.streamId)),u.Pt.info("[%s] [%s] Creating stream token for publishing",this,i),n(function(t,e){return t?(u.Pt.error("[%s] [%s] Failed to create stream token for publishing",this,i,t),a(t)):"ok"!==e.status?(u.Pt.warn("[%s] [%s] Failed to create stream token for publishing with status [%s]",this,i,e.status),a(null,e)):void p.call(u,e.streamToken,r,s,o,a)})},s.isContinuation)}function p(u,c,h,f,d){var l=this,m=!1,p=null;function e(t,e,i){function n(t){var e=v.assign({streamToken:u,isContinuation:!0},h);l.Pt.warn("[%s] Retrying publisher after failure with reason [%s]",this,t),l.us[i.getStreamId()]=!0,"camera-track-failure"===t?(i.stop(t,!1),l.publish(h,d)):(i.stop(t,!0),S.call(l,c,e,f,d))}if(e===k&&(h.streamToken||!h.authFailure)||"timeout"===e){l.Pt.info("[%s] Attempting to create new streamToken and re-publish after [%s] response",this,k);var r=v.assign({isContinuation:!0,authFailure:!0},h);return delete r.streamToken,S.call(l,c,r,f,d)}if("ok"!==e)return l.Pt.warn("[%s] Failure to publish with status [%s]",this,e),p&&(l.us[p.getStreamId()]=!0),d(null,{status:e});delete h.authFailure,l.Un[i.getStreamId()]=i,p=i;var s=v.bind(C,l,function(){},n,!0);if(h.monitor){var o=v.bind(M,l,h.monitor.callback,n);i.monitor(h.monitor.options||{},o),s=v.bind(C,l,h.monitor.callback,n,!0)}i.setPublisherEndedCallback(s);var a=function(n,r,s){var o=this,a=v.bind(n.stop,n);return n.stop=function(t,e){if(o.Pt.info("[%s] [%s] Stopping publisher with reason [%s]",o,n.getStreamId(),t),a(t),r&&(r.src="",r.srcObject=null),s&&n.getStream()&&!e){var i=n.getStream();i&&i.getTracks().forEach(function(t){t.stop()})}},n.enableAudio=function(){return T(n.getStream(),!0)},n.disableAudio=function(){return T(n.getStream(),!1)},n.enableVideo=function(){return I(n.getStream(),!0)},n.disableVideo=function(){return I(n.getStream(),!1)},n.setPublisherEndedCallback=function(){},n}.call(l,i,h.videoElement,f);h.videoElement&&!m&&(w.attachMediaStream(h.videoElement,c,function(t){t&&l.Pt.warn("[%s] [%s] Failed to attach publish media stream to video element.",this,i.getStreamId(),t)}),m=!0),d(null,{status:"ok",publisher:a})}h.tags&&g.isArray(h.tags,"options.tags"),h.connectOptions&&g.isArray(h.connectOptions,"options.connectOptions"),l.waitForOnline(function(t){if(t)return d(t);l.ts.getValue().publish(u,c,e,h.tags,{connectOptions:h.connectOptions})},h.isContinuation)}function E(f,d,l){function i(t,e,i){function r(t){var e=v.assign({isContinuation:!0},d);m.us[i.getStreamId()]=!0,i.stop(t),m.Pt.warn("[%s] [%s] Stream failure occurred with reason [%s]. Attempting to recover from failure.",this,d.streamId,t),E.call(m,f,e,l)}var n;if(!d.skipRetryOnUnauthorized&&e===k&&(d.streamToken||!d.authFailure)||"timeout"===e){m.Pt.info("[%s] [%s] Attempting to create new streamToken and re-subscribe after [%s] response",this,d.streamId,k);var s=v.assign({isContinuation:!0,authFailure:!0},d);return delete s.streamToken,m.subscribe(s,l)}if("streaming-not-ready"===e)return m.Pt.warn("[%s] Failure to subscribe with status [%s]. Try again in a few seconds.",this,e),l(null,{status:e,retry:v.bind(r,m,e)});if("ok"!==e)return m.Pt.warn("[%s] Failure to subscribe with status [%s]",this,e),p&&(m.us[p.getStreamId()]=!0),l(null,{status:e});delete d.authFailure,p=i,d.videoElement&&(n=i.createRenderer()).start(d.videoElement);var o=v.noop,a=v.bind(C,m,o,r,!1);if(d.monitor){var u=v.bind(M,m,d.monitor.callback,r);i.monitor(d.monitor.options||{},u),a=v.bind(C,m,d.monitor.callback,r,!1)}i.setStreamEndedCallback(a);var c=function(e,i){var n=this,r=v.bind(e.stop,e);return e.stop=function(t){n.Pt.info("[%s] [%s] Stopping subscriber with reason [%s]",this,e,t),i&&i.stop(t),r(t)},e.enableAudio=function(){return T(e.getStream(),!0)},e.disableAudio=function(){return T(e.getStream(),!1)},e.enableVideo=function(){return I(e.getStream(),!0)},e.disableVideo=function(){return I(e.getStream(),!1)},e.setStreamEndedCallback=function(){},e}.call(m,i,n),h={status:"ok",mediaStream:c};i.setStreamErrorCallback(function(t,e,i){if("real-time"===e&&"connection-timeout"===i.message)return r.call(m,i.message);if("shaka"!==e||i.severity===b.errorSeverity.critical.id){if("phenix-player"!==e||i.severity!==y.errors.severity.RECOVERABLE)return m.Pt.warn("[%s] [%s] Error occurred while playing stream with Express API. Stopping stream.",this,c.getStreamId(),i),c.stop(),l(i);m.Pt.warn("[%s] [%s] Recoverable error occurred while playing stream with Express API. Attempting to subscribe again.",this,c.getStreamId(),i);var n=v.assign({isContinuation:!0},d);return delete n.streamToken,m.subscribe(n,l)}}),n&&(h.renderer=n),l(null,h)}var m=this,p=null;m.waitForOnline(function(t){if(t)return l(t);var e=v.clone(d.subscriberOptions||{});d.streamId&&(e.originStreamId=d.streamId),m.ts.getValue().subscribe(f,i,e)},d.isContinuation)}function T(t,e){if(t)return R(t.getAudioTracks(),e),e}function I(t,e){if(t)return R(t.getVideoTracks(),e),e}function R(t,e){g.isArray(t,"tracks"),v.forEach(t,function(t){t.enabled=e})}function M(t,e,i,n,r){switch(n){case"camera-track-failure":case"client-side-failure":t(null,v.assign({status:n,retry:v.bind(e,null,n)},r))}}function C(t,e,i,n,r,s){var o={status:"stream-ended",reason:r,description:s};if(this.us[n.getStreamId()])this.Pt.info("[%s] Ignoring stream end due to recovery in progress [%s]",this,n.getStreamId());else switch(r){case"egress-setup-failed":case"ended":case"censored":var a={status:r,reason:r,description:s};return i?a.publisher=n:a.mediaStream=n,t(null,a);case"custom":return t(null,o);case"egress-failed":case"capacity":return void setTimeout(function(){if(!this.rr)return e(r)},u);case"failed":case"maintenance":case"overload":return e(r);case"app-background":default:return o.retry=e,t(null,o)}}return t.prototype.publishRemote=function(i,n){if(g.xt(i,"options"),g.Ct(n,"callback"),g.Nt(i.streamUri,"options.streamUri"),i.capabilities&&g.isArray(i.capabilities,"options.capabilities"),i.connectOptions&&g.isArray(i.connectOptions,"options.connectOptions"),i.mediaConstraints)throw new Error("Invalid argument: mediaConstraints, passed on publishRemote. Local media not allowed when publishing remote content.");if(i.videoElement)throw new Error("May not view remote stream publisher. Please subscribe to view.");i.prerollSkipDuration&&g.re(i.prerollSkipDuration,"options.prerollSkipDuration"),i.monitor&&(g.xt(i.monitor,"options.monitor"),g.Ct(i.monitor.callback,"options.monitor.callback"),i.monitor.options&&g.xt(i.monitor.options,"options.monitor.options")),i.frameRate&&(g.xt(i.frameRate,"options.frameRate"),i.frameRate.exact&&g.re(i.frameRate.exact,"options.frameRate.exact"),i.frameRate.max&&g.re(i.frameRate.max,"options.frameRate.max")),i.streamToken&&g.Nt(i.streamToken,"options.streamToken");var r=this;this.waitForOnline(function(t){if(t)return n(t);var e=v.assign({connectOptions:[],capabilities:[]},i);v.includes(e.capabilities,"publish-uri")||e.capabilities.push("publish-uri"),v.forEach(a,function(t){v.includes(e.capabilities,t)&&e.connectOptions.push("publisher-capability="+t)}),i.frameRate&&i.frameRate.exact&&e.connectOptions.push("source-uri-video-fps="+i.frameRate.exact),i.frameRate&&i.frameRate.max&&e.connectOptions.push("source-uri-video-fps-max="+i.frameRate.max),e.connectOptions.push("source-uri-preroll-skip-duration="+(v.re(i.prerollSkipDuration)?i.prerollSkipDuration:500).toString()),S.call(r,e.streamUri,e,!1,n)})},t.prototype.publishStreamToExternal=function(i,n){if(g.xt(i,"options"),g.Ct(n,"callback"),g.Nt(i.streamId,"options.streamId"),g.Nt(i.externalUri,"options.externalUri"),i.capabilities&&g.isArray(i.capabilities,"options.capabilities"),i.connectOptions&&g.isArray(i.connectOptions,"options.connectOptions"),i.mediaConstraints)throw new Error("Invalid argument: mediaConstraints, passed on publishStreamToExternal. Local media not allowed when publishing remote content.");if(i.videoElement)throw new Error("May not view remote stream publisher. Please subscribe to view.");i.monitor&&(g.xt(i.monitor,"options.monitor"),g.Ct(i.monitor.callback,"options.monitor.callback"),i.monitor.options&&g.xt(i.monitor.options,"options.monitor.options")),i.streamToken&&g.Nt(i.streamToken,"options.streamToken");var r=this;this.waitForOnline(function(t){if(t)return n(t);var e=v.assign({connectOptions:[],capabilities:[]},i);v.includes(e.capabilities,"egress")||e.capabilities.push("egress"),v.includes(e.capabilities,"egress-own-stream")||e.capabilities.push("egress-own-stream"),S.call(r,e.externalUri,e,!1,n)})},t.prototype.publishScreen=function(t,e){var i=v.assign({mediaConstraints:{screen:!0}},t);return v.set(i,["monitor","options"],v.assign({},{monitorFrameRate:!1,videoBitRateThreshold:100,conditionCountForNotificationThreshold:8},v.get(i,["monitor","options"],{}))),this.publish(i,e)},t.prototype.subscribe=function(i,n){g.xt(i,"options"),g.Ct(n,"callback"),g.Nt(i.streamId,"options.streamId"),g.xt(i.capabilities,"options.capabilities"),i.videoElement&&g.xt(i.videoElement,"options.videoElement"),i.monitor&&(g.xt(i.monitor,"options.monitor"),g.Ct(i.monitor.callback,"options.monitor.callback"),i.monitor.options&&g.xt(i.monitor.options,"options.monitor.options")),i.streamToken&&g.Nt(i.streamToken,"options.streamToken"),i.subscriberOptions&&g.xt(i.subscriberOptions,"options.subscriberOptions");var r=this;this.waitForOnline(function(t){return t?(r.Pt.error("[%s] Failed to subscribe after error waiting for online status",this,t),n(t)):i.streamToken?E.call(r,i.streamToken,i,n):(r.Pt.info("[%s] [%s] Generating stream token for subscribing to origin [%s]",this,r.ts.getValue().getProtocol().getSessionId(),i.streamId),void r.es.createStreamTokenForSubscribing(r.ts.getValue().getProtocol().getSessionId(),i.capabilities,i.streamId,null,function(t,e){return t?(r.Pt.error("[%s] Failed to create stream token for subscribing",this,t),n(t)):"ok"!==e.status?(r.Pt.warn("[%s] Failed to create stream token for subscribing with status [%s]",this,e.status),n(null,e)):void E.call(r,e.streamToken,i,n)}))},i.isContinuation)},t.prototype.subscribeToScreen=function(t,e){var i=v.assign({},t);return v.set(i,["monitor","options"],v.assign({},{monitorFrameRate:!1,videoBitRateThreshold:100,conditionCountForNotificationThreshold:8},v.get(i,["monitor","options"],{}))),this.subscribe(i,e)},t.prototype.waitForOnline=function(e,t){if(g.Ct(e,"callback"),this.ts.getValue()&&"online"===this.ts.getValue().getStatus())return e();var i=this,n=t?v.get(i.as,["maxOfflineTime"]):this.os,r=null,s=null,o=setTimeout(function(){i.Pt.info("[%s] Disposing of online listener after [%s] ms",this,n),r&&r.dispose(),s&&s.dispose(),i.rr?i.Pt.info("[%s] Instance was disposed while waiting for online, ignoring callback",this):e(new Error("timeout"))},n);this.Pt.info("[%s] Waiting for online status before continuing. Timeout set to [%s]",this,n),r=this.ts.subscribe(function(t){s&&s.dispose(),t&&(s=t.getObservableStatus().subscribe(function(t){return i.rr?(i.Pt.info("[%s] Instance was disposed while waiting for online, canceling waiting and skip triggering callback",this),clearTimeout(o),s.dispose(),void r.dispose()):"online"===t?(clearTimeout(o),s.dispose(),r.dispose(),e()):void i.Pt.info("[%s] Still waiting for online status before continuing. Current status is [%s]",this,t)},{initial:"notify"}))},{initial:"notify"})},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(6),i(2)],void 0===(r=function(a,u,c,r){"use strict";var h={timeout:2e4,retryOptions:{backoff:1.5,delay:1e3,maxAttempts:3,additionalRetryErrorCodes:[0]}},s={body:{id:1,name:"body"},header:{id:2,name:"header"}},e={createStreamTokenPath:"/stream",createAuthTokenPath:"/auth"},o="auth",f="stream";function t(){this.ds=null,this.ls="",this.ms=e,this.ps={},this.vs=s.body.name,this.g=new r.DisposableList}function d(t,i){var n=null,e=t(a.bind(m,this,function(t,e){switch(clearTimeout(n),a.get(t,["code"])){case 401:return i(null,{status:"unauthorized"});case 404:return i(null,{status:"origin-not-found"});case 410:return i(null,{status:"origin-ended"});default:return i(t,e)}}));return n=setTimeout(function(){e.dispose(),i(new Error("timeout"))},2e4),this.g.add(e),this.g.add(new r.Disposable(function(){clearTimeout(n)})),e}function l(t,e,i,n,r){switch(this.vs){case s.body.name:n=function(t){return a.assign({},t,this.ps)}.call(this,n);break;case s.header.name:r=function(t){return t.headers?(t.headers=a.assign({},this.ps,t.headers),t):a.assign({},{headers:this.ps},t)}.call(this,r);break;default:throw new Error("Unsupported Authentication Mode "+this.vs)}return a.bind(t,e,i,JSON.stringify(n),r)}function m(t,e,i){if(e)return t(e,{});var n=JSON.parse(i.data);return"ok"!==n.status?t(null,{status:n.status||"status-code-missing"}):t(null,n)}function p(t,e,i,n){if(!n||i)return e(i,{status:"failed"});var r={status:"ok"};switch(t){case o:r.authenticationToken=n;break;case f:r.streamToken=n;break;default:throw new Error("Unsupported request type "+t)}return e(i,r)}return t.prototype.dispose=function(){return this.g.dispose()},t.prototype.toString=function(){return"AdminApiProxyClient[customRequestHandler="+(!!this.ds).toString()+",backendUri="+this.ls+",authenticationDataLocationInPayload="+this.vs+",customEndpointPaths="+(this.ms===e).toString()+",customAuthenticationData="+(0<a.keys(this.ps).length).toString()+"]"},t.prototype.getBackendUri=function(){return this.ls},t.prototype.setBackendUri=function(t){u.Yt(t,"backendUri"),this.ls=t},t.prototype.getEndpointPaths=function(){return a.assign({},this.ms)},t.prototype.setEndpointPaths=function(t){u.xt(t,"endpointPaths"),t.createStreamTokenPath&&u.Nt(t.createStreamTokenPath,"endpointPaths.createStreamTokenPath"),t.createAuthTokenPath&&u.Nt(t.createAuthTokenPath,"endpointPaths.createAuthTokenPath"),this.ms=a.assign({},e,t)},t.prototype.getAuthenticationData=function(){return a.assign({},this.ps)},t.prototype.setAuthenticationData=function(t){u.xt(t,"authenticationData"),this.ps=t},t.prototype.getAuthenticationDataLocationInPayload=function(){return this.vs},t.prototype.setAuthenticationDataLocationInPayload=function(t){u.De(t,s,"authenticationDataLocationInPayload"),this.vs=t},t.prototype.getRequestHandler=function(){return this.ds},t.prototype.setRequestHandler=function(t){if(u.Ct(t,"callback"),this.ls)throw new Error("Conflicting parameter [backendUri]");if(0<a.keys(this.ps).length)throw new Error("Conflicting parameter [authenticationData]");if(this.vs!==s.body.name)throw new Error("Conflicting parameter [authenticationDataLocationInPayload]");if(this.ms!==e)throw new Error("Conflicting parameter [endpointPaths]");this.ds=t},t.prototype.createAuthenticationToken=function(t){if(this.ds)return this.ds(o,{},a.bind(p,this,o,t));if(this.ls){var e=l.call(this,c.postWithRetry,c,this.ls+this.ms.createAuthTokenPath,{},h);return d.call(this,e,t)}t(null,{status:"unauthorized"})},t.prototype.createStreamTokenForPublishing=function(t,e,i){u.Nt(t,"sessionId"),u.xt(e,"capabilities");var n={sessionId:t,capabilities:e};if(this.ds)return this.ds(f,n,a.bind(p,this,f,i));if(this.ls){var r=l.call(this,c.postWithRetry,c,this.ls+this.ms.createStreamTokenPath,n,h);return d.call(this,r,i)}i(null,{status:"unauthorized"})},t.prototype.createStreamTokenForPublishingToExternal=function(t,e,i,n){this.createStreamTokenForSubscribing(t,e,i,null,n)},t.prototype.createStreamTokenForSubscribing=function(t,e,i,n,r){u.Nt(t,"sessionId"),u.xt(e,"capabilities"),a.isNullOrUndefined(n)||(u.isArray(n,"additionalStreamIds"),a.forEach(n,function(t){u.Nt(t,"alternateOriginStreamId")}));var s={sessionId:t,capabilities:e,originStreamId:i};if(n&&0<n.length&&(s.alternateOriginStreamIds=n),this.ds)return this.ds(f,s,a.bind(p,this,f,r));if(this.ls){var o=l.call(this,c.postWithRetry,c,this.ls+this.ms.createStreamTokenPath,s,h);return d.call(this,o,r)}r(null,{status:"unauthorized"})},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(2),i(43),i(37),i(46),i(23),i(15),i(14),i(24),i(41),i(13)],void 0===(r=function(k,S,t,E,e,u,p,T,v,g,i,I,R){"use strict";var y=["streaming","rtmp"];function n(t){S.xt(t,"options"),t.pcastExpress&&S.xt(t.pcastExpress,"options.pcastExpress"),this.gs=t.pcastExpress||new e(t),this.ys=!t.pcastExpress,this.ws={},this.bs=[],this.ks={},this.Ss=[],this.Es={},this.Pt=this.gs.getPCast().getLogger(),this.g=new E.DisposableList,this.rr=!1,this.Rn=new R(t.features);var i=this;this.gs.getPCastObservable().subscribe(function(e){e&&(i.Pt.info("Resetting Room Express after change in pcast."),i.gs.waitForOnline(function(){i.gs.getPCastObservable().getValue()===e&&k.forOwn(i.ws,function(t){t.setPCast(e)})}))})}function a(n,r,s){var o=this,a=k.uniqueId();this.gs.waitForOnline(function(t){if(t)return s(t);var e=w.call(o,n,r);if(e)return o.Pt.info("Reusing room service for room [%s]/[%s]",n,r),s(null,{status:"ok",roomService:e});o.ws[a]=new u(o.gs.getPCast());var i=function(r,t){var s=this,e=r.stop,o=r.leaveRoom;return r.stop=function(){e.apply(r,arguments),delete s.ws[t]},r.leaveRoom=function(i){var n=r.getObservableActiveRoom().getValue();o.call(r,function(t,e){return t?(r.stop("leave-room-failure"),i(t)):("ok"!==e.status&&"not-in-room"!==e.status||(s.Pt.info("Successfully disposed Express Room Service [%s]",n?n.getRoomId():"Uninitialized"),r.stop("leave-room")),i(null,e))})},r}.call(o,o.ws[a],a);o.Pt.info("Creating room service for room [%s]/[%s]",n,r),s(null,{status:"ok",roomService:i})})}function w(i,n){return k.find(this.Ss,function(t){var e=t.getObservableActiveRoom().getValue();return e&&(e.getRoomId()===i||e.getObservableAlias().getValue()===n)})}function h(c,h,f){var d=this,l=c.role,m=c.screenName||k.uniqueId();a.call(d,c.roomId,c.alias,function(t,e){if(t)return h(t);if("ok"!==e.status)return h(null,e);function r(){var t=i.getValue();t?(d.Pt.info("Setup member subscription for room [%s]",t.getRoomId()),o=t.getObservableMembers().subscribe(f,{initial:"notify"}),d.g.add(i.subscribe(function(t){o&&(f([]),o.dispose(),o=null),t&&(o=t.getObservableMembers().subscribe(f,{initial:"notify"}))}))):d.Pt.warn("Unable to setup members subscription. Not in room.")}var s=e.roomService,i=s.getObservableActiveRoom(),n=i.getValue(),o=null;if(n||s.start(l,m),c.streams&&0<c.streams.length){var a=c.streams[0];if(c.streamsWildcardTokenCapabilities&&!k.includes(c.streams[0].uri,T.getPCastPrefix())&&(c.streams[0].uri=T.getPCastPrefix()+c.streams[0].uri,d.bs.push(c.streams[0].uri)),c.streamsWildcardTokenCapabilities&&n&&!k.includes(a.uri,"streamToken"))return b.call(d,c,a,n,function(t,e){if(h(t,k.assign({roomService:s},e)),f)return r()});var u=!c.streamsWildcardTokenCapabilities||n||k.includes(a.uri,"streamToken")?c.role:g.roles.audience.name;(function(t,e,i,n){var r=i?i.getObservableActiveRoom().getValue():null;if(t&&i&&i.getSelf().setStreams(t),e&&i&&i.getSelf().getObservableRole().setValue(0===t.length?g.roles.audience.name:e),r&&i.getSelf())return O.call(this,i.getSelf(),n)}).call(d,c.streams,u,s,function(t){if(t)return h(t)})}if(n)return h(null,{status:"ok",roomService:s}),void(f&&r());s.enterRoom(c.roomId,c.alias,function(t,e){if(t)return s.stop("enter-room-failure"),h(t);if("not-found"===e.status)return s.stop("enter-room-failure"),h(null,{status:"room-not-found"});if("ok"!==e.status&&"already-in-room"!==e.status)return s.stop("enter-room-failure"),h(null,e);var i=e.room,n=k.get(c,["streams",0]);return d.Ss.push(s),c.streamsWildcardTokenCapabilities&&n&&!k.includes(n.uri,"streamToken")?b.call(d,c,n,i,function(t,e){if(h(t,k.assign({roomService:s},e)),f)return r()}):(h(null,{status:"ok",roomService:s}),f?r():void 0)})})}function f(e,t){this.ks[t.getRoomId()]&&e&&(this.ks[t.getRoomId()]=k.filter(this.ks[t.getRoomId()],function(t){return t.getStreamId()!==e.getStreamId()}))}function d(t,e,i,n){var r=function(t,e,i){var n=t.getStream(),r=n?n.getAudioTracks():null,s=n?n.getVideoTracks():null,o=0<r.length&&r[0].enabled,a=0<s.length&&s[0].enabled,u={uri:T.getPCastPrefix()+t.getStreamId(),type:e,audioState:o?I.states.trackEnabled.name:I.states.trackDisabled.name,videoState:a?I.states.trackEnabled.name:I.states.trackDisabled.name},c=k.assign({},i,{streamToken:void 0,streamTokenForBroadcastStream:void 0,streamTokenForLiveStream:void 0});delete c.streamToken,delete c.streamTokenForBroadcastStream,delete c.streamTokenForLiveStream;var h=k.reduce(c,function(t,e,i){return t+(t?"&":"?")+i+"="+e},"");return 0<h.length&&(u.uri=u.uri+h),u}(e,t.streamType,t.streamInfo);if(r=C(r,"capabilities",t.capabilities.join(",")),t.enableWildcardCapability)return b.call(this,t,r,i,n);var s=w.call(this,i.getRoomId(),i.getObservableAlias().getValue()),o=k.assign({},t,{streams:P.call(this,r,i)});return D.call(this,o.streams,o.memberRole,s,i,o,n)}function b(u,c,r,h){var f,d=this,t="high-availability"===u.viewerStreamSelectionStrategy&&r.getObservableType().getValue()===v.types.channel.name,l=[],s=h,m=T.parsePCastStreamIdFromStreamUri(k.get(c,"uri","")),e=d.getPCastExpress().getPCast().getProtocol(),i=e?e.getSessionId():"",n=d.Es[m];if(k.includes(c,"capabilities")||(c=C(c,"capabilities",u.capabilities.join(","))),t){var o=p.getSimilarMembers(u.screenName,i,r.getObservableMembers().getValue());l=x(o),s=function(t,e){h(t,e);var o=k.get(e,"roomService",w.call(d,r.getRoomId(),r.getObservableAlias().getValue()));if(!t&&"ok"===e.status&&!f&&o){var a=o.getObservableActiveRoom().getValue();f=a.getObservableMembers().subscribe(function(t){var e=o.getSelf(),i=e?e.getSessionId():"",n=x(p.getSimilarMembers(u.screenName,i,t)),r=n.length===l.length&&k.reduce(n,function(t,e){return t?k.includes(l,e):t},!0),s=e?e.getObservableStreams().getValue():[];if(!k.find(s,function(t){return t.getPCastStreamId()===m}))return f.dispose(),void(f=null);r||(d.Pt.debug("Members with similar content to stream [%s] have changed. Generating new wildcard viewer token",m),f.dispose(),f=null,b.call(d,u,c,a,function(t,e){!t&&"ok"===e.status||h(t,e)}))}),n&&n.add(f)}}}return function(t,e,i,n,r){function s(){k.forEach(a,function(t){t.dispose()})}function o(t,e){if(!c){if(t||"ok"!==e.status)return s(),c=!0,r(t,e);++u===a.length&&r(null,{status:"ok"})}}var a=[],u=0,c=!1;this.Pt.debug("Creating [real-time] and [broadcast] viewer wildcard stream token for published stream [%s] with [%s] additional streams",e,i.length),a.push(M.call(this,[],e,i,n,"streamToken",o)),a.push(M.call(this,["broadcast"],e,i,n,"streamTokenForBroadcastStream",o));var h=k.filter(t,k.bind(k.includes,null,y));return 0<h.length&&(this.Pt.debug("Creating [%s] viewer wildcard stream token for published stream [%s] with [%s] additional streams",h,e,i.length),a.push(M.call(this,h,e,i,n,"streamTokenForLiveStream",o))),k.includes(t,"drm")&&(this.Pt.debug("Creating [drm-open-access] and [drm-hollywood] viewer wildcard stream token for published stream [%s] with [%s] additional streams",e,i.length),a.push(M.call(this,["streaming","drm-open-access"],e,i,n,"streamTokenForLiveStreamWithDrmOpenAccess",o)),a.push(M.call(this,["streaming","drm-hollywood"],e,i,n,"streamTokenForLiveStreamWithDrmHollywood",o))),s}.call(this,u.capabilities,m,l,c,function(t,e){if(t)return h(t);if("ok"!==e.status)return h(null,e);var i=w.call(d,r.getRoomId(),r.getObservableAlias().getValue()),n=k.assign({},u,{streams:P.call(d,c,r)});return D.call(d,n.streams,n.memberRole,i,r,n,s)})}function M(t,e,i,n,r,s){return this.gs.getAdminAPI().createStreamTokenForSubscribing("*",t,e,i,function(t,e){return t?s(t):"ok"!==e.status?s(null,e):(n=C(n,r,e.streamToken),void s(null,e))})}function C(t,e,i){var n=t.uri.indexOf("?"),r=-1<n?"&":"?",s=t.uri.indexOf("#",-1===n?t.uri.length:n),o=-1===s?t.uri:t.uri.substring(0,s),a=-1===s?"":t.uri.substring(s);return t.uri=o+r+e+"="+i+a,t}function x(t){return k.reduce(t,function(t,e){var i=k.get(e.getObservableStreams().getValue(),"0"),n=i?i.getPCastStreamId():"";return n&&t.push(n),t},[])}function P(o,t){var e=this,i=w.call(this,t.getRoomId(),t.getObservableAlias().getValue()),n=o?[o]:[];if(!i)return n;var r=i.getSelf();if(!r)return n;var s=k.map(r.getObservableStreams().getValue(),function(t){return t.toJson()}),a=this.ks[t.getRoomId()]||[],u=k.map(a,function(t){return t.getStreamId()});return s&&0!==s.length?(o&&(s=k.filter(s,function(t){var e=t.uri===o.uri,i=T.parsePCastStreamIdFromStreamUri(t.uri),n=!!i&&i===T.parsePCastStreamIdFromStreamUri(o.uri),r=o.uri.split("?")[0]===t.uri.split("?")[0],s=t.type===o.type;return!e&&!n&&!r||!s})).push(o),k.filter(s,function(t){return!T.parsePCastStreamIdFromStreamUri(t.uri)||k.includes(u,T.parsePCastStreamIdFromStreamUri(t.uri)||t.uri)||k.includes(e.bs,t.uri.split("?")[0])})):n}function D(t,e,i,n,r,s){var o=w.call(this,n.getRoomId(),n.getObservableAlias().getValue()),a=i?i.getObservableActiveRoom().getValue():null,u=!a&&!o;if(this.rr)return this.Pt.warn("Unable to update self after express room service disposal.");if(t&&o&&(this.Pt.debug("Preparing member streams for update in room [%s].",n.getRoomId()),o.getSelf().setStreams(t)),e&&o&&o.getSelf().getObservableRole().getValue()!==e&&(this.Pt.debug("Preparing member role for update in room [%s].",n.getRoomId()),o.getSelf().getObservableRole().setValue(e)),a&&o.getSelf())return O.call(this,o.getSelf(),s);if(u){this.Pt.info("Joining room with member [%s].",n.getRoomId());var c=k.assign({role:e,alias:k.get(r,["room","alias"]),roomId:k.get(r,["room","roomId"])},r);h.call(this,c,function(t,e){return t?s(t):"ok"!==e.status&&"already-in-room"!==e.status?s(null,e):void s(t,e)})}}function O(s,o){var a=0,u=this;try{s.commitChanges(function t(e,i){e&&a++;var n=s.getRoomService(),r=n?n.getObservableActiveRoom().getValue():null;return i&&"ok"===i.status||!r&&"not-found"===i.status?(a=0,!o||o(null,i)):(i&&"ok"!==i.status&&a++,5<=a?(u.Pt.warn("Unable to update self after [%s] attempts.",5),k.re(i.lastUpdate)&&(u.Pt.warn("Updating self last update from [%s] to [%s] to prevent permanent failure state. Our awareness of self does not match up with the server anymore.",s.getObservableLastUpdate().getValue(),i.lastUpdate),s.getObservableLastUpdate().setValue(i.lastUpdate)),o(new Error("Unable to update self"))):0<a&&a<5?(u.Pt.info("Unable to update self after [%s] attempts. Retrying.",a),s.commitChanges(t)):void 0)})}catch(t){o(t)}}function l(t,e,i){return e?t(e):i.retry?i.retry():void t(e,i)}return n.prototype.dispose=function(){this.rr=!0,function(){k.forOwn(this.ks,function(t){k.forEach(t,function(t){t.stop("dispose")})}),k.forOwn(this.ws,function(t){t.stop("dispose")}),this.ks={},this.bs=[],this.ws={},this.Ss=[]}.call(this),this.ys&&this.gs.dispose(),this.g.dispose(),this.Pt.info("Disposed Room Express Instance")},n.prototype.getPCastExpress=function(){return this.gs},n.prototype.createRoom=function(r,s){S.Ct(s,"callback"),S.xt(r.room,"options.room"),S.Nt(r.room.name,"options.room.name"),S.Nt(r.room.type,"options.room.type"),r.room.description&&S.Nt(r.room.description,"options.room.description");var o=r.room.description||function(){switch(r.room.type){case v.types.channel.name:return"Room Channel";case v.types.moderatedChat.name:return"Moderated Chat";case v.types.multiPartyChat.name:return"Multi Party Chat";case v.types.townHall.name:return"Town Hall";case v.types.directChat.name:return"Direct Chat";default:throw new Error("Unsupported Room Type")}}();a.call(this,null,null,function(t,e){if(t)return s(t);if("ok"!==e.status)return s(null,e);var i=e.roomService,n=k.assign({},r.room);n.description||(n.description=o),i.createRoom(n,function(t,e){return t?s(t):(i.stop("create"),s(null,e))})})},n.prototype.joinRoom=function(t,s,e){function i(r){r&&h.call(n,t,function(t,e){var i=e;if(i&&i.roomService){var n=i.roomService.leaveRoom;i.roomService.leaveRoom=function(t){o&&"offline"!==r.getObservableStatus()&&o.dispose(),n(t)}}s(t,e)},e)}S.xt(t,"options"),S.Ct(s,"joinRoomCallback"),S.Nt(t.role,"options.role"),e&&S.Ct(e,"membersChangedCallback"),t.screenName&&S.Nt(t.screenName,"options.screenName"),t.roomId&&S.Nt(t.roomId,"options.roomId"),t.alias&&S.Nt(t.alias,"options.alias"),t.streams&&S.isArray(t.streams,"options.streams");var n=this;if(this.gs.getPCastObservable())return i(this.gs.getPCastObservable());var o=this.gs.getPCastObservable().subscribe(i)},n.prototype.publishToRoom=function(o,a){S.xt(o,"options"),S.Ct(a,"callback"),S.xt(o.room,"options.room"),o.streamUri?S.Nt(o.streamUri,"options.streamUri"):o.mediaConstraints?S.xt(o.mediaConstraints,"options.mediaConstraints"):S.xt(o.userMediaStream,"options.userMediaStream"),o.videoElement&&S.xt(o.videoElement,"options.videoElement"),o.screenName&&S.Nt(o.screenName,"options.screenName"),o.capabilities&&S.isArray(o.capabilities,"options.capabilities"),o.tags&&S.isArray(o.tags,"options.tags"),o.streamInfo&&S.xt(o.streamInfo,"options.streamInfo"),o.viewerStreamSelectionStrategy&&S.Nt(o.viewerStreamSelectionStrategy,"options.viewerStreamSelectionStrategy"),k.isUndefined(o.enableWildcardCapability)&&(o.enableWildcardCapability=!0),S.De(o.streamType,i.types,"options.streamType"),S.De(o.memberRole,g.roles,"options.memberRole"),S.hn(o.enableWildcardCapability,"options.enableWildcardCapability");var u=this,c=o.screenName||k.uniqueId();this.createRoom(o,function(t,n){if(t)return a(t);if("ok"!==n.status&&"already-exists"!==n.status)return a(null,n);var e=n.room,r=k.assign({monitor:{callback:k.bind(l,u,a),options:{conditionCountForNotificationThreshold:8}},streamInfo:{}},o);if(e.getObservableType().getValue()===v.types.channel.name?r.tags=["channelId:"+e.getRoomId(),"channelAlias:"+e.getObservableAlias().getValue()].concat(r.tags||[]):r.tags=["roomId:"+e.getRoomId(),"roomAlias:"+e.getObservableAlias().getValue()].concat(r.tags||[]),o.streamUri){var i=k.assign({connectOptions:[]},r);return k.find(i.connectOptions,function(t){return k.startsWith(t,"room-id")})||(i.connectOptions=i.connectOptions.concat(["room-id="+e.getRoomId(),"member-role="+o.memberRole,"member-stream-type="+o.streamType,"screen-name="+c])),o.enableWildcardCapability&&i.connectOptions.concat(["member-stream-token-type=Wildcard","member-stream-token-refresh-interval="+3e5]),u.gs.publishRemote(i,function(t,e){a(t,e?k.assign({roomService:null},e):e)})}var s=k.assign({},o,{role:g.roles.audience.name,roomId:e.getRoomId()});h.call(u,s,function(t,i){if(t)return a(t);if("ok"!==i.status&&"already-in-room"!==i.status)return a(null,n);var e=i.roomService.getObservableActiveRoom().getValue();(function(r,s,i){function o(t,e){i(t,e?k.assign({publisher:a},e):e)}function t(t,e){if(u&&a&&clearInterval(u),t)return o(t);if("ok"!==e.status)return o(null,e);(function(t,e){this.ks[e.getRoomId()]||(this.ks[e.getRoomId()]=[]),this.ks[e.getRoomId()].push(t)}).call(c,e.publisher,s),f.call(c,a,s),a=e.publisher,c.Es[a.getStreamId()]=new E.DisposableList;var n=k.bind(a.stop,a);a.stop=function(){clearInterval(u),f.call(c,a,s);var t=P.call(c,null,s),e=w.call(c,s.getRoomId()),i=c.Es[a.getStreamId()];i&&(i.dispose(),delete c.Es[a.getStreamId()]),n.apply(a,arguments),e&&D.call(c,t,0===t.length?g.roles.audience.name:r.memberRole,e,s,r,function(t){if(t)return o(t)})},function(o,a){var u=this,e=u.Es[o.getStreamId()],c=o.getStream();if(c){var t=c.getTracks();k.forEach(t,function(s){function t(){var t=s.enabled?I.states.trackEnabled.name:I.states.trackDisabled.name,e=w.call(u,a.getRoomId());if(e&&e.getSelf()){var i=e.getSelf().getObservableStreams().getValue(),n=k.find(i,function(t){return t.getPCastStreamId()===o.getStreamId()}),r=function(n){var t=k.find(this.Ss,function(t){var e=t.getSelf(),i=e?e.getObservableStreams().getValue():[];return k.find(i,function(t){return n===t})});return t?t.getSelf():null}.call(u,n);if(!n)return u.Pt.warn("[%s] [%s] Unable to update member state change after track state change [%s]. Member stream no longer exists on member model.",c.id,s.id,s.enabled);u.Pt.info("[%s] [%s] Track state changed to [%s], updating room member stream state [%s]",c.id,s.id,s.enabled,t),"video"===s.kind?n.getObservableVideoState().setValue(t):n.getObservableAudioState().setValue(t),r&&O.call(u,r)}}k.addEventListener(s,"StateChange",t),e.add(new E.Disposable(function(){k.removeEventListener(s,"StateChange",t)}))})}}.call(c,a,s),r.enableWildcardCapability&&(u=setInterval(function(){c.Pt.info("Refresh wildcard viewer stream token for [%s] interval of [%s] has expired. Creating new token.",a.getStreamId(),3e5);var t=w.call(c,s.getRoomId(),s.getObservableAlias().getValue()),e=t?t.getObservableActiveRoom().getValue():s;d.call(c,r,a,e,function(t,e){!t&&"ok"===e.status||o(t,e)})},3e5),c.g.add(new E.Disposable(function(){clearInterval(u)}))),d.call(c,r,e.publisher,s,o)}var a,u,c=this;if(k.get(r,["mediaConstraints","screen"],!1))return k.set(r,["streamInfo","isScreen"],!0),this.gs.publishScreen(r,t);this.gs.publish(r,t)}).call(u,r,e,function(t,e){a(t,e?k.assign({roomService:i.roomService},e):e)})})})},n.prototype.publishScreenToRoom=function(t,e){var i=k.assign({mediaConstraints:{screen:!0}},t);this.publishToRoom(i,e)},n.prototype.subscribeToMemberStream=function(i,r,s,o){if(S.xt(i,"memberStream"),S.xt(r,"options"),S.Ct(s,"callback"),o=k.re(o)?o:0,r.capabilities)throw new Error("subscribeToMemberStream options.capabilities is deprecated. Please use the constructor features option");var t,e,a=this,n=i.getUri(),u=i.getPCastStreamId(),c=i.getInfo(),h=k.get(c,["isScreen"],!1),f=null,d=c.capabilities||(t=n,e=[],T.getInfoFromStreamUri(t).streamTokenForLiveStream&&e.push("streaming"),e)||[],l=this.Rn.getPreferredFeatureFromPublisherCapabilities(d),m=R.mapFeatureToPCastCapability(l),p=m?[m]:[],v=this.Rn.getFeaturePCastCapabilities(),g=!1;if(!u)throw this.Pt.error("Invalid Member Stream. Unable to parse streamId from uri"),new Error("Invalid Member Stream. Unable to parse streamId from uri");if(k.hasIndexOrKey(c,"capabilities")){if(!l)return this.Pt.warn("Unable to find supported feature. Publisher capabilities [%s]. Requested feature capabilities [%s]",c.capabilities,v),s(null,{status:"unsupported-features"});f=function(t,e){var i=T.getInfoFromStreamUri(t);switch(e){case"rtmp":case"hls":case"dash":return i.streamTokenForLiveStream;case"real-time":return i.streamToken;default:return}}(n,l)}else{if(!l){var y=k.get(v,[o]);if(!y&&o>=v.length)return s(null,{status:"no-supported-features"});p=y?[y]:[],l=y?k.get(R.mapPCastCapabilityToFeatures(y),[0]):null}if(!c.streamTokenForLiveStream&&"streaming"===m)return this.Pt.warn("Streaming is not available for stream [%].",u),s(null,{status:"streaming-not-available"});f=function(t,e){var i=T.getInfoFromStreamUri(t),n=i.streamTokenForLiveStream&&k.includes(e,"streaming"),r=i.streamTokenForLiveStream&&k.includes(e,"rtmp");if(!k.includes(e,"drm-open-access")||!k.includes(e,"drm-hollywood"))return n&&i.streamTokenForLiveStreamWithDrmOpenAccess&&(k.includes(e,"drm-open-access")||R.isAndroid())?i.streamTokenForLiveStreamWithDrmOpenAccess:n&&i.streamTokenForLiveStreamWithDrmHollywood&&k.includes(e,"drm-hollywood")?i.streamTokenForLiveStreamWithDrmHollywood:n||r?i.streamTokenForLiveStream:i.streamTokenForBroadcastStream&&k.includes(e,"broadcast")?i.streamTokenForBroadcastStream:k.includes(e,"streaming")||k.includes(e,"broadcast")||k.includes(e,"rtmp")?void 0:i.streamToken}(n,p),g=!0}this.Pt.info("Subscribing to member stream with feature [%s] and pre-generated token [%s]",l,!!f);var w=k.assign({},{streamId:u,streamToken:f,capabilities:p},r),b=new E.DisposableList;(function(t,e,s){function i(t,e){if(t)return s(t);if("ok"!==e.status&&"streaming-not-ready"!==e.status)return s(null,e);if(a++,"streaming-not-ready"===e.status&&a<3){var i=a*a*1e3;o.Pt.info("Waiting for [%s] ms before retrying after [streaming-not-ready] status.",i);var n=setTimeout(e.retry,i);o.g.add(new E.Disposable(function(){clearTimeout(n)}))}else{if("streaming-not-ready"===e.status&&3<=a)return s(null,{status:e.status});var r=k.assign({},e,{status:"ok"});if(1<a)return r.reason="stream-failure-recovered",s(null,r);s(null,r)}}var o=this,a=0;return e?o.gs.subscribeToScreen(t,i):o.gs.subscribe(t,i)}).call(this,w,h,function(t,n){if(b.dispose(),n&&"ok"===n.status&&n.mediaStream&&n.mediaStream.getStream()&&(b.add(i.getObservableAudioState().subscribe(function(t){var e=n.mediaStream.getMonitor(),i=n.mediaStream.getStream().getAudioTracks();e&&1===i.length&&e.setMonitorTrackState(i[0],t===I.states.trackEnabled.name)},{initial:"notify"})),b.add(i.getObservableVideoState().subscribe(function(t){var e=n.mediaStream.getMonitor(),i=n.mediaStream.getStream().getVideoTracks();e&&1===i.length&&e.setMonitorTrackState(i[0],t===I.states.trackEnabled.name)},{initial:"notify"}))),t&&6===parseInt(t.category))return s(t,{status:"device-insecure"});if(n&&("failed"===n.status||"streaming-not-available"===n.status)&&g&&o<v.length)return a.Pt.info("Attempting to subscribe to member stream with next available feature after failure"),a.subscribeToMemberStream(i,r,s,o+1);var e=k.assign({originStreamId:u},n);s(t,e)})},n}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(o,n){"use strict";var a="most-recent";function t(t,e,i){t&&n.Nt(t,"selectionStrategy"),n.xt(e,"logger"),this.Ts=t||a,this.Pt=e,this.Is=o.get(i,["failureCountForBanningAMember"],1e3),this.Rs=o.get(i,["banMemberOnCapacityFailureCount"],5),this.reset()}function u(t){return t?t.getSessionId()+t.getObservableScreenName().getValue():""}function c(t){return f(t.getObservableScreenName().getValue())}function h(t){return d(t.getObservableScreenName().getValue())}function f(t){return/primary/i.test(t)}function d(t){return/alternate/i.test(t)}return t.prototype.getNext=function(t){this.Pt.info("Select member from [%s]",t);var e=function(t){var e,n=this;switch(this.Ts){case a:return e=o.reduce(t,function(t,e){var i=u(e);return o.get(n.Ms,[i],!1)||t.push(e),t},[]),o.reduce(e,function(t,e){return t&&t.getLastUpdate()>e.getLastUpdate()?t:e});case"high-availability":if(this.Cs&&o.includes(t,this.Cs))return this.Cs;var r=void 0,s=Number.MAX_VALUE;return o.forEach(t,function(t){var e=u(t);if(!o.get(n.Ms,[e],!1)){var i=o.get(n.xs,[t],0);i<s?(s=i,r=t):i===s&&(r?c(t)?c(r)||(r=t):h(t)&&(c(r)||h(r)||(r=t)):r=t)}}),r;default:throw new Error("Invalid Selection Strategy")}}.call(this,t);return e?this.Pt.info("Selecting new member [%s]/[%s]",e.getSessionId(),e.getObservableScreenName().getValue()):this.Pt.info("Unable to select new member from [%s]",t),this.Cs=e},t.prototype.getStrategy=function(){return this.Ts},t.prototype.markFailed=function(t){if(this.Cs){var e=u(this.Cs);if(o.get(t,["failedDueToCapacity"],!1)){var i=o.get(this.Ps,[e],0);if(i++,o.set(this.Ps,[e],i),i>=this.Rs)return this.Pt.info("Disabling member [%s] that has exceeded threshold due to [%s] capacity failures",e,i),this.markDead()}var n=o.get(this.xs,[e],0);if(n++,this.Pt.info("Failure count for member [%s] is now [%s]",e,n),o.set(this.xs,[e],n),n>=this.Is)return this.Pt.info("Disabling member [%s] that has exceeded threshold due to [%s] failures",e,n),this.markDead();this.Cs=null}else this.Pt.warn("Marking failed member but there was no recent selected member")},t.prototype.markDead=function(){if(this.Cs){var t=u(this.Cs);this.Pt.info("Member [%s] is now permanently removed",t),o.set(this.Ms,[t],!0),this.Cs=null}else this.Pt.warn("Marking dead member but there was no recent selected member")},t.prototype.getNumberOfMembersWithFailures=function(){return o.keys(this.xs).length},t.prototype.reset=function(){this.Cs=null,this.xs={},this.Ps={},this.Ms={}},t.prototype.dispose=function(){this.reset()},t.getSimilarMembers=function(e,i,t){var n=o.filter(t,function(t){return t.getObservableScreenName().getValue()!==e&&(!i||t.getSessionId()!==i)}),r=o.filter(n,c),s=o.filter(n,h);return f(e)?r||s||n:d(e)?s||r||n:n||r||s},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(t,e){"use strict";function i(t){e.xt(t,"room"),this.Ds=t}return i.prototype.getChannelId=function(){return this.Ds.getRoomId.apply(this.Ds,arguments)},i.prototype.getObservableAlias=function(){return this.Ds.getObservableAlias.apply(this.Ds,arguments)},i.prototype.getObservableName=function(){return this.Ds.getObservableName.apply(this.Ds,arguments)},i.prototype.getObservableDescription=function(){return this.Ds.getObservableDescription.apply(this.Ds,arguments)},i.prototype.getObservableType=function(){return this.Ds.getObservableType.apply(this.Ds,arguments)},i.prototype.getObservableMembers=function(){return this.Ds.getObservableMembers.apply(this.Ds,arguments)},i.prototype.getObservableBridgeId=function(){return this.Ds.getObservableBridgeId.apply(this.Ds,arguments)},i.prototype.getObservablePin=function(){return this.Ds.getObservablePin.apply(this.Ds,arguments)},i.prototype.toString=function(){return this.Ds.toString.apply(this.Ds,arguments)},i.prototype.toJson=function(){return{channelId:this.Ds.getRoomId(),alias:this.Ds.getObservableAlias().getValue(),name:this.Ds.getObservableName().getValue(),description:this.Ds.getObservableDescription().getValue(),type:this.Ds.getObservableType().getValue(),pin:this.Ds.getObservablePin().getValue(),bridgeId:this.Ds.getObservableBridgeId().getValue()}},i.prototype.commitChanges=function(){return this.Ds.commitChanges.apply(this.Ds,arguments)},i.prototype.reload=function(){return this.Ds.reload.apply(this.Ds,arguments)},i.prototype.an=function(){return this.Ds.an.apply(this.Ds,arguments)},i.prototype.Ar=function(){return this.Ds.Ar.apply(this.Ds,arguments)},i.prototype.Or=function(){return this.Ds.Or.apply(this.Ds,arguments)},i.prototype.qr=function(){return this.Ds.qr.apply(this.Ds,arguments)},i}.apply(e,n))||(t.exports=r)},function(t,e,i){"use strict";var n,r;n=[i(3),i(9),i(27),i(37),i(101),i(105),i(42),i(43),i(45),i(109),i(44)],void 0===(r=function(t,e,i,n,r,s,o,a,u,c,h){return{express:{PCastExpress:a,RoomExpress:u,ChannelExpress:c},lowLevel:{PCast:t.global.PhenixPCast=i,RoomService:n},media:{AudioSpeakerDetector:r,UserMediaResolver:o},net:{AdminApiProxyClient:h},utils:{BandwidthMonitor:s,logging:e,rtc:t},AudioSpeakerDetector:r,BandwidthMonitor:s,logging:e,PCast:i,RoomService:n,RTC:t,UserMediaResolver:o}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";function a(){}a.clone=function(t){return a.isArray(t)?t.slice():a.xt(t)?a.assign({},t):t},a.get=function(t,e,i){if(a.isNullOrUndefined(t))return i;o(t,"objectToTraverse");var n=e;if(a.Yt(n))n=h(e);else if(!a.isArray(n))throw new Error("Unsupported path type "+typeof e);var r=a.reduce(n,function(t,e){if(a.xt(t)||a.isArray(t))return t[e]},t);return a.isUndefined(r)?i:r},a.set=function(t,e,i){if(!a.xt(t))return t;o(t,"objectToTraverse");var n=t,r=e;if(a.Yt(r))r=h(e);else if(!a.isArray(r))throw new Error("Unsupported path type "+typeof e);return a.forEach(r,function(t,e){!function(t,e,i){if(a.re(parseInt(e))&&a.isArray(t))return t[e]=i;if(a.Yt(e)&&a.xt(t))return t[e]=i;throw new Error("Unsupported type "+typeof e+" when setting property or index")}(n,t,function(t,e,i,n){if(t.length-1===e)return n;var r=t[e],s=t[e+1];if(a.isArray(i[r])||a.xt(i[r]))return i[r];if(!a.isArray(i[r])&&a.re(parseInt(s)))return[];if(!a.xt(i[r])&&a.Yt(s))return{};throw new Error("Unsupported type "+typeof r+" when setting property or index")}(r,e,n,i)),n=n[t]}),t},a.bind=function(e,i){var n=Array.prototype.slice.call(arguments,2);return function(){if(!a.Ct(e))throw new TypeError("_.bind - callback must be a function. Received ["+typeof e+"]");var t=n.concat(Array.prototype.slice.call(arguments));return e.apply(i,t)}},a.now=function(){return(new Date).getTime()},a.utc=function(t){return a.re(t)?t:t?Math.floor(t):NaN},a.isoString=function(){var t=new Date;return t.toISOString?t.toISOString():t.getUTCFullYear()+"-"+a.pad(t.getUTCMonth()+1,2)+"-"+a.pad(t.getUTCDate(),2)+"T"+a.pad(t.getUTCHours(),2)+":"+a.pad(t.getUTCMinutes(),2)+":"+a.pad(t.getUTCSeconds(),2)+"."+(t.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},a.map=function(t,i){o(t,"collection");var n=[];return t.constructor===Array?a.forEach(t,function(t,e){a.Yt(i)&&a.xt(t)?n.push(t[i]):a.Ct(i)&&n.push(i(t,e))}):a.forOwn(t,function(t,e){a.Ct(i)&&n.push(i(t,e))}),n},a.values=function(t){if(!a.xt(t)||a.isArray(t))throw new Error("_.values argument, Collection, must be an object. Received ["+typeof t+"]");return a.map(t,function(t){return t})},a.keys=function(t){if(!a.xt(t)||a.isArray(t))throw new Error("_.keys argument, Collection, must be an object. Received ["+typeof t+"]");return a.map(t,function(t,e){return e})},a.forEach=function(t,e){if(!a.Ct(e))throw new Error("_.forEach argument, Callback, must be a function. Received ["+typeof e+"]");s(t,"collection");for(var i=0;i<t.length;i++)if(!1===e(t[i],i))return},a.forOwn=function(t,e){if(!a.Ct(e))throw new Error("Callback must be a function. Received ["+typeof e+"]");o(t,"objectWithProperties");for(var i=Object.keys(t),n=0;n<i.length;n++){var r=i[n];if((t.hasOwnProperty(r)||Object.prototype.hasOwnProperty.call(t,r))&&!1===e(t[r],r))return}},a.argumentsToArray=function(t){if(!a.xt(t)||!t.length)throw new Error("Collection must be arguments. Received ["+typeof t+"]");for(var e=[],i=0;i<t.length;i++)e.push(t[i]);return e},a.assign=function(i){a.isNullOrUndefined(i)&&(i={}),o(i,"target");var t=a.argumentsToArray(arguments);return t.shift(),a.forEach(t,function(t,e){a.isNullOrUndefined(t)||(o(t,"_.assign(sources["+e+"])"),a.forOwn(t,function(t,e){i[e]=t}))}),i},a.includes=function(t,e){if(a.Yt(t))return c(e,"Includes value and search parameter"),-1<t.indexOf(e);if(a.isUndefined(t)||a.isUndefined(e))return!1;function i(t){if(t===e)return!(n=!0)}o(t,"collection");var n=!1;return t.constructor===Array?a.forEach(t,i):a.forOwn(t,i),n},a.reduce=function(t,i,e){o(t,"collection");var n=e===a.noop()?null:e;return t.constructor===Array?a.forEach(t,function(t,e){n=i(n,t,e)}):a.forOwn(t,function(t,e){n=i(n,t,e)}),n},a.sample=function(t){return s(t,"collection"),t[Math.floor(Math.random()*t.length)]},a.uniqueId=function(){return(a.now()*Math.random()).toString()},a.find=function(t,i,n){s(t,"collection");var r=void 0;return a.forEach(t,function(t,e){if(i(t)&&(n||0)<=e)return r=t,!1}),r},a.findIndex=function(t,i,n){s(t,"collection");var r=-1;return a.forEach(t,function(t,e){if(i(t,e)&&(n||0)<=e)return r=e,!1}),r},a.filter=function(t,e){s(t,"collection");var i=[];return a.forEach(t,function(t){e(t)&&i.push(t)}),i},a.remove=function(t,e){return s(t,"collection"),a.filter(t,function(t){return!e(t)})},a.take=function(t,e){return s(t,"collection"),t.slice(0,e)},a.hasDifferences=function(t,e,i){return 0<a.findDifferences(t,e,i).length},a.findDifferences=function(i,n,r){var s=[],o={};function t(t,e){o[e]=1,(a.xt(t)||a.isArray(t))&&r?a.hasIndexOrKey(n,e)&&a.sameTypes(i[e],n[e])?a.hasDifferences(i[e],n[e],r)&&s.push(e):s.push(e):i[e]!==n[e]&&s.push(e)}if(a.isArray(i)&&a.isArray(n))i.length>n.length?a.forEach(i,t):a.forEach(n,t);else{if(!a.xt(i)||!a.xt(n)||a.isArray(i)||a.isArray(n))throw new Error("Object types do not match");a.forOwn(i,t),a.forOwn(n,function(t,e){o.hasOwnProperty(e)||s.push(e)})}return s},a.hasIndexOrKey=function(t,e){return a.isArray(t)?t.length>parseInt(e):!!a.xt(t)&&t.hasOwnProperty(e)},a.startsWith=function(t,e){return c(t,"value"),c(e,"prefix"),0===t.indexOf(e)},a.endsWith=function(t,e){c(t,"value"),c(e,"postfix");var i=t.length-e.length;return t.indexOf(e,i)===i},a.sameTypes=function(t,e){return a.isNullOrUndefined(t)||a.isNullOrUndefined(e)?a.isNullOrUndefined(t)&&a.isNullOrUndefined(e):a.isArray(t)||a.isArray(e)?a.isArray(t)&&a.isArray(e):typeof t==typeof e},a.freeze=function(t){return"freeze"in Object?Object.freeze(t):t},a.noop=function(){},a.xt=function(t){return null!==t&&"object"==typeof t},a.isArray=function(t){return!!a.xt(t)&&t.constructor===Array},a.Yt=function(t){return"string"==typeof t},a.re=function(t){return!isNaN(t)&&"number"==typeof t},a.hn=function(t){return"boolean"==typeof t},a.Ct=function(t){return"function"==typeof t},a.isNullOrUndefined=function(t){return null===t||a.isUndefined(t)},a.isUndefined=function(t){return void 0===t},a.getEnumName=function(t,e){var i=null,n=a.map(t,function(t){return t});return a.re(e)?i=a.find(n,function(t){return t.id===e}):a.Yt(e)&&(i=a.find(n,function(t){return t.name.toLowerCase()===e.toLowerCase()})),i?i.name:null},a.toString=function(t){if(a.Yt(t))return t;if(a.hn(t))return t?"true":"false";if(a.re(t))return t.toString();var e="";if(t)if(a.Ct(t.toString))e=t.toString();else if(a.xt(t.toString))try{e=t.toString()}catch(t){e="[object invalid toString()]"}if(0!==e.indexOf("[object"))return e;var i=[];return e+JSON.stringify(t,function(t,e){if(a.xt(e)&&!a.isNullOrUndefined(e)){if(a.includes(i,e))return"<recursive>";i.push(e)}return""===t?e:a.toString(e)})},a.pad=function(t,e){r(t,"value"),r(e,"numberToPad");for(var i=t.toString().length,n=0;n<e-i;n++)t="0"+t.toString();return t.toString()},a.addEventListener=function(t,e,i,n){o(t,"target"),c(e,"eventName"),u(i,"listener"),t.phenixAddEventListener?t.phenixAddEventListener.call(t,e,i,!!n):t.addEventListener?t.addEventListener(e,i,!!n):t.attachEvent&&t.attachEvent("on"+e,i)},a.removeEventListener=function(t,e,i,n){o(t,"target"),c(e,"eventName"),u(i,"listener"),t.phenixRemoveEventListener?t.phenixRemoveEventListener.call(t,e,i,!!n):t.removeEventListener?t.removeEventListener(e,i,!!n):t.detachEvent&&t.detachEvent("on"+e,i)};var s=function(t){if(!a.isArray(t))throw new Error("Input must be an array. Received ["+typeof t+"]")},r=function(t,e){if(c(e,"name"),!a.re(t))throw new Error(e+" must be a number. Received ["+typeof t+"]")},o=function(t,e){if(c(e,"name"),!a.xt(t))throw new Error("collection type not supported - "+e+" must be an array or object. Received ["+typeof t+"]")},u=function(t,e){if(c(e,"name"),!a.Ct(t))throw new Error(e+" must be a function. Received ["+typeof t+"]")},c=function(t,e){if(!a.Yt(e))throw new Error("Name must be a string. Received ["+typeof e+"]");if(!a.Yt(t))throw new Error(e+" must be a string. Received ["+typeof t+"]")};function h(t){var e=t.split("."),i=[];return a.forEach(e,function(t){i=i.concat(function(t){for(var e="",i=[],n=0,r=0;r<t.length;r++)if("["===t[r]){if(n++,!a.Yt(e)||1<n)return[t];e&&(i.push(e),e="")}else if("]"===t[r]){if(0!=--n)return[t];i.push(e),e=""}else{if(r===t.length-1)return[t];e+=t[r]}return i}(t))}),i}return a}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(0)],void 0===(r=function(s){"use strict";function t(t){this.Os=t||""}return t.prototype.detect=function(){var t="Unknown",e="?",i=this.Os.match(/(Chrome|Chromium|Firefox|Opera|Safari)+\//),n=this.Os.match(/(Chrome|Chromium|Firefox|Version)+\/([0-9]+)\./),r=!1;return i&&2<=i.length?t=i[1]:this.Os.match(/^\(?Mozilla/)&&(t="Mozilla",(this.Os.match(/MSIE/)||this.Os.match(/; Trident\/.*rv:[0-9]+/))&&(t="IE",(n=this.Os.match(/MSIE ([0-9]+)/))?(e=parseInt(n[1],10),(n=this.Os.match(/MSIE [0-9]+.*MSIE ([0-9]+)/))&&(e=parseInt(n[1],10))):(n=this.Os.match(/rv:([0-9]+)/))&&(e=parseInt(n[1],10)))),"Chrome"===t&&this.Os.match(/OPR\//)?(t="Opera",n=this.Os.match(/(OPR)\/([0-9]+)\./)):"Chrome"===t&&this.Os.match(/Edge\//)?(t="Edge",n=this.Os.match(/(Edge)\/([0-9]+)\./)):"Firefox"!==t&&"IE"!==t||!this.Os.match(/Opera/)?"Mozilla"===t&&this.Os.match(/iphone|ipod|ipad/i)&&(t="Safari",e=parseInt(s.get(this.Os.match(/OS\s([0-9]+)/),[1]),10),r=!0):(t="Opera",n=this.Os.match(/(Opera) ([0-9]+)\./)),"Chrome"===t&&(this.Os.match(/; wv/)||this.Os.match(/Android/)&&this.Os.match(/Version\/[0-9].[0-9]/))&&(r=!0),"IE"!==t&&n&&3<=n.length&&(e=parseInt(n[2],10)),"ReactNative"===navigator.product&&(t="ReactNative",e=navigator.productSub||"?"),{browser:t,version:e,isWebview:r}},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0)],void 0===(r=function(r){function s(){}return s.prototype.xt=function(t,e){if(s.prototype.Yt("name",e),!r.xt(t))throw new Error('"'+e+'" must be an object. Received ['+typeof t+"]")},s.prototype.isArray=function(t,e){if(s.prototype.Yt("name",e),!r.isArray(t))throw new Error('"'+e+'" must be an array. Received ['+typeof t+"]")},s.prototype.Yt=function(t,e){if(!r.Yt(e))throw new Error('"name" must be a string. Received ['+typeof e+"]");if(!r.Yt(t))throw new Error('"'+e+'" must be a string. Received ['+typeof t+"]")},s.prototype.hn=function(t,e){if(s.prototype.Yt("name",e),!r.hn(t))throw new Error('"'+e+'" must be a boolean. Received ['+typeof t+"]")},s.prototype.re=function(t,e){if(s.prototype.Yt("name",e),!r.re(t))throw new Error('"'+e+'" must be a number. Received ['+typeof t+"]")},s.prototype.Ct=function(t,e){if(s.prototype.Yt("name",e),!r.Ct(t))throw new Error('"'+e+'" must be a function. Received ['+typeof t+"]")},s.prototype.Mt=function(t,e){s.prototype.Nt(t,e)},s.prototype.Nt=function(t,e){if(s.prototype.Yt("name",e),s.prototype.Yt(t,e),""===t)throw new Error('"'+e+'" must not be empty')},s.prototype.Ht=function(t,e,i){if(s.prototype.Yt("name",i),!r.xt(t))throw new Error('"'+i+'" must be an instance. Received ['+typeof t+"]");if(!(t instanceof e))throw new Error('"'+i+'" must be a valid instance of class '+r.get(e,["name"],"undefined"))},s.prototype.qe=function(t,e){if(s.prototype.Yt("name",e),r.isUndefined(t))throw new Error('"'+e+'" must not be undefined')},s.prototype.De=function(t,e,i){s.prototype.Nt(i,"name");var n=r.getEnumName(e,t);if(r.isNullOrUndefined(n))throw new Error('"'+i+'" must be a valid type. Unable to locate type ['+t+"]");return n},s.prototype.Oe=function(t,i){s.prototype.Yt(i,"name"),s.prototype.isArray(t,i),r.forEach(t,function(t,e){s.prototype.Yt(t,i+"["+e+"]")})},new s}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(t,e){"use strict";function i(t){e.Ct(t,"cleanup"),this.As=t}return i.prototype.dispose=function(){return this.As.call()},i.prototype.toString=function(){return t.toString(this)},i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0)],void 0===(r=function(i){"use strict";function t(){this.qs=[]}return t.prototype.add=function(t){if(!t||!i.Ct(t.dispose))throw new Error('"disposable" must be a disposable or implement dispose');this.qs.push(t)},t.prototype.dispose=function(){var e=[];return i.forEach(this.qs,function(t){e.push(t.dispose())}),this.qs=[],e},t.prototype.toString=function(){return i.toString(this)},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(25)],void 0===(r=function(r,n,s){"use strict";function t(t,e){var i=t;null==i&&(i=[]),n.isArray(i,"valuesToSet"),this.observableArray=new s(i,e)}return t.prototype.getValue=function(){return this.observableArray.getValue()},t.prototype.setValue=function(t){return null==t&&(t=[]),void 0!==t&&n.isArray(t,"values"),this.observableArray.setValue(t)},t.prototype.subscribe=function(t,e){return this.observableArray.subscribe(t,e)},t.prototype.push=function(t){var e=this.observableArray.getValue();e.push(t),this.observableArray.setValue(e)},t.prototype.pop=function(){var t=this.observableArray.getValue(),e=t.pop();return this.observableArray.setValue(t),e},t.prototype.remove=function(e){function t(t){return r.Ct(e)?e(t):t===e}var i=this.observableArray.getValue(),n=r.filter(i,t);return 0<n.length&&this.observableArray.setValue(r.remove(i,t)),n},t.prototype.removeAll=function(){var t=this.observableArray.getValue();return this.observableArray.setValue([]),t},t.prototype.extend=function(t){return this.observableArray.extend(t),this},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(i,e){"use strict";function t(t){e.xt(t,"observable"),this.Fs=t,this.Us=null,this.Ns=!1}return t.prototype.start=function(t,e){this.Ns=!0,this.Us=this.Fs.subscribe(i.noop,{listenForChanges:{callback:t,timeout:e||500}})},t.prototype.stop=function(){this.Ns=!1,this.Us&&this.Us.dispose(),this.Us=null},t.prototype.isEnabled=function(){return this.Ns},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(26)],void 0===(r=function(n,r,i){"use strict";function t(){this.v={}}return t.prototype.fire=function(t,e,i){r.Nt(t,"name"),n.includes(n.keys(this.v),t)&&this.v[t].fire(e,i)},t.prototype.fireAsync=function(t,e,i){r.Nt(t,"name"),n.includes(n.keys(this.v),t)&&this.v[t].fireAsync(e,i)},t.prototype.listen=function(t,e){return r.Nt(t,"name"),(n.includes(n.keys(this.v),t)?this.v[t]:this.v[t]=new i).listen(e)},t.prototype.size=function(t){return n.includes(n.keys(this.v),t)?this.v[t].size():0},t.prototype.dispose=function(){n.forOwn(this.v,function(t){t.dispose()}),this.v={}},t.prototype.toString=function(){return"NamedEvents|"+n.keys(this.v).length},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(8),i(17)],void 0===(r=function(a,e,t,u){"use strict";var c=t.__phenixPageLoadTime||t.__pageLoadTime||a.now(),i="2020-07-14T03:13:57Z",n="2020.2.0";function r(){this.js=[],this.Ls=null,this.Lr=null,this._s="production",this.Bs=i}function s(t){(this.Lr=t)?this.info("Session started on websdk version [%s] ([%s]), user agent [%s]",i,n,navigator.userAgent):this.info("Websdk version [%s] ([%s]), user agent [%s]",i,n,navigator.userAgent)}function o(e,i){var n=(a.now()-c)/1e3,r=function(t){switch(t){case u.level.TRACE:return"Trace";case u.level.DEBUG:return"Debug";case u.level.INFO:return"Info";case u.level.WARN:return"Warn";case u.level.ERROR:return"Error";case u.level.FATAL:return"Fatal";default:throw new Error("Unsupported Logging Level "+t)}}(i.level),s=i.name||"websdk",o=this;a.forEach(this.js,function(t){try{t.log(n,r,s,h(Array.prototype.slice.call(e)),o.Lr,o.Ls,o._s,o.Bs,i)}catch(t){}})}r.prototype.trace=function(){return o.call(this,arguments,{level:u.level.TRACE})},r.prototype.debug=function(){return o.call(this,arguments,{level:u.level.DEBUG})},r.prototype.info=function(){return o.call(this,arguments,{level:u.level.INFO})},r.prototype.warn=function(){return o.call(this,arguments,{level:u.level.WARN})},r.prototype.error=function(){return o.call(this,arguments,{level:u.level.ERROR})},r.prototype.fatal=function(){return o.call(this,arguments,{level:u.level.FATAL})},r.prototype.addAppender=function(t){e.xt(t,"appender"),e.Ct(t.log,"appender.log"),this.js.push(t)},r.prototype.getAppenders=function(){return this.js},r.prototype.getUserId=function(){return this.Ls},r.prototype.setUserId=function(t){this.Ls=t},r.prototype.getEnvironment=function(){return this._s},r.prototype.setEnvironment=function(t){this._s=t},r.prototype.getApplicationVersion=function(){return this.Bs},r.prototype.setApplicationVersion=function(t){this.Bs=t},r.prototype.getObservableSessionId=function(){return this.zs},r.prototype.setObservableSessionId=function(t){this.zs=t,this.Ws&&this.Ws.dispose(),t&&(e.xt(t,"observableSessionId"),this.Ws=this.zs.subscribe(a.bind(s,this),{initial:"notify"}))};var h=function(t){if(0!==t.length){var e=[],i=[];return a.forEach(t,function(t){e.push(a.toString(t)),t instanceof Error&&i.push(t.stack)}),f(e.concat(i))}},f=function(t){for(var e=t[0],i=0;e.indexOf&&1<t.length&&0<=i;)if(0<(i=e.indexOf("%",i)))switch(e.substring(i+1,i+2)){case"%":e=e.substring(0,i)+e.substring(i+1),i++;break;case"s":case"d":t[0]=e=e.substring(0,i)+t[1]+e.substring(i+2),t.splice(1,1);break;default:return t}return t};return r}.apply(e,n))||(t.exports=r)},function(i,n,t){(function(t){var e;void 0===(e=function(){"use strict";return function(){return"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{}}}.apply(n,[]))||(i.exports=e)}).call(this,t(59))},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){var n,r;n=[i(0),i(1),i(17)],void 0===(r=function(t,e,c){"use strict";function i(){this.Vs=c.level.TRACE}i.prototype.setThreshold=function(t){e.re(t,"level"),this.Vs=t},i.prototype.getThreshold=function(){return this.Vs},i.prototype.log=function(t,e,i,n,r,s,o,a,u){u.level<this.Vs||(n[0]=t+" ["+i+"] "+e+" "+n[0],u.level>c.level.INFO?f(n):h(n))};var h=function(t){console.log.apply(console,t)},f=function(t){console.error.apply(console,t)};return i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(19),i(62)],void 0===(r=function(t,e,n,r){var s={urls:{local:"",staging:"https://telemetry-stg.phenixrts.com",production:"https://telemetry.phenixrts.com"}};function i(){this.Hs={}}return i.prototype.getAppender=function(t){var e=n.parseEnvFromPcastBaseUri(t||""),i=s.urls[e];return this.Hs[e]||(this.Hs[e]=function(t){var e=new r(t);return t||e.setEnabled(!1),e}.call(this,i)),this.Hs[e]},new i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(3),i(9),i(20),i(31)],void 0===(r=function(c,h,e,i,n,r){function t(t){h.Yt(t,"uri"),this.Gs="/telemetry/logs",this.Ks="object"==typeof location?location.hostname:e.browser+"-"+e.browserVersion+"-unknown",this.Vs=i.level.TRACE,this.Ns=!0,this.Js=(e.browser||"Browser")+"/"+(e.browserVersion||"?"),this.Xs=0,this.Qs=new n.BatchHttpProto(t+this.Gs,[r],"telemetry.StoreLogRecords",{maxAttempts:3,maxBufferedRecords:1e3,maxBatchSize:512}),this.Qs.on("capacity",c.bind(s,this))}function s(t){this.Qs.addRecordToBeginning({level:"Warn",timestamp:c.isoString(),category:"websdk/telemetryLogger",message:"Deleted "+t+" records",source:this.Js,fullQualifiedName:this.Ks,sessionId:this.$s,userId:this.Ys,environment:this.Zs,version:this.to,runtime:this.Xs})}return t.prototype.setThreshold=function(t){h.re(t,"level"),this.Vs=t},t.prototype.getThreshold=function(){return this.Vs},t.prototype.isEnabled=function(){return this.Ns},t.prototype.setEnabled=function(t){h.hn(t,"enabled"),this.Ns=t},t.prototype.log=function(t,e,i,n,r,s,o,a,u){u.level<this.Vs||!this.Ns||(h.isArray(n,"messages"),this.Xs=t,this.$s=r,this.Ys=s,this.Zs=o,this.to=a,function(t,e,i){this.Qs.addRecord({level:t,timestamp:c.isoString(),category:e,message:i.join(" "),source:this.Js,fullQualifiedName:this.Ks,sessionId:this.$s,userId:this.Ys,environment:this.Zs,version:this.to,runtime:this.Xs})}.call(this,e,i,n))},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5),i(64),i(29)],void 0===(r=function(r,s,o,a,u){"use strict";function t(t,e,i,n){s.Nt(t,"uri"),s.xt(e,"logger"),s.isArray(i,"protocols"),this.Xi=t,this.Pt=e,this.Pt.info("Connecting to [%s]",t),this.sr=new a(this.Xi,this.Pt),this.eo=new u(this.Pt,r.bind(p,this),r.bind(m,this),i,n),this.Xn=new o.NamedEvents,this.sr.onconnected=r.bind(h,this),this.sr.onreconnecting=r.bind(c,this),this.sr.onreconnected=r.bind(f,this),this.sr.ondisconnected=r.bind(d,this),this.sr.onerror=r.bind(l,this),this.io=!1}function e(t,e){this.Xn.fire(t,e,this)}function c(t){e.call(this,"reconnecting")}function h(t){e.call(this,"connected")}function f(t){e.call(this,"reconnected")}function d(t){e.call(this,"disconnected",[t.code,t.reason]),this.io&&(this.Xn.dispose(),this.eo.dispose())}function l(t){e.call(this,"error",[t.data])}function m(t){this.sr.onmessage=t}function p(t){this.sr&&this.sr.send(t)}return t.prototype.onEvent=function(t,e){return this.Xn.listen(t,e),this.eo.onEvent(t,e)},t.prototype.onRequest=function(t,e){return this.eo.onRequest(t,e)},t.prototype.sendRequest=function(t,e,i,n){return this.eo.sendRequest(t,e,i,n)},t.prototype.sendResponse=function(t,e,i,n){return this.eo.sendResponse(t,e,i,n)},t.prototype.disconnect=function(){return this.io=!0,this.sr.disconnect()},t.prototype.disposeOfPendingRequests=function(){return this.Pt.info("Disposing of pending MQ WebSocket requests"),this.eo.disposeOfRequests()},t.prototype.getApiVersion=function(){return this.eo.getApiVersion()},t.prototype.toString=function(){return"MQWebSocket["+this.sr.toString()+"]"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(65)],void 0===(r=function(t){"use strict";return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(28)],void 0===(r=function(s,o,a){"use strict";var u={byebye:{code:1e3,reason:"byebye",desc:"Client closed"},backoffLimitReached:{code:4e3,reason:"backoff-limit-reached",desc:"Reached the limit in terms of the number of reconnects"},networkDisconnect:{code:4001,reason:"network-disconnect",desc:"Network connection monitor determined loss to internet connectivity"},reconnecting:{code:4002,reason:"reconnecting",desc:"Closing WebSocket in order to attempt to establish another connection"}},c={code:1,state:"OPEN",desc:"The connection is open and ready to communicate"},e={code:3,state:"CLOSED",desc:"The connection is closed or could not be opened"};function t(t,e,i,n){o.Nt(t,"uri"),o.xt(e,"logger"),s.isNullOrUndefined(i)?i=4:o.re(i,"maxReconnectAttempts"),this.Xi=t,this.Pt=e,this.no=i,this.ro=n||1e3,this.so=!1,this.xn=!1,this.oo=[],this.ao="connecting",this.Pt.info("Connecting WebSocket to [%s]",t),this.sr=h.call(this,l,f);var r=this;this.uo=null,this.co=a.listenForNetworkChange(function(t){if(t)return s.re(r.uo)&&(clearTimeout(r.uo),r.uo=null),function(){var t=this;setTimeout(function(){return t.xn?t.Pt.info("Unable to go back online after network reconnect. Client has stopped WebSocket."):t.sr.readyState!==c.code?(t.Pt.info("Network Reconnected. Attempting to reconnect WebSocket."),t.reconnect()):t.ho?(t.Pt.info("Network Reconnected with WebSocket status of [%s].",c.state),l.call(t)):("online"===t.ao&&"reconnected"===this.ao||m.call(t),void t.Pt.info("Network Reconnected."))},1e3)}.call(r);s.re(r.uo)||(d.call(r),r.uo=setTimeout(function(){return function(){this.Pt.warn("Network not reconnected after [%s]. Going Offline and disconnecting WebSocket connection.",15e3),this.ho=!0,p.call(this,u.networkDisconnect)}.call(r)},15e3))},0)}function n(t){return this.sr.readyState===e.code?f.call(this,t):this.sr.close(t.code,t.reason)}function h(t,e){var i=new WebSocket(this.Xi);return i.onopen=s.bind(t,this),i.onclose=s.bind(e,this),i.onmessage=s.bind(g,this),i.onerror=s.bind(v,this),i}function r(t){this.sr.readyState!==c.code&&this.reconnect(t+1)}function f(t){switch(t.code){case u.reconnecting.code:return;case u.byebye.code:case u.backoffLimitReached.code:case u.networkDisconnect.code:return p.call(this,t);default:if(this.so)return;return d.call(this,t),this.Pt.info("Attempting to re-establish socket connection after disconnect event with code [%s] and reason [%s]",t.code,t.reason),this.reconnect()}}function d(t){this.Pt.info("WebSocket is reconnecting"),this.ao="reconnecting",this.onreconnecting&&this.onreconnecting(t)}function l(t){this.Pt.info("WebSocket Connected"),function(){var t=this.oo.length;if(0!==t)for(this.Pt.info("Sending [%s] queued messages",t);0<t;){t--;var e=this.oo.shift();this.send(e)}}.call(this),this.ao="connected",this.onconnected&&this.onconnected(t)}function m(t){this.Pt.info("Successfully reconnected to WebSocket"),this.ao="reconnected",this.onreconnected&&this.onreconnected(t)}function p(t){this.Pt.info("WebSocket Disconnected [%s]: [%s]",t.code,t.reason),this.ao="disconnected",this.ondisconnected&&this.ondisconnected(t)}function v(t){this.Pt.error("An error occurred on the WebSocket connection [%s]",t.data||t),this.onerror&&this.onerror(t)}function g(t){this.Pt.debug(">> [%s]",t.data),this.onmessage&&this.onmessage(t)}return t.prototype.onmessage=null,t.prototype.onconnected=null,t.prototype.onreconnecting=null,t.prototype.onreconnected=null,t.prototype.ondisconnected=null,t.prototype.onerror=null,t.prototype.send=function(t){return a.isOnline(),this.sr.send(t)},t.prototype.reconnect=function(t){this.sr.onclose=null,this.sr.onerror=null,this.so=!0;var e,i=this;if(s.re(t)||(t=1),this.xn)return this.Pt.info("Client has stopped WebSocket after [%s] reconnect attempts",t-1);if(t>this.no)return this.Pt.warn("Unable to reconnect WebSocket after [%s] attempts",this.no),n.call(this,u.backoffLimitReached);n.call(this,u.reconnecting);try{this.sr=h.call(i,function(){return e&&clearTimeout(e),i.so=!1,i.sr.onclose=s.bind(f,i),m.call(i)},function(){t+1>i.no&&(e&&clearTimeout(e),r.call(i,t))})}catch(t){this.Pt.warn("Unable to create WebSocket connection [%s]",t)}e=function(t){var e=this;return setTimeout(function(){r.call(e,t)},t*t*this.ro)}.call(this,t)},t.prototype.disconnect=function(){return this.co.dispose(),this.xn=!0,s.re(this.uo)&&(clearTimeout(this.uo),this.uo=null),this.sr.close(u.byebye.code,u.byebye.reason)},t.prototype.toString=function(){return"ReconnectedWebSocket["+this.Xi+","+this.sr.readyState+"]"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(8),i(5),i(4),i(2)],void 0===(r=function(s,e,i,n,o){"use strict";function t(){var t="undefined"==typeof navigator||navigator.onLine;this.fo=new n.Observable(t).extend({timeout:0}),this.Xn=new i.NamedEvents,s.addEventListener(e,"online",s.bind(this.Xn.fire,this.Xn,"online",[])),s.addEventListener(e,"offline",s.bind(this.Xn.fire,this.Xn,"offline",[])),s.addEventListener(e,"unload",s.bind(this.Xn.dispose,this.Xn)),this.Xn.listen("online",s.bind(this.fo.setValue,this.fo,!0)),this.Xn.listen("offline",s.bind(this.fo.setValue,this.fo,!1))}function a(t,e){var i=this;if(this.fo.setValue(!1),!s.re(e))return t(!1);i.offlineTimeout=setTimeout(function(){t&&!i.fo.getValue()&&t(!1)},e)}function u(t){this.fo.setValue(!0),t&&t(!0)}return t.prototype.listenForNetworkChange=function(t,e){var i=new o.DisposableList,n=s.bind(u,this,t),r=s.bind(a,this,t,e);return i.add(this.Xn.listen("online",n)),i.add(this.Xn.listen("offline",r)),i},t.prototype.isOnline=function(){return this.fo.getValue()},new t}.apply(e,n))||(t.exports=r)},function(t,e,i){"use strict";t.exports=r;var n=i(68);function r(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var s=4294967296,o=1/s;function a(t){return t.type===r.Bytes?t.readVarint()+t.pos:t.pos+1}function u(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function c(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;t<=r;r--)i.buf[r+n]=i.buf[r]}function h(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function f(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function d(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function l(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function m(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function p(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function v(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function g(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function y(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function w(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function b(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function k(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}r.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,s=this.pos;this.type=7&n,t(r,e,this),this.pos===s&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=w(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=k(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=w(this.buf,this.pos)+w(this.buf,this.pos+4)*s;return this.pos+=8,t},readSFixed64:function(){var t=w(this.buf,this.pos)+k(this.buf,this.pos+4)*s;return this.pos+=8,t},readFloat:function(){var t=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,n=this.buf;return e=127&(i=n[this.pos++]),i<128?e:(e|=(127&(i=n[this.pos++]))<<7,i<128?e:(e|=(127&(i=n[this.pos++]))<<14,i<128?e:(e|=(127&(i=n[this.pos++]))<<21,i<128?e:function(t,e,i){var n,r,s=i.buf;if(n=(112&(r=s[i.pos++]))>>4,r<128)return u(t,n,e);if(n|=(127&(r=s[i.pos++]))<<3,r<128)return u(t,n,e);if(n|=(127&(r=s[i.pos++]))<<10,r<128)return u(t,n,e);if(n|=(127&(r=s[i.pos++]))<<17,r<128)return u(t,n,e);if(n|=(127&(r=s[i.pos++]))<<24,r<128)return u(t,n,e);if(n|=(1&(r=s[i.pos++]))<<31,r<128)return u(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,i){for(var n="",r=e;r<i;){var s,o,a,u=t[r],c=null,h=239<u?4:223<u?3:191<u?2:1;if(i<r+h)break;1===h?u<128&&(c=u):2===h?128==(192&(s=t[r+1]))&&(c=(31&u)<<6|63&s)<=127&&(c=null):3===h?(s=t[r+1],o=t[r+2],128==(192&s)&&128==(192&o)&&((c=(15&u)<<12|(63&s)<<6|63&o)<=2047||55296<=c&&c<=57343)&&(c=null)):4===h&&(s=t[r+1],o=t[r+2],a=t[r+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&((c=(15&u)<<18|(63&s)<<12|(63&o)<<6|63&a)<=65535||1114112<=c)&&(c=null)),null===c?(c=65533,h=1):65535<c&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),r+=h}return n}(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var i=a(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===r.Varint)for(;127<this.buf[this.pos++];);else if(e===r.Bytes)this.pos=this.readVarint()+this.pos;else if(e===r.Fixed32)this.pos+=4;else{if(e!==r.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),b(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),b(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),b(this.buf,-1&t,this.pos),b(this.buf,Math.floor(t*o),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),b(this.buf,-1&t,this.pos),b(this.buf,Math.floor(t*o),this.pos+4),this.pos+=8},writeVarint:function(c){268435455<(c=+c||0)||c<0?function(t,e){var i,n,r,s,o,a,u;if(0<=c?(i=c%4294967296|0,n=c/4294967296|0):(n=~(-c/4294967296),4294967295^(i=~(-c%4294967296))?i=i+1|0:n=n+1|(i=0)),0x10000000000000000<=c||c<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),a=i,(u=e).buf[u.pos++]=127&a|128,a>>>=7,u.buf[u.pos++]=127&a|128,a>>>=7,u.buf[u.pos++]=127&a|128,a>>>=7,u.buf[u.pos++]=127&a|128,a>>>=7,u.buf[u.pos]=127&a,o=(7&(r=n))<<4,(s=e).buf[s.pos++]|=o|((r>>>=3)?128:0),r&&(s.buf[s.pos++]=127&r|((r>>>=7)?128:0),r&&(s.buf[s.pos++]=127&r|((r>>>=7)?128:0),r&&(s.buf[s.pos++]=127&r|((r>>>=7)?128:0),r&&(s.buf[s.pos++]=127&r|((r>>>=7)?128:0),r&&(s.buf[s.pos++]=127&r)))))}(0,this):(this.realloc(4),this.buf[this.pos++]=127&c|(127<c?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(127<c?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(127<c?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var n,r,s=0;s<e.length;s++){if(55295<(n=e.charCodeAt(s))&&n<57344){if(!r){56319<n||s+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):r=n;continue}if(n<56320){t[i++]=239,t[i++]=191,t[i++]=189,r=n;continue}n=r-55296<<10|n-56320|65536,r=null}else r&&(t[i++]=239,t[i++]=191,t[i++]=189,r=null);n<128?t[i++]=n:(n<2048?t[i++]=n>>6|192:(n<65536?t[i++]=n>>12|224:(t[i++]=n>>18|240,t[i++]=n>>12&63|128),t[i++]=n>>6&63|128),t[i++]=63&n|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;128<=i&&c(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),n.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),n.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;128<=n&&c(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,r.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){this.writeMessage(t,h,e)},writePackedSVarint:function(t,e){this.writeMessage(t,f,e)},writePackedBoolean:function(t,e){this.writeMessage(t,m,e)},writePackedFloat:function(t,e){this.writeMessage(t,d,e)},writePackedDouble:function(t,e){this.writeMessage(t,l,e)},writePackedFixed32:function(t,e){this.writeMessage(t,p,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,v,e)},writePackedFixed64:function(t,e){this.writeMessage(t,g,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,y,e)},writeBytesField:function(t,e){this.writeTag(t,r.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,r.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,r.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,r.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},function(t,e){e.read=function(t,e,i,n,r){var s,o,a=8*r-n-1,u=(1<<a)-1,c=u>>1,h=-7,f=i?r-1:0,d=i?-1:1,l=t[e+f];for(f+=d,s=l&(1<<-h)-1,l>>=-h,h+=a;0<h;s=256*s+t[e+f],f+=d,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=n;0<h;o=256*o+t[e+f],f+=d,h-=8);if(0===s)s=1-c;else{if(s===u)return o?NaN:1/0*(l?-1:1);o+=Math.pow(2,n),s-=c}return(l?-1:1)*o*Math.pow(2,s-n)},e.write=function(t,e,i,n,r,s){var o,a,u,c=8*s-r-1,h=(1<<c)-1,f=h>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,l=n?0:s-1,m=n?1:-1,p=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),2<=(e+=1<=o+f?d/u:d*Math.pow(2,1-f))*u&&(o++,u/=2),h<=o+f?(a=0,o=h):1<=o+f?(a=(e*u-1)*Math.pow(2,r),o+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,r),o=0));8<=r;t[i+l]=255&a,l+=m,a/=256,r-=8);for(o=o<<r|a,c+=r;0<c;t[i+l]=255&o,l+=m,o/=256,c-=8);t[i+l-m]|=128*p}},function(t,e,i){var n,r;n=[i(0)],void 0===(r=function(d){"use strict";function t(t){this.do=t,this.lo={},this.mo={},function s(t,e){0<d.get(t,["messages","length"],0)&&function(t,n){var r=this;n.messages=d.reduce(t,function(t,e){if(!n[e.name]){var i=d.reduce(e.fields,function(t,e){return t[e.id]=!0,t},{});return t[e.name]={parent:n,type:e.name,fieldIds:i},s.call(r,e,t[e.name]),t}},{})}.call(this,t.messages,e),0<d.get(t,["enums","length"],0)&&function(t,e){e.enums=d.reduce(t,function(t,e){return t[e.name]=d.reduce(e.values,function(t,e){return t[e.name]=e,t},{}),t},{})}.call(this,t.enums,e)}.call(this,this.do,this.lo),function e(t,i){var n=this;d.forEach(t.messages,function(t){i.messages[t.name].fields=d.reduce(t.fields,d.bind(r,this,i.messages[t.name]),{}),t.messages&&e.call(n,t,i.messages[t.name])})}.call(this,this.do,this.lo)}function u(r,s,t,e){var i,o=this,n=(i=r.messages[s],d.reduce(i.fields,function(t,e){return t[e.name]=d.clone(e.defaultValue),t},{}));return t.readFields(function(t,e,i){if(r.messages[s].fieldIds[t]){var n=r.messages[s].fields[t];"repeated"===n.rule?e[n.name].push(a.call(o,r.messages[s],s,t,i)):e[n.name]=a.call(o,r.messages[s],s,t,i)}},n,e)}function l(e,i,n,r){var s=this,t=e.messages[i];d.forEach(d.keys(t.fields),function(t){return function i(n,r,s,o,a,t){var u=this,e=n.messages[r].fields[s],c=o[e.name];if(d.isUndefined(t)||(c=c[t]),e.defaultValue!==c&&!d.isUndefined(c)){if(d.isArray(c)){if("repeated"!==e.rule)throw new Error("Invalid type. Array is not valid with rule ["+e.rule+"]");return d.forEach(c,function(t,e){i.call(u,n,r,s,o,a,e)})}if(d.xt(e.schema)&&d.xt(c))return a.writeMessage(s,d.bind(l,this,e.schema.parent,e.type),c);var h=d.isUndefined(c)?e.defaultValue:c;if(d.xt(e.schema)&&!e.schema.fields){var f=d.re(c)?c:d.get(e.schema,[h,"id"]);return a.writeVarintField(s,f)}switch(e.type){case"string":return a.writeStringField(s,h);case"float":return a.writeFloatField(s,h);case"double":return a.writeDoubleField(s,h);case"bool":return a.writeBooleanField(s,h);case"enum":case"uint32":case"uint64":case"int32":case"int64":return a.writeVarintField(s,h);case"sint32":case"sint64":return a.writeSVarintField(s,h);case"fixed32":return a.writeFixed32Field(s,h);case"fixed64":return a.writeFixed64Field(s,h);case"sfixed32":return a.writeSFixed32Field(s,h);case"sfixed64":return a.writeSFixed64Field(s,h);case"bytes":return a.writeBytesField(s,h);default:throw new Error("Unexpected type: "+e.type)}}}.call(s,e,i,parseInt(t),n,r)})}function r(t,e,i){return e[i.id]={rule:i.rule,type:i.type,name:i.name,schema:function t(e,i){return d.get(i,["messages",e])?i.messages[e]:d.get(i,["enums",e])?i.enums[e]:i.parent?t(e,i.parent):e}.call(this,i.type,t),defaultValue:function(t,e,i){if("repeated"===t)return[];switch(e){case"float":case"double":case"uint32":case"uint64":case"int32":case"int64":case"sint32":case"sint64":case"fixed32":case"fixed64":case"sfixed32":case"sfixed64":case"string":case"enum":case"bool":case"long":default:return d.isUndefined(i)?null:i}}(i.rule,i.type,d.get(i,["options","default"]))},e}function a(t,e,i,n){var r="int32"===e||"int64"===e?"true":"",s=t.fields[i];if(d.xt(s.schema)){if(s.schema.fields)return u.call(this,s.schema.parent,s.type,n,n.readVarint()+n.pos);var o=n.readVarint(r),a=d.getEnumName(s.schema,o);if(d.isNullOrUndefined(a))throw new Error("Unsupported enum id ["+o+"] for field ["+s.name+"] on message ["+t.type+"]");return a}switch(s.type){case"string":return n.readString(r);case"float":return n.readFloat(r);case"double":return n.readDouble(r);case"bool":return n.readBoolean(r);case"enum":return n.readVarint(r);case"uint32":case"uint64":case"int32":case"int64":return n.readVarint(r);case"sint32":case"sint64":return n.readSVarint(r);case"fixed32":return n.readFixed32(r);case"fixed64":return n.readFixed64(r);case"sfixed32":return n.readSFixed32(r);case"sfixed64":return n.readSFixed64(r);case"bytes":return n.readBytes(r);default:throw new Error("Unexpected type: "+s.type)}}return t.prototype.read=function(t,e,i){if(!this.lo.messages[t])throw new Error("Unsupported proto type ["+t+"]");return u.call(this,this.lo,t,e,i)},t.prototype.write=function(t,e,i){if(!this.lo.messages[t])throw new Error("Unsupported proto type ["+t+"]");return l.call(this,this.lo,t,e,i)},t.prototype.getDefaults=function(){},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{package:"mq",messages:[{name:"Message",fields:[{rule:"optional",type:"MessageType",name:"messageType",id:7,options:{default:"Request"}},{rule:"optional",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"requestId",id:2},{rule:"required",type:"string",name:"type",id:3},{rule:"optional",type:"string",name:"encoding",id:4},{rule:"required",type:"bytes",name:"payload",id:5},{rule:"repeated",type:"double",name:"wallTime",id:6}],enums:[{name:"MessageType",values:[{name:"Request",id:0},{name:"Response",id:1},{name:"Event",id:2}]}]},{name:"Error",fields:[{rule:"required",type:"string",name:"reason",id:1}]},{name:"PingPong",fields:[{rule:"required",type:"uint64",name:"originTimestamp",id:1},{rule:"optional",type:"uint64",name:"count",id:2}]}]}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(0),i(1),i(8),i(72)],void 0===(r=function(r,s,o,a){"use strict";function u(){this.po=[],this.vo=""}return u.prototype.push=function(){1024<this.po.length+arguments.length&&(this.vo+=String.fromCharCode.apply(String,this.po),this.po.length=0),Array.prototype.push.apply(this.po,arguments)},u.prototype.build=function(){return this.vo+String.fromCharCode.apply(String,this.po)},{toString:function(t){var e=0,i=t.length,n=new u;return a.encode(function(){return e<i?t[e++]:null},r.bind(n.push,n)),n.build()},toByteArray:function(t){s.Yt(t,"data");var e,i,n=[];return a.decode((e=t,i=0,function(){return i<e.length?e.charCodeAt(i++):null}),function(t){n.push(t)}),new o.Uint8Array(n)}}}.apply(e,n))||(t.exports=r)},function(t,e,i){t.exports=i(73)},function(n,s,a){var u;!function(){for(var t={},r=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],o=[],e=0,i=r.length;e<i;++e)o[r[e]]=e;t.encode=function(t,e){for(var i,n;null!==(i=t());)e(r[i>>2&63]),n=(3&i)<<4,null!==(i=t())?(e(r[63&((n|=i>>4&15)|i>>4&15)]),n=(15&i)<<2,null!==(i=t())?(e(r[63&(n|i>>6&3)]),e(r[63&i])):(e(r[63&n]),e(61))):(e(r[63&n]),e(61),e(61))},t.decode=function(t,e){var i,n,r;function s(t){throw Error("Illegal character code: "+t)}for(;null!==(i=t());)if(void 0===(n=o[i])&&s(i),null!==(i=t())&&(void 0===(r=o[i])&&s(i),e(n<<2>>>0|(48&r)>>4),null!==(i=t()))){if(void 0===(n=o[i])){if(61===i)break;s(i)}if(e((15&r)<<4>>>0|(60&n)>>2),null!==(i=t())){if(void 0===(r=o[i])){if(61===i)break;s(i)}e((3&n)<<6>>>0|r)}}},t.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)},n.exports?n.exports=t:void 0===(u=function(){return t}.call(s,a,s,n))||(n.exports=u)}()},function(t,e,i){var n,r;n=[i(0),i(1),i(75),i(30),i(78)],void 0===(r=function(a,u,c,h,n){"use strict";function f(t,e,i){return n.toString(t.encode(e,i))}function d(t,e,i){return t.decode(e+"Response",n.toByteArray(i))}return function(t,e,i,n,r){u.Nt(t,"uri"),u.isArray(e,"protocols"),u.Nt(i,"type"),u.xt(n,"options");var s=a.assign({},n||{},{contentType:"application/protobuf"}),o=new h(e,r);return new c(t,s,a.bind(f,this,o,i),a.bind(d,this,o,i))}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(76)],void 0===(r=function(t){"use strict";return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5),i(8),i(28),i(6),i(4),i(2)],void 0===(r=function(s,o,a,u,c,h,f,d){var i=0,l={capacity:"capacity",error:"error",response:"response"},m=null;function t(t,e,i,n){o.Nt(t,"uri"),e=e||{},o.xt(e,"options"),e.requestType&&o.Nt(e.requestType,"options.requestType"),e.maxAttempts&&o.re(e.maxAttempts,"options.maxAttempts"),e.maxBufferedRecords&&o.re(e.maxBufferedRecords,"options.maxBufferedRecords"),e.maxBatchSize&&o.re(e.maxBatchSize,"options.maxBatchSize"),e.contentType&&o.Nt(e.contentType,"options.maxBatchSize"),i&&o.Ct(i,"serializeRequest"),n&&o.Ct(n,"deserializeResponse"),this.go="__phenixBatchHttpMessages|"+t,this.yo=e.requestType||"POST",this.wo=e.requestTimeout||3e4,this.bo=e.maxAttempts||5,this.ko=e.maxBufferedRecords||1e3,this.So=e.maxBatchSize||100,this.Eo=e.contentType||"application/json",this.To=i,this.Io=n,this.Xi=t,this.Ro=g.call(this)||[],this.Ns=!0,this.Xn=new a.NamedEvents,this.Mo=new f.Observable(!0),this.g=new d.DisposableList,this.Co=!1,this.xo=!1,this.Po=null===m?m=b.call(this):m,this.g.add(this.Mo.subscribe(s.bind(p,this))),this.g.add(function(){var t=this;return c.listenForNetworkChange(function(){v.call(t,t.Co)})}.call(this)),this.g.add(this.Xn),w.call(this,[]),p.call(this);var r=this;s.addEventListener(u,"beforeunload",function(){y.call(r,r.Ro),r.xo=!0,r.Ro=[]})}function e(){if(this.Ro.length>this.ko){var t=this.Ro.length-this.ko/2;this.Ro=this.Ro.slice(t),this.Xn.fireAsync(l.capacity,[null,{numberOfDeletedRecords:t}])}}function p(){if(this.Mo.getValue()&&0!==this.Ro.length){v.call(this,!0);var t={records:s.take(this.Ro,this.So)};this.Ro=this.Ro.slice(this.So);var e=this;try{(function(t,e,n){var r=this,i=this.To?this.To(s.assign({},e)):e;switch(this.yo){case"POST":return h.postWithRetry(t,i,{timeout:this.wo,contentType:this.Eo,retryOptions:{maxAttempts:this.bo,additionalRetryErrorCodes:[0]}},function(t,e){if(t)return"timeout"!==t.message||function(){return this.Ro.length>=this.ko}.call(r)?(v.call(r,!1),r.Xn.fire(l.error,[t])):n();v.call(r,!1);var i=r.Io?r.Io(e.data):e.data;return r.Xn.fire(l.response,[i])});default:throw new Error("Invalid request type")}}).call(this,this.Xi,t,function(){setTimeout(function(){e.Ro=e.Ro.concat(t.records),v.call(e,!1)},i)})}catch(t){setTimeout(function(){return v.call(e,!1),e.Xn.fire(l.error,[t])},i)}}}function v(t){this.Co=t,this.Mo.setValue(!t&&c.isOnline())}t.prototype.on=function(t,e){return o.Nt(t,"eventName"),o.Ct(e,"callback"),this.Xn.listen(t,e)},t.prototype.addRecord=function(t){this.xo?y.call(this,[t]):(this.Ro.push(t),p.call(this),e.call(this))},t.prototype.addRecordToBeginning=function(t){this.Ro.unshift(t),p.call(this),e.call(this)},t.prototype.dispose=function(){this.Ro=[],this.g.dispose()};var g=function(){if(!this.Po)return[];try{var t=u.localStorage.getItem(this.go);if(t)return JSON.parse(t)}catch(t){console.log("Failed to read local storage ["+t.message+"]")}return[]},y=function(t){if(this.Po&&t&&0!==t.length){var e=g.call(this).concat(t);w.call(this,e)}},w=function(t){if(this.Po&&t)try{var e=JSON.stringify(t);u.localStorage.setItem(this.go,e)}catch(t){console.log("Failed to store data in local storage ["+t.message+"]")}},b=function(){try{if(!u.localStorage)return console.log("Local storage not available"),!1;var t="__is_local_storage_supported__";u.localStorage.setItem(t,t);var e=u.localStorage.getItem(t);return u.localStorage.removeItem(t),e!==t&&console.log("Local storage is passively blocked"),e===t}catch(t){return console.log("Local storage is blocked"),!1}};return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(2)],void 0===(r=function(m,a,p){"use strict";var v=1,g=2,y=1500,w={clientAborted:{id:4e3,name:"Aborted by Client"}};function t(){}function r(t,e,i,n,r){u(n=n||{});var s=h(t,c(n.queryParameters||{},e)),o=m.bind(b,this,m.now(),r);if(!s)return r(f());n.responseType&&(s.responseType=n.responseType),d(s,n),s.addEventListener("readystatechange",m.bind(l,this,s,n,o)),s.timeout=n.timeout||15e3,s.send(i)}function s(t,e,i,n,r){var s=m.bind(t,this,e,i,n),o={startTime:m.now(),isDisposed:!1};return k.call(this,e,n,s,o,r)}function u(t){a.xt(t,"settings"),t.queryParameters&&a.xt(t.queryParameters,"settings.queryParameters"),t.mimeType&&a.Mt(t.mimeType,"settings.mimeType"),t.accept&&a.Mt(t.accept,"settings.accept"),t.contentType&&a.Mt(t.contentType,"settings.contentType"),t.responseType&&a.Mt(t.responseType,"settings.responseType"),m.isNullOrUndefined(t.timeout)||a.re(t.timeout,"settings.timeout")}function c(t,e){var i=e.lastIndexOf("#"),n=e.indexOf("?"),r=m.reduce(t,function(t,e,i){return(t+=t?"&":"")+i.toString()+"="+e.toString()},""),s=-1===i?"":e.substring(i+1),o=-1===n?"":e.substring(n+1,s?i:e.length),a=r+(o?"&"+o:"");return e=e.replace("?"+o,"").replace("#"+s,""),a&&(e+="?"+a),s&&(e+="#"+s),e}function h(t,e){var i=new XMLHttpRequest;if("withCredentials"in i)i.open(t,e,!0);else{if("undefined"==typeof XDomainRequest)return;(i=new XDomainRequest).open(t,e)}return i}function f(){var t=new Error("unsupported");return t.code="unsupported",t}function d(i,t){var e=t.contentType||"application/json",n=t.accept||e,r=m.assign({},{"Content-Type":e,Accept:n},m.get(t,["headers"],{}));m.forOwn(r,function(t,e){i.setRequestHeader(e,t)})}function l(t,e,i){if(4===t.readyState)if(200===t.status){var n=(o=t.getAllResponseHeaders(),m.reduce(o.trim().split(/[\r\n]+/),function(t,e){var i=e.split(": "),n=i.shift(),r=i.join(": ");return n&&(t[n]=r),t},{}));i(null,{data:t.response||t.responseText,headers:n,rawXhr:t})}else{var r=new Error(0===t.status?"timeout":"Status=["+t.status+"]"),s=m.get(e,["retryOptions","additionalRetryErrorCodes"],[]);m.forEach(s,function(t){a.re(t,"additionalRetryErrorCode")}),r.code=t.status,(500<=t.status&&t.status<600||m.includes(s,t.status))&&(r.retryable=!0),i(r)}var o}function b(t,e,i,n){n&&m.set(n,["stats","successResponseTime"],m.now()-t),e(i,n)}function k(i,n,r,s,o,a){function t(t,e){return s.isDisposed?o(S(w.clientAborted)):t&&t.retryable&&a<f?k.call(u,i,n,r,s,o,a+1):function(t,e,i,n,r){r&&(m.set(r,["stats","totalResponseTimeForAllAttempts"],m.now()-t),m.set(r,["stats","attempts"],e)),i(n,r)}.call(u,s.startTime,a,o,t,e)}a=a||1;var u=this,e=m.get(n,["delay"],null),c=m.get(n,["retryOptions","delay"],y),h=m.get(n,["retryOptions","backoff"],g),f=m.get(n,["retryOptions","maxAttempts"],v),d=1<a?c*Math.pow(a,h):e,l=new p.Disposable(function(){m.re(s.mostRecentTimeout)&&clearTimeout(s.mostRecentTimeout),s.isDisposed=!0});return!m.re(e)&&1===a||m.get(n,["retryOptions","sync"],!1)?r.call(u,t):function(t,e,i,n,r,s){var o=this;n.mostRecentTimeout=setTimeout(function(){if(n.isDisposed)return s(S(w.clientAborted));i.call(o,s)},r)}.call(u,i,n,r,s,d,t),l}function S(t){var e=new Error(t.name);return e.code=t.id,e}return t.prototype.get=function(t,e,i){u(e=e||{});var n=h("GET",c(e.queryParameters||{},t)),r=m.bind(b,this,m.now(),i);if(!n)return i(f());e.mimeType&&n.overrideMimeType(e.mimeType),e.responseType&&(n.responseType=e.responseType),d(n,e),n.addEventListener("readystatechange",m.bind(l,this,n,e,r)),n.timeout=e.timeout||5e3,n.send()},t.prototype.post=function(t,e,i,n){return r.call(this,"POST",t,e,i,n)},t.prototype.put=function(t,e,i,n){return r.call(this,"PUT",t,e,i,n)},t.prototype.delete=function(t,e,i,n){return r.call(this,"DELETE",t,e,i,n)},t.prototype.getWithRetry=function(t,e,i){var n=m.bind(this.get,this,t,e),r={startTime:m.now(),isDisposed:!1};return k.call(this,t,e,n,r,i)},t.prototype.postWithRetry=function(t,e,i,n){return s.call(this,this.post,t,e,i,n)},t.prototype.putWithRetry=function(t,e,i,n){return s.call(this,this.put,t,e,i,n)},t.prototype.deleteWithRetry=function(t,e,i,n){return s.call(this,this.delete,t,e,i,n)},new t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(1),i(8)],void 0===(r=function(r,s){"use strict";return{toString:function(t){var e=0,i=t.length,n=[],r=[];if(e===i)return"";for(;e<i;)n.push(t[e++]),1024<=n.length&&(r.push(String.fromCharCode.apply(String,n)),n=[]);return r.join("")+String.fromCharCode.apply(String,n)},toByteArray:function(t){r.Yt(t,"data");for(var e,i=0,n=new s.Uint8Array(t.length);i<t.length;){if(255<(e=t.charCodeAt(i)))throw RangeError("illegal char code: "+e);n[i++]=e}return n}}}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5),i(2)],void 0===(r=function(r,e,t,s){"use strict";function i(){this.Xn=new t.NamedEvents,this.Do=r.now(),this.g=new s.DisposableList,this.Oo=!0,this.g.add(this.Xn),function(){if(n())return function(){if(n()){var r=this;chrome.extension.onRequest.addListener(function(t,i,n){"is_selected"===t&&chrome.tabs.getSelected(null,function(t){var e=t.id===i.tab.id;o.call(r,e),n(e)})})}}.call(this);(function(){var e,t,i=this;function n(){var t=!document[e];o.call(i,t)}"object"==typeof document&&(void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden?(e="webkitHidden",t="webkitvisibilitychange"):void 0!==document.hidden&&(e="hidden",t="visibilitychange"),void 0!==document.addEventListener&&void 0!==document[e]?(r.addEventListener(document,t,n,!1),i.g.add(new s.Disposable(function(){r.removeEventListener(document,t,n,!1)}))):function(){var e=this;e.Ao=setInterval(function(){var t=document.hasFocus();o.call(e,t)},3e3),e.g.add(new s.Disposable(function(){r.re(e.Ao)&&clearInterval(e.Ao),e.Ao=null}))}.call(i))}).call(this)}.call(this)}function n(){return"undefined"!=typeof chrome&&chrome.extension&&chrome.extension.onRequest}function o(t){if(e.hn(t,"isForeground"),this.Oo!==t)return t?(this.Oo=!0,a.call(this,"foreground")):(this.Oo=!1,a.call(this,"background"))}function a(t){var e=r.now(),i=e-this.Do;this.Do=e,this.Xn.fire(t,[i])}return i.prototype.isForeground=function(){return this.Oo},i.prototype.getTimeSinceLastChange=function(){return r.now()-this.Do},i.prototype.onForeground=function(t){return e.Ct(t,"callback"),this.Xn.listen("foreground",t)},i.prototype.onBackground=function(t){return e.Ct(t,"callback"),this.Xn.listen("background",t)},i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(20),i(3),i(81),i(82)],void 0===(r=function(c,h,r,s,f,o,a){"use strict";function t(t,e,i,n){h.Nt(t,"uri"),h.Yt(e,"deviceId"),h.Nt(i,"version"),h.xt(n,"logger"),this.fn=e,this.Tt=i,this.Pt=n,this.qo=new s.MQWebSocket(t,this.Pt,[o,a],5),this.zs=new r.Observable(null).extend({rateLimit:0})}return t.prototype.onEvent=function(t,e){return this.qo.onEvent(t,e)},t.prototype.disconnect=function(){return this.zs.setValue(null),this.qo.disconnect()},t.prototype.authenticate=function(t,n){h.Nt(t,"authToken"),h.Ct(n,"callback");var e={apiVersion:this.qo.getApiVersion(),clientVersion:this.Tt,deviceId:this.fn,platform:f.browser,platformVersion:f.browserVersion.toString(),authenticationToken:t};this.getSessionId()&&(e.sessionId=this.getSessionId());var r=this;return this.qo.sendRequest("pcast.Authenticate",e,function(t,e){if(e){var i=r.zs.getValue();i&&i!==e.sessionId&&r.qo.disposeOfPendingRequests(),r.zs.setValue(e.sessionId)}return n(t,e)})},t.prototype.getSessionId=function(){return this.zs.getValue()},t.prototype.getObservableSessionId=function(){return this.zs},t.prototype.bye=function(t,e){h.Nt(t,"reason"),h.Ct(e,"callback");var i={sessionId:this.getSessionId(),reason:t};return this.qo.sendRequest("pcast.Bye",i,e)},t.prototype.setupStream=function(t,e,i,n,r){h.Nt(t,"streamType"),h.Nt(e,"streamToken"),h.xt(i,"options"),h.Ct(r,"callback");var s=f.browser||"UnknownBrowser",o=s+"-"+(f.browserVersion||0),a="rtt[http]="+n,u={streamToken:e,createStream:{sessionId:this.getSessionId(),options:["data-quality-notifications",a],connectUri:i.connectUri,connectOptions:i.connectOptions||[],tags:i.tags||[],userAgent:c.get(f,["global","navigator","userAgent"],o)}};return i.originStreamId&&(u.createStream.originStreamId=i.originStreamId),i.negotiate&&(u.createStream.createOfferDescription={streamId:"",options:[t,s,o],apiVersion:this.qo.getApiVersion()},"undefined"!=typeof screen&&u.createStream.createOfferDescription.options.push("screen="+screen.width+"x"+screen.height)),!1===i.receiveAudio&&u.createStream.options.push("no-audio"),!1===i.receiveVideo&&u.createStream.options.push("no-video"),this.qo.sendRequest("pcast.SetupStream",u,r)},t.prototype.setAnswerDescription=function(t,e,i){h.Nt(t,"streamId"),h.Nt(e,"sdp"),h.Ct(i,"callback");var n={streamId:t,sessionDescription:{type:"Answer",sdp:e},apiVersion:this.qo.getApiVersion()};return this.qo.sendRequest("pcast.SetRemoteDescription",n,i)},t.prototype.addIceCandidates=function(t,e,i,n){h.Nt(t,"streamId"),h.isArray(e,"candidates"),h.xt(i,"options"),h.Ct(n,"callback");var r={streamId:t,candidates:c.map(e,function(t,e){return h.Nt(t.candidate,"candidate["+e+"].candidate"),h.re(t.sdpMLineIndex,"candidate["+e+"].sdpMLineIndex"),h.Nt(t.sdpMid,"candidate["+e+"].sdpMid"),{candidate:t.candidate,sdpMLineIndex:t.sdpMLineIndex,sdpMid:t.sdpMid}}),options:i,apiVersion:this.qo.getApiVersion()};return this.qo.sendRequest("pcast.AddIceCandidates",r,n)},t.prototype.updateStreamState=function(t,e,i,n,r){h.Nt(t,"streamId"),h.Nt(e,"signalingState"),h.Nt(i,"iceGatheringState"),h.Nt(n,"iceConnectionState"),h.Ct(r,"callback");var s={streamId:t,signalingState:e,iceGatheringState:i,iceConnectionState:n,apiVersion:this.qo.getApiVersion()};return this.qo.sendRequest("pcast.UpdateStreamState",s,r)},t.prototype.destroyStream=function(t,e,i){h.Nt(t,"streamId"),h.Yt(e,"reason"),h.Ct(i,"callback");var n={streamId:t,reason:e};return this.qo.sendRequest("pcast.DestroyStream",n,i)},t.prototype.getRoomInfo=function(t,e,i){t?h.Yt(t,"roomId"):h.Yt(e,"alias"),h.Ct(i,"callback");var n={roomId:t,alias:e,sessionId:this.getSessionId()};return this.qo.sendRequest("chat.GetRoomInfo",n,i)},t.prototype.createRoom=function(t,e){h.xt(t,"room"),h.Nt(t.name,"room.name"),h.Nt(t.type,"room.type"),h.Nt(t.description,"room.description"),h.Ct(e,"callback");var i={sessionId:this.getSessionId(),room:t};return this.qo.sendRequest("chat.CreateRoom",i,e)},t.prototype.enterRoom=function(t,e,i,n,r,s){t?h.Yt(t,"roomId"):h.Yt(e,"alias"),h.xt(i,"member"),h.re(r,"timestamp"),h.isArray(n,"options"),h.Ct(s,"callback");var o={roomId:t,alias:e,sessionId:this.getSessionId(),member:i,options:n,timestamp:r};return this.qo.sendRequest("chat.JoinRoom",o,s)},t.prototype.leaveRoom=function(t,e,i){h.Yt(t,"roomId"),h.re(e,"timestamp"),h.Ct(i,"callback");var n={roomId:t,sessionId:this.getSessionId(),timestamp:e};return this.qo.sendRequest("chat.LeaveRoom",n,i)},t.prototype.updateMember=function(t,e,i,n){h.Nt(t,"roomId"),h.xt(e,"member"),h.re(i,"timestamp"),h.Ct(n,"callback"),e.updateStreams=e.hasOwnProperty("streams");var r={sessionId:this.getSessionId(),roomId:t,member:e,timestamp:i};return this.qo.sendRequest("chat.UpdateMember",r,n)},t.prototype.updateRoom=function(t,e,i){h.xt(t,"room"),h.re(e,"timestamp"),h.Ct(i,"callback");var n={sessionId:this.getSessionId(),room:t,timestamp:e};return this.qo.sendRequest("chat.UpdateRoom",n,i)},t.prototype.sendMessageToRoom=function(t,e,i){h.Nt(t,"roomId"),h.xt(e,"chatMessage");var n={roomId:t,chatMessage:e};return this.qo.sendRequest("chat.SendMessageToRoom",n,i)},t.prototype.subscribeToRoomConversation=function(t,e,i,n){h.Nt(t,"sessionId"),h.Nt(e,"roomId"),h.re(i,"batchSize");var r={sessionId:t,roomId:e,limit:i,options:["Subscribe"]};return this.qo.sendRequest("chat.FetchRoomConversation",r,n)},t.prototype.getMessages=function(t,e,i,n,r,s){h.Nt(t,"sessionId"),h.Nt(e,"roomId"),r&&n||h.re(i,"batchSize");var o={sessionId:t,roomId:e,limit:i||0,options:[]};return r&&(h.Nt(r,"beforeMessageId"),o.beforeMessageId=r),n&&(h.Nt(n,"afterMessageId"),o.afterMessageId=n),this.qo.sendRequest("chat.FetchRoomConversation",o,s)},t.prototype.toString=function(){return"PCastProtocol["+this.qo.toString()+"]"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{package:"pcast",options:{optimize_for:"LITE_RUNTIME"},messages:[{name:"Authenticate",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:9,options:{default:0}},{rule:"required",type:"string",name:"clientVersion",id:1},{rule:"optional",type:"string",name:"device",id:12},{rule:"required",type:"string",name:"deviceId",id:2},{rule:"optional",type:"string",name:"manufacturer",id:13},{rule:"required",type:"string",name:"platform",id:3},{rule:"required",type:"string",name:"platformVersion",id:4},{rule:"required",type:"string",name:"authenticationToken",id:5},{rule:"optional",type:"string",name:"connectionId",id:6},{rule:"optional",type:"string",name:"connectionRouteKey",id:10},{rule:"optional",type:"string",name:"remoteAddress",id:11},{rule:"optional",type:"string",name:"sessionId",id:7},{rule:"optional",type:"string",name:"applicationId",id:8}]},{name:"AuthenticateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"sessionId",id:2},{rule:"optional",type:"string",name:"redirect",id:3},{rule:"repeated",type:"string",name:"roles",id:4}]},{name:"Bye",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2}]},{name:"ByeResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SessionDescription",fields:[{rule:"required",type:"Type",name:"type",id:1,options:{default:"Offer"}},{rule:"required",type:"string",name:"sdp",id:2}],enums:[{name:"Type",values:[{name:"Offer",id:0},{name:"Answer",id:1}]}]},{name:"CreateStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"originStreamId",id:2},{rule:"repeated",type:"string",name:"originStreamIds",id:10},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"string",name:"connectUri",id:8},{rule:"repeated",type:"string",name:"connectOptions",id:9},{rule:"repeated",type:"string",name:"tags",id:4},{rule:"optional",type:"string",name:"userAgent",id:11},{rule:"optional",type:"SetRemoteDescription",name:"setRemoteDescription",id:5},{rule:"optional",type:"CreateOfferDescription",name:"createOfferDescription",id:6},{rule:"optional",type:"CreateAnswerDescription",name:"createAnswerDescription",id:7}]},{name:"IceServer",fields:[{rule:"repeated",type:"string",name:"urls",id:1},{rule:"optional",type:"string",name:"username",id:2},{rule:"optional",type:"string",name:"credential",id:3}]},{name:"RtcConfiguration",fields:[{rule:"optional",type:"BundlePolicy",name:"bundlePolicy",id:1},{rule:"optional",type:"uint32",name:"iceCandidatePoolSize",id:3},{rule:"repeated",type:"IceServer",name:"iceServers",id:4},{rule:"optional",type:"IceTransportPolicy",name:"iceTransportPolicy",id:5},{rule:"optional",type:"string",name:"peerIdentity",id:6},{rule:"optional",type:"RtcpMuxPolicy",name:"rtcpMuxPolicy",id:7}],enums:[{name:"BundlePolicy",values:[{name:"BundlePolicyBalanced",id:1},{name:"BundlePolicyMaxCompat",id:2},{name:"BundlePolicyMaxBundle",id:3}]},{name:"IceTransportPolicy",values:[{name:"IceTransportPolicyAll",id:1},{name:"IceTransportPolicyPublic",id:2},{name:"IceTransportPolicyRelay",id:3}]},{name:"RtcpMuxPolicy",values:[{name:"RtcpMuxPolicyNegotiate",id:1},{name:"RtcpMuxPolicyRequire",id:2}]}]},{name:"CreateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamId",id:2},{rule:"optional",type:"string",name:"instanceRouteKey",id:5},{rule:"repeated",type:"string",name:"streamUris",id:8},{rule:"optional",type:"RtcConfiguration",name:"rtcConfiguration",id:9},{rule:"optional",type:"SetRemoteDescriptionResponse",name:"setRemoteDescriptionResponse",id:3},{rule:"optional",type:"CreateOfferDescriptionResponse",name:"createOfferDescriptionResponse",id:4},{rule:"optional",type:"CreateAnswerDescriptionResponse",name:"createAnswerDescriptionResponse",id:6},{rule:"repeated",type:"string",name:"options",id:7},{rule:"optional",type:"uint64",name:"offset",id:10,options:{default:0}}]},{name:"SetLocalDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"SetLocalDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"SetRemoteDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"SetRemoteDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateOfferDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"CreateOfferDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateAnswerDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"CreateAnswerDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"IceCandidate",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"uint32",name:"sdpMLineIndex",id:2},{rule:"required",type:"string",name:"sdpMid",id:3}]},{name:"AddIceCandidates",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"IceCandidate",name:"candidates",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"uint32",name:"apiVersion",id:4,options:{default:0}}]},{name:"AddIceCandidatesResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"UpdateStreamState",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"string",name:"signalingState",id:2},{rule:"required",type:"string",name:"iceGatheringState",id:3},{rule:"required",type:"string",name:"iceConnectionState",id:4},{rule:"optional",type:"uint32",name:"apiVersion",id:5,options:{default:0}}]},{name:"UpdateStreamStateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"DestroyStream",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"optional",type:"string",name:"reason",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"DestroyStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"ConnectionDisconnected",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"uint32",name:"reasonCode",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"ConnectionDisconnectedResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"StreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"tags",id:3}]},{name:"SourceStreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"tags",id:4},{rule:"optional",type:"string",name:"continuationId",id:5},{rule:"optional",type:"string",name:"routeKey",id:6}]},{name:"SourceStreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"capabilities",id:4},{rule:"repeated",type:"string",name:"tags",id:5}]},{name:"StreamEndedResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"continuationId",id:2},{rule:"optional",type:"string",name:"routeKey",id:3}]},{name:"StreamIdle",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamArchived",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"uint64",name:"startTime",id:4},{rule:"required",type:"string",name:"uri",id:3}]},{name:"SessionEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2},{rule:"required",type:"float",name:"duration",id:3}]},{name:"ResourceIdle",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"routeKey",id:2}]},{name:"ResourceIdleResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"StreamPlaylist",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"PlaylistType",name:"playlistType",id:3},{rule:"required",type:"string",name:"uri",id:4},{rule:"required",type:"bool",name:"isVariant",id:5,options:{default:!0}}],enums:[{name:"PlaylistType",values:[{name:"Live",id:0},{name:"OnDemand",id:1}]}]},{name:"StreamRtmp",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"string",name:"uri",id:2},{rule:"required",type:"uint32",name:"height",id:3},{rule:"required",type:"uint32",name:"bitrate",id:4}]},{name:"SendEventToClient",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"string",name:"type",id:2},{rule:"required",type:"bytes",name:"payload",id:3}]},{name:"SendEventToClientResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SendRequestToClient",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"string",name:"type",id:2},{rule:"required",type:"bytes",name:"payload",id:3}]},{name:"SendRequestToClientResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"type",id:2},{rule:"optional",type:"bytes",name:"payload",id:3}]},{name:"SetupStream",fields:[{rule:"required",type:"string",name:"streamToken",id:1},{rule:"required",type:"CreateStream",name:"createStream",id:2}]},{name:"SetupStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"CreateStreamResponse",name:"createStreamResponse",id:2}]},{name:"SetupPlaylistStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamToken",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"PlaylistStreamManifest",fields:[{rule:"required",type:"string",name:"manifest",id:1},{rule:"required",type:"bool",name:"isProtectedContent",id:2},{rule:"optional",type:"string",name:"drmToken",id:3}]},{name:"SetupPlaylistStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"PlaylistStreamManifest",name:"manifests",id:2},{rule:"optional",type:"uint64",name:"offset",id:3,options:{default:0}}]},{name:"StreamDataQuality",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3},{rule:"required",type:"DataQualityStatus",name:"status",id:4},{rule:"required",type:"DataQualityReason",name:"reason",id:5}],enums:[{name:"DataQualityStatus",values:[{name:"NoData",id:0},{name:"AudioOnly",id:1},{name:"All",id:2}]},{name:"DataQualityReason",values:[{name:"None",id:0},{name:"UploadLimited",id:1},{name:"DownloadLimited",id:2},{name:"PublisherLimited",id:3},{name:"NetworkLimited",id:4}]}]},{name:"StreamDataQualityResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"CallbackEvent",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:1,options:{default:0}},{rule:"required",type:"string",name:"entity",id:2},{rule:"required",type:"string",name:"what",id:3},{rule:"required",type:"string",name:"data",id:4},{rule:"optional",type:"string",name:"sessionId",id:5}]},{name:"Uri",fields:[{rule:"optional",type:"string",name:"protocol",id:1,options:{default:"http"}},{rule:"required",type:"string",name:"host",id:2},{rule:"optional",type:"uint32",name:"port",id:3,options:{default:80}},{rule:"optional",type:"string",name:"method",id:4,options:{default:"POST"}},{rule:"optional",type:"string",name:"path",id:5,options:{default:"/"}}]},{name:"SetApplicationCallback",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"Uri",name:"callback",id:3}]},{name:"SetApplicationCallbackResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"endpoint",id:2}]},{name:"IssueAuthenticationToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3}]},{name:"IssueAuthenticationTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"authenticationToken",id:2}]},{name:"IssueStreamToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"sessionId",id:3},{rule:"optional",type:"string",name:"originStreamId",id:4},{rule:"repeated",type:"string",name:"alternateOriginStreamIds",id:6},{rule:"repeated",type:"string",name:"capabilities",id:5},{rule:"optional",type:"bool",name:"permissive",id:7,options:{default:!1}}]},{name:"IssueStreamTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamToken",id:2}]},{name:"IssueDrmToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"sessionId",id:3},{rule:"required",type:"string",name:"originStreamId",id:4},{rule:"repeated",type:"string",name:"capabilities",id:5}]},{name:"IssueDrmTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"drmToken",id:2}]},{name:"TerminateStream",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"streamId",id:3,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"streamToken",id:5,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"reason",id:4}],oneofs:{streamOrToken:[3,5]}},{name:"TerminateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"DeleteStream",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"streamId",id:3,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"streamToken",id:5,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"reason",id:4}],oneofs:{streamOrToken:[3,5]}},{name:"DeleteStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"Stream",fields:[{rule:"required",type:"string",name:"streamId",id:1}]},{name:"ListStreams",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"start",id:3},{rule:"required",type:"uint32",name:"length",id:4},{rule:"repeated",type:"string",name:"options",id:5}]},{name:"ListStreamsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"start",id:2},{rule:"optional",type:"uint32",name:"length",id:3},{rule:"repeated",type:"Stream",name:"streams",id:4}]},{name:"GetPlaylistUris",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"streamId",id:3},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"GetPlaylistUrisResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"Playlist",name:"playlists",id:2},{rule:"optional",type:"StreamMetadata",name:"streamInfo",id:3}],messages:[{name:"PlaylistMetadata",fields:[{rule:"optional",type:"uint32",name:"bitrate",id:1},{rule:"optional",type:"uint32",name:"height",id:2},{rule:"optional",type:"float",name:"framesPerSecond",id:3}]},{name:"StreamMetadata",fields:[{rule:"required",type:"string",name:"startTime",id:1},{rule:"optional",type:"string",name:"endTime",id:2}]},{name:"Playlist",fields:[{rule:"required",type:"string",name:"name",id:1},{rule:"required",type:"PlaylistType",name:"type",id:2},{rule:"required",type:"string",name:"uri",id:3},{rule:"required",type:"bool",name:"isVariant",id:4},{rule:"required",type:"bool",name:"isProtected",id:5},{rule:"required",type:"PlaylistMetadata",name:"info",id:6}]}],enums:[{name:"PlaylistType",values:[{name:"Hls",id:0},{name:"Dash",id:1}]}]}]}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{package:"chat",options:{optimize_for:"LITE_RUNTIME"},messages:[{name:"Room",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"required",type:"string",name:"name",id:3},{rule:"required",type:"string",name:"description",id:4},{rule:"required",type:"RoomType",name:"type",id:5},{rule:"repeated",type:"string",name:"options",id:6},{rule:"optional",type:"string",name:"bridgeId",id:7},{rule:"optional",type:"string",name:"pin",id:8}]},{name:"Stream",fields:[{rule:"required",type:"StreamType",name:"type",id:1},{rule:"required",type:"string",name:"uri",id:2},{rule:"required",type:"TrackState",name:"audioState",id:3},{rule:"required",type:"TrackState",name:"videoState",id:4}]},{name:"Member",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"screenName",id:2},{rule:"required",type:"MemberRole",name:"role",id:3},{rule:"repeated",type:"Stream",name:"streams",id:4},{rule:"required",type:"MemberState",name:"state",id:5},{rule:"required",type:"uint64",name:"lastUpdate",id:6}]},{name:"MemberUpdate",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"screenName",id:2},{rule:"optional",type:"MemberRole",name:"role",id:3},{rule:"required",type:"bool",name:"updateStreams",id:7,options:{default:!1}},{rule:"repeated",type:"Stream",name:"streams",id:4},{rule:"optional",type:"MemberState",name:"state",id:5},{rule:"required",type:"uint64",name:"lastUpdate",id:6}]},{name:"ChatUser",fields:[{rule:"optional",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"screenName",id:2},{rule:"required",type:"MemberRole",name:"role",id:3},{rule:"required",type:"uint64",name:"lastUpdate",id:4}]},{name:"ChatMessage",fields:[{rule:"required",type:"string",name:"messageId",id:1},{rule:"required",type:"uint64",name:"timestamp",id:2},{rule:"required",type:"ChatUser",name:"from",id:3},{rule:"required",type:"string",name:"message",id:4}]},{name:"CreateRoom",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"Room",name:"room",id:2}]},{name:"CreateRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2}]},{name:"JoinRoom",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"required",type:"string",name:"sessionId",id:3},{rule:"required",type:"Member",name:"member",id:4},{rule:"repeated",type:"string",name:"options",id:5},{rule:"required",type:"uint64",name:"timestamp",id:6}]},{name:"JoinRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2},{rule:"repeated",type:"Member",name:"members",id:3},{rule:"optional",type:"Member",name:"self",id:5},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"UpdateRoom",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"Room",name:"room",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3}]},{name:"UpdateRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"UpdateMember",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"roomId",id:5},{rule:"required",type:"MemberUpdate",name:"member",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"required",type:"uint64",name:"timestamp",id:4}]},{name:"UpdateMemberResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"uint64",name:"lastUpdate",id:2}]},{name:"LeaveRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"string",name:"sessionId",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3}]},{name:"LeaveRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"DestroyRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1}]},{name:"DestroyRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"GetRoomInfo",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"optional",type:"string",name:"sessionId",id:3},{rule:"optional",type:"string",name:"applicationId",id:4},{rule:"optional",type:"string",name:"secret",id:5},{rule:"repeated",type:"string",name:"options",id:6}]},{name:"GetRoomInfoResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2},{rule:"repeated",type:"Member",name:"members",id:3},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"RoomEvent",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"required",type:"RoomEventType",name:"eventType",id:3},{rule:"repeated",type:"Member",name:"members",id:4},{rule:"optional",type:"Room",name:"room",id:5},{rule:"repeated",type:"string",name:"options",id:6},{rule:"required",type:"uint64",name:"timestamp",id:7}]},{name:"SendMessageToRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"ChatMessage",name:"chatMessage",id:2}]},{name:"SendMessageToRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"FetchRoomConversation",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"optional",type:"string",name:"afterMessageId",id:3},{rule:"optional",type:"string",name:"beforeMessageId",id:4},{rule:"required",type:"uint32",name:"limit",id:5},{rule:"repeated",type:"RoomConversationOption",name:"options",id:6}]},{name:"FetchRoomConversationResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"ChatMessage",name:"chatMessages",id:2}]},{name:"RoomConversationEvent",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"required",type:"RoomConversationEventType",name:"eventType",id:3},{rule:"repeated",type:"ChatMessage",name:"chatMessages",id:4}]},{name:"RoomBridgeIdle",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"string",name:"bridgeId",id:2}]}],enums:[{name:"RoomType",values:[{name:"DirectChat",id:0},{name:"MultiPartyChat",id:1},{name:"ModeratedChat",id:2},{name:"TownHall",id:3},{name:"Channel",id:4}]},{name:"MemberRole",values:[{name:"Participant",id:0},{name:"Moderator",id:1},{name:"Presenter",id:2},{name:"Audience",id:3}]},{name:"MemberState",values:[{name:"Active",id:0},{name:"Passive",id:1},{name:"HandRaised",id:2},{name:"Inactive",id:3},{name:"Offline",id:4}]},{name:"RoomEventType",values:[{name:"MemberJoined",id:0},{name:"MemberLeft",id:1},{name:"MemberUpdated",id:2},{name:"RoomUpdated",id:3},{name:"RoomEnded",id:4}]},{name:"TrackState",values:[{name:"TrackEnabled",id:0},{name:"TrackDisabled",id:1},{name:"TrackEnded",id:2}]},{name:"StreamType",values:[{name:"User",id:0},{name:"Presentation",id:1},{name:"Audio",id:2}]},{name:"RoomConversationOption",values:[{name:"Subscribe",id:0}]},{name:"RoomConversationEventType",values:[{name:"Message",id:0}]}]}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(84)],void 0===(r=function(t){return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(6),i(2)],void 0===(r=function(s,n,e,r){"use strict";function t(t,e,i){n.xt(t,"options"),n.xt(t.logger,"options.logger"),n.Nt(t.version,"options.version"),n.Ct(e,"onClosestEndpointFound"),i&&n.Ct(i,"onAnEndpointResolved"),this.Pt=t.logger,this.Tt=t.version,this.Fo=e,this.Uo=i,this.g=new r.DisposableList,this.No=!1}return t.prototype.isResolved=function(){return this.No},t.prototype.dispose=function(){this.g.dispose()},t.prototype.completeCallback=function(t,e,i){if(!this.isResolved())return this.No=!0,this.Fo(null,{uri:i,roundTripTime:e,endPoint:t})},t.prototype.resolveAll=function(t){for(var e=0;e<t.length;e++)this.resolve(t[e])},t.prototype.resolve=function(n){var r=this;r.Pt.info("Checking end point [%s]",n);var t=e.getWithRetry(n,{timeout:15e3,queryParameters:{version:r.Tt,_:s.now()},retryOptions:{maxAttempts:1}},function(t,e){var i=s.get(e,["stats","successResponseTime"],0);if(r.Uo&&(t?r.Uo(t,{endPoint:n}):r.Uo(null,{time:i,endPoint:n})),t)503===t.code?r.Pt.info("End point [%s] is temporarily unavailable",n):r.Pt.warn("Unable to resolve end point [%s] with [%s]",n,t);else if(!r.isResolved())return r.completeCallback(n,i,e.data)});r.g.add(t)},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(3)],void 0===(r=function(u,i,n,r){"use strict";var t=52;function e(t,e){t=t||{},i.xt(t,"options"),i.xt(e,"logger"),this.Pt=e,this.jo=t.screenSharingExtensionId||function(){switch(r.browser){case"Chrome":return"icngjadgidcmifnehjcielbmiapkhjpn";case"Firefox":default:return""}}(),this.Lo=t.eagerlyCheckScreenSharingCapabilities||!1,this._o=!1,this.Bo=new n.Observable(!1),this.Lo?c.call(this,u.bind(s,this)):s.call(this,!1)}function s(t){this.Bo.setValue(!0),this._o=t}function c(e){var i=this;if("Chrome"===r.browser&&i.jo){var n=h.call(this);if(!n)return e(!1);try{n.sendMessage(i.jo,{type:"version"},function(t){if(n.lastError||!t||"ok"!==t.status)return i.Pt.info("Screen sharing NOT available"),void e(!1);i.Pt.info("Screen sharing enabled using version [%s]",t.version),e(!0)})}catch(t){t.message&&i.Pt.warn(t.message,t),e(!1)}}else"Firefox"===r.browser&&r.browserVersion>=t?e(!0):"Firefox"===r.browser&&u.xt(r.global.PCastScreenSharing)?e(!0):e(!1)}function o(t){if(this.Bo.getValue())return t();var e=this.Bo.subscribe(function(){return e.dispose(),t()})}function a(o,a){switch(r.browser){case"Chrome":return function(e){var i=this,n=h.call(this);if(!n)return e(new Error("not-available"));try{n.sendMessage(i.jo,{type:"get-desktop-media",sources:["screen","window","tab","audio"]},function(t){if(n.lastError||!t)return c.call(i,function(t){return s.call(i,t),e(new Error("extension-failure"))});"ok"===t.status?e(null,t):e(new Error(t.status),t)})}catch(t){t.message&&i.Pt.warn(t.message),e(t,{status:"failed"})}}.call(this,function(t,e){if(t||e&&"ok"!==e.status)return a(t,e);var i,n,r,s;e.data||e.options||(e.options={canRequestAudioTrack:!0}),a(null,{status:"ok",constraints:(i=o,n=e.streamId,r=e.options,s={},u.xt(i)&&u.xt(i.screen)&&(s.video=i.screen),u.xt(i)&&u.xt(i.screenAudio)&&r.canRequestAudioTrack&&(s.audio=i.screenAudio),i.screen&&u.set(s,["video","mandatory"],{chromeMediaSource:"desktop",chromeMediaSourceId:n}),i.screenAudio&&r.canRequestAudioTrack&&u.set(s,["audio","mandatory"],{chromeMediaSource:"system",chromeMediaSourceId:n}),s)})});case"Firefox":a(null,{status:"ok",constraints:(t=o,e={video:{}},u.xt(t)&&u.xt(t.screen)&&(e.video=t.screen),e.video.mediaSource=e.video.mediaSource||"window",e)});break;default:a(new Error("not-supported"),{status:"not-supported"})}var t,e}function h(){switch(r.browser){case"Chrome":return"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.sendMessage?chrome.runtime:(this.Pt.info("Screen sharing NOT available. Runtime not supported"),null);case"Firefox":default:return null}}return e.prototype.checkForScreenSharingCapability=function(e){return c.call(this,function(t){s.call(this,t),e(t)})},e.prototype.isScreenSharingEnabled=function(e){var i=this;return o.call(this,function(){if(i.Lo||i._o)return e(i._o);c.call(i,function(t){i._o=t,e(t)})})},e.prototype.getScreenSharingConstraints=function(t,e){return o.call(this,u.bind(a,this,t,e))},e.prototype.toString=function(){return"ScreenShareExtensionManager["+r.browser+"]"},e}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(3)],void 0===(r=function(u,c,h){"use strict";function t(t,e,i){c.xt(t,"logger"),c.xt(e,"screenShareExtensionManager"),i&&c.Ct(i,"onScreenShare"),this.Pt=t,this.ln=e,this.$r=i}function i(n,e,r){function s(t){r(f(t),void 0,t)}function o(t){(function(n){var r={},s={},o=this;setTimeout(function t(){var e;e=n,u.reduce(e.getTracks(),function(t,e){return t&&(i=e,c.qe(i,"track"),"ended"===i.readyState);var i},!0)||(u.forEach(n.getTracks(),function(t){if(h.global.Event&&u.hasIndexOrKey(r,t.id)&&r[t.id]!==t.enabled){var e=new h.global.Event("trackenabledchange");(e.data=t).dispatchEvent(e),o.Pt.info("[%s] Detected track [%s] enabled change to [%s]",n.id,t.id,t.enabled)}if(h.global.Event&&u.hasIndexOrKey(s,t.id)&&s[t.id]!==t.readyState){var i=new h.global.Event("readystatechange");(i.data=t).dispatchEvent(i),o.Pt.info("[%s] Detected track [%s] Ready State change to [%s]",n.id,t.id,t.readyState)}r[t.id]=t.enabled,s[t.id]=t.readyState}),setTimeout(t,2e3))},2e3)}).call(a,t),e("ok",t)}var a=this;return function(e,i){var n=this;if(e.screen)return n.ln.isScreenSharingEnabled(function(t){return t?n.ln.getScreenSharingConstraints(e,i):i(new Error("screen-sharing-not-available"))});var t={audio:e.audio||!1,video:e.video||!1};i(null,{status:"ok",constraints:t})}.call(this,n,function(t,e){if("ok"!==u.get(e,["status"]))return s(t);if("cancelled"!==e.status){var i=e.constraints;if(a.$r&&(n.screen||n.screenAudio)&&"Chrome"===h.browser&&!(i=a.$r(i)))throw new Error("onScreenShare must return an object of user media constraints");try{h.getUserMedia(i,o,s)}catch(t){s(t)}}else r("cancelled",null)})}t.prototype.getUserMedia=function(t,e){c.xt(t,"options"),c.Ct(e,"callback"),function(n,r){function s(t,e){a.Wn&&a.Wn.push(e),r(a,t,e)}function o(t,e,i){n.screenAudio&&a.Pt.warn("Screen capture with audio is only supported on Windows or Chrome OS."),r(a,t,e,i)}var a=this,t=n.screen||n.screenAudio,e=n.video||n.audio;return t&&e?i.call(a,{screen:n.screen},function(t,r){return i.call(a,{audio:n.audio,video:n.video},function(t,e){var i,n;i=e,n=r.getTracks(),i&&u.Ct(i.addTrack)&&u.forEach(n,function(t){i.addTrack(t)}),s(t,e)},function(t,e,i){!function(t){if(t&&u.Ct(t.stop)&&t.stop(),t&&u.Ct(t.getTracks))for(var e=t.getTracks(),i=0;i<e.length;i++)e[i].stop()}(r),o(t,e,i)})},o):i.call(a,n,s,o)}.call(this,t,e)};var f=function(t){return"unavailable"===t.code?"conflict":"permission-denied"===t.message?"permission-denied":"PermissionDeniedError"===t.name?"permission-denied":"InternalError"===t.name&&"Starting video failed"===t.message?"conflict":"SourceUnavailableError"===t.name?"conflict":"SecurityError"===t.name&&"The operation is insecure."===t.message?"permission-denied":"failed"};return t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(19),i(88)],void 0===(r=function(t,e,n,r){var s={urls:{local:"",staging:"https://telemetry-stg.phenixrts.com",production:"https://telemetry.phenixrts.com"}};function i(){this.zo={}}return i.prototype.createMetricsTransmitter=function(t){var e=n.parseEnvFromPcastBaseUri(t||""),i=s.urls[e];return this.zo[e]||(this.zo[e]=function(t){var e=new r(t);return t||e.setEnabled(!1),e}.call(this,i)),this.zo[e]},new i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(20),i(3),i(31)],void 0===(r=function(a,u,e,i,n){function t(t){u.Yt(t,"uri"),this.Gs="/telemetry/metrics",this.Ks="object"==typeof location?location.hostname:i.browser+"-"+i.browserVersion+"-unknown",this.Ns=!0,this.Js=(i.browser||"Browser")+"/"+(i.browserVersion||"?"),this.Qs=new e.BatchHttpProto(t+this.Gs,[n],"telemetry.SubmitMetricRecords",{maxAttempts:3,maxBufferedRecords:1e3,maxBatchSize:512}),this.Qs.on("capacity",a.bind(r,this))}function r(t){this.Qs.addRecordToBeginning({metric:"MetricDropped",value:{uint64:t},timestamp:a.isoString(),sessionId:this.$s,streamId:this.Wo,source:this.Js,fullQualifiedName:this.Ks,environment:this.Zs,version:this.to,runtime:this.Xs})}return t.prototype.isEnabled=function(){return this.Ns},t.prototype.setEnabled=function(t){u.hn(t,"enabled"),this.Ns=t},t.prototype.submitMetric=function(t,e,i,n,r,s,o){this.Ns&&(u.Nt(t,"metric"),u.xt(o,"value"),this.Xs=e,this.$s=i,this.Wo=n,this.Zs=r,this.to=s,function(t,e){var i=a.assign({},e,{metric:t,timestamp:a.isoString(),sessionId:this.$s,streamId:this.Wo,source:this.Js,fullQualifiedName:this.Ks,environment:this.Zs,version:this.to,runtime:this.Xs});this.Qs.addRecord(i)}.call(this,t,o))},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(2),i(3)],void 0===(r=function(u,s,c,h){"use strict";var t=h.global.__phenixPageLoadTime||h.global.__pageLoadTime||u.now();function e(t,e,i){s.Nt(t,"sessionId"),this._s="production",this.Tt="2020-07-14T03:13:57Z",this.Lr=t,this.Vo={},this.Pt=e,this.dn=i,this.Ho=u.now(),this.g=new c.DisposableList,this.Go=[],this.Ko=[],this.Jo=[],this.Xo=null,f.call(this,"Stream initializing")}function f(){var t=Array.prototype.slice.call(arguments);if(0===t.length)throw new Error("Invalid logging arguments.");var e="[%s] [StreamTelemetry] [%s] "+t[0],i=t.slice(1),n=[e,this.$i,u.now()-this.Ho].concat(i);this.Pt.debug.apply(this.Pt,n)}function o(){return(u.now()-t)/1e3}function a(t,e){s.Nt(t.metric,"record.metric");var i=u.assign({},this.Vo,t);this.dn.submitMetric(t.metric,e,this.Lr,this.$i,this._s,this.Tt,i)}return e.prototype.setProperty=function(t,e){s.Nt(t,"name"),s.Nt(e,"value"),this.Vo[t]=e},e.prototype.recordMetric=function(t,e,i,n){s.Nt(t,"metric");var r=u.assign({},{metric:t,elapsed:this.elapsed(),value:e,previousValue:i},n||{});a.call(this,r,o())},e.prototype.setStreamId=function(t){if(s.Nt(t,"streamId"),this.$i)throw new Error("Stream ID can only be set once.");this.$i=t;var e=u.now();a.call(this,{metric:"Initialized",elapsed:this.elapsed()-e+this.Ho},o()-(e-this.Ho)/1e3)},e.prototype.setStartOffset=function(t){if(s.re(t,"startOffset"),this.Qo)throw new Error("Start offset can only be set once.");this.Qo=t,this.recordMetric("Offset",{uint64:t})},e.prototype.getStartOffset=function(){return this.Qo},e.prototype.elapsed=function(){return u.now()-this.Ho},e.prototype.stop=function(){this.g.dispose(),this.recordMetric("Stopped"),f.call(this,"Stream stopped")},e.prototype.recordTimeToFirstFrame=function(t){function e(){i.Xo||(i.Xo=u.now()-n,i.recordMetric("TimeToFirstFrame",{uint64:i.Xo}),f.call(i,"First frame [%s]",i.Xo),r.dispose())}var i=this,n=u.now();u.addEventListener(t,"loadeddata",e),u.addEventListener(t,"loadedmetadata",e);var r=new c.Disposable(function(){u.removeEventListener(t,"loadeddata",e),u.removeEventListener(t,"loadedmetadata",e)});return this.g.add(r),r},e.prototype.recordVideoResolutionChanges=function(t,e){var i=this,n={width:e.videoWidth,height:e.videoHeight};if(u.find(this.Go,function(t){return t===e}))return new c.Disposable(u.noop);this.Go.push(e);var r=t.addVideoDisplayDimensionsChangedCallback(function(t,e){n.width===e.width&&n.height===e.height||(i.recordMetric("ResolutionChanged",{string:e.width+"x"+e.height},{string:n.width+"x"+n.height}),n={width:e.width,height:e.height},f.call(i,"Resolution changed: width [%s] height [%s]",e.width,e.height))});return this.g.add(r),r},e.prototype.recordRebuffering=function(r){var s,o,a=this;if(u.find(this.Ko,function(t){return t===r}))return new c.Disposable(u.noop);function t(){s||(a.recordMetric("Stalled"),s=u.now(),f.call(a,"[buffering] Stream has stalled"))}function e(t){var e=r.buffered.length,i=!("playing"===t.type||0<e)||("progress"===t.type||"timeupdate"===t.type)&&r.buffered.end(e-1)===o;if(s&&(e||"Edge"===h.browser)&&!i){"progress"===t.type&&(o=r.buffered.end(e-1));var n=u.now()-s;a.recordMetric("Buffering",{uint64:n}),f.call(a,"[buffering] Stream has recovered from stall after [%s] milliseconds",n),s=null}}this.Ko.push(r),u.addEventListener(r,"stalled",t),u.addEventListener(r,"pause",t),u.addEventListener(r,"suspend",t),u.addEventListener(r,"play",e),u.addEventListener(r,"playing",e),u.addEventListener(r,"progress",e),u.addEventListener(r,"timeupdate",e);var i=new c.Disposable(function(){u.removeEventListener(r,"stalled",t),u.removeEventListener(r,"pause",t),u.removeEventListener(r,"suspend",t),u.removeEventListener(r,"play",e),u.removeEventListener(r,"playing",e),u.removeEventListener(r,"progress",e),u.removeEventListener(r,"timeupdate",e)});return this.g.add(i),i},e.prototype.recordVideoPlayingAndPausing=function(e){var t=this;if(u.find(this.Jo,function(t){return t===e}))return new c.Disposable(u.noop);function i(){e.paused?t.recordMetric("Playing",{boolean:!1}):t.recordMetric("Playing",{boolean:!0})}this.Jo.push(e),u.addEventListener(e,"pause",i),u.addEventListener(e,"playing",i);var n=new c.Disposable(function(){u.removeEventListener(e,"pause",i),u.removeEventListener(e,"playing",i)});return this.g.add(n),n},e}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(2),i(10),i(91),i(3)],void 0===(r=function(s,o,i,n,r,a){"use strict";var t=a.global.__phenixPageLoadTime||a.global.__pageLoadTime||s.now();function e(t,e){this._s="production",this.Tt="2020-07-14T03:13:57Z",this.Lr=null,this.Vo={resource:"session",kind:"event"},this.Pt=t,this.dn=e,this.$o=new r(this.Pt),this.Ho=s.now(),this.g=new i.DisposableList,this.Ro=[],this.g.add(n.onBackground(s.bind(u,this,!1))),this.g.add(n.onForeground(s.bind(u,this,!0))),this.$o.isSupported()&&(this.g.add(this.$o.onNetworkChange(s.bind(d,this))),this.g.add(this.$o),c.call(this),f.call(this),h.call(this))}function u(t,e){var i=t?"ApplicationForeground":"ApplicationBackground";this.recordMetric(i,{uint64:e}),l.call(this,"Application has gone into the [%s] after [%s] ms",t?"foreground":"background",e)}function c(){var t=this.$o.getEffectiveType();this.recordMetric("NetworkType",{string:t},null,{resource:a.browser}),l.call(this,"[%s] has started with Network effective type of [%s]",this.Lr?"Session":"Application",t)}function h(t,e){var i=t||this.$o.getRoundTripTime(),n=e||-1;if(this.recordMetric("RoundTripTime",{uint32:i},{uint32:n},{resource:a.browser}),s.isNullOrUndefined(e))return l.call(this,"Network RTT [%s]",i);l.call(this,"Network RTT changed to [%s] from [%s]",i,n)}function f(t,e){var i=t||this.$o.getDownlinkThroughputCapacity(),n=e||-1;if(this.recordMetric("DownlinkThroughputCapacity",{float:i},{float:n},{resource:a.browser}),s.isNullOrUndefined(e))return l.call(this,"Network downlink throughput capacity [%s]",i);l.call(this,"Network downlink throughput capacity changed to [%s] from [%s]",i,n)}function d(t,e){e.downlinkThroughputCapacity!==t.downlinkThroughputCapacity&&f.call(this,t.downlinkThroughputCapacity,e.downlinkThroughputCapacity),e.rtt!==t.rtt&&h.call(this,t.rtt,e.rtt),e.effectiveType!==t.effectiveType&&function(t,e){var i=t||this.$o.getEffectiveType(),n=e;this.recordMetric("NetworkType",{string:i},{string:n},{resource:a.browser}),l.call(this,"Network effective type has changed to [%s] from [%s]",i,n||"New")}.call(this,t.effectiveType,e.effectiveType)}function l(){var t=Array.prototype.slice.call(arguments);if(0===t.length)throw new Error("Invalid logging arguments.");var e="[%s] [SessionTelemetry] [%s] "+t[0],i=t.slice(1),n=[e,this.Lr,s.now()-this.Ho].concat(i);this.Pt.info.apply(this.Pt,n)}function m(){return(s.now()-t)/1e3}function p(t,e){if(o.Nt(t.metric,"record.metric"),!this.Lr)return this.Ro.push({record:t,since:e});var i=s.assign({},this.Vo,t);this.dn.submitMetric(t.metric,e,this.Lr,null,this._s,this.Tt,i)}return e.prototype.setSessionId=function(t){!t&&this.Lr&&p.call(this,{metric:"Stopped",elapsed:this.elapsed()},m()),(this.Lr=t)&&(p.call(this,{metric:"Initialized",elapsed:this.elapsed()},m()),function(){if(this.Lr)for(var t=this.Ro.length;0<t;){var e=this.Ro.splice(t-1,1);1===e.length&&p.call(this,e[0].record,e[0].since),t--}}.call(this),function(){var t=n.isForeground(),e=n.getTimeSinceLastChange(),i=t?"ApplicationForeground":"ApplicationBackground";this.recordMetric(i,{uint64:e}),l.call(this,"Session has started in the [%s] after [%s] ms",t?"foreground":"background",e)}.call(this),this.$o.isSupported()&&(c.call(this),f.call(this),h.call(this)))},e.prototype.setProperty=function(t,e){o.Nt(t,"name"),o.Nt(e,"value"),this.Vo[t]=e},e.prototype.recordMetric=function(t,e,i,n){o.Nt(t,"metric");var r=s.assign({},{metric:t,elapsed:this.elapsed(),value:e,previousValue:i},n||{});p.call(this,r,m())},e.prototype.elapsed=function(){return s.now()-this.Ho},e.prototype.dispose=function(){this.g.dispose(),this.recordMetric("Stopped"),l.call(this,"Session telemetry stopped")},e}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5),i(2),i(3)],void 0===(r=function(t,e,i,n,r){function s(t){if(e.xt(t,"logger"),this.Pt=t,this.Xn=new i.NamedEvents,this.g=new n.DisposableList,this.g.add(this.Xn),!this.isSupported())return this.Pt.info("Network monitor is not supported.");this.Yo=o.call(this),function(){var t=this;navigator.connection.addEventListener("change",function(){t.Xn.fireAsync("NetworkChange",[o.call(t),t.Yo]),t.Yo=o.call(t)})}.call(this)}function o(){return{downlinkThroughputCapacity:this.getDownlinkThroughputCapacity(),effectiveType:this.getEffectiveType(),rtt:this.getRoundTripTime()}}return s.prototype.isSupported=function(){return r.global.navigator&&r.global.navigator.connection},s.prototype.getDownlinkThroughputCapacity=function(){return this.isSupported()?r.global.navigator.connection.downlink||r.global.navigator.connection.downlinkMax:-1},s.prototype.getEffectiveType=function(){return this.isSupported()?r.global.navigator.connection.effectiveType||r.global.navigator.connection.type:"Unknown"},s.prototype.getRoundTripTime=function(){return this.isSupported()?r.global.navigator.connection.rtt||r.global.navigator.connection.type:-1},s.prototype.onNetworkChange=function(t){if(this.isSupported())return e.Ct(t,"callback"),this.Xn.listen("NetworkChange",t)},s.prototype.dispose=function(){this.g.dispose()},s}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(7)],void 0===(r=function(r,s,o){"use strict";function a(t,e,i){s.Nt(t,"type"),s.xt(e,"stream"),s.xt(i,"logger"),this.Wt=t,this.a=e,this.Pt=i,this.Zo=null;var n=this;this.a.on(o.streamEvents.playerEnded.name,function(t){if(n.Pt.info("[%s] [%s] player ended.",n.a.getStreamId(),n.Wt),n.ta=!0,n.Zo)return n.Zo();n.streamEndedCallback(a.getStreamEndedStatus(t),t)})}return a.prototype.toString=function(){return"Stream["+(this.a?this.a.getStreamId():"")+"]"},a.prototype.on=function(t,e){return this.a.on(t,e)},a.prototype.streamErrorCallback=function(t,e){r.Ct(this.a.streamErrorCallback)?(this.Pt.debug("[%s] [%s] stream error event [%s]",this.a.getStreamId(),this.Wt,e),this.a.streamErrorCallback(this.a,t,e)):this.Pt.error("[%s] [%s] stream error event [%s]",this.a.getStreamId(),this.Wt,e)},a.prototype.streamEndedCallback=function(t,e,i){var n=this.a.getRenderer();if(!this.ea){if(i&&!this.Zo&&this.a.isActive()&&n&&!this.ta)return this.Zo=r.bind(this.streamEndedCallback,this,t,e),this.Pt.info("[%s] [%s] stream ended. Waiting for end of player.",this.a.getStreamId(),this.Wt),void(n&&n.stop(e,i));this.ea=!0,r.Ct(this.a.streamEndedCallback)&&this.a.streamEndedCallback(this.a,t,e),this.a.stop(e),n&&n.stop(e,i)}},a.prototype.dataQualityChangedCallback=function(t,e){var i=this.a.getRenderer();i&&r.Ct(i.dataQualityChangedCallback)&&i.dataQualityChangedCallback(i,t,e)},a.prototype.getPhenixMediaStream=function(){return this.a},a.getStreamEndedStatus=function(t){switch(t){case"":case"none":case"ended":return"ended";case"server-error":case"session-error":case"not-ready":case"error":case"died":return"failed";case"censored":return"censored";case"maintenance":return"maintenance";case"capacity":return"capacity";case"app-background":return"app-background";case"egress-failed":return"egress-failed";case"egress-setup-failed":return"egress-setup-failed";case"overload":return"overload";default:return"custom"}},a}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5),i(6),i(2),i(3),i(11),i(7)],void 0===(r=function(o,e,a,r,u,h,c,s){"use strict";var f=null;function t(t,e,i,n,r,s){this.Pt=s,this.$i=t,this.ia=encodeURI(e).replace(/[#]/g,"%23"),this.kr=i,this.f=n,this.Ut=null,this.vt=null,this.Er=new c(s),this.Ki={time:0,buffered:null,averageLength:0,count:0},this.Xn=new a.NamedEvents,this.g=new u.DisposableList,this.mn=r,this.Gi=o.bind(l,this),this.Ji=o.bind(d,this),this.Qi=o.bind(m,this)}function d(){if(this.Ki.time=o.now(),0===this.vt.buffered.length)return this.Pt.debug("[%s] Shaka live stream player progress event fired without any buffered content",this.$i);var t=this.vt.buffered.end(this.vt.buffered.length-1);if(this.Ki.buffered!==t){if(null!==this.Ki.buffered){var e=this.Ki.averageLength*this.Ki.count+(t-this.Ki.buffered);this.Ki.count+=1,this.Ki.averageLength=e/this.Ki.count}this.Ki.buffered=t}}function l(){var t=this;t.Pt.info("[%s] Loading Shaka live stream player stream stalled.",t.$i),0!==t.Ki.time&&setTimeout(function(){o.now()-t.Ki.time>i.call(t)&&t.na&&t.stop("ended")},i.call(t))}function i(){return 1.5*this.Ki.averageLength<2e3?2e3:1.5*this.Ki.averageLength}function m(){this.Pt.info("[%s] Shaka live stream player ended.",this.$i)}return t.prototype.on=function(t,e){return this.Xn.listen(t,e)},t.prototype.start=function(e){var i=this;i.fi=new this.mn.Player(e),this.g.add(this.kr.recordTimeToFirstFrame(e)),this.g.add(this.kr.recordRebuffering(e)),this.g.add(this.kr.recordVideoResolutionChanges(this,e));var t={abr:{defaultBandwidthEstimate:2e6},manifest:{retryParameters:{timeout:1e4}},streaming:{rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,retryParameters:{timeout:1e4,maxAttempts:10,backoffFactor:1.1}}};function n(t){i.fi.configure(t),!1===i.f.receiveAudio&&(e.muted=!0),o.addEventListener(i.fi,"error",function(t){i.Xn.fire(s.rendererEvents.error.name,["player",t])}),o.addEventListener(e,"stalled",i.Gi,!1),o.addEventListener(e,"pause",i.Gi,!1),o.addEventListener(e,"suspend",i.Gi,!1),o.addEventListener(e,"progress",i.Ji,!1),o.addEventListener(e,"ended",i.Qi,!1),i.fi.load(i.ia).then(function(){i.Pt.info("[%s] DASH live stream has been loaded",i.$i),o.Ct(e.play)&&e.play()}).catch(function(t){i.Pt.error("[%s] Error while loading DASH live stream [%s]",i.$i,t.code,t),i.Xn.fire(s.rendererEvents.error.name,["shaka",t])}),i.Er.start(this,e),i.vt=e}return this.f.isDrmProtectedContent?(function(){var t;if(!o.Ct(Uint8Array))throw t="Uint8Array support required for DRM",this.Pt.error(t),new Error(t);if(!o.Ct(h.global.atob))throw t="rtc.global.atob support required for DRM",this.Pt.error(t),new Error(t)}.call(i),function(u){var c=this;u.getNetworkingEngine().registerResponseFilter(function(t,e){if(t.toString()===c.mn.net.NetworkingEngine.RequestType.LICENSE.toString()){var i=new Uint8Array(e.data),n=String.fromCharCode.apply(null,i),r=JSON.parse(n),s=r.license,o=h.global.atob(s);e.data=new Uint8Array(o.length);for(var a=0;a<o.length;++a)e.data[a]=o.charCodeAt(a);r.trackRestrictions&&u.configure({restrictions:r.trackRestrictions})}})}.call(i,i.fi),function(t,e,i){t.drm||(t.drm={}),t.drm.advanced||(t.drm.advanced={}),t.manifest||(t.manifest={}),t.manifest.dash||(t.manifest.dash={}),function(i,t,n){function e(t,e){t?n(t):(f=e.data,i.drm.advanced["com.widevine.alpha"]={serverCertificate:function(t){for(var e=t.length,i=new Uint8Array(e),n=0;n<e;n++)i[n]=t.charCodeAt(n);return i}(e.data),persistentStateRequired:!0,distinctiveIdentifierRequired:!1},n(null,i))}i.manifest.dash.customScheme=function(t){if("com.phenixrts.widevine"===t.getAttribute("schemeIdUri")||"com.phenixp2p.widevine"===t.getAttribute("schemeIdUri"))return[{keySystem:"com.widevine.alpha",licenseServerUri:decodeURIComponent(t.getAttribute("widevineLicenseServerUrl"))}]},f?e(null,f):r.get(t.widevineServiceCertificateUrl,{mimeType:"text/plain; charset=x-user-defined"},e)}.call(this,t,e,i)}.call(i,t,i.f,function(t,e){if(t)throw i.Pt.error("Failed to add DRM configuration to shaka player",t),t;n(e)})):n(t),e},t.prototype.stop=function(t,e){var i=this;if(!i.ra){if(e)return i.na=!0;if(this.Er.stop(),this.g.dispose(),this.fi){var n=function(){i.vt&&(o.removeEventListener(i.vt,"stalled",i.Gi,!1),o.removeEventListener(i.vt,"pause",i.Gi,!1),o.removeEventListener(i.vt,"suspend",i.Gi,!1),o.removeEventListener(i.vt,"progress",i.Ji,!1),o.removeEventListener(i.vt,"ended",i.Qi,!1),"Edge"===h.browser&&(i.vt.src="")),i.Xn.fire(s.rendererEvents.ended.name,[""]),i.fi=null,i.vt=null};i.fi.destroy().then(function(){i.Pt.info("[%s] Shaka live stream player has been destroyed",i.$i)}).then(function(){n()}).catch(function(t){i.Pt.error("[%s] Error while destroying shaka live stream player [%s]",i.$i,t.code,t),n(),i.Xn.fire(s.rendererEvents.error.name,["shaka",t])}),i.ra=!0}}},t.prototype.getStats=function(){if(!this.fi)return{width:0,height:0,currentTime:0,lag:0,networkState:s.networkStates.networkNoSource.id};var t=o.assign(this.fi.getStats(),{currentTime:0,lag:0}),e=o.get(this.vt,["currentTime"],0),i=(o.now()-this.f.originStartTime)/1e3,n=Math.max(0,i-e);return this.vt&&(t.currentTime=e,t.lag=n),0<t.estimatedBandwidth?t.networkState=s.networkStates.networkLoading.id:0<t.playTime?t.networkState=s.networkStates.networkIdle.id:t.video?t.networkState=s.networkStates.networkEmpty.id:t.networkState=s.networkStates.networkNoSource.id,t},t.prototype.setDataQualityChangedCallback=function(t){e.Ct(t,"callback"),this.dataQualityChangedCallback=t},t.prototype.getPlayer=function(){return this.fi},t.prototype.addVideoDisplayDimensionsChangedCallback=function(t,e){return this.Er.addVideoDisplayDimensionsChangedCallback(t,e)},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(9),i(5),i(6),i(2),i(12),i(3),i(11),i(7)],void 0===(r=function(s,e,o,a,t,u,c,r,h,f){"use strict";var d=6e3,i=15e3;function n(t,e,i,n,r){this.Pt=r,this.$i=t,this.ia=encodeURI(e).replace(/[#]/g,"%23"),this.kr=i,this.f=n,this.Ut=null,this.vt=null,this.Er=new h(r),this.Ki={time:0,buffered:null,averageLength:0,count:0,lastCurrentTime:0,lastCurrentTimeOccurenceTimestamp:0},this.Xn=new a.NamedEvents,this.g=new u.DisposableList,this.Gi=s.bind(g,this),this.Ji=s.bind(v,this),this.Qi=s.bind(w,this)}function l(t){if(p.call(this)&&t&&(3===t.code||t.severity===c.errors.severity.RECOVERABLE))return this.Pt.warn("Reloading unhealthy stream after error event [%s]",t),m.call(this);this.Xn.fire(f.rendererEvents.error.name,["phenix-player",t])}function m(){p.call(this)&&(this.Pt.warn("Reloading unhealthy stream that was active for at least [%s] seconds",i/1e3),this.sa=s.now(),function(){this.fi.dispose(),this.fi=null,this.start(this.vt)}.call(this))}function p(){var t=!this.sa||s.now()-this.sa>i;return this.vt&&!this.na&&this.fi&&0!==this.vt.buffered.length&&t}function v(){if(this.Ki.time=s.now(),0===this.vt.buffered.length)return this.Pt.debug("[%s] Phenix stream player progress event fired without any buffered content",this.$i);var t=this.vt.buffered.end(this.vt.buffered.length-1);if(this.Ki.buffered!==t){if(null!==this.Ki.buffered){var e=this.Ki.averageLength*this.Ki.count+(t-this.Ki.buffered),i=this.Ki.lastCurrentTime===this.vt.currentTime;this.Ki.count+=1,this.Ki.averageLength=e/this.Ki.count,i||(this.Ki.lastCurrentTimeOccurenceTimestamp=s.now());var n=this.Ki.lastCurrentTimeOccurenceTimestamp&&s.now()-this.Ki.lastCurrentTimeOccurenceTimestamp>d;i&&n&&this.vt&&!this.vt.paused&&p.call(this)&&(this.Pt.warn("Reloading stream after current time has not changed for [%s] seconds due to unregistered stall.",d/1e3),m.call(this))}this.Ki.buffered=t,this.Ki.lastCurrentTime=this.vt.currentTime}}function g(t){var e=this;if(e.Pt.info("[%s] Loading Phenix Live stream player stalled caused by [%s] event.",e.$i,t.type),0!==e.Ki.time&&!e.vt.paused){var i=e.vt.currentTime;setTimeout(function(){s.now()-e.Ki.time>y.call(e)&&e.na&&e.stop("ended")},y.call(e)),setTimeout(function(){e.vt&&e.vt.currentTime===i&&!e.vt.paused&&p.call(e)&&(e.Pt.warn("Reloading stream after being stalled for [%s] seconds",d/1e3),m.call(e))},d)}}function y(){return 1.5*this.Ki.averageLength<2e3?2e3:1.5*this.Ki.averageLength}function w(){this.Pt.info("[%s] Phenix stream player ended.",this.$i)}return n.isSupported=function(){return c.isSupported},n.prototype.on=function(t,e){return this.Xn.listen(t,e)},n.prototype.start=function(t){var e,i,n,r=(e=this.Pt,i=e.getAppenders(),n=new o.Logger,s.forEach(i,function(t){t instanceof o.ConsoleAppender&&(t=new o.ConsoleAppender).setThreshold(o.level.INFO),n.addAppender(t)}),n.setUserId(e.getUserId()),n.setEnvironment(e.getEnvironment()),n.setApplicationVersion(e.getApplicationVersion()),n.setObservableSessionId(e.getObservableSessionId()),n);return this.oa=r,this.vt=t,this.g.add(this.kr.recordTimeToFirstFrame(t)),this.g.add(this.kr.recordRebuffering(t)),this.g.add(this.kr.recordVideoResolutionChanges(this,t)),this.g.add(this.kr.recordVideoPlayingAndPausing(t)),function(){var t=s.assign({bandwidthToStartAt:3e6},this.f);s.includes(this.ia,".mpd")&&this.f.isDrmProtectedContent&&(t.drm={"com.widevine.alpha":{serverCertificateUrl:this.f.widevineServiceCertificateUrl,mediaKeySystemConfiguration:{persistentState:"required"}},"com.microsoft.playready":{licenseServerUrl:this.f.playreadyLicenseUrl}});var e=new c.WebPlayer(this.oa,this.vt,t);s.now()-this.f.originStartTime<6e3&&this.f.isDrmProtectedContent&&s.includes(this.ia,".m3u8")?setTimeout(s.bind(e.start,e,this.ia),6e3):e.start(this.ia),this.fi=e,s.addEventListener(this.fi,"error",s.bind(l,this))}.call(this),!1===this.f.receiveAudio&&(t.muted=!0),s.addEventListener(t,"stalled",this.Gi,!1),s.addEventListener(t,"pause",this.Gi,!1),s.addEventListener(t,"suspend",this.Gi,!1),s.addEventListener(t,"progress",this.Ji,!1),s.addEventListener(t,"ended",this.Qi,!1),this.Er.start(this,t),t},n.prototype.stop=function(t,e){var i=this;if(!i.ra){if(e)return i.na=!0;if(this.Er.stop(),this.g.dispose(),this.fi){var n=function(){i.vt&&(s.removeEventListener(i.vt,"stalled",i.Gi,!1),s.removeEventListener(i.vt,"pause",i.Gi,!1),s.removeEventListener(i.vt,"suspend",i.Gi,!1),s.removeEventListener(i.vt,"progress",i.Ji,!1),s.removeEventListener(i.vt,"ended",i.Qi,!1),"Edge"===r.browser&&(i.vt.src="")),i.Xn.fire(f.rendererEvents.ended.name,[""]),i.fi=null,i.vt=null};i.ra=!0;try{i.fi.dispose(),i.Pt.info("[%s] Phenix stream has been destroyed",i.$i),n()}catch(t){i.Pt.error("[%s] Error while destroying Phenix stream player [%s]",i.$i,t.code,t),n(),i.Xn.fire(f.rendererEvents.error.name,["phenix-player",t])}}}},n.prototype.getStats=function(){if(!this.fi)return{width:0,height:0,currentTime:0,lag:0,networkState:f.networkStates.networkNoSource.id};var t=this.fi.getStats(),e=t.currentTime||this.vt.currentTime,i=(s.now()-this.f.originStartTime)/1e3;return t.isNative&&"Hls"===t.deliveryType&&(t.currentTime=i-t.lag),t.isNative||(t.lag=Math.max(0,i-e)),0<t.estimatedBandwidth?t.networkState=f.networkStates.networkLoading.id:0<t.playTime?t.networkState=f.networkStates.networkIdle.id:t.video?t.networkState=f.networkStates.networkEmpty.id:t.networkState=f.networkStates.networkNoSource.id,t},n.prototype.setDataQualityChangedCallback=function(t){e.Ct(t,"callback"),this.dataQualityChangedCallback=t},n.prototype.getPlayer=function(){return this.fi},n.prototype.addVideoDisplayDimensionsChangedCallback=function(t,e){return this.Er.addVideoDisplayDimensionsChangedCallback(t,e)},n}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(9),i(5),i(6),i(2),i(12),i(3),i(11),i(7)],void 0===(r=function(c,o,t,a,e,u,i,h,f,n){"use strict";var r=6e3,s=15e3,d="rtmp-flash-renderer-2019.2.18.swf",l={local:"https://local.phenixrts.com/public/rtmp/"+d,staging:"https://stg.phenixrts.com/public/rtmp/"+d,production:"https://phenixrts.com/public/rtmp/"+d};function m(t,e,i,n,r){o.xt(n,"options"),n.env&&o.Nt(n.env,"options.env");var s=l[n.env||"production"];this.Pt=r,this.$i=t,this.aa=c.map(e,function(t){return t.uri=encodeURI(t.uri).replace(/[#]/g,"%23"),t}),this.kr=i,this.f=n,this.Ut=null,this.ua=null,this.ca=null,this.Xn=new a.NamedEvents,this.Er=new f(r),this.g=new u.DisposableList,this.Gi=c.bind(g,this),this.Qi=c.bind(y,this),this.Yi=c.bind(p,this),this.dt=n.swfSrc||s}function p(t){this.Xn.fire(n.rendererEvents.error.name,["flash-player",t])}function v(){var t=!this.sa||c.now()-this.sa>s;return this.ca&&!this.na&&this.fi&&0!==this.ca.buffered.length&&t}function g(t){var e=this;e.Pt.info("[%s] Loading flash player stalled caused by [%s] event.",e.$i,t.type);var i=e.ca.currentTime;setTimeout(function(){e.ca&&e.ca.currentTime===i&&!e.ca.paused&&v.call(e)&&(e.Pt.warn("Reloading stream after being stalled for [%s] seconds",r/1e3),function(){v.call(this)&&(this.Pt.warn("Reloading unhealthy stream that was active for at least [%s] seconds",s/1e3),this.sa=c.now(),function(){this.ua.destroy(),this.start(this.ha)}.call(this))}.call(e))},r)}function y(){this.Pt.info("[%s] Flash player ended.",this.$i)}m.isSupported=function(){return function(){var t=[10,0,0],e="Shockwave Flash",i=[0,0,0];if(c.hn(w))return w;if(c.get(h.global.navigator,["plugins",e])){var n=h.global.navigator.plugins[e].description;if(n&&c.get(h.global.navigator,["mimeTypes","application/x-shockwave-flash","enabledPlugin"],!1))for(var r=0,s=(i=n.replace(e,"").replace(/^\s+/,"").replace(/\sr/gi,".").split(".")).length;r<s;r++)i[r]=parseInt(i[r].match(/\d+/),10)}else if(h.global.ActiveXObject)try{var o=new h.global.ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(o){var a=o.GetVariable("$version")||"",u=c.get(a.split(" "),[1],i).split(",");i=[parseInt(u[0],10),parseInt(u[1],10),parseInt(u[2],10)]}}catch(t){console.error(t)}return w=i[0]>t[0]||i[0]===t[0]&&0<i[1]||i[0]===t[0]&&0===i[1]&&0<=i[2]}()},m.prototype.on=function(t,e){return this.Xn.listen(t,e)},m.prototype.start=function(t){var e={streamId:this.$i,swfSrc:this.dt};return this.ha=t,this.ua=new h.PhenixVideo(t,this.aa,"flash",e),this.ua.hookUpEvents(),this.ca=this.ua.getElement(),this.g.add(this.kr.recordTimeToFirstFrame(this.ha)),this.g.add(this.kr.recordRebuffering(this.ha)),this.g.add(this.kr.recordVideoResolutionChanges(this,this.ha)),this.g.add(this.kr.recordVideoPlayingAndPausing(this.ha)),this.ca&&this.ca.play(),c.addEventListener(this.ha,"stalled",this.Gi,!1),c.addEventListener(this.ha,"pause",this.Gi,!1),c.addEventListener(this.ha,"suspend",this.Gi,!1),c.addEventListener(this.ha,"ended",this.Qi,!1),c.addEventListener(this.ha,"error",this.Yi,!1),t},m.prototype.stop=function(t){var e=this;if(this.g.dispose(),this.ua){var i=function(){e.ca&&(c.removeEventListener(e.ha,"stalled",e.Gi,!1),c.removeEventListener(e.ha,"pause",e.Gi,!1),c.removeEventListener(e.ha,"suspend",e.Gi,!1),c.removeEventListener(e.ha,"ended",e.Qi,!1),c.removeEventListener(e.ha,"error",e.Yi,!1)),e.ca=null,e.ha=null,e.Xn.fire(n.rendererEvents.ended.name,[t])};try{this.ua.destroy(),this.ua=null,i(),this.Pt.info("[%s] Flash player has been destroyed",this.$i)}catch(t){e.Pt.error("[%s] Error while destroying Flash player [%s]",e.$i,t.code,t),i(),e.Xn.fire(n.rendererEvents.error.name,["flash-player",t])}}},m.prototype.getStats=function(){if(!this.ca)return{width:0,height:0,currentTime:0,lag:0,networkState:n.networkStates.networkNoSource.id};var t={},e=this.ca.currentTime,i=(c.now()-this.f.originStartTime)/1e3;return t.lag=Math.max(0,i-e),0<t.estimatedBandwidth?t.networkState=n.networkStates.networkLoading.id:0<t.playTime?t.networkState=n.networkStates.networkIdle.id:t.video?t.networkState=n.networkStates.networkEmpty.id:t.networkState=n.networkStates.networkNoSource.id,t},m.prototype.setDataQualityChangedCallback=function(t){o.Ct(t,"callback"),this.dataQualityChangedCallback=t},m.prototype.getPlayer=function(){return this.fi},m.prototype.addVideoDisplayDimensionsChangedCallback=function(t,e){return this.Er.addVideoDisplayDimensionsChangedCallback(t,e)};var w=null;return m}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5),i(3),i(2),i(10),i(22),i(33),i(36),i(97),i(13),i(7)],void 0===(r=function(a,o,u,c,h,f,n,i,r,t,s,d){"use strict";function l(t,e,i,n,r,s){this.$i=t,this.fa=e,this.cr=i,this.kr=n,this.f=r,this.Pt=s,this.Sr=[],this.Er=null,this.Xn=new u.NamedEvents,this.da=[],this.la=0,this.ma=null,this.g=new h.DisposableList,this.Pn=0,this.pa=a.get(r,["iceConnectionTimeout"],12e3),this.g.add(f.onForeground(a.bind(m,this)));var o=/(b=AS:([0-9]*)[\n\r]*)/gi.exec(i.remoteDescription);o&&3<=o.length&&(this.la=1e3*o[2]),a.addEventListener(i,"iceconnectionstatechange",a.bind(p,this))}function m(){if(this.ma){var t=this.ma;this.ma=null,t()}}function p(){var t=this,e=this.cr.iceConnectionState;switch(e){case"checking":case"connecting":if(a.re(this.va))return;this.ga=a.now(),this.va=setTimeout(function(){t.Pt.warn("[%s] Stream has not connected within [%s] ms",t.$i,t.pa),t.Xn.fire(d.streamEvents.playerError.name,["real-time",new Error("connection-timeout")])},t.pa);break;case"failed":a.re(this.va)&&(clearTimeout(this.va),this.va=null),this.Pt.info("[%s] Stream has failed",t.$i),this.Xn.fire(d.streamEvents.playerError.name,["real-time",new Error("connection-failed")]);break;case"closed":case"disconnected":a.re(this.va)&&t.Pt.warn("[%s] Stream closed before it was connected",t.$i);break;case"connected":a.re(this.va)&&(clearTimeout(this.va),this.va=null),this.Pn++,this.Pt.info("[%s] Ice Connection completed after [%s] ms for [%s] time",this.$i,a.now()-this.ga,this.Pn),this.ga=null;break;default:this.Pt.info("[%s] Unsupported Ice Connection state [%s]",this.$i,e)}}return l.prototype.on=function(t,e){this.Xn.listen(t,e)},l.prototype.createRenderer=function(){var i=this,e=new t(this.$i,this.fa,this.kr,this.f,this.Pt);return e.on(d.rendererEvents.error.name,function(t,e){i.Xn.fire(d.streamEvents.playerError.name,[t,e])}),e.on(d.rendererEvents.ended.name,function(t){i.Sr=a.filter(i.Sr,function(t){return t!==e}),0===i.Sr.length&&(i.kr.stop(),i.Xn.fire(d.streamEvents.playerEnded.name,[t]))}),this.Sr.push(e),e},l.prototype.select=function(t){o.Ct(t,"trackSelectCallback"),o.Ct(c.global.MediaStream,"rtc.global.MediaStream");for(var e=this.fa.getTracks(),i=new c.global.MediaStream,n=0;n<e.length;n++)t(e[n],n)&&i.addTrack(e[n]);if(0===i.getTracks().length)return this.Pt.warn("No tracks selected");var r=this,s=new l(this.$i,i,this.cr,this.kr,this.f,this.Pt);return s.on(d.streamEvents.stopped.name,function(t){var e;e=r.fa,a.reduce(e.getTracks(),function(t,e){return t&&(i=e,o.xt(i,"track"),"ended"===i.readyState);var i},!0)&&r.Xn.fire(d.streamEvents.stopped.name,[t])}),this.da.push(s),s},l.prototype.setStreamEndedCallback=function(t){o.Ct(t,"callback"),this.ya=t},l.prototype.setStreamErrorCallback=function(t){o.Ct(t,"callback"),this.wa=t},l.prototype.streamEndedCallback=function(t,e,i){a.forEach(this.da,function(t){t.streamEndedCallback(e,i)}),a.Ct(this.ya)&&this.ya(this,e,i)},l.prototype.streamErrorCallback=function(t,e,i){a.forEach(this.da,function(t){t.streamErrorCallback(e,i)}),a.Ct(this.wa)&&this.wa(t,e,i)},l.prototype.stop=function(t){var e;this.isActive()&&(this.g.dispose(),(e=this.fa)&&a.Ct(e.stop,"stream.stop")&&e.stop(),a.forEach(e&&e.getTracks?e.getTracks():[],function(t){t.stop()}),this.Pt.info("[%s] stop [real-time] media stream with reason [%s]",this.$i,t),this.Xn.fire(d.streamEvents.stopped.name,[t]),this.Tr=!0)},l.prototype.monitor=function(t,n){o.xt(t,"options"),o.Ct(n,"callback");var r=this,e=new i(r.$i,r.cr,r.Pt);return t.direction="inbound",e.start(t,function(){return r.isActive()},function t(e,i){return e&&r.Pt.warn("[%s] Media stream monitor triggered unrecoverable error [%s]",r.$i,e),s.isIOS()&&!f.isForeground()?(r.Pt.info("[%s] Media stream monitor triggered event while app is in the background. Waiting until foreground to trigger event.",r.$i),r.ma=t.bind(null,e,i)):(r.Pt.warn("[%s] Media stream triggered monitor condition for [%s] [%s]",r.$i,i.type,i.reasons),n(r,"client-side-failure",i))}),this.Ir=e},l.prototype.getMonitor=function(){return this.Ir},l.prototype.addBitRateThreshold=function(t,e){var i=this;return new r("Media Stream",this.Ir,function(){return i.la}).addThreshold(t,e)},l.prototype.getStream=function(){return this.fa},l.prototype.isActive=function(){return!this.Tr},l.prototype.getStreamId=function(){return this.$i},l.prototype.getStats=function(e){o.Ct(e,"callback"),this.Gn||(this.Gn={});var i=this;return c.getStats(this.cr,null,function(t){e(n.convertPeerConnectionStats(t,i.Gn))})},l.prototype.getRenderer=function(){return a.get(this.Sr,[0],null)},l}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(5),i(6),i(2),i(3),i(10),i(16),i(8),i(11),i(7),i(13)],void 0===(r=function(s,e,o,t,a,r,u,c,h,f,d,n){"use strict";var l=1e3,m=200;function i(t,e,i,n,r){this.Pt=r,this.$i=t,this.fa=e,this.kr=i,this.f=n,this.Ut=null,this.vt=null,this.Er=new f(r),this.Xn=new o.NamedEvents,this.g=new a.DisposableList,this.Js=new c(s.get(h,["navigator","userAgent"],"")).detect(),this.ba=!1,this.ka=0,this.Sa=0,this.g.add(u.onBackground(s.bind(g,this))),this.g.add(u.onForeground(s.bind(y,this))),this.Ea=s.bind(p,this),this.Qi=s.bind(v,this)}function p(t){var e=s.now()-this.ka<l;"pause"===t.type&&e&&(this.ba=!0),this.Sa=s.now(),this.Pt.info("[%s] Loading Phenix Real-Time stream player stalling caused by [%s] event.",this.$i,t.type)}function v(){this.Pt.info("[%s] Phenix Real-Time stream ended.",this.$i)}function g(){if(this.vt){var t=!1,e=s.now()-this.Sa<l;s.hn(this.vt.playing)?t=this.vt.playing:s.hn(this.vt.paused)&&(t=!this.vt.paused),!t&&e&&(t=!0),this.ba=t,this.ka=s.now()}}function y(){if(this.vt){var e=this;if(this.ka=0,this.Sa=0,this.ba){if(this.Pt.info("[%s] Resume playing after entering foreground [%s]",this.$i,this.Js.browser),"Safari"===this.Js.browser&&n.isIOS()){var t=function(){e.Pt.info("Rendered was paused after entering foreground"),e.Xn.fire(d.rendererEvents.failedToPlay.name,["paused-by-background"])};s.addEventListener(e.vt,"pause",t);var i=setTimeout(function(){s.removeEventListener(e.vt,"pause",t)},l);this.g.add(new a.Disposable(function(){clearTimeout(i)})),setTimeout(function(){e.vt.play().catch(function(t){e.Pt.info("[%s] Unable to resume playback after entering foreground",e.$i,t),e.vt.src="",e.Pt.info("[%s] (Re)starting renderer",e.$i),e.start(e.vt)})},m)}}else this.Pt.info("[%s] Entering foreground with paused renderer [%s]",this.$i,this.Js.browser)}}return i.prototype.on=function(t,e){if("userActionRequired"===t)throw new Error('"userActionRequired is no longer supported. See https://phenixrts.com/docs/web/#view-a-channel and https://phenixrts.com/docs/web/#channel-viewer');return this.Xn.listen(t,e)},i.prototype.start=function(e){var i=this,n=!!s.find(this.fa.getTracks(),function(t){return"audio"===t.kind});return this.f.canPlaybackAudio||(this.f.disableAudioIfNoOutputFound&&this.f.forcedAudioDisabled?this.Pt.warn("[%s] Missing audio playback device. Audio has been disabled on stream. Try setting up an audio device and re-subscribe in order to receive audio.",this.$i):!this.f.disableAudioIfNoOutputFound&&n&&this.Pt.warn("[%s] Missing audio playback device. May experience audio and/or video failure. Try setting up an audio device OR pass the [disableAudioIfNoOutputFound] option when subscribing to disable audio playback when no devices are attached.",this.$i)),this.vt=r.attachMediaStream(e,this.fa,function(t){if(t){if(e.muted||!n)return i.Pt.warn("[%s] Failed to play muted stream.",i.$i,t),i.Xn.fire(d.rendererEvents.failedToPlay.name,["failed-to-play"]);if(i.f.disableAutoMuting)return i.Pt.warn("[%s] Failed to play unmuted stream.",i.$i,t),i.Xn.fire(d.rendererEvents.failedToPlay.name,["failed-to-play-unmuted"]);i.Pt.debug("[%s] Failed to start playing stream. Auto muting the playback and trying again.",i.$i),e.muted=!0,i.vt=r.attachMediaStream(e,i.fa,function(t){if(t)return i.Pt.warn("[%s] Failed to play even after auto muting.",i.$i,t),e.muted=!1,i.Xn.fire(d.rendererEvents.failedToPlay.name,["failed-to-play"]);i.Pt.info("[%s] Successfully started playing stream after auto muting. User may manually unmute with user triggered action.",i.$i),i.Xn.fire(d.rendererEvents.autoMuted.name,["retry-play-muted"])})}else i.Pt.debug("[%s] Successfully started playing stream.",i.$i)}),this.g.add(this.kr.recordTimeToFirstFrame(e)),this.g.add(this.kr.recordRebuffering(e)),this.g.add(this.kr.recordVideoResolutionChanges(this,e)),this.g.add(this.kr.recordVideoPlayingAndPausing(e)),!1===this.f.receiveAudio&&(e.muted=!0),s.addEventListener(e,"stalled",this.Ea,!1),s.addEventListener(e,"pause",this.Ea,!1),s.addEventListener(e,"suspend",this.Ea,!1),s.addEventListener(e,"ended",this.Qi,!1),this.Er.start(this,e),e},i.prototype.stop=function(t){this.Er.stop(),this.g.dispose(),this.vt&&(s.removeEventListener(this.vt,"stalled",this.Ea,!1),s.removeEventListener(this.vt,"pause",this.Ea,!1),s.removeEventListener(this.vt,"suspend",this.Ea,!1),s.removeEventListener(this.vt,"ended",this.Qi,!1),s.Ct(this.vt.pause)&&this.vt.pause(),"Edge"===this.Js.browser&&(this.vt.src=""),this.vt.src&&("IE"===this.Js.browser?this.vt.src=null:this.vt.src=""),this.vt.srcObject&&(this.vt.srcObject=null),this.vt=null),this.Pt.info("[%s] Phenix real-time renderer has been destroyed",this.$i),this.Xn.fire(d.rendererEvents.ended.name,[t])},i.prototype.getStats=function(){if(!this.vt)return{width:0,height:0,currentTime:0,lag:0,networkState:d.networkStates.networkNoSource.id};var t=(s.now()-this.f.originStartTime)/1e3,e=this.f.networkLag/1e3;return{width:this.vt.videoWidth||this.vt.width,height:this.vt.videoHeight||this.vt.height,currentTime:t,lag:e,networkState:this.vt.networkState}},i.prototype.setDataQualityChangedCallback=function(t){e.Ct(t,"callback"),this.dataQualityChangedCallback=t},i.prototype.addVideoDisplayDimensionsChangedCallback=function(t,e){return this.Er.addVideoDisplayDimensionsChangedCallback(t,e)},i}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(39)],void 0===(r=function(i,t,r,c){"use strict";function e(t,e,i,n,r,s,o,a,u){this.init(t,e,i,n,r,s,o,a,u)}function s(){throw new Error("ImmutableRoom is Immutable")}function o(){throw new Error("Unable to subscribe to Immutable [ImmutableRoom]")}function h(t,e){i.isArray(t)?i.forEach(t,function(t){n(t,e)}):i.xt(t)&&i.forOwn(t,function(t){i.includes(e,t)||n(t,e)})}function n(t,e){var i,n;n=e,((i=t)instanceof r.Observable||i instanceof r.ObservableArray)&&(i.setValue=s,i.subscribe=o,h(i.getValue(),n)),h(t,e)}return e.prototype.init=function(t,e,i,n,r,s,o,a,u){this.Ds=new c(t,e,i,n,r,s,o,a,u),h(this.Ds,[t])},e.prototype.getRoomId=function(){return this.Ds.getRoomId()},e.prototype.getObservableAlias=function(){return this.Ds.getObservableAlias()},e.prototype.getObservableName=function(){return this.Ds.getObservableName()},e.prototype.getObservableDescription=function(){return this.Ds.getObservableDescription()},e.prototype.getObservableType=function(){return this.Ds.getObservableType()},e.prototype.getObservableMembers=function(){return this.Ds.getObservableMembers()},e.prototype.getObservableBridgeId=function(){return this.Ds.getObservableBridgeId()},e.prototype.getObservablePin=function(){return this.Ds.getObservablePin()},e.prototype.toString=function(){return this.Ds.toString()},e.prototype.toJson=function(){return this.Ds.toJson()},e.prototype.commitChanges=s,e.prototype.reload=s,e.prototype.an=s,e.prototype.Ar=s,e.prototype.Or=s,e.prototype.qr=s,e}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(2),i(100)],void 0===(r=function(s,e,i,n,r){"use strict";var o=100;function t(t){e.xt(t,"roomService"),e.xt(t.Nr,"roomService._pcast"),this.Kr=t,this.Ta=new i.ObservableArray([]),this.Ia=new i.Observable(null),this.g=new n.DisposableList,this.Ra=null,this.setPCast(t.Nr)}function a(t){t&&this.Ra===t.getRoomId()||(c.call(this),t&&u.call(this))}function u(){c.call(this),this.Ma=function(t){var n=this.Kr.getObservableActiveRoom().getValue().getRoomId();this.Ra=n;var r=this;return this.Ta.setValue([]),this.Ca.subscribeAndLoadMessages(n,t,function(t,e){if(t)throw t;if("ok"!==e.status)throw new Error("Unable to subscribe to room chat. Status ["+e.status+"]");var i=r.Ta.getValue();s.forEach(e.chatMessages,function(t){for(var e=i.length;0<e&&t.messageId<s.get(i,[e-1,"messageId"]);)e--;0===e&&0<i.length?r.Pt.info("[%] Ignoring message [%s]/[%s] prior to current chat history to prevent gaps.",n,t.messageId,t.timestamp):0<e&&s.get(i,[e-1,"messageId"])===t.messageId?r.Pt.info("[%] Ignoring duplicate message [%s]/[%s]",n,t.messageId,t.timestamp):(i.splice(e,0,t),r.Ia.setValue(t))}),i.length>o&&i.splice(0,i.length-o),r.Ta.setValue(i)})}.call(this,this.xa)}function c(){this.Ma&&this.Ma.dispose&&this.Ma.dispose()}return t.prototype.setPCast=function(t){e.xt(t,"pcast"),e.Ct(t.getLogger,"pcast.getLogger"),this.Nr=t,this.Pt=t.getLogger(),this.Ca?this.Ca.setPCast(t):this.Ca=new r(t)},t.prototype.getBatchSize=function(){return this.xa},t.prototype.start=function(t){this.xa=t||0,this.Ca.start(),function(){var t=this.Kr.getObservableActiveRoom().subscribe(s.bind(a,this));this.g.add(t)}.call(this),u.call(this)},t.prototype.stop=function(){this.Ca.stop(),c.call(this),this.g&&this.g.dispose()},t.prototype.getObservableChatMessages=function(){return this.Ta},t.prototype.getObservableLastChatMessage=function(){return this.Ia},t.prototype.getObservableChatEnabled=function(){return this.Ca.getObservableChatEnabled()},t.prototype.canSendMessage=function(){return this.Ca.canSendMessage()},t.prototype.sendMessageToRoom=function(t,e){var i=this.Kr.getObservableActiveRoom().getValue();if(!i)return e(new Error("Not in room"),null);var n=i.getRoomId(),r=this.Kr.Mr.getValue();if(!r)return e(new Error("No record for oneself"),null);var s=r.getObservableScreenName().getValue(),o=r.getObservableRole().getValue(),a=r.getLastUpdate();this.Ca.sendMessageToRoom(n,s,o,a,t,e)},t.prototype.getMessages=function(t,e,i,n){var r=this.Kr.getObservableActiveRoom().getValue().getRoomId();return this.Ca.getMessages(r,t,e,i,n)},t.prototype.toString=function(){return"RoomChatService"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(2),i(38)],void 0===(r=function(i,u,e,r,n){"use strict";function t(t){u.xt(t,"pcast"),u.Ct(t.getLogger,"pcast.getLogger"),u.Ct(t.getProtocol,"pcast.getProtocol"),this.Nr=t,this.Pt=t.getLogger(),this.Dn=t.getProtocol(),this.b=new e.Observable(!1),u.xt(this.Pt,"this._logger"),u.xt(this.Dn,"this._protocol"),this.Dr=new n(t)}function s(t){switch(u.xt(t,"event"),u.Nt(t.roomId,"event.roomId"),u.Nt(t.eventType,"event.eventType"),u.isArray(t.chatMessages,"event.chatMessages"),t.eventType){case"Message":this.Pt.debug("[%s] Room messages [%s]",t.roomId,t.chatMessages);var e=this.Pa[t.roomId];a(t.chatMessages),e&&e(null,{status:"ok",chatMessages:t.chatMessages});break;default:this.Pt.warn("Unsupported room conversation event [%s]",t.eventType)}}function o(t){}function c(){if(!this.b.getValue())throw new Error("ChatService not Enabled. Please start before performing actions.")}function a(t){i.forEach(t,function(t){var e;(e=t).timestamp&&(e.timestamp=i.utc(e.timestamp)),e.from&&(e.from.lastUpdate=i.utc(e.from.lastUpdate))})}return t.prototype.setPCast=function(t){u.xt(t,"pcast"),u.Ct(t.getLogger,"pcast.getLogger"),u.Ct(t.getProtocol,"pcast.getProtocol"),this.Nr=t,this.Pt=t.getLogger(),this.Dn=t.getProtocol(),this.Dr.setPCast(t)},t.prototype.start=function(){if(!this.b.getValue()){this.g=new r.DisposableList,this.Pa={},this.b.setValue(!0),function(){var t=this.Dr.getObservableStatus().subscribe(i.bind(o,this));this.g.add(t)}.call(this);var t=this.Dn.onEvent("chat.RoomConversationEvent",i.bind(s,this));this.g.add(t)}},t.prototype.stop=function(){this.b.getValue()&&(this.b.setValue(!1),this.g&&this.g.dispose())},t.prototype.getObservableChatEnabled=function(){return this.b},t.prototype.canSendMessage=function(){return this.Dr.checkAuthorized()},t.prototype.sendMessageToRoom=function(t,e,i,n,r,s){(function(t,e,i,n,r,s){u.Nt(t,"roomId"),u.Nt(e,"screenName"),u.Nt(i,"role"),u.re(n,"lastUpdate"),u.Nt(r,"message"),u.Ct(s,"callback"),c.call(this),this.Dr.assertAuthorized();var o={messageId:"",timestamp:0,from:{sessionId:this.Dr.getPCastSessionId(),screenName:e,role:i,lastUpdate:n},message:r};this.Pt.info("Send message to room [%s] from [%s]",t,e);var a=this;return this.Dn.sendMessageToRoom(t,o,function(t,e){if(t)return a.Pt.error("Send message to room failed with error [%s]",t),s(t,null);var i={status:e.status};"ok"!==e.status&&a.Pt.warn("Send message to room failed with status [%s]",e.status),s(null,i)})}).call(this,t,e,i,n,r,s)},t.prototype.subscribeAndLoadMessages=function(t,e,i){var n=function(t,e){var i=this;this.Pa[t]=e;var n=new r.Disposable(function(){i.Pa[t]===e&&delete i.Pa[t]});return this.g.add(n),n}.call(this,t,i);return function(r,t){u.Nt(r,"roomId"),u.re(t,"batchSize"),c.call(this),this.Dr.assertAuthorized();var e=this.Dr.getPCastSessionId();this.Pt.info("Subscribe to room [%s] conversation with batch size of [%s]",r,t);var s=this;this.Dn.subscribeToRoomConversation(e,r,t,function(t,e){var i=s.Pa[r];if(!i)return s.Pt.warn("No subscription callback set for room [%s]",r);if(t)return s.Pt.error("Subscribe to room conversation failed with error [%s]",t),i(t,null);var n={status:e.status};if("ok"!==e.status)return delete s.Pa[r],s.Pt.warn("Subscribe to room conversation failed with status [%s]",e.status),i(null,n);n.chatMessages=e.chatMessages,a(n.chatMessages),i(null,n)})}.call(this,t,e),n},t.prototype.getMessages=function(t,e,i,n,r){(function(t,e,i,n,r){u.Nt(t,"roomId"),u.Ct(r,"callback"),n&&i||u.re(e,"batchSize"),n&&u.Nt(n,"beforeMessageId"),i&&u.Nt(i,"afterMessageId"),c.call(this),this.Dr.assertAuthorized();var s=this.Dr.getPCastSessionId();this.Pt.info("Get messages from room [%s] conversation with batch size of [%s], after [%s], and before [%s]",t,e,i,n);var o=this;this.Dn.getMessages(s,t,e,i,n,function(t,e){if(t)return o.Pt.error("Get messages from room conversation failed with error [%s]",t),r(t,null);var i={status:e.status};if("ok"!==e.status)return o.Pt.warn("Get messages from room conversation failed with status [%s]",e.status),r(null,i);i.chatMessages=e.chatMessages,a(i.chatMessages),r(null,i)})}).call(this,t,e,i,n,r)},t.prototype.toString=function(){return"ChatService"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(18),i(21),i(32),i(102),i(104)],void 0===(r=function(i,r,n,s,o,a,u){"use strict";function t(t,e){r.isArray(t,"userMediaStreams"),e=e||{},this.in=e.uri||s.DefaultPCastUri,this.Pt=e.logger||n.createPCastLogger(this.in),this.ur=e.audioContext||new o,this.Da=this.ur.getNativeAudioContext(),this.Oa=null,this.Aa=t,this.qa=!i.xt(e.audioContext),this.Fa=new a(this.Pt),i.forEach(this.Aa,i.bind(c,this,e))}function c(t,e){r.xt(e,"stream"),r.xt(t,"options");var i=this.Fa.getAudioVolumeMeter(e);i.init(this.Da,t.alpha),i.connect(e)}function h(t,e){r.xt(e,"stream"),r.xt(t,"options");var i=this.Fa.getAudioVolumeMeter(e),n=new u(this.Pt);t.alpha&&i.setAlpha(t.alpha),n.onValue(this.Oa),n.startDetection(i,t)}return t.prototype.start=function(t,e){r.Ct(e,"callback"),this.Oa=e,t=t||{},i.forEach(this.Aa,i.bind(h,this,t))},t.prototype.stop=function(){i.forEach(this.getAudioVolumeMeters(),function(t){t.onValue(function(){})}),this.Oa=null},t.prototype.getAudioVolumeMeter=function(t){return r.xt(t,"stream"),this.Fa.getAudioVolumeMeter(t)},t.prototype.getAudioVolumeMeters=function(){return this.Fa.getAudioVolumeMeters()},t.prototype.dispose=function(){this.qa&&this.Da.close(),this.Fa.stopAllMeters(),this.Aa=null},t.prototype.toString=function(){return"AudioSpeakerDetector"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(103)],void 0===(r=function(t,e,i){"use strict";function n(t){e.xt(t,"logger"),this.Pt=t,this.Ua={}}return n.prototype.stopAllMeters=function(){t.forOwn(this.Ua,function(t){t.stop()})},n.prototype.getAudioVolumeMeter=function(t){return e.xt(t,"stream"),e.Nt(t.id,"streamId"),this.Ua[t.id]||(this.Ua[t.id]=new i(this.Pt)),this.Ua[t.id]},n.prototype.getAudioVolumeMeters=function(){return t.values(this.Ua)},n.prototype.toString=function(){return"AudioVolumeMeterFactory"},n}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(s,i){"use strict";function t(t){i.xt(t,"logger"),this.Pt=t}function n(t){for(var e=t.inputBuffer.getChannelData(0),i=0,n=0,r=0;r<e.length;r++)i+=e[r]*e[r],.99<Math.abs(e[r])&&n++;this.Na=Math.sqrt(i/e.length),this.ja=this.La*this.Na+(1-this.La)*this.ja,this._a=Math.max(this.Na,this.La*this.Na+(1-this.La)*this._a),this.Ba=n,this.za&&this.za.call(this,{date:s.now(),value:this.Na,smoothedValue:this.ja,smoothedPeakValue:this._a,clipped:this.Ba})}return t.prototype.init=function(t,e){i.xt(t,"context"),i.Ct(t.createScriptProcessor,"context.createScriptProcessor"),e=parseFloat(e||1/16),i.re(e,"alpha"),this.Wa=t,this.La=e,this.Na=0,this.ja=0,this._a=0,this.Ba=0,this.Va=t.createScriptProcessor(4096,1,1),s.addEventListener(this.Va,"audioprocess",s.bind(n,this))},t.prototype.onValue=function(t){this.za=t},t.prototype.getValue=function(){return this.Na},t.prototype.getSmoothedValue=function(){return this.ja},t.prototype.getSmoothedPeakValue=function(){return this._a},t.prototype.setAlpha=function(t){i.re(t,"alpha"),this.La=parseFloat(t)},t.prototype.connect=function(t){return function(t){i.xt(t,"stream"),0<t.getAudioTracks().length?(this.Ha=this.Wa.createMediaStreamSource(t),this.Ha.connect(this.Va),this.Va.connect(this.Wa.destination)):this.Pt.info("Stream has no audio tracks")}.call(this,t)},t.prototype.stop=function(){return function(){this.Ha&&this.Ha.disconnect(),this.Va.disconnect()}.call(this)},t.prototype.toString=function(){return"AudioVolumeMeter"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(d,l){"use strict";function t(t){l.xt(t,"logger"),this.Pt=t,this.init()}return t.prototype.init=function(){},t.prototype.onValue=function(t){this.za=t},t.prototype.startDetection=function(t,e){return function(s,t){l.xt(s,"audioVolumeMeter");var o=this,a=(t=t||{}).speakingHysteresisInterval||50,u=t.silenceHysteresisInterval||1500;l.re(a,"options.speakingHysteresisInterval"),l.re(u,"options.silenceHysteresisInterval");var c=!1,h=d.now()+a,f=d.now()+u;s.onValue(function(t){l.xt(s,"audioVolumeMeter"),l.re(t.date,"value.date"),l.re(t.value,"value.value"),l.re(t.smoothedValue,"value.smoothedValue"),l.re(t.smoothedPeakValue,"value.smoothedPeakValue"),l.re(t.clipped,"value.clipped");var e=.01<t.value&&t.value>2*t.smoothedValue&&t.value>.25*t.smoothedPeakValue,i=t.value>.8*t.smoothedValue,n=t.value<.5*t.smoothedValue,r=!e;(e||c&&i)&&h<t.date?(f=d.utc(t.date)+u,c||(c=!0,o.Pt.info("Speaking detected"),o.za&&o.za("speaking"))):(n||!c&&r)&&f<t.date&&(h=d.utc(t.date)+a,c&&(c=!1,o.Pt.info("Silence detected"),o.za&&o.za("silence")))})}.call(this,t,e)},t.prototype.toString=function(){return"AudioSpeakerDetection"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(18),i(21),i(106)],void 0===(r=function(i,n,r,s,o){"use strict";function t(t,e){n.isArray(t,"userMediaStreams"),e=e||{},this.in=e.uri||s.DefaultPCastUri,this.Pt=e.logger||r.createPCastLogger(this.in),this.Ga=[],this.Un=t}function a(t,e,i){var n=new o(i);n.connect(t,e),this.Ga.push(n)}return t.prototype.start=function(t,e){e=e||{},i.forEach(this.Un,i.bind(a,this,t,e))},t.prototype.stop=function(){i.forEach(this.Ga,function(t){t.close()}),this.Ga=[]},t.prototype.toString=function(){return"BandwidthMonitor"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(r,s){"use strict";function t(t){this.init(t)}function o(t,e){if(this.Ka&&this.Ka.dispose(),!e)return this.Ja.limitBandwidth(t);var i=e.getObservableMembers();this.Ka=i.subscribe(r.bind(n,this,t),{initial:"notify"})}function n(t,e){if(e.length!==this.Xa){this.Xa=e.length;var i=t/Math.max(1,this.Xa-1);this.Ja.limitBandwidth(i)}}return t.prototype.init=function(t){s.xt(t,"publisher"),this.Ja=t,this.Xa=0,this.Qa=null,this.Ka=null},t.prototype.connect=function(t,e){s.xt(t,"roomService"),e=e||{};var i=t.getObservableActiveRoom(),n=e.roomBandwidthLimit||5e6;this.Qa=i.subscribe(r.bind(o,this,n),{initial:"notify"})},t.prototype.close=function(){this.Qa&&this.Qa.dispose(),this.Ka&&this.Ka.dispose(),this.Qa=null,this.Ka=null},t.prototype.toString=function(){return"PublisherBandwidthAdjuster"},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1)],void 0===(r=function(l,n){"use strict";var m=[{"9x16":[{3840:2160},{1920:1080},{1366:768},{1280:720},{1024:576},{854:480},{640:360},{320:180}]},{"3x4":[{1600:1200},{1440:1080},{960:720},{800:600},{768:576},{640:480},{480:360},{352:288},{320:240},{176:144},{160:120}]},{"16x9":[{2160:3840},{1080:1920},{768:1366},{720:1280},{576:1024},{480:854},{360:640},{180:320}]},{"4x3":[{1200:1600},{1080:1440},{720:960},{600:800},{576:768},{480:640},{360:480},{288:352},{240:320},{144:176},{120:160}]}],r={fallbackToLower:{id:0,name:"fallbackToLower"},fallbackToHigher:{id:1,name:"fallbackToHigher"},fallbackToLowerThenHigher:{id:2,name:"fallbackToLowerThenHigher"},exact:{id:3,name:"exact"}};function t(t){n.xt(t,"options"),t.resolutionSelectionStrategy&&n.De(t.resolutionSelectionStrategy,r,"options.resolutionSelectionStrategy"),t.aspectRatio&&n.Nt(t.aspectRatio,"options.aspectRatio"),t.resolution&&n.re(t.resolution,"options.resolution"),t.frameRate&&n.re(t.frameRate,"options.frameRate"),this.$a=t.resolutionSelectionStrategy||r.fallbackToLowerThenHigher.name,this.Yr=t.aspectRatio||"16x9",this.Ya=parseInt(t.resolution,10)||720,this.Za=function(t,e){switch(n.Nt(t,"aspectRatio"),n.re(e,"resolution"),t){case"16x9":case"4x3":return e;case"9x16":return i(16/9*e);case"3x4":return i(4/3*e);default:throw new Error("Aspect Ratio not supported")}}.call(this,this.Yr,this.Ya),this.tu=t.frameRate||15}function i(t){return n.re(t,"value"),2*Math.floor((t+1)/2)}function s(t,e){var i,n,r,s,o=p(e,m),a=v(e,m),u=v(t.toString(),o),c=0===u,h=m.length-1===a;if(u<0){if((u=f(t,o))<0)return null}else{if(c)return h?null:(n=p(i=g(++a,m),m),(u=f(this.Za,n))<0?null:(r=g(u,o),s=this.calculateLongerDimensionByAspectRatio(r,i),{resolution:Math.min(r,s),aspectRatio:i,height:parseInt(r,10),width:parseInt(s,10)}));u--}return i=g(a,m),r=g(u,n=y(a,m)),s=n[u][r],{resolution:Math.min(r,s),aspectRatio:i,height:parseInt(r,10),width:s}}function o(t,e){var i,n,r,s,o,a,u=p(e,m),c=v(e,m),h=v(t.toString(),u),f=h===u.length-1,d=m.length-1===c;if(l.re(h)){if(f)return d?null:(i=g(++c,m),r=this.Za,s=this.calculateLongerDimensionByAspectRatio(r,i),{resolution:Math.min(r,s),aspectRatio:i,height:parseInt(r,10),width:parseInt(s,10)});h++}else if(o=t,a=u,!(h=l.keys(a[a.length-1])[0]>o?null:l.reduce(a,function(t,e,i){if(!t)return i;var n=l.keys(a[t])[0],r=l.keys(e)[0];return o<r?t:Math.abs(o-r)<Math.abs(o-n)?i:t})))return;return i=g(c,m),r=g(h,n=y(c,m)),s=n[h][r],{resolution:Math.min(r,s),aspectRatio:i,height:parseInt(r,10),width:parseInt(s,10)}}function p(e,t){var i=l.find(t,function(t){return t.hasOwnProperty(e)});return i?i[e]:null}function v(e,t){return l.findIndex(t,function(t){return t.hasOwnProperty(e)})}function g(t,e){return l.keys(e[t])[0]}function y(t,e){var i=l.keys(e[t]);return e[t][i[0]]}function f(s,o){return l.keys(o[0])[0]<s?-1:l.reduce(o,function(t,e,i){if(!t)return i;var n=l.keys(o[t])[0],r=l.keys(e)[0];return r<s?t:Math.abs(s-r)<Math.abs(s-n)?i:t})}return t.prototype.getDefaultResolution=function(){var t=this.calculateLongerDimensionByAspectRatio(this.Ya,this.Yr);switch(this.Yr){case"9x16":case"3x4":return{resolution:this.Ya,aspectRatio:this.Yr,height:t,width:this.Ya};case"16x9":case"4x3":default:return{resolution:this.Ya,aspectRatio:this.Yr,height:this.Ya,width:t}}},t.prototype.getDefaultFrameRate=function(){return this.tu},t.prototype.getNextResolution=function(t,e){switch(n.re(t,"height"),n.Nt(e,"aspectRatio"),this.$a){case r.fallbackToLower.name:return o.call(this,t,e);case r.fallbackToHigher.name:return s.call(this,t,e);case r.fallbackToLowerThenHigher.name:var i=null;return t>this.Za?i=s.call(this,t,e):(i=o.call(this,t,e))&&i.height||(i=s.call(this,this.Ya,this.Yr)),i;case r.exact.name:default:return}},t.prototype.canResolveNextResolution=function(){return this.$a!==r.exact.name},t.prototype.calculateLongerDimensionByAspectRatio=function(t,e){switch(e){case"16x9":case"9x16":return i(16/9*t);case"4x3":case"3x4":return i(4/3*t);default:throw new Error("Aspect Ratio not supported")}},t}.apply(e,n))||(t.exports=r)},function(t,e,i){var n;void 0===(n=function(){"use strict";return{errorSeverity:{recoverable:{id:1,name:"RECOVERABLE"},critical:{id:2,name:"CRITICAL"}}}}.apply(e,[]))||(t.exports=n)},function(t,e,i){var n,r;n=[i(0),i(1),i(4),i(2),i(45),i(110),i(47),i(46),i(23),i(15),i(14),i(24)],void 0===(r=function(w,n,t,e,i,r,s,o,a,u,b,c){"use strict";var h={reconnectOptions:{maxOfflineTime:864e5,maxReconnectFrequency:6e4}};function f(t){n.xt(t,"options"),t.roomExpress&&n.xt(t.roomExpress,"options.roomExpress"),this.eu=w.assign(w.clone(h),t),this.iu=t.roomExpress||new i(this.eu),this.nu=!t.roomExpress,this.Pt=this.iu.getPCastExpress().getPCast().getLogger()}function k(t,e,i){i&&w.hasIndexOrKey(i,"roomService")&&(i.channelService=i.roomService?new r(i.roomService):null,delete i.roomService),i&&w.hasIndexOrKey(i,"room")&&(i.channel=i.room?new s(i.room):null,delete i.room),t(e,i)}return f.prototype.dispose=function(){this.fs&&(this.fs.dispose(),this.fs=null),this.nu&&this.iu.dispose(),this.Pt.info("Disposed channel express instance")},f.prototype.getRoomExpress=function(){return this.iu},f.prototype.getPCastExpress=function(){return this.iu.getPCastExpress()},f.prototype.createChannel=function(t,e){n.xt(t,"options"),n.xt(t.channel,"options.channel");var i=w.assign({room:t.channel},t);i.room.type=u.types.channel.name,delete i.channel,this.iu.createRoom(i,w.bind(k,null,e))},f.prototype.joinChannel=function(h,s,f){n.xt(h,"options"),n.Ct(s,"joinChannelCallback"),n.Ct(f,"subscriberCallback"),h.videoElement&&n.xt(h.videoElement,"options.videoElement"),h.streamSelectionStrategy&&n.Nt(h.streamSelectionStrategy,"options.streamSelectionStrategy");var d,l,m,t=w.assign({type:u.types.channel.name,role:b.roles.audience.name},h),e=w.get(h,["failureCountForBanningAMember"]),i=w.get(h,["banMemberOnCapacityFailureCount"]),p=new o(h.streamSelectionStrategy,this.Pt,{failureCountForBanningAMember:e,banMemberOnCapacityFailureCount:i}),v="",g=this;t.channelId&&(t.roomId=t.channelId),delete t.channelId;var y=null;g.iu.joinRoom(t,function(t,e){var i=!e||w.assign({},e);if(g.fs&&(g.fs.dispose(),g.fs=null),e&&e.roomService){var n=e.roomService.leaveRoom,r=e.roomService.getObservableActiveRoom().getValue();m=e.roomService,v=r?r.getRoomId():"",g.Pt.info("Joined channel [%s] with [%s] selection strategy",v,p.getStrategy()),i.roomService.leaveRoom=function(t){d&&d.stop("leave-channel"),n(t)}}k(s,t,i)},function n(t,e){null!==y&&(g.Pt.info("[%s] Clearing backoff interval after member changed",v),clearTimeout(y),y=null),g.Pt.info("[%s] Members changed with status [%s]. Channel has [%s] active members.",v,e,t.length);var i=w.filter(t,function(t){return t.getObservableRole().getValue()===b.roles.presenter.name&&0<t.getObservableStreams().getValue().length}),r=p.getNext(i),s=r?r.getObservableStreams().getValue()[0]:null,o=s?s.getPCastStreamId():"";if(!s)return 0===i.length?(p.reset(),f(l=d=null,{status:"no-stream-playing"})):e?(g.Pt.info("Unable to find a new presenter to replace stream [%s] that ended in channel [%s] with status [%s] and [%s] black-listed members",l,v,e,p.getNumberOfMembersWithFailures()),l&&d&&d.isActive()&&d.stop("presenter-failure"),f(null,{status:e||"unable-to-recover"})):f(null,{status:"no-stream-playing"});if(!o)return g.Pt.info("Channel [%s] presenter has no stream",v),f(null,{status:"no-stream-playing"});if(l&&d)if(o===l){if(!e)return;g.Pt.info("[%s] Stream [%s] ended with status [%s], retrying",v,l,e),d.stop("same-presenter-failure")}else g.Pt.info("[%s] Stream [%s] ended with status [%s], failing over to stream [%s]",v,l,e,o),d.stop("change-presenter");function a(i){return null!==y&&(g.Pt.warn("[%s] Clearing backoff interval after triggering of another unexpected failure [%s]",v,i),clearTimeout(y),y=null),y=setTimeout(function(){y=null;var t=m?m.getObservableActiveRoom().getValue():null;if(t){var e=t.getObservableMembers().getValue();return n(e,i)}},"capacity"===i?5e3:100)}var u=w.assign({},{monitor:{callback:w.bind(function(t,e,i){if(l===t){if(e)return a("unable-to-subscribe");if("app-background"===i.reason)return f(e,i);if(i.retry&&"high-availability"!==p.getStrategy())return g.Pt.info("Retrying to subscribe to channel [%s] after stream [%s] failed with reason [%s]",v,t,i.status),i.retry();var n=w.get(i,["status"],"");if("ok"!==n){if("custom"===i.reason&&"client-side-failure"!==i.description)return f(e,i);switch(n){case"ended":case"origin-ended":case"origin-stream-ended":p.markDead();break;default:p.markFailed({failedDueToCapacity:"capacity"===n})}return g.Pt.info("[%s] Monitor subscriber reported status [%s]. Trying next member",t,n),a(n)}}else g.Pt.info("[%s] Ignore old channel subscriber monitor stream [%s]. Active stream is [%s]",v,t,l)},this,o),options:{conditionCountForNotificationThreshold:8}}},h),c=l?e?"recovered-from-failure":"stream-override":"stream-started";l=o,g.iu.subscribeToMemberStream(s,u,w.bind(function(t,e,i){if(l===t){var n=w.get(i,["status"],"");if("ok"===n&&(i.reason=c),e||"ok"!==n){switch(g.Pt.info("[%s] Issue with stream [%s]. Trying next member",t,n,e),n){case"unauthorized":case"not-found":case"ended":case"origin-not-found":case"origin-ended":case"origin-stream-ended":case"unsupported-features":p.markDead();break;default:p.markFailed({failedDueToCapacity:"capacity"===n})}return a(n)}d=i&&i.mediaStream?i.mediaStream:l=null,f(e,i)}else g.Pt.info("[%s] Ignore old media stream callback for stream [%s]. Active stream is [%s]",v,t,l)},this,o))})},f.prototype.publishToChannel=function(t,e){n.xt(t,"options"),n.Ct(e,"callback");var i=w.assign({memberRole:b.roles.presenter.name,streamType:c.types.presentation.name,room:t.channel},t);i.room.type=u.types.channel.name,delete i.channel,this.iu.publishToRoom(i,w.bind(k,null,e))},f.prototype.publishScreenToChannel=function(t,e){n.xt(t,"options"),n.Ct(e,"callback");var i=w.assign({memberRole:b.roles.presenter.name,streamType:c.types.presentation.name,room:t.channel},t);i.room.type=u.types.channel.name,delete i.channel,this.iu.publishScreenToRoom(i,w.bind(k,null,e))},f}.apply(e,n))||(t.exports=r)},function(t,e,i){var n,r;n=[i(0),i(1),i(47)],void 0===(r=function(n,r,s){"use strict";function t(t){r.xt(t,"roomService"),this.Kr=t}function o(t,e,i){return i&&i.room&&(i.channel=new s(i.room),delete i.room),t(e,i)}return t.prototype.start=function(){return this.Kr.start.apply(this.Kr,arguments)},t.prototype.getChannelInfo=function(t,e,i){return t?r.Nt(t,"channelId"):r.Nt(e,"alias"),r.Ct(i,"callback"),this.Kr.getRoomInfo(t,e,n.bind(o,null,i))},t.prototype.createChannel=function(t,e){return r.xt(t,"channel"),r.Nt(t.name,"channel.name"),r.Nt(t.type,"channel.type"),r.Yt(t.description,"channel.description"),r.Ct(e,"callback"),this.Kr.createRoom(t,n.bind(o,null,e))},t.prototype.enterChannel=function(t,e,i){return t?r.Nt(t,"roomId"):r.Nt(e,"alias"),r.Ct(i,"callback"),this.Kr.enterRoom(t,e,n.bind(o,null,i))},t.prototype.leaveChannel=function(){return this.Kr.leaveRoom.apply(this.Kr,arguments)},t.prototype.getChatService=function(){return this.Kr.getChatService.apply(this.Kr,arguments)},t.prototype.getSelf=function(){return this.Kr.getSelf.apply(this.Kr,arguments)},t.prototype.getObservableActiveChannel=function(){return this.Kr.getObservableActiveRoom.apply(this.Kr,arguments)},t.prototype.updateSelf=function(){return this.Kr.updateSelf.apply(this.Kr,arguments)},t.prototype.updateMember=function(){return this.Kr.updateMember.apply(this.Kr,arguments)},t.prototype.updateChannel=function(){return this.Kr.updateRoom.apply(this.Kr,arguments)},t.prototype.revertChannelChanges=function(){return this.Kr.revertRoomChanges.apply(this.Kr,arguments)},t.prototype.revertMemberChanges=function(){return this.Kr.revertMemberChanges.apply(this.Kr,arguments)},t.prototype.isInChannel=function(){return this.Kr.isInRoom.apply(this.Kr,arguments)},t.prototype.toString=function(){return"ChannelService"},t.prototype.stop=function(){return this.Kr.stop.apply(this.Kr,arguments)},t}.apply(e,n))||(t.exports=r)}],f.c=e,f.d=function(t,e,i){f.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},f.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},f.t=function(e,t){if(1&t&&(e=f(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(f.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)f.d(i,n,function(t){return e[t]}.bind(null,n));return i},f.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return f.d(e,"a",e),e},f.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},f.p="",f(f.s=48);function f(t){if(e[t])return e[t].exports;var i=e[t]={i:t,l:!1,exports:{}};return d[t].call(i.exports,i,i.exports,f),i.l=!0,i.exports}var d,e});